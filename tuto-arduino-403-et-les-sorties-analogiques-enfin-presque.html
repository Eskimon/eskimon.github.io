<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Et les sorties “analogiques”, enfin… presque ! &bull; Le blog d'Eskimon</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="./static/css/hljs-monokai.css" />
    <link rel="stylesheet" href="./static/css/style.css" />
    <!-- Google font -->
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="./static/images/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="57x57" href="./static/images/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="./static/images/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="./static/images/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="./static/images/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="./static/images/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="./static/images/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="./static/images/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./static/images/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./static/images/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="./static/images/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./static/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="./static/images/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./static/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="./static/images/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="./static/images/favicon/ms-icon-144x144.png">



    <meta name="tags" content="arduino" />
    <meta name="tags" content="tuto" />

  <meta property="og:site_name" content="Le blog d'Eskimon">
  <meta property="og:title" content="Et les sorties “analogiques”, enfin… presque !">
  <meta property="og:url" content="./tuto-arduino-403-et-les-sorties-analogiques-enfin-presque.html">
  <meta property="og:language" content="fr_FR">
  <meta property="og:type" content="website">

  <meta property="twitter:domain" content="./">
  <meta property="twitter:card" content="summary">
  <meta property="twitter:url" content="./tuto-arduino-403-et-les-sorties-analogiques-enfin-presque.html">
  <meta property="twitter:title" content="Et les sorties “analogiques”, enfin… presque !">
  <meta property="twitter:site" content="SITENAME">
  <meta property="twitter:creator" content="@eskimon_fr">

  <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
  <meta name="DC.publisher" lang="fr" content="Le blog d'Eskimon" />
  <meta name="DC.creator" content="Eskimon" />
  <meta name="DC.type" content="text" />
  <meta name="DC.title" content="Et les sorties “analogiques”, enfin… presque !" />
  <meta name="DC.abstract" content="Et les sorties “analogiques”, enfin… presque !" />
  <meta name="DC.subject" lang="fr" content="Arduino/Les grandeurs analogiques – arduino; tuto" />
  <meta name="DC.date" content="2010-12-03T10:20:00+01:00" />
  <meta name="DC.format" content="text/html" />
  <meta name="DC.language" content="fr" />
  <meta name="DC.rights" content="CC BY-NC-SA" />
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light bg-secondary-l40 py-0">
    <a class="navbar-brand" href=".">
        <img src="./static/images/logo.png" width="20" height="20" alt="">
        Le blog d'Eskimon
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav ml-auto">
                <a class="nav-item nav-link active" href="./category/arduino.html">Arduino</a>
                <a class="nav-item nav-link " href="./category/memo.html">Memo</a>
                <a class="nav-item nav-link " href="./category/tuto.html">Tuto</a>
                <a class="nav-item nav-link " href="./category/web.html">Web</a>
            <!--<a class="nav-item nav-link active" href="#">Home <span class="sr-only">(current)</span></a>-->
        </div>
    </div>
</nav>
<!--
    <div class="vh-100 m-0 p-0 ">
        <div class="wmax-1024 mx-auto my-0 py-0 text-justify">
            <div class="text-center">
                <a href="." class="text-dark no-decoration" >
                    <h1 class="logo-font text-center my-5 display-2 d-md-block d-none">Le blog d'Eskimon</h1>
                    <h2 class="logo-font text-center d-md-none my-5">Le blog d'Eskimon</h2>
                </a>
            </div>
        </div>
    </div>
-->
    <div class="container-fluid es-verticalfill">
<div class="row">
    <!-- Sidebar -->
    <div class="col-md-2 col-lg-2 d-none d-md-block sticky-top es-scrollable pt-3 px-1 bg-light es-ul-bordered" id="es-side-summary">
        <nav class="px-2" id="es-side-summary-content">
            <!-- Summary will come here -->
        </nav>
        <!-- Add here self-promo for ebook -->
        <!-- Add here adsense block -->
        <hr>
        <div id="es-side-summary-bot-annonce">
        </div>
    </div>
    <!-- Main content -->
    <div class="col-md-9 col-lg-7 offset-lg-1 d-block pt-3">
        <section>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb bg-white">
                    <li class="breadcrumb-item"><a href="./category/arduino.html">Arduino</a></li>
                        <li class="breadcrumb-item"><a href="./subcategory/arduino/les-grandeurs-analogiques.html">Les grandeurs analogiques</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Et les sorties “analogiques”, enfin… presque !</li>
                </ol>
            </nav>
            <header class="es-post-info">
                <h1 class="text-center my-4">Et les sorties “analogiques”, enfin… presque !</h1>
            </header>
            <footer class="es-post-info pb-2 mb-2">
                <div class="row align-items-center">
                    <div class="col-auto mr-auto">
                        <span class="vcard author">
                            <a class="" href="./author/eskimon.html">Eskimon</a>
                        </span>
                        ,
                        <time class="" datetime="2010-12-03T10:20:00+01:00">
                            le Fri 03 December 2010
                        </time>
                    </div>
                    <div class="col-auto">
                        <a class="btn btn-outline-primary btn-sm" href="./tag/arduino.html">arduino</a>
                        <a class="btn btn-outline-primary btn-sm" href="./tag/tuto.html">tuto</a>
                    </div>
                </div>
            </footer>

            <!-- /.post-info -->
            <div class="entry-content">
                <p>
 Vous vous souvenez du premier chapitre de cette partie ? Oui, lorsque je vous parlais de convertir une grandeur analogique (tension) en une donnée numérique. Eh bien là, il va s’agir de faire l’opération inverse. Comment ? C’est ce que nous allons voir. Je peux vous dire que ça à un rapport avec la PWM…
</p>
<h3 id="sommaire">
 <a aria-hidden="true" href="#sommaire">
  <span class="icon icon-link">
  </span>
 </a>
 Sommaire
</h3>
<ul>
 <li>
  <p>
   <a href="#convertir-des-données-binaires-en-signal-analogique">
    Convertir des données binaires en signal analogique
   </a>
  </p>
  <ul>
   <li>
    <a href="#convertisseur-numérique-analogique">
     Convertisseur Numérique-&gt;Analogique
    </a>
   </li>
   <li>
    <p>
     <a href="#pwm-ou-mli">
      PWM ou MLI
     </a>
    </p>
    <ul>
     <li>
      <a href="#définition">
       Définition
      </a>
     </li>
     <li>
      <a href="#la-fréquence-et-le-rapport-cyclique">
       La fréquence et le rapport cyclique
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#la-pwm-de-larduino">
    La PWM de l’Arduino
   </a>
  </p>
  <ul>
   <li>
    <p>
     <a href="#avant-de-commencer-à-programmer">
      Avant de commencer à programmer
     </a>
    </p>
    <ul>
     <li>
      <a href="#les-broches-de-la-pwm">
       Les broches de la PWM
      </a>
     </li>
     <li>
      <a href="#la-fréquence-de-la-pwm">
       La fréquence de la PWM
      </a>
     </li>
     <li>
      <a href="#la-fonction-analogwrite">
       La fonction analogWrite()
      </a>
     </li>
     <li>
      <a href="#utilisation">
       Utilisation
      </a>
     </li>
    </ul>
   </li>
   <li>
    <p>
     <a href="#quelques-outils-essentiels">
      Quelques outils essentiels
     </a>
    </p>
    <ul>
     <li>
      <a href="#la-led-rgb-ou-rvb">
       La LED RGB ou RVB
      </a>
     </li>
     <li>
      <a href="#mixer-les-couleurs">
       Mixer les couleurs
      </a>
     </li>
    </ul>
   </li>
   <li>
    <p>
     <a href="#À-vos-claviers-prêt-programmez">
      À vos claviers, prêt… programmez !
     </a>
    </p>
    <ul>
     <li>
      <a href="#lobjectif">
       L’objectif
      </a>
     </li>
     <li>
      <a href="#le-montage-à-réaliser">
       Le montage à réaliser
      </a>
     </li>
     <li>
      <a href="#correction">
       Correction
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#transformation-pwm---signal-analogique">
    Transformation PWM -&gt; signal analogique
   </a>
  </p>
  <ul>
   <li>
    <p>
     <a href="#la-valeur-moyenne-dun-signal">
      La valeur moyenne d’un signal
     </a>
    </p>
    <ul>
     <li>
      <a href="#le-signal-carré">
       Le signal carré
      </a>
     </li>
     <li>
      <a href="#explications">
       Explications
      </a>
     </li>
    </ul>
   </li>
   <li>
    <p>
     <a href="#extraire-cette-valeur-moyenne">
      Extraire cette valeur moyenne
     </a>
    </p>
    <ul>
     <li>
      <a href="#le-condensateur">
       Le condensateur
      </a>
     </li>
     <li>
      <a href="#le-couple-rc">
       Le couple RC
      </a>
     </li>
     <li>
      <a href="#explications-1">
       Explications
      </a>
     </li>
     <li>
      <a href="#imposons-notre-pwm">
       Imposons notre PWM !
      </a>
     </li>
     <li>
      <a href="#constante-de-temps-tau-supérieure-à-la-période">
       Constante de temps \tau supérieure à la période
      </a>
     </li>
    </ul>
   </li>
   <li>
    <p>
     <a href="#calibrer-correctement-la-constante-rc">
      Calibrer correctement la constante RC
     </a>
    </p>
    <ul>
     <li>
      <a href="#le-temps-de-stabilisation-entre-deux-paliers">
       Le temps de stabilisation entre deux paliers
      </a>
     </li>
     <li>
      <a href="#la-perte-de-temps-en-conversion">
       La perte de temps en conversion
      </a>
     </li>
     <li>
      <a href="#finalement-comment-calibrer-correctement-la-constante-rc">
       Finalement, comment calibrer correctement la constante RC ?
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#modifier-la-fréquence-de-la-pwm">
    Modifier la fréquence de la PWM
   </a>
  </p>
  <ul>
   <li>
    <ul>
     <li>
      <a href="#pourquoi-changer-la-fréquence-de-la-pwm">
       Pourquoi changer la fréquence de la PWM ?
      </a>
     </li>
     <li>
      <a href="#utilisation-du-registre">
       Utilisation du registre
      </a>
     </li>
     <li>
      <a href="#code-de-modification-de-la-fréquence-de-la-pwm">
       Code de modification de la fréquence de la PWM
      </a>
     </li>
     <li>
      <a href="#traduction-sil-vous-plait">
       Traduction s’il vous plait !
      </a>
     </li>
     <li>
      <a href="#test-de-vérification">
       Test de vérification
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<h3 id="convertir-des-données-binaires-en-signal-analogique">
 <a aria-hidden="true" href="#convertir-des-données-binaires-en-signal-analogique">
  <span class="icon icon-link">
  </span>
 </a>
 Convertir des données binaires en signal analogique
</h3>
<p>
 Je vais vous présenter deux méthodes possibles qui vont vous permettre de convertir des données numériques en grandeur analogique (je ne parlerai là encore de tension). Mais avant, plaçons-nous dans le contexte.
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Convertir du binaire en analogique, pour quoi faire ? C’est vrai, avec la conversion analogique-&gt;numérique il y avait une réelle utilité, mais là, qu’en est-il ?
  </p>
 </div>
</div>
<p>
 L’utilité est tout aussi pesante que pour la conversion A-&gt;N. Cependant, les applications sont différentes, à chaque outil un besoin dirais-je. En effet, la conversion A-&gt;N permettait de transformer une grandeur analogique non-utilisable directement par un système à base numérique en une donnée utilisable pour une application numérique.
</p>
<p>
 Ainsi, on a pu envoyer la valeur lue sur la liaison série. Quant à la conversion opposée, conversion N-&gt;A, les applications sont différentes, je vais en citer une plus ou moins intéressante : par exemple commander une, ou plusieurs, LED tricolore (Rouge-Vert-Bleu) pour créer un luminaire dont la couleur est commandée par le son (nécessite une entrée analogique
 <img alt=":-°" class="smiley" src="./static/smileys/siffle.png"/>
 ). Tiens, en voilà un projet intéressant ! Je vais me le garder sous la main…
 <img alt=":ninja:" class="smiley" src="./static/smileys/ninja.png"/>
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Alors ! alors ! alors !! Comment on fait !?
   <img alt=":D" class="smiley" src="./static/smileys/heureux.png"/>
  </p>
 </div>
</div>
<p>
 Serait-ce un léger soupçon de curiosité que je perçois dans vos yeux frétillants ?
 <img alt=":p" class="smiley" src="./static/smileys/langue.png"/>
 Comment fait-on ? Suivez -le guide !
</p>
<h4 id="convertisseur-numérique-analogique">
 <a aria-hidden="true" href="#convertisseur-numérique-analogique">
  <span class="icon icon-link">
  </span>
 </a>
 Convertisseur Numérique-&gt;Analogique
</h4>
<p>
 La première méthode consiste en l’utilisation d’un convertisseur Numérique-&gt;Analogique (que je vais abréger CNA). Il en existe, tout comme le CAN, de plusieurs sortes :
</p>
<ul>
 <li>
  <strong>
   CNA à résistances pondérées
  </strong>
  : ce convertisseur utilise un grand nombre de résistances qui ont chacune le double de la valeur de la résistance qui la précède. On a donc des résistances de valeur R, 2R, 4R, 8R, 16R, …, 256R, 512R, 1024R, etc. Chacune des résistances sera connectée grâce au micro-contrôleur à la masse ou bien au +5V. Ces niveaux logiques correspondent aux bits de données de la valeur numérique à convertir. Plus le bit est de poids fort, plus la résistance à laquelle il est adjoint est grande (maximum R). À l’inverse, plus il est de poids faible, plus il verra sa résistance de sortie de plus petite valeur. Après, grâce à un petit montage électronique, on arrive à créer une tension proportionnelle au nombre de bit à 1.
 </li>
 <li>
  <strong>
   CNA de type R/2R
  </strong>
  : là, chaque sortie du micro-contrôleur est reliée à une résistance de même valeur (2R), elle-même connectée au +5V par l’intermédiaire d’une résistance de valeur R. Toujours avec un petit montage, on arrive à créer une tension analogique proportionnelle au nombre de bit à 1.
 </li>
</ul>
<p>
 Cependant, je n’expliquerai pas le fonctionnement ni l’utilisation de ces convertisseurs car ils doivent être connectés à autant de broches du micro-contrôleur qu’ils ne doivent avoir de précision. Pour une conversion sur 10 bits, le convertisseur doit utiliser 10 sorties du microcontrôleur !
</p>
<h4 id="pwm-ou-mli">
 <a aria-hidden="true" href="#pwm-ou-mli">
  <span class="icon icon-link">
  </span>
 </a>
 PWM ou MLI
</h4>
<p>
 Bon, s’il n’y a pas moyen d’utiliser un CNA, alors on va
 <del>
  le créer
 </del>
 utiliser ce que peut nous fournir la carte Arduino : la
 <strong>
  PWM
 </strong>
 . Vous vous souvenez que j’ai évoqué ce terme dans le chapitre sur la conversion A-&gt;N ? Mais concrètement, c’est quoi ?
</p>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   Avant de poursuivre, je vous conseille d’aller
   <a href="https:// zestedesavoir.com/tutoriels/537/arduino-premiers-pas-en-informatique-embarquee/745/les-grandeurs-analogiques/3430/les-entrees-analogiques-de-larduino/#1-un-signal-analogique-petits-rappels">
    relire cette première partie
   </a>
   du chapitre sur les entrées analogiques pour revoir les rappels que j’ai faits sur les signaux analogiques.
   <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
  </p>
 </div>
</div>
<h5 id="définition">
 <a aria-hidden="true" href="#définition">
  <span class="icon icon-link">
  </span>
 </a>
 Définition
</h5>
<p>
 N’ayez point peur, je vais vous expliquer ce que c’est au lieu de vous donner une définition tordue comme on peut en trouver parfois dans les dictionnaires.
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
 D’abord, la PWM sa veut dire :
 <strong>
  Pulse Width Modulation
 </strong>
 et en français cela donne
 <strong>
  Modulation à Largeur d’Impulsion
 </strong>
 (MLI). La PWM est en fait un signal numérique qui, à une
 <strong>
  fréquence
 </strong>
 donnée, a un
 <strong>
  rapport cyclique
 </strong>
 qui change.
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Y’a plein de mots que je comprends pas, c’est normal ?
   <img alt="o_O" class="smiley" src="./static/smileys/blink.gif"/>
  </p>
 </div>
</div>
<p>
 Oui, car pour l’instant je n’en ai nullement parlé. Voilà donc notre prochain objectif.
</p>
<h5 id="la-fréquence-et-le-rapport-cyclique">
 <a aria-hidden="true" href="#la-fréquence-et-le-rapport-cyclique">
  <span class="icon icon-link">
  </span>
 </a>
 La fréquence et le rapport cyclique
</h5>
<p>
 La
 <em>
  fréquence
 </em>
 d’un signal périodique correspond au nombre de fois que la période se répète en UNE seconde. On la mesure en
 <strong>
  Hertz
 </strong>
 , noté
 <strong>
  Hz
 </strong>
 . Prenons l’exemple d’un signal logique qui émet un 1, puis un 0, puis un 1, puis un 0, etc. autrement dit un signal créneaux, on va mesurer sa période (en temps) entre le début du niveau 1 et la fin du niveau 0 :
</p>
<p>
 <img alt="Représentation d'une période" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/representation-dune-periode.png"/>
</p>
<p>
 Ensuite, lorsque l’on aura mesuré cette période, on va pouvoir calculer sa fréquence (le nombre de périodes en une seconde) grâce à la formule suivante :
</p>
<p>
 <span class="inlineMath inlineMathDouble">
  <span class="katex-display">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         F
        </mi>
        <mo>
         =
        </mo>
        <mfrac>
         <mn>
          1
         </mn>
         <mi>
          T
         </mi>
        </mfrac>
       </mrow>
       <annotation encoding="application/x-tex">
        F = \frac 1 T
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:1.32144em;">
     </span>
     <span class="strut bottom" style="height:2.00744em;vertical-align:-0.686em;">
     </span>
     <span class="base displaystyle textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.13889em;">
       F
      </span>
      <span class="mrel">
       =
      </span>
      <span class="mord reset-textstyle displaystyle textstyle uncramped">
       <span class="mopen sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter">
       </span>
       <span class="mfrac">
        <span class="vlist">
         <span style="top:0.686em;">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          <span class="reset-textstyle textstyle cramped">
           <span class="mord mathit" style="margin-right:0.13889em;">
            T
           </span>
          </span>
         </span>
         <span style="top:-0.22999999999999998em;">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          <span class="reset-textstyle textstyle uncramped frac-line">
          </span>
         </span>
         <span style="top:-0.677em;">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          <span class="reset-textstyle textstyle uncramped">
           <span class="mord mathrm">
            1
           </span>
          </span>
         </span>
         <span class="baseline-fix">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          ​
         </span>
        </span>
       </span>
       <span class="mclose sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter">
       </span>
      </span>
     </span>
    </span>
   </span>
  </span>
 </span>
</p>
<p>
 Avec :
</p>
<ul>
 <li>
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         F
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        F
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.13889em;">
       F
      </span>
     </span>
    </span>
   </span>
  </span>
  : fréquence du signal en Hertz (Hz)
 </li>
 <li>
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         T
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        T
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.13889em;">
       T
      </span>
     </span>
    </span>
   </span>
  </span>
  : temps de la période en seconde (s)
 </li>
</ul>
<p>
 Le
 <em>
  rapport cyclique
 </em>
 , un mot bien particulier pour désigner le fait que le niveau logique 1 peut ne pas durer le même temps que le niveau logique 0. C’est avec ça que tout repose le principe de la PWM. C’est-à-dire que la PWM est un signal de fréquence fixe qui a un rapport cyclique qui varie avec le temps suivant "les ordres qu’elle reçoit" (on reviendra dans un petit moment sur ces mots).
</p>
<p>
 Le rapport cyclique est mesuré en pourcentage (%). Plus le pourcentage est élevé, plus le niveau logique 1 est présent dans la période et moins le niveau logique 0 l’est. Et inversement. Le rapport cyclique du signal est donc le pourcentage de temps de la période durant lequel le signal est au niveau logique 1. En somme, cette image extraite de la
 <a href="http://arduino.cc/en/Tutorial/PWM">
  documentation officielle
 </a>
 d’Arduino nous montre quelques exemples d’un signal avec des rapports cycliques différents :
</p>
<p>
 <figure>
  <img alt="Des signaux aux rapports cycliques différents" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/des-signaux-aux-rapports-cycliques-differents.png"/>
  <figcaption>
   Des signaux aux rapports cycliques différents - (CC-BY-SA -
   <a href="http://arduino.cc/en/Tutorial/PWM">
    Timothy Hirzel
   </a>
   )
  </figcaption>
 </figure>
</p>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   Astuce : Rapport cyclique ce dit
   <strong>
    Duty Cycle
   </strong>
   en anglais.
  </p>
 </div>
</div>
<p>
 Ce n’est pas tout ! Après avoir généré ce signal, il va nous falloir le transformer en signal analogique. Et oui ! Pour l’instant ce signal est encore constitué d’états logiques, on va donc devoir le transformer en extrayant sa
 <em>
  valeur moyenne
 </em>
 … Je ne vous en dis pas plus, on verra plus bas ce que cela signifie.
</p>
<h3 id="la-pwm-de-larduino">
 <a aria-hidden="true" href="#la-pwm-de-larduino">
  <span class="icon icon-link">
  </span>
 </a>
 La PWM de l’Arduino
</h3>
<h4 id="avant-de-commencer-à-programmer">
 <a aria-hidden="true" href="#avant-de-commencer-à-programmer">
  <span class="icon icon-link">
  </span>
 </a>
 Avant de commencer à programmer
</h4>
<h5 id="les-broches-de-la-pwm">
 <a aria-hidden="true" href="#les-broches-de-la-pwm">
  <span class="icon icon-link">
  </span>
 </a>
 Les broches de la PWM
</h5>
<p>
 Sur votre carte Arduino, vous devriez disposer de 6 broches qui sont compatibles avec la génération d’une PWM. Elles sont repérées par le symbole
 <em>
  tilde
 </em>
 <strong>
  ~
 </strong>
 . Voici les broches générant une PWM : 3, 5, 6, 9, 10 et 11.
</p>
<h5 id="la-fréquence-de-la-pwm">
 <a aria-hidden="true" href="#la-fréquence-de-la-pwm">
  <span class="icon icon-link">
  </span>
 </a>
 La fréquence de la PWM
</h5>
<p>
 Cette fréquence, je le disais, est fixe, elle ne varie pas au cours du temps. Pour votre carte Arduino elle est de environ 490Hz.
</p>
<h5 id="la-fonction-analogwrite">
 <a aria-hidden="true" href="#la-fonction-analogwrite">
  <span class="icon icon-link">
  </span>
 </a>
 La fonction analogWrite()
</h5>
<p>
 Je pense que vous ne serez pas étonné si je vous dis que Arduino intègre une fonction toute prête pour utiliser la PWM ? Plus haut, je vous disais ceci :
</p>
<figure>
 <blockquote>
  <p>
   la PWM est un signal de fréquence fixe qui a un rapport cyclique qui varie avec le temps suivant "les ordres qu’elle reçoit"
  </p>
 </blockquote>
 <figcaption>
  Moi :P
 </figcaption>
</figure>
<p>
 C’est sur ce point que j’aimerais revenir un instant. En fait, les ordres dont je parle sont les paramètres passés dans la fonction qui génère la PWM. Ni plus ni moins. Étudions maintenant la fonction permettant de réaliser ce signal :
 <code>
  analogWrite()
 </code>
 . Elle prend deux arguments :
</p>
<ul>
 <li>
  Le premier est le numéro de la broche où l’on veut générer la PWM
 </li>
 <li>
  Le second argument représente la valeur du rapport cyclique à appliquer. Malheureusement on n’exprime pas cette valeur en pourcentage, mais avec un nombre entier compris entre 0 et 255
 </li>
</ul>
<p>
 Si le premier argument va de soi, le second mérite quelques précisions. Le rapport cyclique s’exprime de 0 à 100 % en temps normal. Cependant, dans cette fonction il s’exprimera de 0 à 255 (sur 8 bits). Ainsi, pour un rapport cyclique de 0% nous enverrons la valeur 0, pour un rapport de 50% on enverra 127 et pour 100% ce sera 255. Les autres valeurs sont bien entendu considérées de manière proportionnelle entre les deux. Il vous faudra faire un petit calcul pour savoir quel est le pourcentage du rapport cyclique plutôt que l’argument passé dans la fonction.
</p>
<h5 id="utilisation">
 <a aria-hidden="true" href="#utilisation">
  <span class="icon icon-link">
  </span>
 </a>
 Utilisation
</h5>
<p>
 Voilà un petit exemple de code illustrant tout ça :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-comment">// une sortie analogique sur la broche 6</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> sortieAnalogique = <span class="hljs-number">6</span>;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    pinMode(sortieAnalogique, OUTPUT);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// on met un rapport cyclique de 107/255 = 42 %</span>
    analogWrite(sortieAnalogique, <span class="hljs-number">107</span>);
}
</code></pre>
 </div>
 <figcaption>
  Exemple simple d’utilisation de la PWM
 </figcaption>
</figure>
<h4 id="quelques-outils-essentiels">
 <a aria-hidden="true" href="#quelques-outils-essentiels">
  <span class="icon icon-link">
  </span>
 </a>
 Quelques outils essentiels
</h4>
<p>
 Savez-vous que vous pouvez d’ores et déjà utiliser cette fonction pour allumer plus ou moins intensément une LED ? En effet, pour un rapport cyclique faible, la LED va se voir parcourir par un courant moins longtemps que lorsque le rapport cyclique est fort. Or, si elle est parcourue moins longtemps par le courant, elle s’éclairera également moins longtemps. En faisant varier le rapport cyclique, vous pouvez ainsi faire varier la luminosité de la LED.
</p>
<h5 id="la-led-rgb-ou-rvb">
 <a aria-hidden="true" href="#la-led-rgb-ou-rvb">
  <span class="icon icon-link">
  </span>
 </a>
 La LED RGB ou RVB
</h5>
<p>
 <strong>
  RGB
 </strong>
 pour Red-Green-Blue en anglais. Cette LED est composée de trois LED de couleurs précédemment énoncées. Elle possède donc 4 broches et existe sous deux modèles : à anode commune et à cathode commune. Exactement comme les afficheurs 7 segments. Choisissez-en une à
 <em>
  anode commune
 </em>
 .
</p>
<h5 id="mixer-les-couleurs">
 <a aria-hidden="true" href="#mixer-les-couleurs">
  <span class="icon icon-link">
  </span>
 </a>
 Mixer les couleurs
</h5>
<p>
 Lorsque l’on utilise des couleurs, il est bon d’avoir quelques bases en arts plastiques. Révisons les fondements. La lumière, peut-être ne le savez-vous pas, est composée de trois couleurs primaires qui sont :
</p>
<ul>
 <li>
  Le
  <strong>
   rouge
  </strong>
 </li>
 <li>
  Le
  <strong>
   vert
  </strong>
 </li>
 <li>
  Le
  <strong>
   bleu
  </strong>
 </li>
</ul>
<p>
 À partir de ces trois couleurs, il est possible de créer n’importe quelle autre couleur du spectre lumineux visible en mélangeant ces trois couleurs primaires entre elles. Par exemple, pour faire de l’orange on va mélanger du rouge (2/3 du volume final) et du vert (à 1/3 du volume final). Je vous le disais, la fonction analogWrite() prend un argument pour la PWM qui va de 0 à 255. Tout comme la proportion de couleur dans les logiciels de dessin ! On parle de "norme RGB" faisant référence aux trois couleurs primaires. Pour connaître les valeurs RGB d’une couleur, je vous propose de regarder avec le logiciel
 <strong>
  Gimp
 </strong>
 (gratuit et multiplateforme)
 <sup id="fnref-1">
  <a class="footnote-ref" href="#fn-1">
   1
  </a>
 </sup>
 . Pour cela, il suffit de deux observations/clics :
</p>
<ol>
 <li>
  Tout d’abord on sélectionne la "boîte à couleurs" dans la boîte à outils
 </li>
 <li>
  Ensuite, en jouant sur les valeurs R, G et B on peut voir la couleur obtenue
 </li>
</ol>
<p>
 <img alt="La boite à couleur de Gimp" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/la-boite-a-couleur-de-gimp.jpg"/>
</p>
<p>
 <img alt="Le ColorPicker de Gimp" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/le-colorpicker-de-gimp.jpg"/>
</p>
<p>
 Afin de faire des jolies couleurs, nous utiliserons analogWrite() trois fois (une pour chaque LED). Prenons tout de suite un exemple avec du
 <strong>
  orange
 </strong>
 et regardons sa composition sous Gimp :
</p>
<p>
 <img alt="La couleur orange avec Gimp" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/la-couleur-orange-avec-gimp.png"/>
</p>
<p>
 À partir de cette image nous pouvons voir qu’il faut :
</p>
<ul>
 <li>
  100 % de rouge (255)
 </li>
 <li>
  56 % de vert (144)
 </li>
 <li>
  0% de bleu (0)
 </li>
</ul>
<p>
 Nous allons donc pouvoir simplement utiliser ces valeurs pour faire une jolie couleur sur notre LED RGB :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ledRouge = <span class="hljs-number">11</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ledVerte =  <span class="hljs-number">9</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ledBleue = <span class="hljs-number">10</span>;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// on déclare les broches en sorties</span>
    pinMode(ledRouge, OUTPUT);
    pinMode(ledVerte, OUTPUT);
    pinMode(ledBleue, OUTPUT);

    <span class="hljs-comment">// on met la valeur de chaque couleur</span>
    analogWrite(ledRouge, <span class="hljs-number">255</span>);
    analogWrite(ledVerte, <span class="hljs-number">144</span>);
    analogWrite(ledBleue, <span class="hljs-number">0</span>);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// on ne change pas la couleur donc rien à faire dans la boucle principale</span>
}
</code></pre>
 </div>
 <figcaption>
  Utilisation d’une led RGB
 </figcaption>
</figure>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Moi j’obtiens pas du tout de l’orange ! Plutôt un bleu étrange…
  </p>
 </div>
</div>
<p>
 C’est exact. Souvenez-vous que c’est une LED à anode commune, or lorsqu’on met une tension de 5V en sortie du microcontrôleur, la LED sera éteinte. Les LED sont donc pilotées
 <strong>
  à l’état bas
 </strong>
 . Autrement dit, ce n’est pas la durée de l’état haut qui est importante mais plutôt celle de l’état bas. Afin de pallier cela, il va donc falloir mettre la valeur "inverse" de chaque couleur sur chaque broche en faisant l’opération
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        V
       </mi>
       <mi>
        a
       </mi>
       <mi>
        l
       </mi>
       <mi>
        e
       </mi>
       <mi>
        u
       </mi>
       <mi>
        r
       </mi>
       <mi>
        R
       </mi>
       <mi>
        e
       </mi>
       <mi>
        e
       </mi>
       <mi>
        l
       </mi>
       <mi>
        l
       </mi>
       <mi>
        e
       </mi>
       <mo>
        =
       </mo>
       <mn>
        2
       </mn>
       <mn>
        5
       </mn>
       <mn>
        5
       </mn>
       <mo>
        −
       </mo>
       <mi>
        V
       </mi>
       <mi>
        a
       </mi>
       <mi>
        l
       </mi>
       <mi>
        e
       </mi>
       <mi>
        u
       </mi>
       <mi>
        r
       </mi>
       <mi>
        T
       </mi>
       <mi>
        h
       </mi>
       <mi>
        e
       </mi>
       <mi>
        o
       </mi>
       <mi>
        r
       </mi>
       <mi>
        i
       </mi>
       <mi>
        q
       </mi>
       <mi>
        u
       </mi>
       <mi>
        e
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       ValeurReelle = 255 - ValeurTheorique
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.69444em;">
    </span>
    <span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.22222em;">
      V
     </span>
     <span class="mord mathit">
      a
     </span>
     <span class="mord mathit" style="margin-right:0.01968em;">
      l
     </span>
     <span class="mord mathit">
      e
     </span>
     <span class="mord mathit">
      u
     </span>
     <span class="mord mathit" style="margin-right:0.02778em;">
      r
     </span>
     <span class="mord mathit" style="margin-right:0.00773em;">
      R
     </span>
     <span class="mord mathit">
      e
     </span>
     <span class="mord mathit">
      e
     </span>
     <span class="mord mathit" style="margin-right:0.01968em;">
      l
     </span>
     <span class="mord mathit" style="margin-right:0.01968em;">
      l
     </span>
     <span class="mord mathit">
      e
     </span>
     <span class="mrel">
      =
     </span>
     <span class="mord mathrm">
      2
     </span>
     <span class="mord mathrm">
      5
     </span>
     <span class="mord mathrm">
      5
     </span>
     <span class="mbin">
      −
     </span>
     <span class="mord mathit" style="margin-right:0.22222em;">
      V
     </span>
     <span class="mord mathit">
      a
     </span>
     <span class="mord mathit" style="margin-right:0.01968em;">
      l
     </span>
     <span class="mord mathit">
      e
     </span>
     <span class="mord mathit">
      u
     </span>
     <span class="mord mathit" style="margin-right:0.02778em;">
      r
     </span>
     <span class="mord mathit" style="margin-right:0.13889em;">
      T
     </span>
     <span class="mord mathit">
      h
     </span>
     <span class="mord mathit">
      e
     </span>
     <span class="mord mathit">
      o
     </span>
     <span class="mord mathit" style="margin-right:0.02778em;">
      r
     </span>
     <span class="mord mathit">
      i
     </span>
     <span class="mord mathit" style="margin-right:0.03588em;">
      q
     </span>
     <span class="mord mathit">
      u
     </span>
     <span class="mord mathit">
      e
     </span>
    </span>
   </span>
  </span>
 </span>
 . Le code précédent devient donc :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ledRouge = <span class="hljs-number">11</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ledVerte =  <span class="hljs-number">9</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ledBleue = <span class="hljs-number">10</span>;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// on déclare les broches en sorties</span>
    pinMode(ledRouge, OUTPUT);
    pinMode(ledVerte, OUTPUT);
    pinMode(ledBleue, OUTPUT);

    <span class="hljs-comment">// on met la valeur de chaque couleur</span>
    analogWrite(ledRouge, <span class="hljs-number">255</span><span class="hljs-number">-255</span>);
    analogWrite(ledVerte, <span class="hljs-number">255</span><span class="hljs-number">-144</span>);
    analogWrite(ledBleue, <span class="hljs-number">255</span><span class="hljs-number">-0</span>);
}
</code></pre>
 </div>
 <figcaption>
  Utilisation d’une led RGB à anode commune
 </figcaption>
</figure>
<p>
 On en a fini avec les rappels, on va pouvoir commencer un petit exercice.
</p>
<h4 id="À-vos-claviers-prêt-programmez">
 <a aria-hidden="true" href="#À-vos-claviers-prêt-programmez">
  <span class="icon icon-link">
  </span>
 </a>
 À vos claviers, prêt… programmez !
</h4>
<h5 id="lobjectif">
 <a aria-hidden="true" href="#lobjectif">
  <span class="icon icon-link">
  </span>
 </a>
 L’objectif
</h5>
<p>
 L’objectif est assez simple, vous allez générer trois PWM différentes (une pour chaque LED de couleur) et créer 7 couleurs (le noir ne compte pas ! :P ) distinctes qui sont les suivantes :
</p>
<ul>
 <li>
  rouge
 </li>
 <li>
  vert
 </li>
 <li>
  bleu
 </li>
 <li>
  jaune
 </li>
 <li>
  bleu ciel
 </li>
 <li>
  violet
 </li>
 <li>
  blanc
 </li>
</ul>
<p>
 Ces couleurs devront "défiler" une par une (dans l’ordre que vous voudrez) toutes les 500ms.
</p>
<h5 id="le-montage-à-réaliser">
 <a aria-hidden="true" href="#le-montage-à-réaliser">
  <span class="icon icon-link">
  </span>
 </a>
 Le montage à réaliser
</h5>
<p>
 Vous allez peut-être être surpris car je vais utiliser pour le montage une LED à anode commune, afin de bien éclairer les LED avec la bonne proportion de couleur. Donc, lorsqu’il y aura la valeur 255 dans analogWrite(), la LED de couleur rouge, par exemple, sera complètement illuminée.
</p>
<p>
 <img alt="RGB schéma" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/rgb-schema.jpg"/>
</p>
<p>
 <img alt="RGB montage" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/rgb-montage.png"/>
</p>
<p>
 ** C’est parti !
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
 **
</p>
<h5 id="correction">
 <a aria-hidden="true" href="#correction">
  <span class="icon icon-link">
  </span>
 </a>
 Correction
</h5>
<p>
 Voilà le petit programme que j’ai fait pour répondre à l’objectif demandé :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-comment">// définition des broches utilisée (vous êtes libre de les changer)</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> led_verte = <span class="hljs-number">9</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> led_bleue = <span class="hljs-number">10</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> led_rouge = <span class="hljs-number">11</span>;

<span class="hljs-keyword">int</span> compteur_defilement = <span class="hljs-number">0</span>; <span class="hljs-comment">// variable permettant de changer de couleur</span>


<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// définition des broches en sortie</span>
    pinMode(led_rouge, OUTPUT);
    pinMode(led_verte, OUTPUT);
    pinMode(led_bleue, OUTPUT);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    couleur(compteur_defilement); <span class="hljs-comment">// appel de la fonction d'affichage</span>
    compteur_defilement++; <span class="hljs-comment">// incrémentation de la couleur à afficher</span>

    <span class="hljs-comment">// si le compteur dépasse 6 couleurs</span>
    <span class="hljs-keyword">if</span>(compteur_defilement&gt; <span class="hljs-number">6</span>)
        compteur_defilement = <span class="hljs-number">0</span>;

    delay(<span class="hljs-number">500</span>);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">couleur</span><span class="hljs-params">(<span class="hljs-keyword">int</span> numeroCouleur)</span>
</span>{
    <span class="hljs-keyword">switch</span>(numeroCouleur)
    {
    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span> : <span class="hljs-comment">// rouge</span>
        <span class="hljs-comment">// rapport cyclique au minimum pour une meilleure luminosité de la LED</span>
        analogWrite(led_rouge, <span class="hljs-number">0</span>);
        <span class="hljs-comment">// qui je le rappel est commandée en "inverse"</span>
        <span class="hljs-comment">// (0 -&gt; LED allumée ; 255 -&gt; LED éteinte)</span>
        analogWrite(led_verte, <span class="hljs-number">255</span>);
        analogWrite(led_bleue, <span class="hljs-number">255</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span> : <span class="hljs-comment">// vert</span>
        analogWrite(led_rouge, <span class="hljs-number">255</span>);
        analogWrite(led_verte, <span class="hljs-number">0</span>);
        analogWrite(led_bleue, <span class="hljs-number">255</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span> : <span class="hljs-comment">// bleu</span>
        analogWrite(led_rouge, <span class="hljs-number">255</span>);
        analogWrite(led_verte, <span class="hljs-number">255</span>);
        analogWrite(led_bleue, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span> : <span class="hljs-comment">// jaune</span>
        analogWrite(led_rouge, <span class="hljs-number">0</span>);
        analogWrite(led_verte, <span class="hljs-number">0</span>);
        analogWrite(led_bleue, <span class="hljs-number">255</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span> : <span class="hljs-comment">// violet</span>
        analogWrite(led_rouge, <span class="hljs-number">0</span>);
        analogWrite(led_verte, <span class="hljs-number">255</span>);
        analogWrite(led_bleue, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">5</span> : <span class="hljs-comment">// bleu ciel</span>
        analogWrite(led_rouge, <span class="hljs-number">255</span>);
        analogWrite(led_verte, <span class="hljs-number">0</span>);
        analogWrite(led_bleue, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span> : <span class="hljs-comment">// blanc</span>
        analogWrite(led_rouge, <span class="hljs-number">0</span>);
        analogWrite(led_verte, <span class="hljs-number">0</span>);
        analogWrite(led_bleue, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span> : <span class="hljs-comment">// "noir"</span>
        analogWrite(led_rouge, <span class="hljs-number">255</span>);
        analogWrite(led_verte, <span class="hljs-number">255</span>);
        analogWrite(led_bleue, <span class="hljs-number">255</span>);
        <span class="hljs-keyword">break</span>;
    }
}
</code></pre>
 </div>
 <figcaption>
  Exercice, affichage de plusieurs couleurs
 </figcaption>
</figure>
<p>
 Bon ben je vous laisse lire le code tout seul, vous êtes assez préparé pour le faire, du moins j’espère. Pendant ce temps je vais continuer la rédaction de ce chapitre.
 <img alt=":-°" class="smiley" src="./static/smileys/siffle.png"/>
</p>
<h3 id="transformation-pwm---signal-analogique">
 <a aria-hidden="true" href="#transformation-pwm---signal-analogique">
  <span class="icon icon-link">
  </span>
 </a>
 Transformation PWM -&gt; signal analogique
</h3>
<p>
 Bon, on est arrivé à modifier les couleurs d’une LED RGB juste avec des "impulsions", plus exactement en utilisant directement le signal PWM.
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Mais comment faire si je veux un signal complètement analogique ?
  </p>
 </div>
</div>
<p>
 C’est justement l’objet de cette sous-partie : créer un signal analogique à partir d’un signal numérique.
</p>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   Cependant, avant de continuer, je tiens à vous informer que l’on va aborder des notions plus profondes en électronique et que vous n’êtes pas obligé de lire cette sous-partie si vous ne vous en sentez pas capable. Revenez plus tard si vous le voulez. Pour ceux qui cela intéresserait vraiment, je ne peux que vous encourager à vous accrocher et éventuellement lire
   <a href="http://fr.openclassrooms.com/sciences/cours/l-electronique-de-zero/le-condensateur-en-regime-continu">
    ce chapitre
   </a>
   pour mieux comprendre certains points essentiels utilisés dans cette sous-partie.
  </p>
 </div>
</div>
<h4 id="la-valeur-moyenne-dun-signal">
 <a aria-hidden="true" href="#la-valeur-moyenne-dun-signal">
  <span class="icon icon-link">
  </span>
 </a>
 La valeur moyenne d’un signal
</h4>
<p>
 Sur une période d’un signal périodique, on peut calculer sa valeur moyenne. En fait, il faut faire une moyenne de toutes les valeurs que prend le signal pendant ce temps donné. C’est une peu lorsque l’on fait la moyenne des notes des élèves dans une classe, on additionne toutes les notes et on divise le résultat par le nombre total de notes. Je ne vais prendre qu’un seul exemple, celui dont nous avons besoin : le signal carré.
</p>
<h5 id="le-signal-carré">
 <a aria-hidden="true" href="#le-signal-carré">
  <span class="icon icon-link">
  </span>
 </a>
 Le signal carré
</h5>
<p>
 Reprenons notre signal carré :
</p>
<p>
 <img alt="Un signal carré" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/un-signal-carre.png"/>
</p>
<p>
 J’ai modifié un peu l’image pour vous faire apparaitre les temps. On observe donc que du temps
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mn>
        0
       </mn>
      </mrow>
      <annotation encoding="application/x-tex">
       0
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.64444em;">
    </span>
    <span class="strut bottom" style="height:0.64444em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathrm">
      0
     </span>
    </span>
   </span>
  </span>
 </span>
 (l’origine) au temps
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        T
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       T
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.13889em;">
      T
     </span>
    </span>
   </span>
  </span>
 </span>
 , on a une période du signal.
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        a
       </mi>
       <mi>
        T
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       aT
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit">
      a
     </span>
     <span class="mord mathit" style="margin-right:0.13889em;">
      T
     </span>
    </span>
   </span>
  </span>
 </span>
 correspond au moment où le signal change d’état. En somme, il s’agit du temps de l’état haut, qui donne aussi le temps à l’état bas et finalement permet de calculer le rapport cyclique du signal. Donnons quelques valeurs numériques à titre d’exemple :
</p>
<ul>
 <li>
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         T
        </mi>
        <mo>
         =
        </mo>
        <mn>
         1
        </mn>
        <mi>
         m
        </mi>
        <mi>
         s
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        T = 1ms
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.13889em;">
       T
      </span>
      <span class="mrel">
       =
      </span>
      <span class="mord mathrm">
       1
      </span>
      <span class="mord mathit">
       m
      </span>
      <span class="mord mathit">
       s
      </span>
     </span>
    </span>
   </span>
  </span>
 </li>
 <li>
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         a
        </mi>
        <mo>
         =
        </mo>
        <mn>
         0
        </mn>
        <mi mathvariant="normal">
         .
        </mi>
        <mn>
         5
        </mn>
       </mrow>
       <annotation encoding="application/x-tex">
        a = 0.5
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.64444em;">
     </span>
     <span class="strut bottom" style="height:0.64444em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit">
       a
      </span>
      <span class="mrel">
       =
      </span>
      <span class="mord mathrm">
       0
      </span>
      <span class="mord mathrm">
       .
      </span>
      <span class="mord mathrm">
       5
      </span>
     </span>
    </span>
   </span>
  </span>
  (correspond à un rapport cyclique de 50%)
 </li>
</ul>
<p>
 La formule permettant de calculer la valeur moyenne de cette période est la suivante :
</p>
<p>
 <span class="inlineMath inlineMathDouble">
  <span class="katex-display">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mo>
         ⟨
        </mo>
        <mi>
         U
        </mi>
        <mo>
         ⟩
        </mo>
        <mo>
         =
        </mo>
        <mfrac>
         <mrow>
          <msub>
           <mi>
            U
           </mi>
           <mn>
            1
           </mn>
          </msub>
          <mo>
           ×
          </mo>
          <mi>
           a
          </mi>
          <mi>
           T
          </mi>
          <mo>
           +
          </mo>
          <msub>
           <mi>
            U
           </mi>
           <mn>
            2
           </mn>
          </msub>
          <mo>
           ×
          </mo>
          <mo>
           (
          </mo>
          <mi>
           T
          </mi>
          <mo>
           −
          </mo>
          <mi>
           a
          </mi>
          <mi>
           T
          </mi>
          <mo>
           )
          </mo>
         </mrow>
         <mi>
          T
         </mi>
        </mfrac>
       </mrow>
       <annotation encoding="application/x-tex">
        \langle U \rangle = \frac{U_1 \times aT + U_2 \times (T - aT)}T
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:1.427em;">
     </span>
     <span class="strut bottom" style="height:2.113em;vertical-align:-0.686em;">
     </span>
     <span class="base displaystyle textstyle uncramped">
      <span class="mopen">
       ⟨
      </span>
      <span class="mord mathit" style="margin-right:0.10903em;">
       U
      </span>
      <span class="mclose">
       ⟩
      </span>
      <span class="mrel">
       =
      </span>
      <span class="mord reset-textstyle displaystyle textstyle uncramped">
       <span class="mopen sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter">
       </span>
       <span class="mfrac">
        <span class="vlist">
         <span style="top:0.686em;">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          <span class="reset-textstyle textstyle cramped">
           <span class="mord mathit" style="margin-right:0.13889em;">
            T
           </span>
          </span>
         </span>
         <span style="top:-0.22999999999999998em;">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          <span class="reset-textstyle textstyle uncramped frac-line">
          </span>
         </span>
         <span style="top:-0.677em;">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          <span class="reset-textstyle textstyle uncramped">
           <span class="mord textstyle uncramped">
            <span class="mord">
             <span class="mord mathit" style="margin-right:0.10903em;">
              U
             </span>
             <span class="msupsub">
              <span class="vlist">
               <span style="top:0.15em;margin-right:0.05em;margin-left:-0.10903em;">
                <span class="fontsize-ensurer reset-size5 size5">
                 <span style="font-size:0em;">
                  ​
                 </span>
                </span>
                <span class="reset-textstyle scriptstyle cramped mtight">
                 <span class="mord mathrm mtight">
                  1
                 </span>
                </span>
               </span>
               <span class="baseline-fix">
                <span class="fontsize-ensurer reset-size5 size5">
                 <span style="font-size:0em;">
                  ​
                 </span>
                </span>
                ​
               </span>
              </span>
             </span>
            </span>
            <span class="mbin">
             ×
            </span>
            <span class="mord mathit">
             a
            </span>
            <span class="mord mathit" style="margin-right:0.13889em;">
             T
            </span>
            <span class="mbin">
             +
            </span>
            <span class="mord">
             <span class="mord mathit" style="margin-right:0.10903em;">
              U
             </span>
             <span class="msupsub">
              <span class="vlist">
               <span style="top:0.15em;margin-right:0.05em;margin-left:-0.10903em;">
                <span class="fontsize-ensurer reset-size5 size5">
                 <span style="font-size:0em;">
                  ​
                 </span>
                </span>
                <span class="reset-textstyle scriptstyle cramped mtight">
                 <span class="mord mathrm mtight">
                  2
                 </span>
                </span>
               </span>
               <span class="baseline-fix">
                <span class="fontsize-ensurer reset-size5 size5">
                 <span style="font-size:0em;">
                  ​
                 </span>
                </span>
                ​
               </span>
              </span>
             </span>
            </span>
            <span class="mbin">
             ×
            </span>
            <span class="mopen">
             (
            </span>
            <span class="mord mathit" style="margin-right:0.13889em;">
             T
            </span>
            <span class="mbin">
             −
            </span>
            <span class="mord mathit">
             a
            </span>
            <span class="mord mathit" style="margin-right:0.13889em;">
             T
            </span>
            <span class="mclose">
             )
            </span>
           </span>
          </span>
         </span>
         <span class="baseline-fix">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          ​
         </span>
        </span>
       </span>
       <span class="mclose sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter">
       </span>
      </span>
     </span>
    </span>
   </span>
  </span>
 </span>
</p>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   La valeur moyenne d’un signal se note avec des chevrons &lt;, &gt; autour de la lettre indiquant de quelle grandeur physique il s’agit.
  </p>
 </div>
</div>
<h5 id="explications">
 <a aria-hidden="true" href="#explications">
  <span class="icon icon-link">
  </span>
 </a>
 Explications
</h5>
<p>
 Premièrement dans la formule, on calcule la tension du signal sur la première partie de la période, donc de
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mn>
        0
       </mn>
      </mrow>
      <annotation encoding="application/x-tex">
       0
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.64444em;">
    </span>
    <span class="strut bottom" style="height:0.64444em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathrm">
      0
     </span>
    </span>
   </span>
  </span>
 </span>
 à
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        a
       </mi>
       <mi>
        T
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       aT
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit">
      a
     </span>
     <span class="mord mathit" style="margin-right:0.13889em;">
      T
     </span>
    </span>
   </span>
  </span>
 </span>
 . Pour ce faire, on multiplie
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <msub>
        <mi>
         U
        </mi>
        <mn>
         1
        </mn>
       </msub>
      </mrow>
      <annotation encoding="application/x-tex">
       U_1
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord">
      <span class="mord mathit" style="margin-right:0.10903em;">
       U
      </span>
      <span class="msupsub">
       <span class="vlist">
        <span style="top:0.15em;margin-right:0.05em;margin-left:-0.10903em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord mathrm mtight">
           1
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
     </span>
    </span>
   </span>
  </span>
 </span>
 , qui est la tension du signal pendant cette période, par le temps de la première partie de la période, soit
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        a
       </mi>
       <mi>
        T
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       aT
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit">
      a
     </span>
     <span class="mord mathit" style="margin-right:0.13889em;">
      T
     </span>
    </span>
   </span>
  </span>
 </span>
 . Ce qui donne :
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <msub>
        <mi>
         U
        </mi>
        <mn>
         1
        </mn>
       </msub>
       <mo>
        ×
       </mo>
       <mi>
        a
       </mi>
       <mi>
        T
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       U_1 \times aT
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord">
      <span class="mord mathit" style="margin-right:0.10903em;">
       U
      </span>
      <span class="msupsub">
       <span class="vlist">
        <span style="top:0.15em;margin-right:0.05em;margin-left:-0.10903em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord mathrm mtight">
           1
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
     </span>
     <span class="mbin">
      ×
     </span>
     <span class="mord mathit">
      a
     </span>
     <span class="mord mathit" style="margin-right:0.13889em;">
      T
     </span>
    </span>
   </span>
  </span>
 </span>
 . Deuxièmement, on fait de même avec la deuxième partie du signal. On multiplie le temps de ce bout de période par la tension
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <msub>
        <mi>
         U
        </mi>
        <mn>
         2
        </mn>
       </msub>
      </mrow>
      <annotation encoding="application/x-tex">
       U_2
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord">
      <span class="mord mathit" style="margin-right:0.10903em;">
       U
      </span>
      <span class="msupsub">
       <span class="vlist">
        <span style="top:0.15em;margin-right:0.05em;margin-left:-0.10903em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord mathrm mtight">
           2
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
     </span>
    </span>
   </span>
  </span>
 </span>
 pendant ce temps. Ce temps vaut
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        T
       </mi>
       <mo>
        −
       </mo>
       <mi>
        a
       </mi>
       <mi>
        T
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       T - aT
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.76666em;vertical-align:-0.08333em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.13889em;">
      T
     </span>
     <span class="mbin">
      −
     </span>
     <span class="mord mathit">
      a
     </span>
     <span class="mord mathit" style="margin-right:0.13889em;">
      T
     </span>
    </span>
   </span>
  </span>
 </span>
 . Le résultat donne alors :
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <msub>
        <mi>
         U
        </mi>
        <mn>
         2
        </mn>
       </msub>
       <mo>
        ×
       </mo>
       <mo>
        (
       </mo>
       <mi>
        T
       </mi>
       <mo>
        −
       </mo>
       <mi>
        a
       </mi>
       <mi>
        T
       </mi>
       <mo>
        )
       </mo>
      </mrow>
      <annotation encoding="application/x-tex">
       U_2 \times (T - aT)
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.75em;">
    </span>
    <span class="strut bottom" style="height:1em;vertical-align:-0.25em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord">
      <span class="mord mathit" style="margin-right:0.10903em;">
       U
      </span>
      <span class="msupsub">
       <span class="vlist">
        <span style="top:0.15em;margin-right:0.05em;margin-left:-0.10903em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord mathrm mtight">
           2
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
     </span>
     <span class="mbin">
      ×
     </span>
     <span class="mopen">
      (
     </span>
     <span class="mord mathit" style="margin-right:0.13889em;">
      T
     </span>
     <span class="mbin">
      −
     </span>
     <span class="mord mathit">
      a
     </span>
     <span class="mord mathit" style="margin-right:0.13889em;">
      T
     </span>
     <span class="mclose">
      )
     </span>
    </span>
   </span>
  </span>
 </span>
 Finalement, on divise le tout par le temps total de la période après avoir additionné les deux résultats précédents. Après simplification, la formule devient :
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mo>
        ⟨
       </mo>
       <mi>
        U
       </mi>
       <mo>
        ⟩
       </mo>
       <mo>
        =
       </mo>
       <mi>
        a
       </mi>
       <mo>
        ×
       </mo>
       <msub>
        <mi>
         U
        </mi>
        <mn>
         1
        </mn>
       </msub>
       <mo>
        +
       </mo>
       <msub>
        <mi>
         U
        </mi>
        <mn>
         2
        </mn>
       </msub>
       <mo>
        −
       </mo>
       <mi>
        a
       </mi>
       <mo>
        ×
       </mo>
       <msub>
        <mi>
         U
        </mi>
        <mn>
         2
        </mn>
       </msub>
      </mrow>
      <annotation encoding="application/x-tex">
       \langle U \rangle = a \times U_1 + U_2 - a \times U_2
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.75em;">
    </span>
    <span class="strut bottom" style="height:1em;vertical-align:-0.25em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mopen">
      ⟨
     </span>
     <span class="mord mathit" style="margin-right:0.10903em;">
      U
     </span>
     <span class="mclose">
      ⟩
     </span>
     <span class="mrel">
      =
     </span>
     <span class="mord mathit">
      a
     </span>
     <span class="mbin">
      ×
     </span>
     <span class="mord">
      <span class="mord mathit" style="margin-right:0.10903em;">
       U
      </span>
      <span class="msupsub">
       <span class="vlist">
        <span style="top:0.15em;margin-right:0.05em;margin-left:-0.10903em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord mathrm mtight">
           1
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
     </span>
     <span class="mbin">
      +
     </span>
     <span class="mord">
      <span class="mord mathit" style="margin-right:0.10903em;">
       U
      </span>
      <span class="msupsub">
       <span class="vlist">
        <span style="top:0.15em;margin-right:0.05em;margin-left:-0.10903em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord mathrm mtight">
           2
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
     </span>
     <span class="mbin">
      −
     </span>
     <span class="mord mathit">
      a
     </span>
     <span class="mbin">
      ×
     </span>
     <span class="mord">
      <span class="mord mathit" style="margin-right:0.10903em;">
       U
      </span>
      <span class="msupsub">
       <span class="vlist">
        <span style="top:0.15em;margin-right:0.05em;margin-left:-0.10903em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord mathrm mtight">
           2
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
     </span>
    </span>
   </span>
  </span>
 </span>
 Et cela se simplifie encore en :
</p>
<p>
 <span class="inlineMath inlineMathDouble">
  <span class="katex-display">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mo>
         ⟨
        </mo>
        <mi>
         U
        </mi>
        <mo>
         ⟩
        </mo>
        <mo>
         =
        </mo>
        <mi>
         a
        </mi>
        <mo>
         ×
        </mo>
        <mo>
         (
        </mo>
        <msub>
         <mi>
          U
         </mi>
         <mn>
          1
         </mn>
        </msub>
        <mo>
         −
        </mo>
        <msub>
         <mi>
          U
         </mi>
         <mn>
          2
         </mn>
        </msub>
        <mo>
         )
        </mo>
        <mo>
         +
        </mo>
        <msub>
         <mi>
          U
         </mi>
         <mn>
          2
         </mn>
        </msub>
       </mrow>
       <annotation encoding="application/x-tex">
        \langle U \rangle = a \times (U_1 - U_2) + U_2
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.75em;">
     </span>
     <span class="strut bottom" style="height:1em;vertical-align:-0.25em;">
     </span>
     <span class="base displaystyle textstyle uncramped">
      <span class="mopen">
       ⟨
      </span>
      <span class="mord mathit" style="margin-right:0.10903em;">
       U
      </span>
      <span class="mclose">
       ⟩
      </span>
      <span class="mrel">
       =
      </span>
      <span class="mord mathit">
       a
      </span>
      <span class="mbin">
       ×
      </span>
      <span class="mopen">
       (
      </span>
      <span class="mord">
       <span class="mord mathit" style="margin-right:0.10903em;">
        U
       </span>
       <span class="msupsub">
        <span class="vlist">
         <span style="top:0.15em;margin-right:0.05em;margin-left:-0.10903em;">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          <span class="reset-textstyle scriptstyle cramped mtight">
           <span class="mord mathrm mtight">
            1
           </span>
          </span>
         </span>
         <span class="baseline-fix">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          ​
         </span>
        </span>
       </span>
      </span>
      <span class="mbin">
       −
      </span>
      <span class="mord">
       <span class="mord mathit" style="margin-right:0.10903em;">
        U
       </span>
       <span class="msupsub">
        <span class="vlist">
         <span style="top:0.15em;margin-right:0.05em;margin-left:-0.10903em;">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          <span class="reset-textstyle scriptstyle cramped mtight">
           <span class="mord mathrm mtight">
            2
           </span>
          </span>
         </span>
         <span class="baseline-fix">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          ​
         </span>
        </span>
       </span>
      </span>
      <span class="mclose">
       )
      </span>
      <span class="mbin">
       +
      </span>
      <span class="mord">
       <span class="mord mathit" style="margin-right:0.10903em;">
        U
       </span>
       <span class="msupsub">
        <span class="vlist">
         <span style="top:0.15em;margin-right:0.05em;margin-left:-0.10903em;">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          <span class="reset-textstyle scriptstyle cramped mtight">
           <span class="mord mathrm mtight">
            2
           </span>
          </span>
         </span>
         <span class="baseline-fix">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          ​
         </span>
        </span>
       </span>
      </span>
     </span>
    </span>
   </span>
  </span>
 </span>
</p>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   Dans notre cas, comme il s’agit d’un signal carré ayant que deux valeurs : 0V et 5V, on va pouvoir simplifier le calcul par celui-ci :
   <span class="inlineMath">
    <span class="katex">
     <span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mo>
          ⟨
         </mo>
         <mi>
          U
         </mi>
         <mo>
          ⟩
         </mo>
         <mo>
          =
         </mo>
         <mi>
          a
         </mi>
         <mo>
          ×
         </mo>
         <msub>
          <mi>
           U
          </mi>
          <mn>
           1
          </mn>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         \langle U \rangle = a \times U_1
        </annotation>
       </semantics>
      </math>
     </span>
     <span aria-hidden="true" class="katex-html">
      <span class="strut" style="height:0.75em;">
      </span>
      <span class="strut bottom" style="height:1em;vertical-align:-0.25em;">
      </span>
      <span class="base textstyle uncramped">
       <span class="mopen">
        ⟨
       </span>
       <span class="mord mathit" style="margin-right:0.10903em;">
        U
       </span>
       <span class="mclose">
        ⟩
       </span>
       <span class="mrel">
        =
       </span>
       <span class="mord mathit">
        a
       </span>
       <span class="mbin">
        ×
       </span>
       <span class="mord">
        <span class="mord mathit" style="margin-right:0.10903em;">
         U
        </span>
        <span class="msupsub">
         <span class="vlist">
          <span style="top:0.15em;margin-right:0.05em;margin-left:-0.10903em;">
           <span class="fontsize-ensurer reset-size5 size5">
            <span style="font-size:0em;">
             ​
            </span>
           </span>
           <span class="reset-textstyle scriptstyle cramped mtight">
            <span class="mord mathrm mtight">
             1
            </span>
           </span>
          </span>
          <span class="baseline-fix">
           <span class="fontsize-ensurer reset-size5 size5">
            <span style="font-size:0em;">
             ​
            </span>
           </span>
           ​
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
    </span>
   </span>
   ,car
   <span class="inlineMath">
    <span class="katex">
     <span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           U
          </mi>
          <mn>
           2
          </mn>
         </msub>
         <mo>
          =
         </mo>
         <mn>
          0
         </mn>
        </mrow>
        <annotation encoding="application/x-tex">
         U_2 = 0
        </annotation>
       </semantics>
      </math>
     </span>
     <span aria-hidden="true" class="katex-html">
      <span class="strut" style="height:0.68333em;">
      </span>
      <span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;">
      </span>
      <span class="base textstyle uncramped">
       <span class="mord">
        <span class="mord mathit" style="margin-right:0.10903em;">
         U
        </span>
        <span class="msupsub">
         <span class="vlist">
          <span style="top:0.15em;margin-right:0.05em;margin-left:-0.10903em;">
           <span class="fontsize-ensurer reset-size5 size5">
            <span style="font-size:0em;">
             ​
            </span>
           </span>
           <span class="reset-textstyle scriptstyle cramped mtight">
            <span class="mord mathrm mtight">
             2
            </span>
           </span>
          </span>
          <span class="baseline-fix">
           <span class="fontsize-ensurer reset-size5 size5">
            <span style="font-size:0em;">
             ​
            </span>
           </span>
           ​
          </span>
         </span>
        </span>
       </span>
       <span class="mrel">
        =
       </span>
       <span class="mord mathrm">
        0
       </span>
      </span>
     </span>
    </span>
   </span>
  </p>
 </div>
</div>
<div class="custom-block alert alert-danger">
 <div class="custom-block-body">
  <p>
   Les formules que l’on vient d’apprendre ne s’appliquent que pour
   <strong>
    une seule
   </strong>
   période du signal. Si le signal a toujours la même période et le même rapport cyclique alors le résultat de la formule est admissible à l’ensemble du signal. En revanche, si le signal a un rapport cyclique qui varie au cours du temps, alors le résultat donné par la formule n’est valable que pour un rapport cyclique donné. Il faudra donc calculer la valeur moyenne pour chaque rapport cyclique que possède le signal.
  </p>
 </div>
</div>
<p>
 De ce fait, si on modifie le rapport cyclique de la PWM de façon maitrisée, on va pouvoir créer un signal analogique de la forme qu’on le souhaite, compris entre 0 et 5V, en extrayant la valeur moyenne du signal. On retiendra également que,
 <strong>
  dans cette formule uniquement
 </strong>
 , le temps n’a pas d’importance.
</p>
<h4 id="extraire-cette-valeur-moyenne">
 <a aria-hidden="true" href="#extraire-cette-valeur-moyenne">
  <span class="icon icon-link">
  </span>
 </a>
 Extraire cette valeur moyenne
</h4>
<p>
 Alors, mais comment faire pour extraire la valeur moyenne du signal de la PWM, me direz-vous. Eh bien on va utiliser les propriétés d’un certain couple de composants très connu : le
 <strong>
  couple RC
 </strong>
 ou
 <strong>
  résistance-condensateur
 </strong>
 .
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   La résistance on connait, mais, le condensateur… tu nous avais pas dit qu’il servait à supprimer les parasites ?
   <img alt="o_O" class="smiley" src="./static/smileys/blink.gif"/>
  </p>
 </div>
</div>
<p>
 Si, bien sûr, mais il possède plein de caractéristiques intéressantes. C’est pour cela que c’est un des composants les plus utilisé en électronique. Cette fois, je vais vous montrer une de ses caractéristiques qui va nous permettre d’extraire cette fameuse valeur moyenne.
</p>
<h5 id="le-condensateur">
 <a aria-hidden="true" href="#le-condensateur">
  <span class="icon icon-link">
  </span>
 </a>
 Le condensateur
</h5>
<p>
 Je vous ai déjà parlé de la résistance, vous savez qu’elle limite le courant suivant la loi d’Ohm. Je vous ai aussi parlé du condensateur, je vous disais qu’il absorbait les parasites créés lors d’un appui sur un bouton poussoir. À présent, on va voir un peu plus en profondeur son fonctionnement car on est loin d’avoir tout vu ! Le condensateur, je rappel ses symboles :
 <img alt="Symbole des condensateurs polarisés" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/symbole-des-condensateurs-polarises.jpg"/>
 est constitué de deux plaques métalliques, des
 <strong>
  armatures
 </strong>
 , posées face à face et isolées par… un isolant ! :P Donc, en somme le condensateur
 <strong>
  est équivalent
 </strong>
 à un interrupteur ouvert puisqu’il n’y a pas de courant qui peut passer entre les deux armatures. Chaque armature sera mise à un potentiel électrique. Il peut être égal sur les deux armatures, mais l’utilisation majoritaire fait que les deux armatures ont un potentiel différent.
</p>
<h5 id="le-couple-rc">
 <a aria-hidden="true" href="#le-couple-rc">
  <span class="icon icon-link">
  </span>
 </a>
 Le couple RC
</h5>
<p>
 Bon, et maintenant ? Maintenant on va faire un petit montage électrique,vous pouvez le faire si vous voulez, non en fait faites-le vous comprendrez mes explications en même temps que vous ferez l’expérience qui va suivre. Voilà le montage à réaliser :
</p>
<p>
 <img alt="Un couple RC en action" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/un-couple-rc-en-action.jpg"/>
</p>
<p>
 Les valeurs des composants sont :
</p>
<ul>
 <li>
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         U
        </mi>
        <mo>
         =
        </mo>
        <mn>
         5
        </mn>
        <mi>
         V
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        U = 5V
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.10903em;">
       U
      </span>
      <span class="mrel">
       =
      </span>
      <span class="mord mathrm">
       5
      </span>
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
     </span>
    </span>
   </span>
  </span>
  (utilisez la tension 5V fournie par votre carte Arduino)
 </li>
 <li>
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         C
        </mi>
        <mo>
         =
        </mo>
        <mn>
         1
        </mn>
        <mn>
         0
        </mn>
        <mn>
         0
        </mn>
        <mn>
         0
        </mn>
        <mi>
         μ
        </mi>
        <mi>
         F
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        C = 1000 \mu F
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.8777699999999999em;vertical-align:-0.19444em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.07153em;">
       C
      </span>
      <span class="mrel">
       =
      </span>
      <span class="mord mathrm">
       1
      </span>
      <span class="mord mathrm">
       0
      </span>
      <span class="mord mathrm">
       0
      </span>
      <span class="mord mathrm">
       0
      </span>
      <span class="mord mathit">
       μ
      </span>
      <span class="mord mathit" style="margin-right:0.13889em;">
       F
      </span>
     </span>
    </span>
   </span>
  </span>
 </li>
 <li>
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <msub>
         <mi>
          R
         </mi>
         <mrow>
          <mi>
           c
          </mi>
          <mi>
           h
          </mi>
          <mi>
           a
          </mi>
          <mi>
           r
          </mi>
          <mi>
           g
          </mi>
          <mi>
           e
          </mi>
         </mrow>
        </msub>
        <mo>
         =
        </mo>
        <mn>
         1
        </mn>
        <mi>
         k
        </mi>
        <mi mathvariant="normal">
         Ω
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        R_{charge} = 1k\Omega
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.69444em;">
     </span>
     <span class="strut bottom" style="height:0.980548em;vertical-align:-0.286108em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord">
       <span class="mord mathit" style="margin-right:0.00773em;">
        R
       </span>
       <span class="msupsub">
        <span class="vlist">
         <span style="top:0.15em;margin-right:0.05em;margin-left:-0.00773em;">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          <span class="reset-textstyle scriptstyle cramped mtight">
           <span class="mord scriptstyle cramped mtight">
            <span class="mord mathit mtight">
             c
            </span>
            <span class="mord mathit mtight">
             h
            </span>
            <span class="mord mathit mtight">
             a
            </span>
            <span class="mord mathit mtight" style="margin-right:0.02778em;">
             r
            </span>
            <span class="mord mathit mtight" style="margin-right:0.03588em;">
             g
            </span>
            <span class="mord mathit mtight">
             e
            </span>
           </span>
          </span>
         </span>
         <span class="baseline-fix">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          ​
         </span>
        </span>
       </span>
      </span>
      <span class="mrel">
       =
      </span>
      <span class="mord mathrm">
       1
      </span>
      <span class="mord mathit" style="margin-right:0.03148em;">
       k
      </span>
      <span class="mord mathrm">
       Ω
      </span>
     </span>
    </span>
   </span>
  </span>
 </li>
 <li>
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <msub>
         <mi>
          R
         </mi>
         <mrow>
          <mi>
           d
          </mi>
          <mi>
           e
          </mi>
          <mi>
           c
          </mi>
          <mi>
           h
          </mi>
          <mi>
           a
          </mi>
          <mi>
           r
          </mi>
          <mi>
           g
          </mi>
          <mi>
           e
          </mi>
         </mrow>
        </msub>
        <mo>
         =
        </mo>
        <mn>
         1
        </mn>
        <mi>
         k
        </mi>
        <mi mathvariant="normal">
         Ω
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        R_{decharge} = 1k\Omega
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.69444em;">
     </span>
     <span class="strut bottom" style="height:0.980548em;vertical-align:-0.286108em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord">
       <span class="mord mathit" style="margin-right:0.00773em;">
        R
       </span>
       <span class="msupsub">
        <span class="vlist">
         <span style="top:0.15em;margin-right:0.05em;margin-left:-0.00773em;">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          <span class="reset-textstyle scriptstyle cramped mtight">
           <span class="mord scriptstyle cramped mtight">
            <span class="mord mathit mtight">
             d
            </span>
            <span class="mord mathit mtight">
             e
            </span>
            <span class="mord mathit mtight">
             c
            </span>
            <span class="mord mathit mtight">
             h
            </span>
            <span class="mord mathit mtight">
             a
            </span>
            <span class="mord mathit mtight" style="margin-right:0.02778em;">
             r
            </span>
            <span class="mord mathit mtight" style="margin-right:0.03588em;">
             g
            </span>
            <span class="mord mathit mtight">
             e
            </span>
           </span>
          </span>
         </span>
         <span class="baseline-fix">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          ​
         </span>
        </span>
       </span>
      </span>
      <span class="mrel">
       =
      </span>
      <span class="mord mathrm">
       1
      </span>
      <span class="mord mathit" style="margin-right:0.03148em;">
       k
      </span>
      <span class="mord mathrm">
       Ω
      </span>
     </span>
    </span>
   </span>
  </span>
 </li>
</ul>
<p>
 Le montage est terminé ? Alors fermez l’interrupteur…
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Que se passe-t-il ?
  </p>
 </div>
</div>
<p>
 Lorsque vous fermez l’interrupteur, le courant peut s’établir dans le circuit. Il va donc aller allumer la LED. Ceci fait abstraction du condensateur. Mais, justement, dans ce montage il y a un condensateur. Qu’observez-vous ? La LED ne s’allume pas immédiatement et met un peu de temps avant d’être complètement allumée. Ouvrez l’interrupteur. Et là, qu’y a-t-il de nouveau ? En théorie, la LED devrait être éteinte, cependant, le condensateur fait des siennes. On voit la LED s’éteindre tout doucement et pendant plus longtemps que lorsqu’elle s’allumait. Troublant, n’est-ce pas ?
 <img alt=":D" class="smiley" src="./static/smileys/heureux.png"/>
</p>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   Vous pouvez réitérer l’expérience en changeant la valeur des composants, sans jamais descendre en dessous de 220 Ohm pour la résistance de décharge.
  </p>
 </div>
</div>
<h5 id="explications-1">
 <a aria-hidden="true" href="#explications-1">
  <span class="icon icon-link">
  </span>
 </a>
 Explications
</h5>
<p>
 Je vais vous expliquer ce phénomène assez étrange. Vous l’aurez sans doute deviné, c’est le condensateur qui joue le premier rôle ! En fait, lorsque l’on applique un potentiel différent sur chaque armature, le condensateur n’aime pas trop ça. Je ne dis pas que ça risque de l’endommager, simplement qu’il n’aime pas ça, comme si vous on vous forçait à manger quelque chose que vous n’aimez pas. Du coup, lorsqu’on lui applique une tension de 5V sur une des ses armatures et l’autre armature est reliée à la masse, il met du temps à accepter la tension. Et plus la tension croit, moins il aime ça et plus il met du temps à l’accepter. Si on regarde la tension aux bornes de ce pauvre condensateur, on peut observer ceci :
</p>
<p>
 <img alt="La courbe de charge d'un condensateur" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/la-courbe-de-charge-dun-condensateur.jpg"/>
</p>
<p>
 La tension augmente d’abord très rapidement, puis de moins en moins rapidement aux bornes du condensateur lorsqu’on le
 <strong>
  charge
 </strong>
 à travers une résistance. Oui, on appelle ça la
 <strong>
  charge
 </strong>
 du condensateur. C’est un peu comme si la résistance donnait un mauvais goût à la tension et plus la résistance est grande, plus le goût est horrible et moins le condensateur se charge vite. C’est l’explication de pourquoi la LED s’est éclairée lentement. Lorsque l’on ouvre l’interrupteur, il se passe le phénomène inverse. Là, le condensateur peut se débarrasser de ce mauvais goût qu’il a accumulé, sauf que la résistance et la LED l’en empêchent. Il met donc du temps à se
 <strong>
  décharger
 </strong>
 et la LED s’éteint doucement :
</p>
<p>
 <img alt="La courbe de décharge d'un condensateur" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/la-courbe-de-decharge-dun-condensateur.jpg"/>
</p>
<p>
 Pour terminer, on peut déterminer le temps de charge et de décharge du condensateur à partir d’un paramètre très simple, que voici :
</p>
<p>
 <span class="inlineMath inlineMathDouble">
  <span class="katex-display">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         τ
        </mi>
        <mo>
         =
        </mo>
        <mi>
         R
        </mi>
        <mo>
         ×
        </mo>
        <mi>
         C
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        \tau = R \times C
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.76666em;vertical-align:-0.08333em;">
     </span>
     <span class="base displaystyle textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.1132em;">
       τ
      </span>
      <span class="mrel">
       =
      </span>
      <span class="mord mathit" style="margin-right:0.00773em;">
       R
      </span>
      <span class="mbin">
       ×
      </span>
      <span class="mord mathit" style="margin-right:0.07153em;">
       C
      </span>
     </span>
    </span>
   </span>
  </span>
 </span>
</p>
<p>
 Avec :
</p>
<ul>
 <li>
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         τ
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        \tau
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.43056em;">
     </span>
     <span class="strut bottom" style="height:0.43056em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.1132em;">
       τ
      </span>
     </span>
    </span>
   </span>
  </span>
  : (prononcez "to") temps de charge/décharge en secondes (s)
 </li>
 <li>
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         R
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        R
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.00773em;">
       R
      </span>
     </span>
    </span>
   </span>
  </span>
  : valeur de la résistance en Ohm (
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi mathvariant="normal">
         Ω
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        \Omega
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathrm">
       Ω
      </span>
     </span>
    </span>
   </span>
  </span>
  )
 </li>
 <li>
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         C
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        C
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.07153em;">
       C
      </span>
     </span>
    </span>
   </span>
  </span>
  : valeur de la capacité du condensateur en Farad (F)
 </li>
</ul>
<p>
 Cette formule donne le temps
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        τ
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       \tau
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.43056em;">
    </span>
    <span class="strut bottom" style="height:0.43056em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.1132em;">
      τ
     </span>
    </span>
   </span>
  </span>
 </span>
 qui correspond à 63% de la charge à la tension appliquée au condensateur. On considère que le condensateur est complètement chargé à partir de
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mn>
        3
       </mn>
       <mi>
        τ
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       3 \tau
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.64444em;">
    </span>
    <span class="strut bottom" style="height:0.64444em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathrm">
      3
     </span>
     <span class="mord mathit" style="margin-right:0.1132em;">
      τ
     </span>
    </span>
   </span>
  </span>
 </span>
 (soit 95% de la tension de charge) ou
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mn>
        5
       </mn>
       <mi>
        τ
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       5\tau
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.64444em;">
    </span>
    <span class="strut bottom" style="height:0.64444em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathrm">
      5
     </span>
     <span class="mord mathit" style="margin-right:0.1132em;">
      τ
     </span>
    </span>
   </span>
  </span>
 </span>
 (99% de la tension de charge).
</p>
<h5 id="imposons-notre-pwm">
 <a aria-hidden="true" href="#imposons-notre-pwm">
  <span class="icon icon-link">
  </span>
 </a>
 Imposons notre PWM !
</h5>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Bon, très bien, mais quel est le rapport avec la PWM ?
  </p>
 </div>
</div>
<p>
 Ha, haa ! Alors, pour commencer, vous connaissez la réponse.
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Depuis quand ?
   <img alt="o_O" class="smiley" src="./static/smileys/blink.gif"/>
  </p>
 </div>
</div>
<p>
 Depuis que je vous ai donné les explications précédentes. Dès que l’on aura imposé notre PWM au couple RC, il va se passer quelque chose. Quelque chose que je viens de vous expliquer. À chaque fois que le signal de la PWM sera au NL 1 (Niveau Logique 1), le condensateur va se charger. Dès que le signal repasse au NL 0, le condensateur va se décharger. Et ainsi de suite. En somme, cela donne une variation de tension aux bornes du condensateur semblable à celle-ci :
</p>
<p>
 <img alt="Charge et décharge successive" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/charge-et-decharge-successive.jpg"/>
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Qu’y a-t-il de nouveau par rapport au signal carré, à part sa forme bizarroïde !?
  </p>
 </div>
</div>
<p>
 Dans ce cas, rien de plus, si on calcule la valeur moyenne du signal bleu, on trouvera la même valeur que pour le signal rouge. (Ne me demandez pas pourquoi, c’est comme ça, c’est une formule très compliquée qui le dit :P ). Précisons que dans ce cas, encore une fois, le temps de charge/décharge
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mn>
        3
       </mn>
       <mi>
        τ
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       3\tau
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.64444em;">
    </span>
    <span class="strut bottom" style="height:0.64444em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathrm">
      3
     </span>
     <span class="mord mathit" style="margin-right:0.1132em;">
      τ
     </span>
    </span>
   </span>
  </span>
 </span>
 du condensateur est choisi de façon à ce qu’il soit égal à une demi-période du signal. Que se passera-t-il si on choisit un temps de charge/décharge plus petit ou plus grand ?
</p>
<h5 id="constante-de-temps-tau-supérieure-à-la-période">
 <a aria-hidden="true" href="#constante-de-temps-tau-supérieure-à-la-période">
  <span class="icon icon-link">
  </span>
 </a>
 Constante de temps
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        τ
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       \tau
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.43056em;">
    </span>
    <span class="strut bottom" style="height:0.43056em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.1132em;">
      τ
     </span>
    </span>
   </span>
  </span>
 </span>
 supérieure à la période
</h5>
<p>
 Voilà le chronogramme lorsque la constante de temps de charge/décharge du condensateur est plus grande que la période du signal :
</p>
<p>
 <img alt="Charge et décharge successive" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/charge-et-decharge-successive.png"/>
</p>
<p>
 Ce chronogramme permet d’observer un phénomène intéressant. En effet, on voit que la tension aux bornes du condensateur n’atteint plus le +5V et le 0V comme au chronogramme précédent. Le couple RC étant plus grand que précédemment, le condensateur met plus de temps à se charger, du coup, comme le signal "va plus vite" que le condensateur, ce dernier ne peut se charger/décharger complètement. Si on continue d’augmenter la valeur résultante du couple RC, on va arriver à un signal comme ceci :
</p>
<p>
 <img alt="Charge et décharge successive" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/charge-et-decharge-successive.png"/>
</p>
<p>
 Et ce signal, Mesdames et Messieurs, c’est la valeur moyenne du signal de la PWM !!
 <img alt=":D" class="smiley" src="./static/smileys/heureux.png"/>
</p>
<h4 id="calibrer-correctement-la-constante-rc">
 <a aria-hidden="true" href="#calibrer-correctement-la-constante-rc">
  <span class="icon icon-link">
  </span>
 </a>
 Calibrer correctement la constante RC
</h4>
<p>
 Je vous sens venir avec vos grands airs en me disant : "
 <em>
  Oui, mais là le signal il est pas du tout constant pour un niveau de tension. Il arrête pas de bouger et monter descendre ! Comment on fait si on veut une belle droite ?
 </em>
 " "
 <em>
  Eh bien
 </em>
 , dirais-je,
 <em>
  cela n’est pas impossible, mais se révèle être une tâche difficile et contraignante. Plusieurs arguments viennent conforter mes dires
 </em>
 ".
</p>
<h5 id="le-temps-de-stabilisation-entre-deux-paliers">
 <a aria-hidden="true" href="#le-temps-de-stabilisation-entre-deux-paliers">
  <span class="icon icon-link">
  </span>
 </a>
 Le temps de stabilisation entre deux paliers
</h5>
<p>
 Je vais vous montrer un chronogramme qui représente le signal PWM avec deux rapports cycliques différents. Vous allez pouvoir observer un phénomène "qui se cache" :
</p>
<p>
 <img alt="Charge et décharge successive" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/charge-et-decharge-successive.jpg"/>
</p>
<p>
 Voyez donc ce fameux chronogramme. Qu’en pensez-vous ? Ce n’est pas merveilleux hein !
 <img alt=":(" class="smiley" src="./static/smileys/triste.png"/>
 Quelques explications : pour passer d’un palier à un autre, le condensateur met un certain temps. Ce temps est grosso modo celui de son temps de charge (constante RC). C’est-à-dire que plus on va augmenter le temps de charge, plus le condensateur mettra du temps pour se stabiliser au palier voulu. Or si l’on veut créer un signal analogique qui varie assez rapidement, cela va nous poser problème.
</p>
<h5 id="la-perte-de-temps-en-conversion">
 <a aria-hidden="true" href="#la-perte-de-temps-en-conversion">
  <span class="icon icon-link">
  </span>
 </a>
 La perte de temps en conversion
</h5>
<p>
 C’est ce que je viens d’énoncer, plus la constante de temps est grande, plus il faudra de périodes de PWM pour stabiliser la valeur moyenne du signal à la tension souhaitée. À l’inverse, si on diminue la constante de temps, changer de palier sera plus rapide, mais la tension aux bornes du condensateur aura tendance à suivre le signal. C’est le premier chronogramme que l’on a vu plus haut.
</p>
<h5 id="finalement-comment-calibrer-correctement-la-constante-rc">
 <a aria-hidden="true" href="#finalement-comment-calibrer-correctement-la-constante-rc">
  <span class="icon icon-link">
  </span>
 </a>
 Finalement, comment calibrer correctement la constante RC ?
</h5>
<p>
 Cela s’avère être délicat. Il faut trouver le juste milieu en fonction du besoin que l’on a.
</p>
<ul>
 <li>
  Si l’on veut un signal qui soit le plus proche possible de la valeur moyenne, il faut une constante de temps très grande.
 </li>
 <li>
  Si au contraire on veut un signal qui soit le plus rapide et que la valeur moyenne soit une approximation, alors il faut une constante de temps faible.
 </li>
 <li>
  <p>
   Si on veut un signal rapide et le plus proche possible de la valeur moyenne, on a deux solutions qui sont :
  </p>
  <ul>
   <li>
    mettre un deuxième montage ayant une constante de temps un peu plus grande, en cascade du premier (on perd quand même en rapidité)
   </li>
   <li>
    changer la fréquence de la PWM
   </li>
  </ul>
 </li>
</ul>
<h3 id="modifier-la-fréquence-de-la-pwm">
 <a aria-hidden="true" href="#modifier-la-fréquence-de-la-pwm">
  <span class="icon icon-link">
  </span>
 </a>
 Modifier la fréquence de la PWM
</h3>
<p>
 On l’a vu, avec la fréquence actuelle de la PWM en sortie de l’Arduino, on va ne pouvoir créer que des signaux "lents". Lorsque vous aurez besoin d’aller plus vite, vous vous confronterez à ce problème. C’est pourquoi je vais vous expliquer comment modifier la fréquence de cette PWM.
</p>
<div class="custom-block alert alert-danger">
 <div class="custom-block-body">
  <p>
   Nouveau message d’avertissement : cette fois, on va directement toucher aux registres du microcontrôleur, donc si vous comprenez pas tout, ce n’est pas très grave car cela requiert un niveau encore plus élevé que celui que vous avez actuellement.
  </p>
 </div>
</div>
<p>
 Commençons cette très courte sous-partie.
</p>
<h5 id="pourquoi-changer-la-fréquence-de-la-pwm">
 <a aria-hidden="true" href="#pourquoi-changer-la-fréquence-de-la-pwm">
  <span class="icon icon-link">
  </span>
 </a>
 Pourquoi changer la fréquence de la PWM ?
</h5>
<p>
 Oui, pourquoi ? Tout simplement pour essayer de créer un signal qui se rapproche le plus de la valeur moyenne de la PWM à chaque instant. L’objectif est de pouvoir maximiser l’avantage de la structure ayant une faible constante de temps tout en éliminant au mieux son désavantage. Vous verrez peut-être mieux avec des chronogrammes. En voici deux, le premier est celui où la fréquence de la PWM est celle fournie d’origine par l’Arduino, le second est la PWM à une fréquence deux fois plus élevée, après modification du programme :
</p>
<p>
 <img alt="L'impact de la modification de la PWM" src="./images/uploaded/tuto-arduino-403-et-les-sorties-analogiques-enfin-presque/limpact-de-la-modification-de-la-pwm.jpg"/>
</p>
<p>
 Pour une constante de temps identique pour chaque courbe réalisée, on relève que le temps de stabilisation du signal est plus rapide sur le chronogramme où la fréquence est deux fois plus élevée qu’avec la fréquence standard d’Arduino. Ici donc, on a :
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <msub>
        <mi>
         t
        </mi>
        <mn>
         2
        </mn>
       </msub>
       <mo>
        −
       </mo>
       <msub>
        <mi>
         t
        </mi>
        <mn>
         1
        </mn>
       </msub>
       <mo>
        =
       </mo>
       <mn>
        2
       </mn>
       <mo>
        ×
       </mo>
       <mo>
        (
       </mo>
       <msub>
        <mi>
         t
        </mi>
        <mn>
         4
        </mn>
       </msub>
       <mo>
        −
       </mo>
       <msub>
        <mi>
         t
        </mi>
        <mn>
         3
        </mn>
       </msub>
       <mo>
        )
       </mo>
      </mrow>
      <annotation encoding="application/x-tex">
       t_2 - t_1 = 2 \times (t_4 - t_3)
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.75em;">
    </span>
    <span class="strut bottom" style="height:1em;vertical-align:-0.25em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord">
      <span class="mord mathit">
       t
      </span>
      <span class="msupsub">
       <span class="vlist">
        <span style="top:0.15em;margin-right:0.05em;margin-left:0em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord mathrm mtight">
           2
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
     </span>
     <span class="mbin">
      −
     </span>
     <span class="mord">
      <span class="mord mathit">
       t
      </span>
      <span class="msupsub">
       <span class="vlist">
        <span style="top:0.15em;margin-right:0.05em;margin-left:0em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord mathrm mtight">
           1
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
     </span>
     <span class="mrel">
      =
     </span>
     <span class="mord mathrm">
      2
     </span>
     <span class="mbin">
      ×
     </span>
     <span class="mopen">
      (
     </span>
     <span class="mord">
      <span class="mord mathit">
       t
      </span>
      <span class="msupsub">
       <span class="vlist">
        <span style="top:0.15em;margin-right:0.05em;margin-left:0em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord mathrm mtight">
           4
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
     </span>
     <span class="mbin">
      −
     </span>
     <span class="mord">
      <span class="mord mathit">
       t
      </span>
      <span class="msupsub">
       <span class="vlist">
        <span style="top:0.15em;margin-right:0.05em;margin-left:0em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord mathrm mtight">
           3
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
     </span>
     <span class="mclose">
      )
     </span>
    </span>
   </span>
  </span>
 </span>
 . En effet car le temps (T) est inversement proportionnel à la fréquence (F) selon cette formule :
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        F
       </mi>
       <mo>
        =
       </mo>
       <mfrac>
        <mn>
         1
        </mn>
        <mi>
         T
        </mi>
       </mfrac>
      </mrow>
      <annotation encoding="application/x-tex">
       F = \frac 1 T
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.845108em;">
    </span>
    <span class="strut bottom" style="height:1.190108em;vertical-align:-0.345em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.13889em;">
      F
     </span>
     <span class="mrel">
      =
     </span>
     <span class="mord reset-textstyle textstyle uncramped">
      <span class="mopen sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter">
      </span>
      <span class="mfrac">
       <span class="vlist">
        <span style="top:0.345em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord mathit mtight" style="margin-right:0.13889em;">
           T
          </span>
         </span>
        </span>
        <span style="top:-0.22999999999999998em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle textstyle uncramped frac-line">
         </span>
        </span>
        <span style="top:-0.394em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle uncramped mtight">
          <span class="mord mathrm mtight">
           1
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
      <span class="mclose sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter">
      </span>
     </span>
    </span>
   </span>
  </span>
 </span>
 Avec quelques mots pour expliquer cela, le temps de charge du condensateur, pour se stabiliser au nouveau palier de tension, est plus rapide avec une fréquence plus élevée. À comparaison, pour le premier signal, le temps de charge est deux fois plus grand que celui pour le deuxième signal où la fréquence est deux fois plus élevée.
</p>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   Mes dessins ne sont pas très rigoureux, mais mes talents de graphistes me limitent à ça. Soyez indulgent à mon égard.
   <img alt=":-°" class="smiley" src="./static/smileys/siffle.png"/>
   Quoi qu’il en soit, il s’agissait, ici, simplement d’illustrer mes propos et donner un exemple concret.
  </p>
 </div>
</div>
<h5 id="utilisation-du-registre">
 <a aria-hidden="true" href="#utilisation-du-registre">
  <span class="icon icon-link">
  </span>
 </a>
 Utilisation du registre
</h5>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Bigre ! Je viens de comprendre pourquoi on avait besoin de changer la fréquence de la PWM.
   <img alt=":D" class="smiley" src="./static/smileys/heureux.png"/>
   Mais euh… comment on fait ? C’est quoi les registres ?
   <img alt=":-°" class="smiley" src="./static/smileys/siffle.png"/>
  </p>
 </div>
</div>
<p>
 Les registres…………… eh bien…………… c’est compliqué !
 <img alt=":ninja:" class="smiley" src="./static/smileys/ninja.png"/>
 Non, je n’entrerai pas dans le détail en expliquant ce qu’est un registre, de plus c’est un sujet que je ne maitrise pas bien et qui vous sera certainement inutile dans le cas présent. Disons pour l’instant que le registre est une variable très spéciale.
</p>
<h5 id="code-de-modification-de-la-fréquence-de-la-pwm">
 <a aria-hidden="true" href="#code-de-modification-de-la-fréquence-de-la-pwm">
  <span class="icon icon-link">
  </span>
 </a>
 Code de modification de la fréquence de la PWM
</h5>
<p>
 Alors, pour modifier la fréquence de la PWM de l’Arduino on doit utiliser le code suivant :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-comment">// on définit une variable de type byte</span>
<span class="hljs-comment">// qui contiendra l'octet à donner au registre pour diviser la fréquence de la PWM</span>

<span class="hljs-comment">// division par : 1, 8, 64, 256, 1024</span>
byte division_frequence=<span class="hljs-number">0x01</span>;
<span class="hljs-comment">// fréquence : 62500Hz, 7692Hz, ...</span>
<span class="hljs-comment">// temps de la période : 16µs, 130µs, ...</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    pinMode(<span class="hljs-number">6</span>, OUTPUT); <span class="hljs-comment">// broche de sortie</span>

    <span class="hljs-comment">// TCCR0B c'est le registre, on opère un masquage sur lui même</span>
    TCCR0B = TCCR0B &amp; <span class="hljs-number">0b11111000</span> | division_frequence;
    <span class="hljs-comment">// ce qui permet de modifier la fréquence de la PWM</span>
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span> <span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// on écrit simplement la valeur de 0 à 255 du rapport cyclique du signal</span>
    analogWrite(<span class="hljs-number">6</span>, <span class="hljs-number">128</span>);
    <span class="hljs-comment">// qui est à la nouvelle fréquence choisit</span>
}
</code></pre>
 </div>
 <figcaption>
  Modification de la fréquence de la PWM
 </figcaption>
</figure>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   Vous remarquerez que les nombres binaires avec Arduino s’écrivent avec les caractères
   <strong>
    0b
   </strong>
   devant.
  </p>
 </div>
</div>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   Cette sous-partie peut éventuellement être prise pour un
   <em>
    truc et astuce
   </em>
   . C’est quelque peu le cas, malheureusement, mais pour éviter que cela ne le soit complètement, je vais vous expliquer des notions supplémentaires, par exemple la ligne 14 du code.
  </p>
 </div>
</div>
<h5 id="traduction-sil-vous-plait">
 <a aria-hidden="true" href="#traduction-sil-vous-plait">
  <span class="icon icon-link">
  </span>
 </a>
 Traduction s’il vous plait !
</h5>
<p>
 Je le disais donc, on va voir ensemble comment fonctionne la ligne 14 du programme :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">TCCR0B = TCCR0B &amp; <span class="hljs-number">0b11111000</span> | division_frequence;
</code></pre>
</div>
<p>
 Très simplement,
 <code>
  TCCR0B
 </code>
 est le nom du registre utilisé. Cette ligne est donc là pour modifier le registre puisqu’on fait une opération avec et le résultat est inscrit dans le registre. Cette opération est, il faudra l’avouer, peu commune. On effectue, ce que l’on appelle en programmation, un
 <strong>
  masquage
 </strong>
 . Le masquage est une opération logique que l’on utilise avec des données binaires. On peut faire différents masquages en utilisant les opérations logiques ET, OU, OU exclusif, … Dans le cas présent, on a la variable
 <code>
  TCCR0B
 </code>
 qui est sous forme binaire et on effectue une opération
 <strong>
  ET
 </strong>
 (symbole
 <strong>
  &amp;
 </strong>
 ) puis une opération
 <strong>
  OU
 </strong>
 (symbole
 <strong>
  |
 </strong>
 ). Les opérations ET et OU sont définies par une
 <strong>
  table de vérité
 </strong>
 . Avec deux entrées, on a une sortie qui donne le résultat de l’opération effectuée avec les deux niveaux d’entrée.
</p>
<div class="text-center">
 <div class="table-wrapper">
  <table class=" table table-bordered table-striped">
   <thead>
    <tr>
     <th colspan="2" rowspan="1">
      <p>
       Entrées
      </p>
     </th>
     <th colspan="1" rowspan="1">
      <p>
       Sortie ET
      </p>
     </th>
     <th colspan="1" rowspan="1">
      <p>
       Sortie OU
      </p>
     </th>
    </tr>
    <tr>
     <th colspan="1" rowspan="1">
      <p>
       A
      </p>
     </th>
     <th colspan="1" rowspan="1">
      <p>
       B
      </p>
     </th>
     <th colspan="1" rowspan="1">
      <p>
       A ET B
      </p>
     </th>
     <th colspan="1" rowspan="1">
      <p>
       A OU B
      </p>
     </th>
    </tr>
   </thead>
   <tbody>
    <tr>
     <td colspan="1" rowspan="1">
      <p>
       0
      </p>
     </td>
     <td colspan="1" rowspan="1">
      <p>
       0
      </p>
     </td>
     <td colspan="1" rowspan="1">
      <p>
       0
      </p>
     </td>
     <td colspan="1" rowspan="1">
      <p>
       0
      </p>
     </td>
    </tr>
    <tr>
     <td colspan="1" rowspan="1">
      <p>
       0
      </p>
     </td>
     <td colspan="1" rowspan="1">
      <p>
       1
      </p>
     </td>
     <td colspan="1" rowspan="1">
      <p>
       0
      </p>
     </td>
     <td colspan="1" rowspan="1">
      <p>
       1
      </p>
     </td>
    </tr>
    <tr>
     <td colspan="1" rowspan="1">
      <p>
       1
      </p>
     </td>
     <td colspan="1" rowspan="1">
      <p>
       0
      </p>
     </td>
     <td colspan="1" rowspan="1">
      <p>
       0
      </p>
     </td>
     <td colspan="1" rowspan="1">
      <p>
       1
      </p>
     </td>
    </tr>
    <tr>
     <td colspan="1" rowspan="1">
      <p>
       1
      </p>
     </td>
     <td colspan="1" rowspan="1">
      <p>
       1
      </p>
     </td>
     <td colspan="1" rowspan="1">
      <p>
       1
      </p>
     </td>
     <td colspan="1" rowspan="1">
      <p>
       1
      </p>
     </td>
    </tr>
   </tbody>
  </table>
 </div>
 <p>
  Table: Table de vérité de l’opérateur ET et OU
 </p>
</div>
<p>
 Les opérations de type ET et OU ont un niveau de priorité comme la multiplication et l’addition. On commence toujours par effectuer l’opération ET, puis on termine avec l’opération OU. On pourrait donc écrire ceci :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">TCCR0B = (TCCR0B &amp; <span class="hljs-number">0b11111000</span>) | division_frequence;
</code></pre>
</div>
<p>
 Prenons maintenant un exemple où la variable spéciale
 <code>
  TCCR0B
 </code>
 serait un nombre binaire égal à :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">TCCR0B = <span class="hljs-number">0b10011101</span>; <span class="hljs-comment">// valeur du registre</span>
</code></pre>
</div>
<p>
 À présent, on lui fait un masquage de type ET :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">TCCR0B = <span class="hljs-number">0b10011101</span>;

TCCR0B = TCCR0B &amp; <span class="hljs-number">0b11111000</span>; <span class="hljs-comment">// masquage de type ET</span>
</code></pre>
</div>
<p>
 On fait l’opération à l’aide de la table de vérité du ET (voir tableau ci-dessus) et on trouve le résultat :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">TCCR0B = <span class="hljs-number">0b10011101</span>;

TCCR0B = TCCR0B &amp; <span class="hljs-number">0b11111000</span>;

<span class="hljs-comment">// TCCR0B vaut maintenant : 0b10011000</span>
</code></pre>
</div>
<p>
 En somme, on conclut que l’on a gardé la valeur des 5 premiers bits, mais l’on a effacé la valeur des 3 derniers bits pour les mettre à zéro. Ainsi, quelle que soit la valeur binaire de TCCR0B, on met les bits que l’on veut à l’état bas. Ceci va ensuite nous permettre de changer l’état des bits mis à l’état bas en effectuant l’opération OU :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">byte division_frequence = <span class="hljs-number">0x01</span>; <span class="hljs-comment">// nombre haxadécimal qui vaut 0b00000001</span>

TCCR0B = <span class="hljs-number">0b10011101</span>;

TCCR0B = TCCR0B &amp; <span class="hljs-number">0b11111000</span>;
<span class="hljs-comment">// TCCR0B vaut maintenant : 0b10011000</span>

TCCR0B = TCCR0B | division_frequence;
<span class="hljs-comment">// TCCR0B vaut maintenant : 0b10011001</span>
</code></pre>
</div>
<p>
 D’après la table de vérité du OU logique, on a modifié la valeur de
 <code>
  TCCR0B
 </code>
 en ne changeant que le ou les bits que l’on voulait.
</p>
<div class="custom-block alert alert-danger">
 <div class="custom-block-body">
  <p>
   La valeur de
   <code>
    TCCR0B
   </code>
   que je vous ai donnée est bidon. C’est un exemple qui vous permet de comprendre comment fonctionne un masquage.
  </p>
 </div>
</div>
<p>
 Ce qu’il faut retenir, pour changer la fréquence de la PWM, c’est que pour la variable
 <code>
  division_frequence
 </code>
 , il faut lui donner les valeurs hexadécimales suivantes :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp"><span class="hljs-number">0x01</span> <span class="hljs-comment">// la fréquence vaut 62500Hz (fréquence maximale fournie par la PWM =&gt; provient de la fréquence du quartz / 256)</span>
<span class="hljs-comment">// effectue une division par 1 de la fréquence max</span>

<span class="hljs-number">0x02</span> <span class="hljs-comment">// f = 7692Hz (division par 8 de la fréquence maximale)</span>
<span class="hljs-number">0x03</span> <span class="hljs-comment">// f = 976Hz, division par 64</span>
<span class="hljs-number">0x04</span> <span class="hljs-comment">// f = 244Hz, division par 256</span>
<span class="hljs-number">0x05</span> <span class="hljs-comment">// f = 61Hz, division par 1024</span>
</code></pre>
</div>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   Vous trouverez plus de détails sur
   <a href="http://www.arcfn.com/2009/07/secrets-of-arduino-pwm.html">
    cette page
   </a>
   (en anglais).
  </p>
 </div>
</div>
<h5 id="test-de-vérification">
 <a aria-hidden="true" href="#test-de-vérification">
  <span class="icon icon-link">
  </span>
 </a>
 Test de vérification
</h5>
<p>
 Pour vérifier que la fréquence a bien changé, on peut reprendre le montage que l’on a fait plus haut et enlever l’interrupteur en le remplaçant par un fil. On ne met plus un générateur de tension continue, mais on branche une sortie PWM de l’arduino avec le programme qui va bien. Pour deux fréquences différentes, on devrait voir la LED s’allumer plus ou moins rapidement. On compare le temps à l’état au lorsque l’on écrit 1000 fois un niveau de PWM à 255 à celui mis par le même programme avec une fréquence de PWM différente, grâce à une LED.
</p>
<p>
 À partir de maintenant, vous allez pouvoir faire des choses amusantes avec la PWM. Cela va nous servir pour les moteurs pour ne citer qu’eux. Mais avant, car on en est pas encore là, je vous propose un petit TP assez sympa. Rendez-vous au prochain chapitre !
 <img alt=":)" class="smiley" src="./static/smileys/smile.png"/>
</p>
<div class="footnotes">
 <hr/>
 <ol>
  <li id="fn-1">
   <p>
    La même chose est réalisable avec des sites comme
    <a href="http://htmlcolorcodes.com/color-picker/">
     http://htmlcolorcodes.com/color-picker/
    </a>
   </p>
   <a class="footnote-backref" href="#fnref-1" title="Retourner au texte de la note 1">
    ↩
   </a>
  </li>
 </ol>
</div>
            </div>
            <!-- /.entry-content -->
            <hr>
            <div class="row bg-light my-2 py-2 rounded">
                <div class="col mr-auto">
                    <a class="" href="./tuto-arduino-402-tp-vu-mètre-à-led.html">
                        <i class="fas fa-chevron-left fa-lg"></i>
                        tuto-arduino-402-tp-vu-mètre-à-led
                    </a>
                </div>
                <div class="col-auto">
                    <a class="" href="./tuto-arduino-404-exercice-une-animation-youtube.html">
                        tuto-arduino-404-exercice-une-animation-youtube
                        <i class="fas fa-chevron-right fa-lg"></i>
                    </a>
                </div>
            </div>
            <div class="mb-3 text-center">
                <a class="btn btn-outline-dark mx-1" href="https://twitter.com/share?url=./tuto-arduino-403-et-les-sorties-analogiques-enfin-presque.html&amp;text=Et les sorties “analogiques”, enfin… presque ! - ./tuto-arduino-403-et-les-sorties-analogiques-enfin-presque.html" rel="nofollow" title="Partager cet article sur Twitter" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-twitter fa-lg"></i>
                </a>
                <a class="btn btn-outline-dark mx-1" href="https://www.facebook.com/sharer.php?u=./tuto-arduino-403-et-les-sorties-analogiques-enfin-presque.html&amp;t=Et les sorties “analogiques”, enfin… presque ! - ./tuto-arduino-403-et-les-sorties-analogiques-enfin-presque.html" rel="nofollow" title="Partager cet article sur Facebook" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-facebook-f fa-lg"></i>
                </a>
                <a class="btn btn-outline-dark mx-1" href="https://plus.google.com/share?url=./tuto-arduino-403-et-les-sorties-analogiques-enfin-presque.html&amp;hl=fr" rel="nofollow" title="Partager cet article sur Google +" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-google-plus fa-lg"></i>
                </a>
                <!--<a class="btn btn-outline-dark mx-1" href="http://sharetodiaspora.github.io/?url=./tuto-arduino-403-et-les-sorties-analogiques-enfin-presque.html&amp;title=Et les sorties “analogiques”, enfin… presque ! - ./tuto-arduino-403-et-les-sorties-analogiques-enfin-presque.html" rel="nofollow"  title="Partager cet article sur Diaspora" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-google-plus fa-lg"></i>
                </a>-->
                <a class="btn btn-outline-dark mx-1" href="mailto:?subject=Et les sorties “analogiques”, enfin… presque !&amp;body=./tuto-arduino-403-et-les-sorties-analogiques-enfin-presque.html"rel="nofollow" title="Partager cet article par email" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="far fa-envelope fa-lg"></i>
                </a>
            </div>
        </section>
    </div>
</div>
    </div>
<footer class="container-fluid bg-dark small text-white px-3">
<div class="row">
    <div class="col align-self-start">

    </div>
    <div class="col align-self-center text-center">
        © Eskimon -
        Blog propulsé par <a class="bold text-white" href="https://blog.getpelican.com/" rel="nofollow">Pelican</a> -
        Thème fait maison
    </div>
    <div class="col align-self-end text-right">
        <a class="btn btn-lg text-light" href="https://github.com/Eskimon" rel="nofollow" title="Mon profil Github">
            <i class="fab fa-github fa-lg"></i>
        </a>
        <a class="btn btn-lg text-light" href="https://twitter.com/Eskimon_fr" rel="nofollow" title="Me suivre sur Linkedin">
            <i class="fab fa-twitter fa-lg"></i>
        </a>
    </div>
  </div>
</footer>

    <!-- For formula -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- Font awesome -->
    <script src="https://use.fontawesome.com/releases/v5.0.0/js/all.js"></script>
    <!-- JQuery first -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <!-- Popper.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <!-- Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- For tooltips -->
    <script>$(function () {  $('[data-toggle="tooltip"]').tooltip()})</script>
    <script src="./static/js/my-scripts.js"></script>
<script>
function create_side_summary() {
    // Duplicate summary
    var main_summary = $('#sommaire').next();
    if(main_summary.length === 0)
        return
    var side_summary = main_summary.clone();
    side_summary.addClass('pl-0');
    var all_p = side_summary.find('p');
    all_p.contents().unwrap();
    var all_li = side_summary.find('li');
    all_li.addClass('pl-1');

    // scrollspy - in
    side_summary.attr('id', 'es-side-summary-mainlist');
    //side_summary.addClass('nav');
    //all_li.addClass('nav-item');
    var all_a = side_summary.find('a');
    all_a.addClass('nav-link');
    var all_ul = side_summary.find('ul');
    all_ul.addClass('pl-1');
    $('body').scrollspy({ target: '#es-side-summary-mainlist' });
    // scrollspy - out

    var summary_title = document.createElement("h4");
    summary_title.className = 'navbar-brand';
    summary_title.innerHTML = 'Sommaire';
    $(summary_title).prependTo('#es-side-summary-content');
    side_summary.appendTo('#es-side-summary-content');
    main_summary.addClass('es-subul-collapse');
}

function generate_spoilers() {
    all_secret = $('.custom-block-spoiler');
    all_secret.each(function( index ) {
    let content = $(this).html();
    $(this).html('');
    $(this).addClass('card');
    var headerText = document.createElement("button");
    var cardHeader = document.createElement("div");
    var cardBodyWrapper = document.createElement("div");
    var cardBody = document.createElement("div");
    $(headerText).text('Contenu masqué, cliquez pour afficher');
    $(headerText).addClass('btn btn-link btn-sm');
    $(headerText).attr('data-toggle', 'collapse');
    $(headerText).attr('data-target', '#collapse-' + index);
    $(headerText).attr('aria-controls', 'collapse-' + index);
    $(headerText).attr('aria-expanded', 'false');
    $(cardHeader).append(headerText);
    $(cardHeader).addClass('card-header');
    $(cardHeader).attr('id', 'spoiler-' + index);
    $(cardBody).html(content);
    $(cardBody).addClass('card-body');
    $(cardBodyWrapper).append(cardBody);
    $(cardBodyWrapper).addClass('collapse hide');
    $(cardBodyWrapper).attr('id', 'collapse-' + index)
    $(cardBodyWrapper).attr('aria-labelledby', 'spoiler-' + index)
    $(this).prepend(cardHeader);
    $(this).append(cardBodyWrapper);
    });

    $('.collapse').collapse({toggle: false});
}

create_side_summary();
generate_spoilers();
</script>
</body>

</html>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Des capteurs plus évolués &bull; Le blog d'Eskimon</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/hljs-monokai.css" />
    <link rel="stylesheet" href="/static/css/style.css" />
    <!-- Google font -->
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/images/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="57x57" href="/static/images/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/static/images/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/static/images/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/static/images/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/static/images/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/static/images/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/static/images/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/static/images/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/images/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/static/images/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/static/images/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="/static/images/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/static/images/favicon/ms-icon-144x144.png">

    <link href="https://eskimon.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Le blog d'Eskimon Atom Feed" />
    <link href="https://eskimon.fr/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Le blog d'Eskimon RSS Feed" />

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-46353906-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-46353906-1');
    </script>

    <meta name="description" content="Dernier chapitre pour parler de capteurs plus évolués renvoyant des informations plus compliquées à traiter." />

  <meta name="tags" content="arduino" />
  <meta name="tags" content="tuto" />


  <meta property="og:site_name" content="Le blog d'Eskimon">
  <meta property="og:title" content="Des capteurs plus évolués">
  <meta property="og:url" content="https://eskimon.fr/tuto-arduino-503-des-capteurs-plus-évolués">
  <meta property="og:language" content="fr_FR">
  <meta property="og:type" content="website">

  <meta property="twitter:domain" content="https://eskimon.fr/">
  <meta property="twitter:card" content="summary">
  <meta property="twitter:url" content="https://eskimon.fr/tuto-arduino-503-des-capteurs-plus-évolués">
  <meta property="twitter:title" content="Des capteurs plus évolués">
<meta property="twitter:description" content="Dernier chapitre pour parler de capteurs plus évolués renvoyant des informations plus compliquées à traiter.">  <meta property="twitter:site" content="SITENAME">
  <meta property="twitter:creator" content="@eskimon_fr">

  <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
  <meta name="DC.publisher" lang="fr" content="Le blog d'Eskimon" />
  <meta name="DC.creator" content="Eskimon" />
  <meta name="DC.type" content="text" />
  <meta name="DC.title" content="Des capteurs plus évolués" />
  <meta name="DC.abstract" content="Des capteurs plus évolués – Dernier chapitre pour parler de capteurs plus évolués renvoyant des informations plus compliquées à traiter." />
  <meta name="DC.subject" lang="fr" content="Arduino/E - Les capteurs et l'environnement autour d'Arduino – arduino; tuto" />
<meta name="DC.description" lang="fr" content="Dernier chapitre pour parler de capteurs plus évolués renvoyant des informations plus compliquées à traiter." />  <meta name="DC.date" content="2014-03-05T08:00:00+01:00" />
  <meta name="DC.format" content="text/html" />
  <meta name="DC.language" content="fr" />
  <meta name="DC.rights" content="CC BY-NC-SA" />

  <script type="application/ld+json">
    [{
        "@context": "http://schema.org",
        "@type": "Article",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://eskimon.fr/tuto-arduino-503-des-capteurs-plus-évolués"
        },
        "headline": ""Des capteurs plus \u00e9volu\u00e9s"",
        "datePublished": "2014-03-05T08:00:00+01:00",
        "image": [
            "https://eskimon.fr/static/images/logo.png"
        ],
        "author": {
            "@type": "Person",
            "name": "Eskimon",
            "image": "https://eskimon.fr/static/images/logo.png"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Eskimon",
            "logo": {
                "@type": "ImageObject",
                "url": "https://eskimon.fr/static/images/logo.png"
            }
        },
        "description": ""Dernier chapitre pour parler de capteurs plus \u00e9volu\u00e9s renvoyant des informations plus compliqu\u00e9es \u00e0 traiter.""
    },
    {
        "@context": "http://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [{
            "@type": "ListItem",
            "position": 1,
            "item": {
                "@id": "https://eskimon.fr/category/arduino",
                "name": ""Arduino""
            }
        }
        , {
            "@type": "ListItem",
            "position": 2,
            "item": {
                "@id": "https://eskimon.fr/subcategory/arduino/e-les-capteurs-et-lenvironnement-autour-darduino",
                "name": ""E - Les capteurs et l\u0027environnement autour d\u0027Arduino""
            }
        }
        , {
            "@type": "ListItem",
            "position": 3,
            "item": {
                "@id": "https://eskimon.fr/tuto-arduino-503-des-capteurs-plus-évolués",
                "name": ""Des capteurs plus \u00e9volu\u00e9s""
            }
        }]
    }]
    </script>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-2080155902357792",
              enable_page_level_ads: true
         });
    </script>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light bg-secondary-l40 py-0">
    <a class="navbar-brand" href="/">
        <img src="/static/images/logo.png" width="20" height="20" alt="">
        Le blog d'Eskimon
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div></div>
        <div>
            <a class="btn btn-lg text-secondary" href="https://github.com/Eskimon" rel="nofollow" title="Mon profil Github">
                <i class="fab fa-github fa-lg"></i>
            </a>
            <a class="btn btn-lg text-secondary" href="https://twitter.com/Eskimon_fr" rel="nofollow" title="Me suivre sur Twitter">
                <i class="fab fa-twitter fa-lg"></i>
            </a>
            <a class="btn btn-lg text-secondary" href="https://twitch.tv/eskimon" rel="nofollow" title="Me suivre sur Twitch">
                <i class="fab fa-twitch fa-lg"></i>
            </a>
            <a class="btn btn-lg text-secondary" href="https://www.youtube.com/user/Eskimon49/featured" rel="nofollow" title="Les VOD sur Youtube">
                <i class="fab fa-youtube fa-lg"></i>
            </a>
            <a class="btn btn-lg text-secondary" href="https://discord.gg/9SkDWft" rel="nofollow" title="Venez participer sur Discord">
                <i class="fab fa-discord fa-lg"></i>
            </a>
        </div>
        <div class="navbar-nav">
                <a class="nav-item nav-link active" href="/category/arduino">Arduino</a>
                <a class="nav-item nav-link " href="/category/articles">Articles</a>
                <a class="nav-item nav-link " href="/category/web">Web</a>
        </div>
    </div>
</nav>
    <div class="container-fluid es-verticalfill">
<div class="row">
    <!-- Sidebar -->
    <div class="col-lg-2 d-none d-lg-block sticky-top es-scrollable pt-3 px-1 bg-light es-ul-bordered" id="es-side-summary">
        <nav class="px-2" id="es-side-summary-content">
            <!-- Summary will come here -->
        </nav>
        <hr>
        <!-- Self-promo for ebook -->
        <div class="text-center">
            <h4>Ebook Arduino !</h4>
            <a href="/ebook-tutoriel-arduino.html"><img src="/images/couverture-mini.png" alt="couverture ebook" title="couverture de l'ebook"></a>
        </div>
        <hr>
        <!-- Blog side carree -->
        <div id="es-side-summary-bot-annonce" class="text-center">
            <ins class="adsbygoogle"
                 style="display:inline-block;width:250px;height:250px"
                 data-ad-client="ca-pub-2080155902357792"
                 data-ad-slot="6115810402"></ins>
            <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>
    <!-- Main content -->
    <div class="col-md-10 col-lg-8 col-xl-7 offset-md-1 offset-lg-1 offset-xl-1 d-block pt-3" id="es-content">

<div class="row" role="alert">
    <div class="ml-auto mr-auto alert alert-primary text-center">
        <a class="btn btn-lg text-secondary" href="https://twitch.tv/eskimon" rel="nofollow" title="Me suivre sur Twitch"><i class="fab fa-twitch fa-lg"></i></a>
        Rejoignez moi en <a href="htts://twitch.tv/eskimon"> live sur Twitch </a> pour apprendre le tuto Arduino autrement ! (<a href="https://twitter.com/Eskimon_fr/status/1169158978129092618">plus d'infos</a>)
        <a class="btn btn-lg text-secondary" href="https://twitch.tv/eskimon" rel="nofollow" title="Me suivre sur Twitch"><i class="fab fa-twitch fa-lg"></i></a>
    </div>
</div>

        <article>
            <!-- Leaderboard head article -->
            <ins class="adsbygoogle"
                style="display:inline-block;width:970px;height:90px"
                data-ad-client="ca-pub-2080155902357792"
                data-ad-slot="7158680773"></ins>
            <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb bg-white">
                    <li class="breadcrumb-item"><a href="/category/arduino">Arduino</a></li>
                        <li class="breadcrumb-item"><a href="/subcategory/arduino/e-les-capteurs-et-lenvironnement-autour-darduino">E - Les capteurs et l'environnement autour d'Arduino</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Des capteurs plus évolués</li>
                </ol>
            </nav>
            <header class="es-post-info">
                <h1 class="text-center my-4">Des capteurs plus évolués</h1>
            </header>
            <footer class="es-post-info pb-2 mb-2">
                <div class="row align-items-center">
                    <div class="col-auto mr-auto">
                        <span class="vcard author">
                            <a class="" href="/author/eskimon" rel="author">Eskimon</a>
                        </span>
                        ,
                        <time class="" datetime="2014-03-05T08:00:00+01:00" pubdate>
                            le mer. 05 mars 2014
                        </time>
                            (<a href="https://eskimon.fr/tuto-arduino-503-des-capteurs-plus-évolués#disqus_thread" data-disqus-identifier="tuto-arduino-503-des-capteurs-plus-évolués">commentaires</a>)
                    </div>
                    <div class="col-auto">
                        <a class="btn btn-outline-primary btn-sm" href="/tag/arduino" rel="tag">arduino</a>
                        <a class="btn btn-outline-primary btn-sm" href="/tag/tuto" rel="tag">tuto</a>
                    </div>
                </div>
            </footer>
            <button type="button" id="sidebarCollapse" class="float-right btn btn-secondary sticky-top d-block d-lg-none">
                Sommaire
            </button>
            <!-- /.post-info -->
            <div class="entry-content">
                <p>
 Comme nous avons pu le voir plus tôt, certains capteurs transmettent l’information sous forme d’une donnée électrique qui varie : la résistance ou la tension.
Cependant, certains capteurs envoient l’information de manière "codée", afin qu’elle soit plus résistante au bruit (perturbations) et garantir le signal transmis. Parmi ces méthodes de transmission, on retrouve l’utilisation d’une PWM, de la fréquence ou d’un protocole de communication.
</p>
<h3 id="sommaire">
 <a aria-hidden="true" href="#sommaire">
  <span class="es-autolink-heading">
  </span>
 </a>
 Sommaire
</h3>
<ul>
 <li>
  <p>
   <a href="#capteur-à-sortie-en-modulation-de-largeur-dimpulsion-pwm">
    Capteur à sortie en modulation de largeur d’impulsion (PWM)
   </a>
  </p>
  <ul>
   <li>
    <a href="#principe">
     Principe
    </a>
   </li>
   <li>
    <p>
     <a href="#utilisation">
      Utilisation
     </a>
    </p>
    <ul>
     <li>
      <a href="#dans-la-pratique-avec-arduino">
       Dans la pratique avec Arduino
      </a>
     </li>
     <li>
      <a href="#simulation-de-lexemple">
       Simulation de l’exemple
      </a>
     </li>
    </ul>
   </li>
   <li>
    <a href="#Étude-de-cas-le-capteur-de-distance-srf05">
     Étude de cas : le capteur de distance SRF05
    </a>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#capteur-à-signal-de-sortie-de-fréquence-variable">
    Capteur à signal de sortie de fréquence variable
   </a>
  </p>
  <ul>
   <li>
    <p>
     <a href="#exemple--exercice">
      Exemple / Exercice
     </a>
    </p>
    <ul>
     <li>
      <p>
       <a href="#principe-1">
        Principe
       </a>
      </p>
      <ul>
       <li>
        <a href="#la-fonction-tone">
         La fonction tone()
        </a>
       </li>
      </ul>
     </li>
     <li>
      <a href="#correction">
       Correction
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#capteur-utilisant-un-protocole-de-communication">
    Capteur utilisant un protocole de communication
   </a>
  </p>
  <ul>
   <li>
    <p>
     <a href="#quelques-protocoles-de-communication">
      Quelques protocoles de communication
     </a>
    </p>
    <ul>
     <li>
      <a href="#voie-série--uart">
       Voie série / UART
      </a>
     </li>
     <li>
      <a href="#i2c">
       I2C
      </a>
     </li>
     <li>
      <a href="#spi">
       SPI
      </a>
     </li>
     <li>
      <a href="#protocole-propriétaire">
       Protocole propriétaire
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<h3 id="capteur-à-sortie-en-modulation-de-largeur-dimpulsion-pwm">
 <a aria-hidden="true" href="#capteur-à-sortie-en-modulation-de-largeur-dimpulsion-pwm">
  <span class="es-autolink-heading">
  </span>
 </a>
 Capteur à sortie en modulation de largeur d’impulsion (PWM)
</h3>
<h4 id="principe">
 <a aria-hidden="true" href="#principe">
  <span class="es-autolink-heading">
  </span>
 </a>
 Principe
</h4>
<p>
 Vous vous souvenez de la PWM ? Nous l’avons utilisée dans le chapitre sur
 <a href="https://zestedesavoir.com/tutoriels/537/arduino-premiers-pas-en-informatique-embarquee/745/les-grandeurs-analogiques/3432/et-les-sorties-analogiques-enfin-presque/">
  les sorties analogiques
 </a>
 . Dans ce type de signal, l’information est présente dans la durée de l’état haut par rapport à l’état bas. Ici, notre capteur va donc de la même façon coder l’information via une durée d’état (mais elle ne sera pas forcément relative à son état antagoniste). Il est donc nécessaire de connaitre les caractéristiques du capteur pour pouvoir interpréter le signal correctement.
</p>
<p>
 En effet, si on prend le signal sans rien savoir du capteur, comment déterminer ce que 20ms d’état haut signifie par exemple ?
Pour cela, ce type de composant doit toujours être utilisé avec sa documentation technique, afin de déterminer des paramètres comme ses bornes inférieure et supérieure de mesure. Mais c’est aussi vrai pour les autres (si vous tombez sur une résistance variable sans rien en connaître, vous devrez vous farcir une belle séance d’étalonnage pour l’identifier !).
</p>
<h4 id="utilisation">
 <a aria-hidden="true" href="#utilisation">
  <span class="es-autolink-heading">
  </span>
 </a>
 Utilisation
</h4>
<p>
 Prenons un cas simple. Imaginons que nous avons un capteur de température qui nous renvoie l’information suivante :
 <em>
  "La température en °C Celsius est proportionnelle à la durée d’état haut. La plage de mesure va de 0°C à 75°C pour une durée d’état haut de 0ms à 20ms"
 </em>
 .
</p>
<p>
 Nous avons donc une relation proportionnelle entre une température et une durée. Nous pouvons alors déduire une règle mathématique pour faire la conversion degrésdurée.
</p>
<p>
 En effet, on a les équivalences suivantes :
</p>
<ul>
 <li>
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <msup>
         <mn>
          0
         </mn>
         <mo>
          ∘
         </mo>
        </msup>
        <mi>
         C
        </mi>
        <mo>
         ⇔
        </mo>
        <mn>
         0
        </mn>
        <mi>
         m
        </mi>
        <mi>
         s
        </mi>
        <mo>
         ⇔
        </mo>
        <mn>
         0
        </mn>
        <mi mathvariant="normal">
         %
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        0^{\circ}C \Leftrightarrow 0ms \Leftrightarrow 0\%
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.75em;">
     </span>
     <span class="strut bottom" style="height:0.80556em;vertical-align:-0.05556em;">
     </span>
     <span class="base">
      <span class="mord">
       <span class="mord">
        0
       </span>
       <span class="msupsub">
        <span class="vlist-t">
         <span class="vlist-r">
          <span class="vlist" style="height:0.674115em;">
           <span style="top:-3.063em;margin-right:0.05em;">
            <span class="pstrut" style="height:2.7em;">
            </span>
            <span class="sizing reset-size6 size3 mtight">
             <span class="mord mtight">
              <span class="mord mtight">
               ∘
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      <span class="mord mathit" style="margin-right:0.07153em;">
       C
      </span>
      <span class="mord rule" style="margin-right:0.2777777777777778em;">
      </span>
      <span class="mrel">
       ⇔
      </span>
      <span class="mord rule" style="margin-right:0.2777777777777778em;">
      </span>
      <span class="mord">
       0
      </span>
      <span class="mord mathit">
       m
      </span>
      <span class="mord mathit">
       s
      </span>
      <span class="mord rule" style="margin-right:0.2777777777777778em;">
      </span>
      <span class="mrel">
       ⇔
      </span>
      <span class="mord rule" style="margin-right:0.2777777777777778em;">
      </span>
      <span class="mord">
       0
      </span>
      <span class="mord">
       %
      </span>
     </span>
    </span>
   </span>
  </span>
 </li>
 <li>
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mn>
         7
        </mn>
        <msup>
         <mn>
          5
         </mn>
         <mo>
          ∘
         </mo>
        </msup>
        <mi>
         C
        </mi>
        <mo>
         ⇔
        </mo>
        <mn>
         2
        </mn>
        <mn>
         0
        </mn>
        <mi>
         m
        </mi>
        <mi>
         s
        </mi>
        <mo>
         ⇔
        </mo>
        <mn>
         1
        </mn>
        <mn>
         0
        </mn>
        <mn>
         0
        </mn>
        <mi mathvariant="normal">
         %
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        75^{\circ}C \Leftrightarrow 20ms \Leftrightarrow 100\%
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.75em;">
     </span>
     <span class="strut bottom" style="height:0.80556em;vertical-align:-0.05556em;">
     </span>
     <span class="base">
      <span class="mord">
       7
      </span>
      <span class="mord">
       <span class="mord">
        5
       </span>
       <span class="msupsub">
        <span class="vlist-t">
         <span class="vlist-r">
          <span class="vlist" style="height:0.674115em;">
           <span style="top:-3.063em;margin-right:0.05em;">
            <span class="pstrut" style="height:2.7em;">
            </span>
            <span class="sizing reset-size6 size3 mtight">
             <span class="mord mtight">
              <span class="mord mtight">
               ∘
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
      <span class="mord mathit" style="margin-right:0.07153em;">
       C
      </span>
      <span class="mord rule" style="margin-right:0.2777777777777778em;">
      </span>
      <span class="mrel">
       ⇔
      </span>
      <span class="mord rule" style="margin-right:0.2777777777777778em;">
      </span>
      <span class="mord">
       2
      </span>
      <span class="mord">
       0
      </span>
      <span class="mord mathit">
       m
      </span>
      <span class="mord mathit">
       s
      </span>
      <span class="mord rule" style="margin-right:0.2777777777777778em;">
      </span>
      <span class="mrel">
       ⇔
      </span>
      <span class="mord rule" style="margin-right:0.2777777777777778em;">
      </span>
      <span class="mord">
       1
      </span>
      <span class="mord">
       0
      </span>
      <span class="mord">
       0
      </span>
      <span class="mord">
       %
      </span>
     </span>
    </span>
   </span>
  </span>
 </li>
</ul>
<p>
 Une simple règle de trois nous donne :
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        x
       </mi>
       <mo>
        =
       </mo>
       <mfrac>
        <mrow>
         <mn>
          7
         </mn>
         <mn>
          5
         </mn>
        </mrow>
        <mrow>
         <mn>
          2
         </mn>
         <mn>
          0
         </mn>
        </mrow>
       </mfrac>
       <mo>
        =
       </mo>
       <mn>
        3
       </mn>
       <mi mathvariant="normal">
        .
       </mi>
       <mn>
        7
       </mn>
       <msup>
        <mn>
         5
        </mn>
        <mo>
         ∘
        </mo>
       </msup>
       <mi>
        C
       </mi>
       <mi mathvariant="normal">
        /
       </mi>
       <mi>
        m
       </mi>
       <mi>
        s
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       x = \frac{75}{20} = 3.75^{\circ}C/ms
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.845108em;">
    </span>
    <span class="strut bottom" style="height:1.190108em;vertical-align:-0.345em;">
    </span>
    <span class="base">
     <span class="mord mathit">
      x
     </span>
     <span class="mord rule" style="margin-right:0.2777777777777778em;">
     </span>
     <span class="mrel">
      =
     </span>
     <span class="mord rule" style="margin-right:0.2777777777777778em;">
     </span>
     <span class="mord">
      <span class="mopen nulldelimiter">
      </span>
      <span class="mfrac">
       <span class="vlist-t vlist-t2">
        <span class="vlist-r">
         <span class="vlist" style="height:0.845108em;">
          <span style="top:-2.6550000000000002em;">
           <span class="pstrut" style="height:3em;">
           </span>
           <span class="sizing reset-size6 size3 mtight">
            <span class="mord mtight">
             <span class="mord mtight">
              2
             </span>
             <span class="mord mtight">
              0
             </span>
            </span>
           </span>
          </span>
          <span style="top:-3.15em;">
           <span class="pstrut" style="height:3em;">
           </span>
           <span class="stretchy" style="height:0.2em;">
            <svg height="0.2em" preserveaspectratio="xMinYMin slice" viewbox="0 0 400000 200" width="400em">
             <path d="M0 80H400000 v40H0z M0 80H400000 v40H0z">
             </path>
            </svg>
           </span>
          </span>
          <span style="top:-3.394em;">
           <span class="pstrut" style="height:3em;">
           </span>
           <span class="sizing reset-size6 size3 mtight">
            <span class="mord mtight">
             <span class="mord mtight">
              7
             </span>
             <span class="mord mtight">
              5
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="vlist-s">
          ​
         </span>
        </span>
        <span class="vlist-r">
         <span class="vlist" style="height:0.345em;">
         </span>
        </span>
       </span>
      </span>
      <span class="mclose nulldelimiter">
      </span>
     </span>
     <span class="mord rule" style="margin-right:0.2777777777777778em;">
     </span>
     <span class="mrel">
      =
     </span>
     <span class="mord rule" style="margin-right:0.2777777777777778em;">
     </span>
     <span class="mord">
      3
     </span>
     <span class="mord">
      .
     </span>
     <span class="mord">
      7
     </span>
     <span class="mord">
      <span class="mord">
       5
      </span>
      <span class="msupsub">
       <span class="vlist-t">
        <span class="vlist-r">
         <span class="vlist" style="height:0.674115em;">
          <span style="top:-3.063em;margin-right:0.05em;">
           <span class="pstrut" style="height:2.7em;">
           </span>
           <span class="sizing reset-size6 size3 mtight">
            <span class="mord mtight">
             <span class="mord mtight">
              ∘
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
       </span>
      </span>
     </span>
     <span class="mord mathit" style="margin-right:0.07153em;">
      C
     </span>
     <span class="mord">
      /
     </span>
     <span class="mord mathit">
      m
     </span>
     <span class="mord mathit">
      s
     </span>
    </span>
   </span>
  </span>
 </span>
 ce qui signifie que pour chaque milliseconde, on a 3.75°C .
</p>
<p>
 Voyons maintenant comment l’utiliser…
</p>
<h5 id="dans-la-pratique-avec-arduino">
 <a aria-hidden="true" href="#dans-la-pratique-avec-arduino">
  <span class="es-autolink-heading">
  </span>
 </a>
 Dans la pratique avec Arduino
</h5>
<p>
 Bon, c’est pas mal on a le côté théorique de la chose, mais ça ne nous dit toujours pas comment on va l’exploiter avec notre Arduino. En effet, générer une PWM on sait faire, mais mesurer une durée d’état haut ça on ne sait pas !
Et bien rassurez-vous, comme d’habitude c’est assez simple. En effet, il existe une fonction dans le framework Arduino qui sert exactement à cela, mesurer une durée d’état haut ou bas.
</p>
<p>
 Cette fonction s’appelle
 <a href="http://arduino.cc/en/Reference/pulseIn">
  <code>
   pulseIn()
  </code>
 </a>
 . Elle prend simplement en paramètres la broche sur laquelle vous voulez faire la mesure et l’état que vous voulez mesurer (HIGH ou LOW). En option, un troisième paramètre permettra de spécifier un "timeout", un temps maximal à attendre avant de décider que la mesure n’est pas possible. Si le timeout est de 2 secondes et que l’état à mesurer n’a pas commencé 2 secondes après l’appel de la fonction, alors cette dernière retournera 0. Dernier détail, l’intervalle de mesure de la fonction est de 10µs à 3 minutes et renvoie un
 <code>
  unsigned long
 </code>
 représentant la durée de l’état en
 <strong>
  microsecondes
 </strong>
 .
</p>
<p>
 Voilà, vous savez tout pour utiliser cette fonction ! Il ne faut pas oublier cependant que la broche sur laquelle nous allons faire la mesure doit être placée en INPUT lors du setup()
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
 .
</p>
<p>
 Reprenons maintenant l’exemple commencé ci-dessus.
</p>
<p>
 Pour mesurer la température, nous allons mesurer l’état haut en sachant que celui-ci sera proportionnel à la température. Un code simple serait donc :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> capteur = <span class="hljs-number">2</span>; <span class="hljs-comment">// en admettant que le capteur de température soit sur la broche 2</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
   pinMode(capteur, INPUT);
   Serial.begin(<span class="hljs-number">9600</span>); <span class="hljs-comment">// pour afficher la température</span>
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> duree = pulseIn(capteur, HIGH, <span class="hljs-number">25000</span>);
   <span class="hljs-comment">// dans notre exemple la valeur est dans l'intervalle [0, 20000]</span>
   <span class="hljs-keyword">float</span> temperature = duree*<span class="hljs-number">0.00375</span>; <span class="hljs-comment">// 3.75 °C par ms donc 0.00375 °C par µs</span>

   <span class="hljs-comment">/* Dans notre cas, on n'utilise pas "map()" car la fonction fait des arrondis,
   ce qui risquerait de nous faire perdre de l'informations */</span>

   Serial.print(<span class="hljs-string">"Duree lue : "</span>);
   Serial.println(duree, DEC);
   Serial.print(<span class="hljs-string">"Temperature : "</span>);
   Serial.println(temperature);

   delay(<span class="hljs-number">200</span>); <span class="hljs-comment">// pour ne pas spammer la voie série</span>
}
</code></pre>
 </div>
 <figcaption>
  Mise en pratique de
  <code>
   pulseIn
  </code>
 </figcaption>
</figure>
<h5 id="simulation-de-lexemple">
 <a aria-hidden="true" href="#simulation-de-lexemple">
  <span class="es-autolink-heading">
  </span>
 </a>
 Simulation de l’exemple
</h5>
<p>
 Si comme moi vous n’avez pas de capteur retournant une PWM, voici un petit montage tout simple permettant de tester ce concept.
</p>
<p>
 Pour cela, nous allons utiliser une PWM de l’Arduino ! En effet, on sait depuis le chapitre
 <a href="https:// zestedesavoir.com/tutoriels/537/arduino-premiers-pas-en-informatique-embarquee/745/les-grandeurs-analogiques/3432/et-les-sorties-analogiques-enfin-presque/">
  Sorties analogiques
 </a>
 faire varier un rapport cyclique dans une PWM, on va donc l’appliquer ici pour tester
 <code>
  pulseIn()
 </code>
 .
</p>
<p>
 Pour cela, reliez une broche PWM à la broche qui vous sert de capteur puis essayez de réaliser ce que l’on vient de voir.
</p>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   La fréquence de la PWM via Arduino est d’environ 490Hz, ce qui signifie que la durée d’état haut pourra varier entre 0ms et 2,04ms
  </p>
 </div>
</div>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> capteur = <span class="hljs-number">2</span>; <span class="hljs-comment">// broche capteur</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> emetteur = <span class="hljs-number">3</span>; <span class="hljs-comment">// broche PWM</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
   pinMode(capteur, INPUT);
   pinMode(emetteur, OUTPUT);

   Serial.begin(<span class="hljs-number">9600</span>);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
   analogWrite(emetteur, <span class="hljs-number">127</span>); <span class="hljs-comment">// test avec une valeur moyenne : environ 1ms</span>
   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> duree = pulseIn(capteur, HIGH);

   Serial.print(<span class="hljs-string">"Duree : "</span>);
   Serial.println(duree, DEC); <span class="hljs-comment">// vérifie qu'on a bien la durée attendue</span>

   delay(<span class="hljs-number">250</span>);
}
</code></pre>
 </div>
 <figcaption>
  Simulation d’un capteur PWM et exploitation de
  <code>
   pulseIn
  </code>
 </figcaption>
</figure>
<h4 id="Étude-de-cas-le-capteur-de-distance-srf05">
 <a aria-hidden="true" href="#Étude-de-cas-le-capteur-de-distance-srf05">
  <span class="es-autolink-heading">
  </span>
 </a>
 Étude de cas : le capteur de distance SRF05
</h4>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   Un tutoriel plus complet sur ce capteur peut être trouvé ici :
   <a href="https://zestedesavoir.com/tutoriels/539/realiser-un-telemetre-a-ultrasons/">
    https://zestedesavoir.com/tutoriels/539/realiser-un-telemetre-a-ultrasons/
   </a>
  </p>
 </div>
</div>
<p>
 Prenons un exemple, le télémètre ultrason SRF05 dont la doc. technique a été retranscrite
 <a href="http://www.robot-electronics.co.uk/htm/srf05tech.htm">
  ici
 </a>
 .
</p>
<p>
 Ce composant est l’exemple classique du capteur renvoyant un créneau codant l’information. En effet, ce dernier mesure ce que l’on appelle un
 <strong>
  temps de vol
 </strong>
 . Explications !
Le SRF05 est un télémètre ultra-son. Pour mesurer une distance, il compte le temps que met une onde pour faire un aller-retour. Un chronomètre est déclenché lors du départ de l’onde et est arrêté lorsque l’on détecte le retour de l’onde (une fois que celle-ci a "rebondi" sur un obstacle). Puisque l’on connait la vitesse de propagation (V) de l’onde dans l’air, on peut déterminer la distance (d) nous séparant de l’objet. On a donc la formule :
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        v
       </mi>
       <mo>
        =
       </mo>
       <mfrac>
        <mrow>
         <mi>
          d
         </mi>
        </mrow>
        <mrow>
         <mi>
          t
         </mi>
        </mrow>
       </mfrac>
      </mrow>
      <annotation encoding="application/x-tex">
       v = \frac{d}{t}
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.8801079999999999em;">
    </span>
    <span class="strut bottom" style="height:1.2251079999999999em;vertical-align:-0.345em;">
    </span>
    <span class="base">
     <span class="mord mathit" style="margin-right:0.03588em;">
      v
     </span>
     <span class="mord rule" style="margin-right:0.2777777777777778em;">
     </span>
     <span class="mrel">
      =
     </span>
     <span class="mord rule" style="margin-right:0.2777777777777778em;">
     </span>
     <span class="mord">
      <span class="mopen nulldelimiter">
      </span>
      <span class="mfrac">
       <span class="vlist-t vlist-t2">
        <span class="vlist-r">
         <span class="vlist" style="height:0.8801079999999999em;">
          <span style="top:-2.6550000000000002em;">
           <span class="pstrut" style="height:3em;">
           </span>
           <span class="sizing reset-size6 size3 mtight">
            <span class="mord mtight">
             <span class="mord mathit mtight">
              t
             </span>
            </span>
           </span>
          </span>
          <span style="top:-3.15em;">
           <span class="pstrut" style="height:3em;">
           </span>
           <span class="stretchy" style="height:0.2em;">
            <svg height="0.2em" preserveaspectratio="xMinYMin slice" viewbox="0 0 400000 200" width="400em">
             <path d="M0 80H400000 v40H0z M0 80H400000 v40H0z">
             </path>
            </svg>
           </span>
          </span>
          <span style="top:-3.394em;">
           <span class="pstrut" style="height:3em;">
           </span>
           <span class="sizing reset-size6 size3 mtight">
            <span class="mord mtight">
             <span class="mord mathit mtight">
              d
             </span>
            </span>
           </span>
          </span>
         </span>
         <span class="vlist-s">
          ​
         </span>
        </span>
        <span class="vlist-r">
         <span class="vlist" style="height:0.345em;">
         </span>
        </span>
       </span>
      </span>
      <span class="mclose nulldelimiter">
      </span>
     </span>
    </span>
   </span>
  </span>
 </span>
 soit
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        d
       </mi>
       <mo>
        =
       </mo>
       <mi>
        t
       </mi>
       <mo>
        ×
       </mo>
       <mi>
        v
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       d = t \times v
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.69444em;">
    </span>
    <span class="strut bottom" style="height:0.77777em;vertical-align:-0.08333em;">
    </span>
    <span class="base">
     <span class="mord mathit">
      d
     </span>
     <span class="mord rule" style="margin-right:0.2777777777777778em;">
     </span>
     <span class="mrel">
      =
     </span>
     <span class="mord rule" style="margin-right:0.2777777777777778em;">
     </span>
     <span class="mord mathit">
      t
     </span>
     <span class="mord rule" style="margin-right:0.2222222222222222em;">
     </span>
     <span class="mbin">
      ×
     </span>
     <span class="mord rule" style="margin-right:0.2222222222222222em;">
     </span>
     <span class="mord mathit" style="margin-right:0.03588em;">
      v
     </span>
    </span>
   </span>
  </span>
 </span>
 .
</p>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   Le temps mesuré correspond à l’aller ET au retour de l’onde, on a donc deux fois la distance. Il ne faudra pas oublier de diviser le résultat par deux pour obtenir la distance réelle qui nous sépare de l’objet.
  </p>
 </div>
</div>
<p>
 Comme expliqué dans la documentation, pour utiliser le sonar il suffit de générer un état haut pendant 10 µs puis ensuite mesurer l’état haut généré par le sonar.
</p>
<p>
 Ce dernier représente le temps que met l’onde à faire son aller-retour. Si l’onde met plus de 30ms à faire son voyage, elle est alors considérée comme perdue et la ligne repasse à LOW.
</p>
<p>
 Et voilà, vous avez maintenant toutes les informations pour faire un petit programme d’essai pour utiliser ce sonar.
</p>
<p>
 Ah, une dernière information… La vitesse d’une onde sonore dans l’air à 15°C est de 340 mètres par seconde. Ça pourrait être utile !
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> VITESSE 340 <span class="hljs-comment">// vitesse du son 340 m/s</span></span>

<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> declencheur = <span class="hljs-number">2</span>; <span class="hljs-comment">// la broche servant à déclencher la mesure</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> capteur = <span class="hljs-number">3</span>; <span class="hljs-comment">// la broche qui va lire la mesure</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
   pinMode(declencheur, OUTPUT);
   pinMode(capteur, INPUT);

   digitalWrite(declencheur, LOW);
   Serial.begin(<span class="hljs-number">9600</span>);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
   digitalWrite(declencheur, HIGH);
   delayMicroseconds(<span class="hljs-number">10</span>); <span class="hljs-comment">// on attend 10 µs</span>
   digitalWrite(declencheur, LOW);

   <span class="hljs-comment">// puis on récupère la mesure</span>
   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> duree = pulseIn(capteur, HIGH);

   <span class="hljs-keyword">if</span>(duree &gt; <span class="hljs-number">30000</span>)
   {
      <span class="hljs-comment">// si la durée est supérieure à 30ms, l'onde est perdue</span>
      Serial.println(<span class="hljs-string">"Onde perdue, mesure echouee !"</span>);
   }
   <span class="hljs-keyword">else</span>
   {
      <span class="hljs-comment">// l'onde est revenue ! on peut faire le calcul</span>
      <span class="hljs-comment">// on divise par 2 pour n'avoir qu'un trajet (plutôt que l'aller-retour)</span>
      duree = duree/<span class="hljs-number">2</span>;
      <span class="hljs-keyword">float</span> temps = duree/<span class="hljs-number">1000000.0</span>; <span class="hljs-comment">// on met en secondes</span>
      <span class="hljs-keyword">float</span> distance = temps*VITESSE; <span class="hljs-comment">// on multiplie par la vitesse, d=t*v</span>

      Serial.print(<span class="hljs-string">"Duree = "</span>);
      Serial.println(temps); <span class="hljs-comment">// affiche le temps de vol d'un trajet en secondes</span>
      Serial.print(<span class="hljs-string">"Distance = "</span>);
      Serial.println(distance); <span class="hljs-comment">// affiche la distance mesurée</span>
   }

   delay(<span class="hljs-number">250</span>);
}
</code></pre>
 </div>
 <figcaption>
  Utilisation d’un capteur à ultrasons
 </figcaption>
</figure>
<div class="video-container">
 <div class="video-wrapper">
  <iframe allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/vB4oMEFHZSo" width="560">
  </iframe>
 </div>
</div>
<h3 id="capteur-à-signal-de-sortie-de-fréquence-variable">
 <a aria-hidden="true" href="#capteur-à-signal-de-sortie-de-fréquence-variable">
  <span class="es-autolink-heading">
  </span>
 </a>
 Capteur à signal de sortie de fréquence variable
</h3>
<p>
 Voyons maintenant un autre type de sortie très similaire à celui vu ci-dessus, la fréquence. Les capteurs de ce type vont donc vous délivrer une fréquence variable en fonction de la valeur mesurée. Je ne vais pas vous mentir, je n’ai pas d’exemple en tête !
Cependant, il est facile d’imaginer comment les utiliser en prenant en compte ce que l’on vient de voir pour le capteur renvoyant une PWM.
</p>
<p>
 En effet, considérons un capteur nous envoyant un signal de type "créneau" à une fréquence
 <em>
  f
 </em>
 . Un créneau possède en théorie une durée d’état haut égale à la durée de l’état bas. Si on fait donc une mesure de cette durée d’état haut via
 <code>
  pulseIn()
 </code>
 vue précédemment, on peut aisément déduire la période (T) du signal (qui sera égale à deux fois la valeur lue) et ainsi la fréquence puisque
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        f
       </mi>
       <mo>
        =
       </mo>
       <mn>
        1
       </mn>
       <mi mathvariant="normal">
        /
       </mi>
       <mi>
        T
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       f = 1/T
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.75em;">
    </span>
    <span class="strut bottom" style="height:1em;vertical-align:-0.25em;">
    </span>
    <span class="base">
     <span class="mord mathit" style="margin-right:0.10764em;">
      f
     </span>
     <span class="mord rule" style="margin-right:0.2777777777777778em;">
     </span>
     <span class="mrel">
      =
     </span>
     <span class="mord rule" style="margin-right:0.2777777777777778em;">
     </span>
     <span class="mord">
      1
     </span>
     <span class="mord">
      /
     </span>
     <span class="mord mathit" style="margin-right:0.13889em;">
      T
     </span>
    </span>
   </span>
  </span>
 </span>
 .
</p>
<p>
 De manière programmatoire, on obtiendra donc le code suivant :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> capteur = <span class="hljs-number">2</span>; <span class="hljs-comment">// broche sur laquelle est branchée le capteur</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
   pinMode(capteur, INPUT);

   Serial.begin(<span class="hljs-number">9600</span>);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> duree = pulseIn(capteur, HIGH); <span class="hljs-comment">// ou LOW, ce serait pareil !</span>
   duree = duree*<span class="hljs-number">2</span>; <span class="hljs-comment">// pour avoir la période complète</span>

   <span class="hljs-comment">// hop! on calcule la fréquence !</span>
   <span class="hljs-keyword">float</span> frequence = <span class="hljs-number">1.0</span>/duree;
   <span class="hljs-comment">// passe la fréquence en Hz (car la période était mesurée en µs)</span>
   frequence = frequence*<span class="hljs-number">1000000</span>;
   Serial.print(<span class="hljs-string">"Frequence = "</span>);
   Serial.println(frequence);

   delay(<span class="hljs-number">250</span>);
}
</code></pre>
 </div>
 <figcaption>
  Mesurer une fréquence
 </figcaption>
</figure>
<h4 id="exemple--exercice">
 <a aria-hidden="true" href="#exemple--exercice">
  <span class="es-autolink-heading">
  </span>
 </a>
 Exemple / Exercice
</h4>
<p>
 Afin de mettre tout cela en pratique, je vous propose un petit exercice pour mettre en œuvre ce dernier point. Peu de matériel est à prévoir.
</p>
<h5 id="principe-1">
 <a aria-hidden="true" href="#principe-1">
  <span class="es-autolink-heading">
  </span>
 </a>
 Principe
</h5>
<p>
 Pour cet exercice, je vous propose d’émuler le comportement d’un capteur générant une fréquence variable.
</p>
<p>
 Nous allons utiliser un potentiomètre qui va nous servir de "variateur". Ensuite nous allons utiliser une fonction propre à Arduino pour générer une fréquence particulière qui sera l’image multipliée par 10 de la valeur mesurée du potentiomètre. Enfin, nous allons "reboucler" la sortie "fréquence" sur une entrée quelconque sur laquelle nous mesurerons cette fréquence.
</p>
<p>
 C’est clair ? J’espère !
</p>
<h6 id="la-fonction-tone">
 <a aria-hidden="true" href="#la-fonction-tone">
  <span class="es-autolink-heading">
  </span>
 </a>
 La fonction tone()
</h6>
<p>
 Pour faire cette exercice vous connaissez déjà tout à une chose près : Comment générer une fréquence. Pour cela, je vous propose de partir à la découverte de la fonction
 <code>
  tone()
 </code>
 . Cette dernière génère une fréquence sur une broche, n’importe laquelle. Elle prend en paramètre la broche sur laquelle le signal doit être émis ainsi que la fréquence à émettre. Par exemple, pour faire une fréquence de 100Hz sur la broche 3 on fera simplement :
 <code>
  tone(3, 100);
 </code>
 .
</p>
<p>
 Un troisième argument peut-être utilisé. Ce dernier sert à indiquer la durée pendant laquelle le signal doit être émis. Si on omet cet argument, la fréquence sera toujours générée jusqu’à l’appel de la fonction antagoniste
 <code>
  noTone()
 </code>
 à laquelle on passe en paramètre la broche sur laquelle le signal doit être arrêté.
</p>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   L’utilisation de la fonction tone interfère avec le module PWM des broches 3 et 11. Gardez-le en mémoire
   <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
   . Cette fonction ne peut pas non plus descendre en dessous de 31Hz.
  </p>
 </div>
</div>
<p>
 Vous avez toutes les informations, maintenant à vous de jouer !
</p>
<h5 id="correction">
 <a aria-hidden="true" href="#correction">
  <span class="es-autolink-heading">
  </span>
 </a>
 Correction
</h5>
<p>
 Voici ma correction commentée. Comme il n’y a rien de réellement compliqué, je ne vais pas faire des lignes d’explications et vous laisser simplement avec le code et ses commentaires
 <img alt=":diable:" class="smiley" src="./static/smileys/diable.png"/>
 !
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> potar = <span class="hljs-number">0</span>; <span class="hljs-comment">// potentiomètre sur la broche A0;</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> emetteur = <span class="hljs-number">8</span>; <span class="hljs-comment">// fréquence émise sur la broche 8</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> recepteur = <span class="hljs-number">2</span>; <span class="hljs-comment">// fréquence mesurée sur la broche 2</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
   pinMode(emetteur, OUTPUT);
   pinMode(recepteur, INPUT);

   Serial.begin(<span class="hljs-number">9600</span>);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
   <span class="hljs-comment">// fait la lecture analogique (intervalle [0;1023] )</span>
   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> mesure = <span class="hljs-number">100</span>;

   <span class="hljs-comment">// applique la mesure comme fréquence (intervalle [0;10230] )</span>
   tone(emetteur, mesure*<span class="hljs-number">10</span>);

   <span class="hljs-comment">// mesure la demi-période</span>
   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> periode = pulseIn(recepteur, HIGH);
   <span class="hljs-comment">// pour avoir une période complète on multiplie par 2</span>
   periode = periode*<span class="hljs-number">2</span>;
   <span class="hljs-comment">// transforme en fréquence</span>
   <span class="hljs-keyword">float</span> frequence = <span class="hljs-number">1.0</span>/periode;
   <span class="hljs-comment">// passe la fréquence en Hz (car la période était mesurée en µs)</span>
   frequence = frequence*<span class="hljs-number">1000000</span>;

   Serial.print(<span class="hljs-string">"Mesure : "</span>);
   Serial.println(mesure, DEC);
   Serial.print(<span class="hljs-string">"Periode : "</span>);
   Serial.println(periode, DEC);
   Serial.print(<span class="hljs-string">"Frequence : "</span>);
   Serial.println(frequence);

   delay(<span class="hljs-number">250</span>);
}
</code></pre>
 </div>
 <figcaption>
  Générateur et mesure de fréquence, correction
 </figcaption>
</figure>
<h3 id="capteur-utilisant-un-protocole-de-communication">
 <a aria-hidden="true" href="#capteur-utilisant-un-protocole-de-communication">
  <span class="es-autolink-heading">
  </span>
 </a>
 Capteur utilisant un protocole de communication
</h3>
<p>
 Certains capteurs ne renvoient pas l’information sous forme "physique" dans le sens où ils ne renvoient pas quelque chose de mesurable directement, comme un temps ou une tension. Non, ces derniers préfèrent envoyer l’information encapsulée bien au chaud dans une trame d’un protocole de communication.
</p>
<p>
 Le gros intérêt de cette méthode est très probablement la résistance au "bruit". Je ne parle bien sûr pas des cris des enfants du voisin ou les klaxons dans la rue mais bien de bruit électronique. Ce dernier est partout et peut avoir des conséquences ennuyeuses sur vos mesures. Transmettre l’information par un protocole de communication est donc un moyen fiable de garantir que la donnée arrivera de manière intègre jusqu’au destinataire. De plus, on peut facilement coupler cette transmission avec un protocole de vérification simple ou compliqué (comme la vérification de parité ou un calcul de CRC).
</p>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   Cette partie ne va pas vous enseigner comment utiliser chacun des moyens de communication que nous allons voir. En effet, il s’agit plutôt d’une introduction/ouverture sur l’existence de ces derniers. Ils seront traités de manière indépendante dans des chapitres dédiés comme le fût
   <a href="https://zestedesavoir.com/tutoriels/686/arduino-premiers-pas-en-informatique-embarquee/744_la-communication-avec-arduino/">
    la voie série
   </a>
   .
  </p>
 </div>
</div>
<h4 id="quelques-protocoles-de-communication">
 <a aria-hidden="true" href="#quelques-protocoles-de-communication">
  <span class="es-autolink-heading">
  </span>
 </a>
 Quelques protocoles de communication
</h4>
<h5 id="voie-série--uart">
 <a aria-hidden="true" href="#voie-série--uart">
  <span class="es-autolink-heading">
  </span>
 </a>
 Voie série / UART
</h5>
<p>
 Ce protocole vous devez déjà le connaître par cœur puisque nous l’utilisons presque dans tous les chapitres ! Il s’agit en effet de la voie série via
 <code>
  Serial
 </code>
 . Rien de réellement compliqué donc tellement vous êtes habitués à le voir !
Ceci est une liaison point-à-point, donc seuls deux composants (l’Arduino et le capteur) peuvent être reliés entre eux directement. Elle est généralement bi-directionnelle, ce qui signifie que les deux composants reliés peuvent émettre en même temps.
</p>
<h5 id="i2c">
 <a aria-hidden="true" href="#i2c">
  <span class="es-autolink-heading">
  </span>
 </a>
 I2C
</h5>
<p>
 Le protocole I²C (
 <em>
  Inter-Integrated Circuit
 </em>
 ) ou TWI (
 <em>
  Two Wire Interface
 </em>
 ) permet d’établir une liaison de type "maître/esclave". L’Arduino sera maître et le capteur l’esclave (l’Arduino peut aussi être un esclave dans certains cas). Ainsi, l’Arduino émettra les ordres pour faire les demandes de données et le capteur, lorsqu’il recevra cet ordre, la renverra.
</p>
<p>
 Ce protocole utilise 3 fils. Un pour la masse et ainsi avoir un référentiel commun, un servant à émettre un signal d’horloge (SCL) et un dernier portant les données synchronisées avec l’horloge (SDA).
</p>
<p>
 Chez Arduino, il existe une librairie pour utiliser l’I2C, elle s’appelle
 <code>
  Wire
 </code>
 .
</p>
<p>
 On peut placer plusieurs esclaves à la suite. Un code d’adresse est alors utilisé pour décider à quel composant le maître fait une requête.
</p>
<div class="video-container">
 <div class="video-wrapper">
  <iframe allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/5_ZEJNjwF1Q" width="560">
  </iframe>
 </div>
</div>
<h5 id="spi">
 <a aria-hidden="true" href="#spi">
  <span class="es-autolink-heading">
  </span>
 </a>
 SPI
</h5>
<p>
 Le SPI (Serial Peripheral Interface) est une sorte de combo entre la voie série et l’I2C. Elle prend le meilleur des deux mondes.
</p>
<p>
 Comme en voie série, la liaison est bi-directionnelle et point-à-point
 <sup id="fnref-1-OegZLxgDF">
  <a class="footnote-ref" href="#fn-1-OegZLxgDF">
   1
  </a>
 </sup>
 . Cela signifie que Arduino et le capteur sont reliés directement entre eux et ne peuvent que parler entre eux. Cela signifie aussi que les deux peuvent s’envoyer des données simultanément.
</p>
<p>
 Comme en I2C, la liaison est de type maître/esclave. L’un fait une demande à l’autre, le maître transmet l’horloge à l’esclave pour transmettre les données.
</p>
<p>
 Cette transmission utilise 4 fils. Une masse pour le référentiel commun, un fil d’horloge (SCLK), un fil nommé MOSI (
 <em>
  Master Output, Slave Input
 </em>
 , données partant de l’Arduino et allant vers le capteur) et MISO (
 <em>
  Master Input, Slave Output
 </em>
 , données partant du capteur et allant vers l’Arduino).
</p>
<p>
 Chez Arduino, il existe une librairie pour utiliser le SPI, elle s’appelle …
 <code>
  SPI
 </code>
 .
</p>
<h5 id="protocole-propriétaire">
 <a aria-hidden="true" href="#protocole-propriétaire">
  <span class="es-autolink-heading">
  </span>
 </a>
 Protocole propriétaire
</h5>
<p>
 Ici pas de solution miracle, il faudra manger de la documentation technique (très formateur !). En effet, si le constructeur décide d’implémenter un protocole à sa sauce alors ce sera à vous de vous plier et de coder pour réussir à l’implémenter et l’utiliser.
</p>
<p>
 Vous savez maintenant tout sur les capteurs, votre Arduino peut maintenant "sentir" le monde qui l’entoure comme promis en introduction de cette partie. Mais ce n’est pas fini, il existe un grand nombre de capteurs, beaucoup trop important pour en faire une liste exhaustive dans un tutoriel comme celui-ci.
Maintenant que vous pouvez percevoir le monde, passons à la suite en essayant d’interagir avec ce dernier grâce à l’utilisation des moteurs.
</p>
<div class="footnotes">
 <hr/>
 <ol>
  <li id="fn-1-OegZLxgDF">
   <p>
    Afin d’améliorer cette voie série, il existe une autre broche nommée SS (Slave Select) permettant de choisir à quel composant le maître parle. Ainsi la liaison n’est plus limitée à un esclave seulement.
   </p>
   <a class="footnote-backref" href="#fnref-1-OegZLxgDF" title="Retourner au texte de la note 1">
    ↩
   </a>
  </li>
 </ol>
</div>
            </div>
            <!-- /.entry-content -->
            <hr>
            <div class="row bg-light my-2 py-2 rounded">
                <div class="col mr-auto">
                    <a class="" href="/tuto-arduino-502-différents-types-de-mesures" rel="prev">
                        <i class="fas fa-chevron-left fa-lg"></i>
                        tuto-arduino-502-différents-types-de-mesures
                    </a>
                </div>
                <div class="col-auto">
                    <a class="" href="/tuto-arduino-601-le-moteur-à-courant-continu" rel="next">
                        tuto-arduino-601-le-moteur-à-courant-continu
                        <i class="fas fa-chevron-right fa-lg"></i>
                    </a>
                </div>
            </div>
            <div class="text-center">
                <img class="es-licence-pic" src="/static/images/CC BY-NC-SA.png" alt="Licence CC BY-NC-SA" title="Article sous licence CC BY-NC-SA">
            </div>
            <div class="my-3 text-center">
                <a class="btn btn-outline-dark mx-1" href="https://twitter.com/share?url=https://eskimon.fr/tuto-arduino-503-des-capteurs-plus-évolués&amp;text=Des capteurs plus évolués - https://eskimon.fr/tuto-arduino-503-des-capteurs-plus-évolués" rel="nofollow" title="Partager cet article sur Twitter" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-twitter fa-lg"></i>
                </a>
                <a class="btn btn-outline-dark mx-1" href="https://www.facebook.com/sharer.php?u=https://eskimon.fr/tuto-arduino-503-des-capteurs-plus-évolués&amp;t=Des capteurs plus évolués - https://eskimon.fr/tuto-arduino-503-des-capteurs-plus-évolués" rel="nofollow" title="Partager cet article sur Facebook" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-facebook-f fa-lg"></i>
                </a>
                <a class="btn btn-outline-dark mx-1" href="https://plus.google.com/share?url=https://eskimon.fr/tuto-arduino-503-des-capteurs-plus-évolués&amp;hl=fr" rel="nofollow" title="Partager cet article sur Google +" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-google-plus fa-lg"></i>
                </a>
                <!--<a class="btn btn-outline-dark mx-1" href="http://sharetodiaspora.github.io/?url=https://eskimon.fr/tuto-arduino-503-des-capteurs-plus-évolués&amp;title=Des capteurs plus évolués - https://eskimon.fr/tuto-arduino-503-des-capteurs-plus-évolués" rel="nofollow"  title="Partager cet article sur Diaspora" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-google-plus fa-lg"></i>
                </a>-->
                <a class="btn btn-outline-dark mx-1" href="mailto:?subject=Des capteurs plus évolués&amp;body=https://eskimon.fr/tuto-arduino-503-des-capteurs-plus-évolués"rel="nofollow" title="Partager cet article par email" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="far fa-envelope fa-lg"></i>
                </a>
            </div>
            <hr>
            <div class="text-center">
                <!-- billboard horizontal fin article -->
                <ins class="adsbygoogle" style="display:inline-block;width:970px;height:250px" data-ad-client="ca-pub-2080155902357792" data-ad-slot="6471099302"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
            <!-- disqus start -->
            <div id="disqus_thread"></div>
            <script>
                var disqus_config = function () {
                    this.page.url = 'https://eskimon.fr/tuto-arduino-503-des-capteurs-plus-évolués';
                    this.page.identifier = 'tuto-arduino-503-des-capteurs-plus-évolués';
                    this.page.title = 'Des capteurs plus évolués';
                };
                (function () { // DON'T EDIT BELOW THIS LINE
                    var d = document, s = d.createElement('script');
                    s.src = 'https://eskimon-fr.disqus.com/embed.js';
                    s.setAttribute('data-timestamp', +new Date());
                    (d.head || d.body).appendChild(s);
                })();
            </script>
            <noscript>Please enable JavaScript to view the
                <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
            </noscript>
            <!-- disqus end -->
        </article>
    </div>
    <div class="d-none d-xl-block col-xl-1 offset-xl-1 px-0">
        <div class="d-flex flex-column justify-content-around align-items-end h-100" id="es-right-ad-block">
            <!-- Pub ajouté auto -->
        </div>
    </div>
</div>
    </div>
<footer class="container-fluid bg-dark small text-white px-3">
<div class="row">
    <div class="col align-self-center">
        © Eskimon -
        Blog propulsé par <a class="bold text-white" href="https://blog.getpelican.com/" rel="nofollow">Pelican</a> -
        Thème fait maison
    </div>
    <div class="col align-self-end text-right">
        <a class="btn btn-lg text-light" href="https://github.com/Eskimon" rel="nofollow" title="Mon profil Github">
            <i class="fab fa-github fa-lg"></i>
        </a>
        <a class="btn btn-lg text-light" href="https://twitter.com/Eskimon_fr" rel="nofollow" title="Me suivre sur Twitter">
            <i class="fab fa-twitter fa-lg"></i>
        </a>
        <a class="btn btn-lg text-light" href="https://twitch.tv/eskimon" rel="nofollow" title="Me suivre sur Twitch">
            <i class="fab fa-twitch fa-lg"></i>
        </a>
        <a class="btn btn-lg text-light" href="https://www.youtube.com/user/Eskimon49/featured" rel="nofollow" title="Les VOD sur Youtube">
            <i class="fab fa-youtube fa-lg"></i>
        </a>
        <a class="btn btn-lg text-light" href="https://discord.gg/9SkDWft" rel="nofollow" title="Venez participer sur Discord">
            <i class="fab fa-discord fa-lg"></i>
        </a>
    </div>
  </div>
</footer>
    <!-- For formula -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- Font awesome -->
    <script src="https://use.fontawesome.com/releases/v5.0.0/js/all.js"></script>
    <!-- JQuery first -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <!-- Popper.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <!-- Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- For tooltips -->
    <script>$(function () {  $('[data-toggle="tooltip"]').tooltip()})</script>
    <script src="/static/js/my-scripts.js"></script>
<script>
function create_side_summary() {
    // Duplicate summary
    var main_summary = $('#sommaire').next();
    if(main_summary.length === 0)
        return
    var side_summary = main_summary.clone();
    side_summary.addClass('pl-0');
    var all_p = side_summary.find('p');
    all_p.contents().unwrap();
    var all_li = side_summary.find('li');
    all_li.addClass('pl-1');

    // scrollspy - in
    side_summary.attr('id', 'es-side-summary-mainlist');
    //side_summary.addClass('nav');
    //all_li.addClass('nav-item');
    var all_a = side_summary.find('a');
    all_a.addClass('nav-link');
    var all_ul = side_summary.find('ul');
    all_ul.addClass('pl-1');
    $('body').scrollspy({ target: '#es-side-summary-mainlist' });
    // scrollspy - out

    var summary_title = document.createElement("h4");
    summary_title.className = 'navbar-brand';
    summary_title.innerHTML = 'Sommaire';
    $(summary_title).prependTo('#es-side-summary-content');
    side_summary.appendTo('#es-side-summary-content');
    main_summary.addClass('es-subul-collapse');
}

function generate_spoilers() {
    all_secret = $('.custom-block-spoiler');
    all_secret.each(function( index ) {
        let content = $(this).html();
        $(this).html('');
        $(this).addClass('card');
        var headerText = document.createElement("button");
        var cardHeader = document.createElement("div");
        var cardBodyWrapper = document.createElement("div");
        var cardBody = document.createElement("div");
        $(headerText).text('Contenu masqué, cliquez pour afficher');
        $(headerText).addClass('btn btn-link btn-sm');
        $(headerText).attr('data-toggle', 'collapse');
        $(headerText).attr('data-target', '#collapse-' + index);
        $(headerText).attr('aria-controls', 'collapse-' + index);
        $(headerText).attr('aria-expanded', 'false');
        $(cardHeader).append(headerText);
        $(cardHeader).addClass('card-header');
        $(cardHeader).attr('id', 'spoiler-' + index);
        $(cardBody).html(content);
        $(cardBody).addClass('card-body');
        $(cardBodyWrapper).append(cardBody);
        $(cardBodyWrapper).addClass('collapse hide');
        $(cardBodyWrapper).attr('id', 'collapse-' + index)
        $(cardBodyWrapper).attr('aria-labelledby', 'spoiler-' + index)
        $(this).prepend(cardHeader);
        $(this).append(cardBodyWrapper);
    });

    $('.collapse').collapse({toggle: false});
}

function load_extra_ads() {
    return;
    // Load right side blocks
    var sidebar = $('#es-right-ad-block');
    var n_height = Math.floor(sidebar.height() / 2000);
    for (i = 0; i < n_height; i++) {
        var frag = document.createDocumentFragment();
        var newAdBlock = document.createElement("div");
        var block1 = document.createElement("ins");
        var block2 = document.createElement("script");

        block1.innerHTML = '<ins class="adsbygoogle" ' +
            'style="display:inline-block;width:120px;height:600px" ' +
            'data-ad-client="ca-pub-2080155902357792" ' +
            'data-ad-slot="4023722026"></ins>';
        block2.innerHTML = '(adsbygoogle = window.adsbygoogle || []).push({});';

        $(newAdBlock).append(block1);
        $(newAdBlock).append(block2);
        $(frag).append(newAdBlock);

        $(sidebar).append(frag);
    }

    // Load in feed blocks (above every h3)
    var frag = document.createDocumentFragment();
    var newAdBlock = document.createElement("div");
    var block1 = document.createElement("ins");
    var block2 = document.createElement("script");
    block1.innerHTML = '<ins class="adsbygoogle"' +
    'style = "display:inline-block;width:970px;height:90px"' +
    'data - ad - client="ca-pub-2080155902357792"' +
    'data - ad - slot="7100712740" ></ins >'
    block2.innerHTML = '(adsbygoogle = window.adsbygoogle || []).push({});';
    $(newAdBlock).append(block1);
    $(newAdBlock).append(block2);
    newAdBlock.className = 'my-3 text-center';
    $(frag).append(newAdBlock);
    var titles = $('.entry-content h3').slice(1);
    $(frag).insertBefore(titles);
}

$(document).ready(function () {

    create_side_summary();
    generate_spoilers();
    load_extra_ads();

    // when opening the sidebar
    $('#sidebarCollapse').on('click', function () {
        // open sidebar
        $('#es-side-summary').removeClass('d-none');
        $('#es-content').addClass('d-none');
        $('#sidebarCollapse').removeClass('sticky-top');
    });

    // if dismiss or overlay was clicked
    $('#es-side-summary').on('click', function () {
      // hide the sidebar
      $('#es-side-summary').addClass('d-none');
      $('#es-content').removeClass('d-none');
      $('#sidebarCollapse').addClass('sticky-top');
    });
});
</script>

<script id="dsq-count-scr" src="//eskimon-fr.disqus.com/count.js" async></script>
</body>

</html>
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Un moteur qui a de la tête : le Servomoteur &bull; Le blog d'Eskimon</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/hljs-monokai.css" />
    <link rel="stylesheet" href="/static/css/style.css" />
    <!-- Google font -->
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/images/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="57x57" href="/static/images/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/static/images/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/static/images/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/static/images/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/static/images/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/static/images/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/static/images/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/static/images/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/images/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/static/images/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/static/images/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="/static/images/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/static/images/favicon/ms-icon-144x144.png">


    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-46353906-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-46353906-1');
    </script>

    <meta name="description" content="Dans cette partie, voyons comment interfacer un servo-moteur avec Arduino. Étudions aussi ses particularités et comment il fonctionne." />

  <meta name="tags" content="arduino" />
  <meta name="tags" content="tuto" />


  <meta property="og:site_name" content="Le blog d'Eskimon">
  <meta property="og:title" content="Un moteur qui a de la tête : le Servomoteur">
  <meta property="og:url" content="http://eskimon.fr/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur">
  <meta property="og:language" content="fr_FR">
  <meta property="og:type" content="website">

  <meta property="twitter:domain" content="http://eskimon.fr/">
  <meta property="twitter:card" content="summary">
  <meta property="twitter:url" content="http://eskimon.fr/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur">
  <meta property="twitter:title" content="Un moteur qui a de la tête : le Servomoteur">
<meta property="twitter:description" content="Dans cette partie, voyons comment interfacer un servo-moteur avec Arduino. Étudions aussi ses particularités et comment il fonctionne.">  <meta property="twitter:site" content="SITENAME">
  <meta property="twitter:creator" content="@eskimon_fr">

  <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
  <meta name="DC.publisher" lang="fr" content="Le blog d'Eskimon" />
  <meta name="DC.creator" content="Eskimon" />
  <meta name="DC.type" content="text" />
  <meta name="DC.title" content="Un moteur qui a de la tête : le Servomoteur" />
  <meta name="DC.abstract" content="Un moteur qui a de la tête : le Servomoteur – Dans cette partie, voyons comment interfacer un servo-moteur avec Arduino. Étudions aussi ses particularités et comment il fonctionne." />
  <meta name="DC.subject" lang="fr" content="Arduino/Le mouvement grâce aux moteurs – arduino; tuto" />
<meta name="DC.description" lang="fr" content="Dans cette partie, voyons comment interfacer un servo-moteur avec Arduino. Étudions aussi ses particularités et comment il fonctionne." />  <meta name="DC.date" content="2013-12-12T12:22:00+01:00" />
  <meta name="DC.format" content="text/html" />
  <meta name="DC.language" content="fr" />
  <meta name="DC.rights" content="CC BY-NC-SA" />

  <script type="application/ld+json">
    [{
        "@context": "http://schema.org",
        "@type": "Article",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "http://eskimon.fr/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur"
        },
        "headline": "Un moteur qui a de la tête : le Servomoteur",
        "datePublished": "2013-12-12T12:22:00+01:00",
        "image": [
            "http://eskimon.fr/static/images/logo.png"
        ],
        "author": {
            "@type": "Person",
            "name": "Eskimon",
            "image": "http://eskimon.fr/static/images/logo.png"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Eskimon",
            "logo": {
                "@type": "ImageObject",
                "url": "http://eskimon.fr/static/images/logo.png"
            }
        },
        "description": "Dans cette partie, voyons comment interfacer un servo-moteur avec Arduino. Étudions aussi ses particularités et comment il fonctionne."
    },
    {
        "@context": "http://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [{
            "@type": "ListItem",
            "position": 1,
            "item": {
                "@id": "http://eskimon.fr/category/arduino",
                "name": "Arduino"
            }
        }
        , {
            "@type": "ListItem",
            "position": 2,
            "item": {
                "@id": "http://eskimon.fr/subcategory/arduino/le-mouvement-grace-aux-moteurs",
                "name": "Le mouvement grâce aux moteurs"
            }
        }
        , {
            "@type": "ListItem",
            "position": 3,
            "item": {
                "@id": "http://eskimon.fr/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur",
                "name": "Un moteur qui a de la tête : le Servomoteur"
            }
        }]
    }]
    </script>

</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light bg-secondary-l40 py-0">
    <a class="navbar-brand" href="/">
        <img src="/static/images/logo.png" width="20" height="20" alt="">
        Le blog d'Eskimon
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav ml-auto">
                <a class="nav-item nav-link active" href="/category/arduino">Arduino</a>
                <a class="nav-item nav-link " href="/category/articles">Articles</a>
                <a class="nav-item nav-link " href="/category/tuto">Tuto</a>
        </div>
    </div>
</nav>
    <div class="container-fluid es-verticalfill">
<div class="row">
    <!-- Sidebar -->
    <div class="col-lg-2 d-none d-lg-block sticky-top es-scrollable pt-3 px-1 bg-light es-ul-bordered" id="es-side-summary">
        <div id="es-side-summary-bot-annonce">
            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <!-- Blog side carree -->
            <ins class="adsbygoogle"
                 style="display:inline-block;width:250px;height:250px"
                 data-ad-client="ca-pub-2080155902357792"
                 data-ad-slot="6115810402"></ins>
            <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        <hr>
        <nav class="px-2" id="es-side-summary-content">
            <!-- Summary will come here -->
        </nav>
        <hr>
        <!-- Add here self-promo for ebook -->
    </div>
    <!-- Main content -->
    <div class="col-md-10 col-lg-8 col-xl-7 offset-md-1 offset-lg-1 offset-xl-1 d-block pt-3" id="es-content">
        <article>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb bg-white">
                    <li class="breadcrumb-item"><a href="/category/arduino">Arduino</a></li>
                        <li class="breadcrumb-item"><a href="/subcategory/arduino/le-mouvement-grace-aux-moteurs">Le mouvement grâce aux moteurs</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Un moteur qui a de la tête : le Servomoteur</li>
                </ol>
            </nav>
            <header class="es-post-info">
                <h1 class="text-center my-4">Un moteur qui a de la tête : le Servomoteur</h1>
            </header>
            <footer class="es-post-info pb-2 mb-2">
                <div class="row align-items-center">
                    <div class="col-auto mr-auto">
                        <span class="vcard author">
                            <a class="" href="/author/eskimon" rel="author">Eskimon</a>
                        </span>
                        ,
                        <time class="" datetime="2013-12-12T12:22:00+01:00" pubdate>
                            le jeu. 12 décembre 2013
                        </time>
                    </div>
                    <div class="col-auto">
                        <a class="btn btn-outline-primary btn-sm" href="/tag/arduino" rel="tag">arduino</a>
                        <a class="btn btn-outline-primary btn-sm" href="/tag/tuto" rel="tag">tuto</a>
                    </div>
                </div>
            </footer>
            <button type="button" id="sidebarCollapse" class="float-right btn btn-secondary sticky-top d-block d-lg-none">
                Sommaire
            </button>
            <!-- /.post-info -->
            <div class="entry-content">
                <p>
 Dans ce chapitre, nous allons parler d’un moteur que nos amis modélistes connaissent bien : le
 <strong>
  Servomoteur
 </strong>
 (abrégé : "servo"). C’est un moteur un peu particulier, puisqu’il confond un ensemble de mécanique et d’électronique, mais son principe de fonctionnement reste assez simple. Les parties seront donc assez courtes dans l’ensemble car les servomoteurs contiennent dans leur "ventre" des moteurs à courant continu que vous connaissez à présent. Cela m’évitera des explications supplémentaires.
 <img alt=":-°" class="smiley" src="./static/smileys/siffle.png"/>
</p>
<h3 id="sommaire">
 <a aria-hidden="true" href="#sommaire">
  <span class="es-autolink-heading">
  </span>
 </a>
 Sommaire
</h3>
<ul>
 <li>
  <p>
   <a href="#principe-du-servomoteur">
    Principe du servomoteur
   </a>
  </p>
  <ul>
   <li>
    <p>
     <a href="#vue-générale">
      Vue générale
     </a>
    </p>
    <ul>
     <li>
      <a href="#le-servo-un-drôle-de-moteur">
       Le servo, un drôle de moteur
      </a>
     </li>
     <li>
      <a href="#lexemple-de-la-voiture-radiocommandée">
       L’exemple de la voiture radiocommandée
      </a>
     </li>
    </ul>
   </li>
   <li>
    <p>
     <a href="#composition-dun-servomoteur">
      Composition d’un servomoteur
     </a>
    </p>
    <ul>
     <li>
      <a href="#apparence">
       Apparence
      </a>
     </li>
     <li>
      <a href="#connectique">
       Connectique
      </a>
     </li>
     <li>
      <a href="#la-mécanique">
       La mécanique
      </a>
     </li>
     <li>
      <a href="#lélectronique-dasservissement">
       L’électronique d’asservissement
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#la-commande-dun-servomoteur">
    La commande d’un servomoteur
   </a>
  </p>
  <ul>
   <li>
    <p>
     <a href="#le-signal-de-commande">
      Le signal de commande
     </a>
    </p>
    <ul>
     <li>
      <a href="#la-fréquence-fixe">
       La fréquence fixe
      </a>
     </li>
     <li>
      <a href="#la-durée-de-létat-haut">
       La durée de l’état HAUT
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#arduino-et-les-servomoteurs">
    Arduino et les servomoteurs
   </a>
  </p>
  <ul>
   <li>
    <a href="#câblage">
     Câblage
    </a>
   </li>
   <li>
    <p>
     <a href="#la-librairie-servo">
      La librairie Servo
     </a>
    </p>
    <ul>
     <li>
      <a href="#préparer-le-terrain">
       Préparer le terrain
      </a>
     </li>
     <li>
      <a href="#utiliser-le-servo">
       Utiliser le servo
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#lélectronique-dasservissement-1">
    L’électronique d’asservissement
   </a>
  </p>
  <ul>
   <li>
    <a href="#principe-de-fonctionnement">
     Principe de fonctionnement
    </a>
   </li>
   <li>
    <p>
     <a href="#Électronique-à-consigne-manuelle">
      Électronique à consigne manuelle
     </a>
    </p>
    <ul>
     <li>
      <a href="#synoptique-de-lélectronique-interne">
       Synoptique de l’électronique interne
      </a>
     </li>
     <li>
      <a href="#schéma-de-principe">
       Schéma de principe
      </a>
     </li>
     <li>
      <a href="#fonctionnement-du-comparateur">
       Fonctionnement du comparateur
      </a>
     </li>
    </ul>
   </li>
   <li>
    <p>
     <a href="#Électronique-à-consigne-pwm">
      Électronique à consigne PWM
     </a>
    </p>
    <ul>
     <li>
      <a href="#synoptique-de-principe">
       Synoptique de principe
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#un-peu-dexercice">
    Un peu d’exercice !
   </a>
  </p>
  <ul>
   <li>
    <ul>
     <li>
      <a href="#consigne">
       Consigne
      </a>
     </li>
     <li>
      <a href="#objectif">
       Objectif
      </a>
     </li>
    </ul>
   </li>
   <li>
    <p>
     <a href="#correction">
      Correction
     </a>
    </p>
    <ul>
     <li>
      <a href="#fonction-loop">
       Fonction loop()
      </a>
     </li>
     <li>
      <a href="#et-la-liaison-série">
       Et la liaison série
      </a>
     </li>
     <li>
      <a href="#code-final">
       Code final
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#tester-un-servomoteur-non-standard">
    Tester un servomoteur “non-standard”
   </a>
  </p>
  <ul>
   <li>
    <ul>
     <li>
      <a href="#writemicroseconds">
       writeMicroSeconds()
      </a>
     </li>
     <li>
      <a href="#read">
       read()
      </a>
     </li>
    </ul>
   </li>
   <li>
    <a href="#programme-de-test">
     Programme de test
    </a>
   </li>
  </ul>
 </li>
</ul>
<h3 id="principe-du-servomoteur">
 <a aria-hidden="true" href="#principe-du-servomoteur">
  <span class="es-autolink-heading">
  </span>
 </a>
 Principe du servomoteur
</h3>
<p>
 Un servomoteur… Étrange comme nom, n’est-ce pas ? Cela dit, il semblerait qu’il le porte bien puisque ces moteurs, un peu particuliers je le disais, emportent avec eux une électronique de commande (faisant office de "cerveau"). Le nom vient en fait du latin
 <em>
  servus
 </em>
 qui signifie esclave. Mais avant de nous atteler à l’exploration interne de ce cher ami, façon de parler, nous allons avant tout voir à quoi il sert.
</p>
<h4 id="vue-générale">
 <a aria-hidden="true" href="#vue-générale">
  <span class="es-autolink-heading">
  </span>
 </a>
 Vue générale
</h4>
<h5 id="le-servo-un-drôle-de-moteur">
 <a aria-hidden="true" href="#le-servo-un-drôle-de-moteur">
  <span class="es-autolink-heading">
  </span>
 </a>
 Le servo, un drôle de moteur
</h5>
<p>
 Commençons en image, avec la photographie d’un servomoteur :
</p>
<p>
 <img alt="Un servomoteur" src="./images/uploaded/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur/un-servomoteur.jpg"/>
</p>
<p>
 C’est, en règle générale, à quoi ils ressemblent, variant selon leur taille.
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Pfiouuu, c’est quoi ce moteur, ça n’y ressemble même pas !
   <img alt=":o" class="smiley" src="./static/smileys/huh.png"/>
  </p>
 </div>
</div>
<p>
 J’vous l’avais dit que c’était des moteurs particuliers ! En détail, voyons à quoi ils servent. De manière semblable aux moteurs à courant continu, les servomoteurs disposent d’un axe de rotation. Sur la photo, il se trouve au centre de la roue blanche. Cet axe de rotation est en revanche entravé par un système de bridage. Cela ne veut pas dire qu’il ne tourne pas, mais cela signifie qu’il ne peut pas tourner au-delà d’une certaine limite. Par exemple, certains servomoteurs ne peuvent même pas faire tourner leur axe de rotation en leur faisant faire un tour complet ! D’autres en sont capables, mais pas plus d’un tour. Enfin, un cas à part que nous ne ferons qu’évoquer, ceux qui tournent sans avoir de limite (autant de tours qu’ils le veulent). Et là, c’est le moment où je vous dis : "
 <em>
  détrompez-vous !
 </em>
 " en répondant à la question critique que vous avez en tête : "
 <em>
  Un moteur qui ne peut même pas faire un tour avec son axe de rotation, ça ne sert à rien ?
  <img alt="o_O" class="smiley" src="./static/smileys/blink.gif"/>
 </em>
 " En effet, s’il ne peut pas faire avancer votre robot, il peut cependant le guider. Prenons l’exemple d’une petite voiture de modélisme à quatre roues. Les roues arrière servent à faire avancer la voiture, elles sont mises en rotation par un moteur à courant continu, tandis que les roues avant, qui servent à la direction de la voiture pour ne pas qu’elle se prenne les murs, sont pilotées par un servomoteur. Comment ? Eh bien nous allons vous l’expliquer.
</p>
<h5 id="lexemple-de-la-voiture-radiocommandée">
 <a aria-hidden="true" href="#lexemple-de-la-voiture-radiocommandée">
  <span class="es-autolink-heading">
  </span>
 </a>
 L’exemple de la voiture radiocommandée
</h5>
<p>
 Regardons l’image que je vous ai préparée pour comprendre à quoi sert un servomoteur :
</p>
<p>
 <img alt="*Vue de dessus* Représentation schématique du système de guidage des roues d'une" src="./images/uploaded/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur/vue-de-dessus-representation-schematique-du-systeme-de-guidage-des-roues-dune.jpg"/>
</p>
<p>
 Chaque roue est positionnée sur un axe de rotation (partie bleue) lui-même monté sur un pivot sur le châssis de la voiture (en vert). La baguette (rouge) permet de garder le parallélisme entre les roues. Si l’une pivote vers la gauche, l’autre en fait de même (ben ouais, sinon la voiture devrait se couper en deux pour aller dans les deux directions opposées
 <img alt=":lol:" class="smiley" src="./static/smileys/rire.gif"/>
 ). Cette baguette est fixée, par un pivot encore, au bras de sortie du servomoteur. Ce bras est à son tour fixé à l’axe de rotation du servomoteur. Ainsi, lorsque le servomoteur fait tourner son axe, il entraine le bras qui entraine la baguette et fait pivoter les roues pour permettre à la voiture de prendre une direction dans son élan (tourner à gauche, à droite, ou aller tout droit). Il n’y a rien de bien compliqué. Ce qu’il faut retenir est que le servomoteur va entrainer la baguette pour orienter les roues dans un sens ou dans l’autre. Elles auront donc un angle d’orientation par rapport au châssis de la voiture. Voyez plutôt :
</p>
<p>
 <img alt="Animation de la direction" src="./images/uploaded/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur/animation-de-la-direction.gif"/>
</p>
<p>
 Alors, vous allez me dire : "
 <em>
  mais pourquoi on ne met pas un moteur à courant continu avec un bras sur son axe, ce serait plus simple, non ?
 </em>
 " Eh bien non, car cela ne conviendrait pas. Je vous explique pourquoi. Nous l’avons vu, un moteur à courant continu tourne sans s’arrêter, sauf si on lui coupe l’alimentation. Le problème c’est que, dans notre cas, si on laisse le moteur tourner, il pourrait faire pivoter les roues plus loin que leur angle maximal et casser le système de guidage car il ne saura pas quand il faut s’arrêter (à savoir, quand les roues sont arrivées à leur angle maximal).
Bon, on pourrait très bien faire un système qui coupe l’alimentation quand les roues arrivent sur leur butée. En plus, les moteurs à courant continu sont de bien piètres athlètes, il leur faudrait nécessairement un réducteur pour arriver à avoir une vitesse faible et un couple plus élevé. Mais pourquoi s’embêter avec ça plutôt que d’utiliser quelque chose de déjà tout prêt ? C’est le servomoteur qui va faire tout ça ! Pour être précis, le servomoteur est commandé de telle sorte qu’au lieu de donner une vitesse de rotation de son axe, il donne une position angulaire de l’arbre relié à son axe. Donc, on lui demande de faire tourner son axe de 10° vers la gauche et il s’exécute !
</p>
<h4 id="composition-dun-servomoteur">
 <a aria-hidden="true" href="#composition-dun-servomoteur">
  <span class="es-autolink-heading">
  </span>
 </a>
 Composition d’un servomoteur
</h4>
<p>
 Les servomoteurs ont donc l’avantage d’être
 <em>
  asservis
 </em>
 en
 <strong>
  position angulaire
 </strong>
 . Cela signifie, je vous l’expliquais, que l’axe de sortie du servomoteur respectera une consigne d’orientation que vous lui envoyez en son entrée. En plus, tenez-vous bien, si par malheur les roues venaient à changer d’orientation en passant sur un caillou par exemple, l’électronique interne du servomoteur essaiera tant bien que mal de conserver cette position ! Et quelle que soit la force que l’on exerce sur le bras du servomoteur, il essayera de toujours garder le même angle (dans les limites du raisonnable évidemment). En quelque sorte vous ne pilotez pas directement le moteur, mais plutôt
 <strong>
  vous imposez le résultat que vous voulez avoir en sortie
 </strong>
 .
</p>
<h5 id="apparence">
 <a aria-hidden="true" href="#apparence">
  <span class="es-autolink-heading">
  </span>
 </a>
 Apparence
</h5>
<p>
 On en trouve de toutes les tailles et de toutes les puissances. La plupart du temps la sortie peut se positionner entre 0 et 180°. Cela dit, il en existe également dont la sortie peut se débattre sur seulement 90° et d’autres, ayant un plus grand débattement, sur 360°. Ceux qui ont la possibilité de faire plusieurs tours sont souvent appelés
 <strong>
  servo-treuils
 </strong>
 . Enfin, les derniers, qui peuvent faire tourner leur axe sans jamais se buter, sont appelés
 <strong>
  servomoteurs à rotation continue
 </strong>
 . Les servomoteurs sont très fréquemment employés dans les applications de modélisme pour piloter le safran d’un bateau, le gouvernail d’un avion ou bien même les roues d’une voiture téléguidée dont on a parlé jusqu’à présent. Maintenant que les présentations sont faites, mettons-le à nu ! Il est composé de plusieurs éléments visibles … :
</p>
<ul>
 <li>
  Les fils, qui sont au nombre de trois (nous y reviendrons)
 </li>
 <li>
  L’axe de rotation sur lequel est monté un accessoire en plastique ou en métal
 </li>
 <li>
  Le boitier qui le protège
 </li>
</ul>
<p>
 … mais aussi de plusieurs éléments que l’on ne voit pas :
</p>
<ul>
 <li>
  un moteur à courant continu
 </li>
 <li>
  des engrenages pour former un réducteur (en plastique ou en métal)
 </li>
 <li>
  un capteur de position de l’angle d’orientation de l’axe (un potentiomètre bien souvent)
 </li>
 <li>
  une carte électronique pour le contrôle de la position de l’axe et le pilotage du moteur à courant continu
 </li>
</ul>
<p>
 Voilà une image 3D (extraite du
 <a href="http://ericaeromodelisme974.unblog.fr/2011/06/04/le-servomoteur/">
  site internet suivant
 </a>
 ) de vue de l’extérieur et de l’intérieur d’un servomoteur :
</p>
<p>
 <img alt="Vue interne d'un servomoteur (sans l'électronique de commande)" src="./images/uploaded/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur/vue-interne-dun-servomoteur-sans-lelectronique-de-commande.jpg"/>
</p>
<p>
 (
 <a href="http://ericaeromodelisme974.unblog.fr/2011/06/04/le-servomoteur/">
  Source de l’image
 </a>
 )
</p>
<h5 id="connectique">
 <a aria-hidden="true" href="#connectique">
  <span class="es-autolink-heading">
  </span>
 </a>
 Connectique
</h5>
<p>
 Le servomoteur a besoin de trois fils de connexion pour fonctionner. Deux fils servent à son alimentation, le dernier étant celui qui reçoit le signal de commande :
</p>
<ul>
 <li>
  rouge : pour l’alimentation positive (4.5V à 6V en général)
 </li>
 <li>
  noir ou marron : pour la masse (0V)
 </li>
 <li>
  orange, jaune, blanc, … : entrée du signal de commande
 </li>
</ul>
<p>
 Nous verrons tout à l’heure ce que nous devons entrer sur le dernier fil.
</p>
<h5 id="la-mécanique">
 <a aria-hidden="true" href="#la-mécanique">
  <span class="es-autolink-heading">
  </span>
 </a>
 La mécanique
</h5>
<p>
 Comme on le voit dans l’image précédente, le servomoteur possède plusieurs pignons (engrenages) en sortie du petit moteur CC. Cet ensemble est ce qui constitue le
 <strong>
  réducteur
 </strong>
 . Ce réducteur fait deux choses : d’une part il réduit la vitesse de rotation en sortie de l’axe du servomoteur (et non du moteur CC), d’autre part il permet d’augmenter le couple en sortie du servomoteur (là encore non en sortie du moteur CC). Alors, à quoi ça sert de réduire la vitesse et d’augmenter le couple ? Eh bien les moteurs CC se débrouillent très bien pour tourner très vite, mais lorsqu’ils font une si petite taille ils sont bien moins bons pour fournir du couple. On va donc utiliser ce réducteur qui va réduire la vitesse, car nous n’avons pas besoin d’avoir une vitesse trop élevée, et augmenter le couple pour ainsi pouvoir déplacer une charge plus lourde. Ceci est prouvé par la formule que je vous ai donnée dans le chapitre précédent :
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        R
       </mi>
       <mo>
        =
       </mo>
       <mfrac>
        <mrow>
         <msub>
          <mi>
           ω
          </mi>
          <mrow>
           <mi>
            e
           </mi>
           <mi>
            n
           </mi>
           <mi>
            t
           </mi>
           <mi>
            r
           </mi>
           <mi>
            e
           </mi>
           <mi>
            e
           </mi>
          </mrow>
         </msub>
        </mrow>
        <mrow>
         <msub>
          <mi>
           ω
          </mi>
          <mrow>
           <mi>
            s
           </mi>
           <mi>
            o
           </mi>
           <mi>
            r
           </mi>
           <mi>
            t
           </mi>
           <mi>
            i
           </mi>
           <mi>
            e
           </mi>
          </mrow>
         </msub>
        </mrow>
       </mfrac>
       <mo>
        =
       </mo>
       <mfrac>
        <mrow>
         <msub>
          <mi>
           C
          </mi>
          <mrow>
           <mi>
            s
           </mi>
           <mi>
            o
           </mi>
           <mi>
            r
           </mi>
           <mi>
            t
           </mi>
           <mi>
            i
           </mi>
           <mi>
            e
           </mi>
          </mrow>
         </msub>
        </mrow>
        <mrow>
         <msub>
          <mi>
           C
          </mi>
          <mrow>
           <mi>
            e
           </mi>
           <mi>
            n
           </mi>
           <mi>
            t
           </mi>
           <mi>
            r
           </mi>
           <mi>
            e
           </mi>
           <mi>
            e
           </mi>
          </mrow>
         </msub>
        </mrow>
       </mfrac>
      </mrow>
      <annotation encoding="application/x-tex">
       R = \frac{\omega_{entree}}{\omega_{sortie}} = \frac{C_{sortie}}{C_{entree}}
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.8884309999999999em;">
    </span>
    <span class="strut bottom" style="height:1.3335309999999998em;vertical-align:-0.44509999999999994em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.00773em;">
      R
     </span>
     <span class="mrel">
      =
     </span>
     <span class="mord reset-textstyle textstyle uncramped">
      <span class="mopen sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter">
      </span>
      <span class="mfrac">
       <span class="vlist">
        <span style="top:0.345em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord scriptstyle cramped mtight">
           <span class="mord mtight">
            <span class="mord mathit mtight" style="margin-right:0.03588em;">
             ω
            </span>
            <span class="msupsub">
             <span class="vlist">
              <span style="top:0.143em;margin-right:0.07142857142857144em;margin-left:-0.03588em;">
               <span class="fontsize-ensurer reset-size5 size5">
                <span style="font-size:0em;">
                 ​
                </span>
               </span>
               <span class="reset-scriptstyle scriptscriptstyle cramped mtight">
                <span class="mord scriptscriptstyle cramped mtight">
                 <span class="mord mathit mtight">
                  s
                 </span>
                 <span class="mord mathit mtight">
                  o
                 </span>
                 <span class="mord mathit mtight" style="margin-right:0.02778em;">
                  r
                 </span>
                 <span class="mord mathit mtight">
                  t
                 </span>
                 <span class="mord mathit mtight">
                  i
                 </span>
                 <span class="mord mathit mtight">
                  e
                 </span>
                </span>
               </span>
              </span>
              <span class="baseline-fix">
               <span class="fontsize-ensurer reset-size5 size5">
                <span style="font-size:0em;">
                 ​
                </span>
               </span>
               ​
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
        <span style="top:-0.22999999999999998em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle textstyle uncramped frac-line">
         </span>
        </span>
        <span style="top:-0.4100999999999999em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle uncramped mtight">
          <span class="mord scriptstyle uncramped mtight">
           <span class="mord mtight">
            <span class="mord mathit mtight" style="margin-right:0.03588em;">
             ω
            </span>
            <span class="msupsub">
             <span class="vlist">
              <span style="top:0.143em;margin-right:0.07142857142857144em;margin-left:-0.03588em;">
               <span class="fontsize-ensurer reset-size5 size5">
                <span style="font-size:0em;">
                 ​
                </span>
               </span>
               <span class="reset-scriptstyle scriptscriptstyle cramped mtight">
                <span class="mord scriptscriptstyle cramped mtight">
                 <span class="mord mathit mtight">
                  e
                 </span>
                 <span class="mord mathit mtight">
                  n
                 </span>
                 <span class="mord mathit mtight">
                  t
                 </span>
                 <span class="mord mathit mtight" style="margin-right:0.02778em;">
                  r
                 </span>
                 <span class="mord mathit mtight">
                  e
                 </span>
                 <span class="mord mathit mtight">
                  e
                 </span>
                </span>
               </span>
              </span>
              <span class="baseline-fix">
               <span class="fontsize-ensurer reset-size5 size5">
                <span style="font-size:0em;">
                 ​
                </span>
               </span>
               ​
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
      <span class="mclose sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter">
      </span>
     </span>
     <span class="mrel">
      =
     </span>
     <span class="mord reset-textstyle textstyle uncramped">
      <span class="mopen sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter">
      </span>
      <span class="mfrac">
       <span class="vlist">
        <span style="top:0.345em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord scriptstyle cramped mtight">
           <span class="mord mtight">
            <span class="mord mathit mtight" style="margin-right:0.07153em;">
             C
            </span>
            <span class="msupsub">
             <span class="vlist">
              <span style="top:0.143em;margin-right:0.07142857142857144em;margin-left:-0.07153em;">
               <span class="fontsize-ensurer reset-size5 size5">
                <span style="font-size:0em;">
                 ​
                </span>
               </span>
               <span class="reset-scriptstyle scriptscriptstyle cramped mtight">
                <span class="mord scriptscriptstyle cramped mtight">
                 <span class="mord mathit mtight">
                  e
                 </span>
                 <span class="mord mathit mtight">
                  n
                 </span>
                 <span class="mord mathit mtight">
                  t
                 </span>
                 <span class="mord mathit mtight" style="margin-right:0.02778em;">
                  r
                 </span>
                 <span class="mord mathit mtight">
                  e
                 </span>
                 <span class="mord mathit mtight">
                  e
                 </span>
                </span>
               </span>
              </span>
              <span class="baseline-fix">
               <span class="fontsize-ensurer reset-size5 size5">
                <span style="font-size:0em;">
                 ​
                </span>
               </span>
               ​
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
        <span style="top:-0.22999999999999998em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle textstyle uncramped frac-line">
         </span>
        </span>
        <span style="top:-0.4100999999999999em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle uncramped mtight">
          <span class="mord scriptstyle uncramped mtight">
           <span class="mord mtight">
            <span class="mord mathit mtight" style="margin-right:0.07153em;">
             C
            </span>
            <span class="msupsub">
             <span class="vlist">
              <span style="top:0.143em;margin-right:0.07142857142857144em;margin-left:-0.07153em;">
               <span class="fontsize-ensurer reset-size5 size5">
                <span style="font-size:0em;">
                 ​
                </span>
               </span>
               <span class="reset-scriptstyle scriptscriptstyle cramped mtight">
                <span class="mord scriptscriptstyle cramped mtight">
                 <span class="mord mathit mtight">
                  s
                 </span>
                 <span class="mord mathit mtight">
                  o
                 </span>
                 <span class="mord mathit mtight" style="margin-right:0.02778em;">
                  r
                 </span>
                 <span class="mord mathit mtight">
                  t
                 </span>
                 <span class="mord mathit mtight">
                  i
                 </span>
                 <span class="mord mathit mtight">
                  e
                 </span>
                </span>
               </span>
              </span>
              <span class="baseline-fix">
               <span class="fontsize-ensurer reset-size5 size5">
                <span style="font-size:0em;">
                 ​
                </span>
               </span>
               ​
              </span>
             </span>
            </span>
           </span>
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
      <span class="mclose sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter">
      </span>
     </span>
    </span>
   </span>
  </span>
 </span>
 .
</p>
<p>
 Le rapport de réduction ® du réducteur définit le couple et la vitesse de sortie (en sortie du réducteur) selon la vitesse et le couple d’entrée (en sortie du moteur CC). Ces données sont souvent transparentes lorsque l’on achète un servomoteur. Dans la quasi-totalité des cas, nous n’avons que la vitesse angulaire (en degré par seconde °/s ), le couple de sortie du servomoteur et le débattement maximal (s’il s’agit d’un servomoteur ayant un débattement de 0 à 90°, 180, 360 ou autre). Et c’est largement suffisant étant donné que c’est que ce qui nous intéresse dans le choix d’un servomoteur. Il y a cependant une unité qui pourra peut-être vous donner quelques doutes ou une certaine incompréhension. Cette caractéristique est celle du couple du servomoteur et a pour unité le
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        k
       </mi>
       <mi>
        g
       </mi>
       <mi mathvariant="normal">
        .
       </mi>
       <mi>
        c
       </mi>
       <mi>
        m
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       kg.cm
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.69444em;">
    </span>
    <span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.03148em;">
      k
     </span>
     <span class="mord mathit" style="margin-right:0.03588em;">
      g
     </span>
     <span class="mord mathrm">
      .
     </span>
     <span class="mord mathit">
      c
     </span>
     <span class="mord mathit">
      m
     </span>
    </span>
   </span>
  </span>
 </span>
 (kilogramme-centimètre). Nous allons tout de suite rappeler ce que cela signifie. Avant tout, rappelons la formule suivante :
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        C
       </mi>
       <mo>
        =
       </mo>
       <mi>
        F
       </mi>
       <mo>
        ×
       </mo>
       <mi>
        r
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       C = F \times r
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.76666em;vertical-align:-0.08333em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.07153em;">
      C
     </span>
     <span class="mrel">
      =
     </span>
     <span class="mord mathit" style="margin-right:0.13889em;">
      F
     </span>
     <span class="mbin">
      ×
     </span>
     <span class="mord mathit" style="margin-right:0.02778em;">
      r
     </span>
    </span>
   </span>
  </span>
 </span>
 qui donne la relation entre le couple
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        C
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       C
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.07153em;">
      C
     </span>
    </span>
   </span>
  </span>
 </span>
 du servomoteur (en kilogramme mètre),
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        F
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       F
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.13889em;">
      F
     </span>
    </span>
   </span>
  </span>
 </span>
 la force exercée sur le bras du servomoteur (en kilos) et
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        r
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       r
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.43056em;">
    </span>
    <span class="strut bottom" style="height:0.43056em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.02778em;">
      r
     </span>
    </span>
   </span>
  </span>
 </span>
 la distance (en m) à laquelle s’exerce cette force par rapport à l’axe de rotation du servomoteur. Disséquons dans notre langage la signification de cette formule : le couple © exercé sur un axe est égal à la force (F) appliquée au bout du levier accroché à ce même axe.
</p>
<p>
 À force identique, plus le levier est long et plus le couple exercé sur cet axe est important. En d’autres termes, si votre servomoteur dispose d’un bras d’un mètre de long (oui c’est très long) eh bien il aura beaucoup plus de difficultés à soulever une charge de, disons 10g, que son homologue qui supporte la même charge avec un bras nettement raccourci à 10 centimètres. Prenons l’exemple d’un servomoteur assez commun, le
 <a href="http://www.gpdealera.com/cgi-bin/wgainf100p.pgm?I=FUTM0031">
  Futaba s3003
 </a>
 . Sa documentation nous indique que lorsqu’il est alimenté sous 4.8V (on reviendra dessus plus tard), il peut fournir un couple (
 <em>
  torque
 </em>
 en anglais) de
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mn>
        3
       </mn>
       <mo separator="true">
        ,
       </mo>
       <mn>
        2
       </mn>
       <mi>
        k
       </mi>
       <mi>
        g
       </mi>
       <mi mathvariant="normal">
        .
       </mi>
       <mi>
        c
       </mi>
       <mi>
        m
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       3,2 kg.cm
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.69444em;">
    </span>
    <span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathrm">
      3
     </span>
     <span class="mpunct">
      ,
     </span>
     <span class="mord mathrm">
      2
     </span>
     <span class="mord mathit" style="margin-right:0.03148em;">
      k
     </span>
     <span class="mord mathit" style="margin-right:0.03588em;">
      g
     </span>
     <span class="mord mathrm">
      .
     </span>
     <span class="mord mathit">
      c
     </span>
     <span class="mord mathit">
      m
     </span>
    </span>
   </span>
  </span>
 </span>
 . C’est à dire, qu’au bout de son bras, s’il fait 1 centimètre, il pourra soulever une charge de 3,2kg. Simple, n’est-ce pas ?
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
 Si le bras fait 10 centimètres, vous aurez compris que l’on perd 10 fois la capacité à soulever une masse, on se retrouve alors avec un poids de 320g au maximum (sans compter le poids du bras lui-même, certes négligeable ici, mais parfois non).
</p>
<p>
 <img alt="Principe du couple mécanique" src="./images/uploaded/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur/principe-du-couple-mecanique.jpg"/>
</p>
<p>
 Voilà une image qui permet d’illustrer un peu ce que je vous raconte depuis tout à l’heure (ça commençait à être ennuyeux, non ?). Bref. Ici, chaque poids représenté est celui maximum que peut soulever le servomoteur selon la distance à laquelle il est situé. Et ne vous avisez pas de les mettre tous car votre pauvre servo serait bien dans l’incapacité de les soulever en même temps. Et oui, malgré le fait qu’il n’y ait que 320g au bout du bras, le servo voit comme s’il y avait un poids de 3,2kg ! Dans cette situation on aurait trois fois 3,2kg, ce qui ferait un poids total de 9,6kg ! Impossible pour le servo de ne bouger ne serait-ce que d’un millimètre (vous risqueriez fort de le détruire d’ailleurs).
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Bon, d’accord, je comprends, mais et le zéro il y est pas sur ton dessin. Comment je sais quel poids je peux mettre sur l’axe du moteur ?
   <img alt="o_O" class="smiley" src="./static/smileys/blink.gif"/>
  </p>
 </div>
</div>
<p>
 Eh bien tout dépend du diamètre de cet axe. Voilà une question pertinente ! Alors, oui, répondons à la question. Mais avant, vous devriez avoir une idée de la réponse que je vais vous donner. Non ? Ben si, voyons ! Plus on éloigne le poids le l’axe et plus celui-ci diminue, et cela fonctionne dans l’autre sens : plus on le rapproche, plus sa valeur maximale augmente. En théorie, si on se met à 0cm, on pourrait mettre un poids infini. Admettons, plus rigoureusement, que l’on mette le poids à 1mm de l’axe (soit un axe de diamètre 2mm). Le poids que le servo pourrait soulever serait de… 10 fois plus ! Soit 32kg !! En conclusion, on peut admettre la formule suivante qui définit le poids maximal à mettre à la distance voulue :
</p>
<p>
 <span class="inlineMath inlineMathDouble">
  <span class="katex-display">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <msub>
         <mi>
          P
         </mi>
         <mrow>
          <mi>
           m
          </mi>
          <mi>
           a
          </mi>
          <mi>
           x
          </mi>
         </mrow>
        </msub>
        <mo>
         =
        </mo>
        <mfrac>
         <mi>
          C
         </mi>
         <mrow>
          <mi>
           d
          </mi>
         </mrow>
        </mfrac>
       </mrow>
       <annotation encoding="application/x-tex">
        P_{max} = \frac C {d}
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:1.36033em;">
     </span>
     <span class="strut bottom" style="height:2.04633em;vertical-align:-0.686em;">
     </span>
     <span class="base displaystyle textstyle uncramped">
      <span class="mord">
       <span class="mord mathit" style="margin-right:0.13889em;">
        P
       </span>
       <span class="msupsub">
        <span class="vlist">
         <span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          <span class="reset-textstyle scriptstyle cramped mtight">
           <span class="mord scriptstyle cramped mtight">
            <span class="mord mathit mtight">
             m
            </span>
            <span class="mord mathit mtight">
             a
            </span>
            <span class="mord mathit mtight">
             x
            </span>
           </span>
          </span>
         </span>
         <span class="baseline-fix">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          ​
         </span>
        </span>
       </span>
      </span>
      <span class="mrel">
       =
      </span>
      <span class="mord reset-textstyle displaystyle textstyle uncramped">
       <span class="mopen sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter">
       </span>
       <span class="mfrac">
        <span class="vlist">
         <span style="top:0.686em;">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          <span class="reset-textstyle textstyle cramped">
           <span class="mord textstyle cramped">
            <span class="mord mathit">
             d
            </span>
           </span>
          </span>
         </span>
         <span style="top:-0.22999999999999998em;">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          <span class="reset-textstyle textstyle uncramped frac-line">
          </span>
         </span>
         <span style="top:-0.677em;">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          <span class="reset-textstyle textstyle uncramped">
           <span class="mord mathit" style="margin-right:0.07153em;">
            C
           </span>
          </span>
         </span>
         <span class="baseline-fix">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          ​
         </span>
        </span>
       </span>
       <span class="mclose sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter">
       </span>
      </span>
     </span>
    </span>
   </span>
  </span>
 </span>
</p>
<p>
 Avec :
</p>
<ul>
 <li>
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <msub>
         <mi>
          P
         </mi>
         <mrow>
          <mi>
           m
          </mi>
          <mi>
           a
          </mi>
          <mi>
           x
          </mi>
         </mrow>
        </msub>
       </mrow>
       <annotation encoding="application/x-tex">
        P_{max}
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord">
       <span class="mord mathit" style="margin-right:0.13889em;">
        P
       </span>
       <span class="msupsub">
        <span class="vlist">
         <span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          <span class="reset-textstyle scriptstyle cramped mtight">
           <span class="mord scriptstyle cramped mtight">
            <span class="mord mathit mtight">
             m
            </span>
            <span class="mord mathit mtight">
             a
            </span>
            <span class="mord mathit mtight">
             x
            </span>
           </span>
          </span>
         </span>
         <span class="baseline-fix">
          <span class="fontsize-ensurer reset-size5 size5">
           <span style="font-size:0em;">
            ​
           </span>
          </span>
          ​
         </span>
        </span>
       </span>
      </span>
     </span>
    </span>
   </span>
  </span>
  : poids maximal de charge en kilogramme (kg)
 </li>
 <li>
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         C
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        C
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.07153em;">
       C
      </span>
     </span>
    </span>
   </span>
  </span>
  : couple du servomoteur, en kilogramme centimètre (kg.cm)
 </li>
 <li>
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         d
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        d
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.69444em;">
     </span>
     <span class="strut bottom" style="height:0.69444em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit">
       d
      </span>
     </span>
    </span>
   </span>
  </span>
  : distance à laquelle le poids est placé en centimètre (cm)
 </li>
</ul>
<p>
 Et si on se concentrait sur le pourquoi du servomoteur, car son objectif principal est avant tout de donner une position angulaire à son bras. Allez, voyons ça tout de suite !
</p>
<h5 id="lélectronique-dasservissement">
 <a aria-hidden="true" href="#lélectronique-dasservissement">
  <span class="es-autolink-heading">
  </span>
 </a>
 L’électronique d’asservissement
</h5>
<p>
 "
 <em>
  Qu’est-ce que l’asservissement ?
 </em>
 ", vous demandez-vous sans doute en ce moment. Malgré la signification peu intuitive que ce terme porte, il se cache derrière quelque chose de simple à comprendre, mais parfois très compliqué à mettre en œuvre. Heureusement, ce n’est pas le cas pour le servomoteur. Toutefois, nous n’entrerons pas dans le détail et nous nous contenterons de présenter le fonctionnement. L’asservissement n’est ni plus ni moins qu’un moyen de gérer une consigne de régulation selon une commande d’entrée. Euuuh, vous me suivez ?
 <img alt=":euh:" class="smiley" src="./static/smileys/unsure.gif"/>
</p>
<p>
 Prenons l’exemple du servomoteur : on l’alimente et on lui envoie un signal de commande qui permet de définir à quel angle va se positionner le bras du servomoteur. Ce dernier va s’exécuter. Essayez de forcer sur le bras du servomoteur… vous avez vu ? Quelle que soit la force que vous exercez (dans les limites du raisonnable), le servo va faire en sorte de toujours garder la position de son bras à l’angle voulu. Même si le poids est largement supérieur à ce qu’il peut supporter, il va essayer de remettre le bras dans la position à laquelle il se trouvait (à éviter cependant).
</p>
<p>
 Ainsi, si vous changez l’angle du bras en forçant dessus, lorsque vous relâcherez le bras, il va immédiatement reprendre sa position initiale (celle définie grâce au signal de commande). Pour pouvoir réaliser le maintien de la position du bras de manière correcte, le servo utilise une
 <strong>
  électronique de commande
 </strong>
 . On peut la nommer
 <strong>
  électronique d’asservissement
 </strong>
 , car c’est elle qui va gérer la position du bras du servomoteur. Cette électronique est constituée d’une zone de comparaison qui compare (étonnamment
 <img alt="^^" class="smiley" src="./static/smileys/hihi.png"/>
 ) la position du bras du servo au signal de commande. Le deuxième élément qui constitue cette électronique, c’est le capteur de position du bras. Ce capteur n’est autre qu’un potentiomètre couplé à l’axe du moteur. La mesure de la tension au point milieu de ce potentiomètre permet d’obtenir une tension image de l’angle d’orientation du bras.
</p>
<p>
 Cette position est ensuite comparée, je le disais, à la consigne (le signal de commande) qui est transmise au servomoteur. Après une rapide comparaison entre la consigne et valeur réelle de position du bras, le servomoteur (du moins son électronique de commande) va appliquer une correction si le bras n’est pas orienté à l’angle imposé par la consigne.
</p>
<p>
 <img alt="Synoptique de fonctionnement de l'asservissement du servomoteur" src="./images/uploaded/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur/synoptique-de-fonctionnement-de-lasservissement-du-servomoteur.jpg"/>
</p>
<p>
 Afin de garder la position de son bras stable, il est donc important de savoir quelle est la charge maximale applicable sur le bras du servomoteur. En somme, bien vérifier que le poids de la charge que vous comptez mettre sur votre servomoteur ne dépasse pas celui maximal qu’il peut supporter. Avant de passer à la suite, je vous propose de regarder cette superbe vidéo que j’ai trouvée par hasard sur
 <a href="http://trissiti.blogspot.fr/2012/04/servomoteur-pour-robot.html">
  ce site web
 </a>
 . Vous allez pouvoir comprendre au mieux le fonctionnement de la mécanique du servomoteur :
</p>
<div class="text-center">
 <div class="video-container">
  <div class="video-wrapper">
   <iframe allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/ZZhuD78BLDk" width="560">
   </iframe>
  </div>
 </div>
</div>
<div class="text-center">
 <p>
  (Crédit vidéo : Bartek Sliwinski)
 </p>
</div>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Mais au fait, comment est transmise la consigne de commande de position du bras ? On lui dit par la liaison série ?
  </p>
 </div>
</div>
<p>
 C’est ce que nous allons voir tout de suite dans la partie suivante. En avant !
</p>
<h3 id="la-commande-dun-servomoteur">
 <a aria-hidden="true" href="#la-commande-dun-servomoteur">
  <span class="es-autolink-heading">
  </span>
 </a>
 La commande d’un servomoteur
</h3>
<p>
 Ce qu’il est intéressant de découvrir à présent, c’est de savoir comment piloter un moteur de ce type. Eh oui, car cela n’a pas beaucoup de ressemblances avec le moteur à courant continu. Il ne va pas être question de pont en H ou autres bizarreries de ce type, non, vous allez voir, ça va être très simple.
</p>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   Sachez toutefois qu’il existe deux types de servomoteur : ceux qui possèdent une électronique de commande de type analogique, qui sont les plus courants et les moins chers et ceux qui sont asservis par une électronique de commande numérique, très fiables et très performants, mais bien plus onéreux que leurs homologues analogiques. Vous comprendrez pourquoi notre choix s’oriente sur le premier type. :P De plus, leur contrôle est bien plus simple que les servomoteurs à régulation numérique qui utilisent parfois des protocoles bien particuliers.
  </p>
 </div>
</div>
<h4 id="le-signal-de-commande">
 <a aria-hidden="true" href="#le-signal-de-commande">
  <span class="es-autolink-heading">
  </span>
 </a>
 Le signal de commande
</h4>
<p>
 La consigne envoyée au servomoteur n’est autre qu’un signal électronique de type PWM. Il dispose cependant de deux caractéristiques indispensables pour que le servo puisse comprendre ce qu’on lui demande. À savoir : une fréquence fixe de valeur 50Hz (comme celle du réseau électrique EDF) et d’une durée d’état HAUT elle aussi fixée à certaines limites. Nous allons étudier l’affaire.
</p>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   Certains sites de modélisme font état d’un nom pour ce signal : une PPM pour
   <em>
    Pulse Position Modulation
   </em>
   . J’utiliserais également ce terme de temps en temps, n’en soyez pas surpris !
  </p>
 </div>
</div>
<h5 id="la-fréquence-fixe">
 <a aria-hidden="true" href="#la-fréquence-fixe">
  <span class="es-autolink-heading">
  </span>
 </a>
 La fréquence fixe
</h5>
<p>
 Le signal que nous allons devoir générer doit avoir une fréquence de 50 Hz. Autrement dit, le temps séparant deux fronts montants est de 20 ms. Je rappelle la formule qui donne la relation entre la fréquence (F) et le temps de la période du signal (T) :
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        F
       </mi>
       <mo>
        =
       </mo>
       <mfrac>
        <mn>
         1
        </mn>
        <mi>
         T
        </mi>
       </mfrac>
      </mrow>
      <annotation encoding="application/x-tex">
       F = \frac 1 T
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.845108em;">
    </span>
    <span class="strut bottom" style="height:1.190108em;vertical-align:-0.345em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.13889em;">
      F
     </span>
     <span class="mrel">
      =
     </span>
     <span class="mord reset-textstyle textstyle uncramped">
      <span class="mopen sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter">
      </span>
      <span class="mfrac">
       <span class="vlist">
        <span style="top:0.345em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord mathit mtight" style="margin-right:0.13889em;">
           T
          </span>
         </span>
        </span>
        <span style="top:-0.22999999999999998em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle textstyle uncramped frac-line">
         </span>
        </span>
        <span style="top:-0.394em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle uncramped mtight">
          <span class="mord mathrm mtight">
           1
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
      <span class="mclose sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter">
      </span>
     </span>
    </span>
   </span>
  </span>
 </span>
</p>
<p>
 <img alt="Signal de fréquence 50 Hz" src="./images/uploaded/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur/signal-de-frequence-50-hz.png"/>
</p>
<p>
 Malheureusement ,la fonction analogWrite() de Arduino ne possède pas une fréquence de 50Hz, mais dix fois plus élevée, de 500Hz environ. On ne pourra donc pas utiliser cette fonction.
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Haaaaaaaaaa ! Mais comment on va faire !!!
   <img alt=":'(" class="smiley" src="./static/smileys/pleure.png"/>
  </p>
 </div>
</div>
<p>
 Ola, ne vous affolez pas ! Il existe une alternative, ne vous pressez pas, on va voir ça dans un moment.
 <img alt="^^" class="smiley" src="./static/smileys/hihi.png"/>
</p>
<h5 id="la-durée-de-létat-haut">
 <a aria-hidden="true" href="#la-durée-de-létat-haut">
  <span class="es-autolink-heading">
  </span>
 </a>
 La durée de l’état HAUT
</h5>
<p>
 Pourquoi est-ce si important ? Qu’avons-nous à savoir sur la durée de l’état HAUT du signal PWM ? À quoi cela sert-il, finalement ? Eh bien ces questions trouvent leurs réponses dans ce qui va suivre, alors tendez bien l’oreille et ne perdez pas une miette de ce que je vais vous expliquer.
 <sub>
  (Eh ! Entre nous, c’est pas mal cette petite intro, non ? Elle captive votre attention tout en faisant durer le suspense. Perso j’aime bien, pas vous ? Bon, je continue.
  <img alt="^^" class="smiley" src="./static/smileys/hihi.png"/>
  )
 </sub>
 Cette durée, chers petits zéros, est ce qui compose l’essentiel du signal. Car c’est selon elle que le servomoteur va savoir comment positionner son bras à un angle précis. Vous connaissez comment fonctionne un signal PWM, qui sert également à piloter la vitesse d’un moteur à courant continu. Eh bien, pour le servomoteur, c’est quelque peu semblable.
En fait, un signal ayant une durée d’état HAUT très faible donnera un angle à 0°, le même signal avec une durée d’état HAUT plus grande donnera un angle au maximum de ce que peut admettre le servomoteur. Mais, soyons rigoureux ! Précisément, je vous parlais de valeurs limites pour cet état HAUT et ce n’est pas pour rien, car ce dernier est limité entre une valeur de
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mn>
        1
       </mn>
       <mi>
        m
       </mi>
       <mi>
        s
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       1ms
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.64444em;">
    </span>
    <span class="strut bottom" style="height:0.64444em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathrm">
      1
     </span>
     <span class="mord mathit">
      m
     </span>
     <span class="mord mathit">
      s
     </span>
    </span>
   </span>
  </span>
 </span>
 au minimum et au maximum de
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mn>
        2
       </mn>
       <mi>
        m
       </mi>
       <mi>
        s
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       2ms
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.64444em;">
    </span>
    <span class="strut bottom" style="height:0.64444em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathrm">
      2
     </span>
     <span class="mord mathit">
      m
     </span>
     <span class="mord mathit">
      s
     </span>
    </span>
   </span>
  </span>
 </span>
 (ce sont bien des millisecondes puisque l’on parle de durée en temps) pour les servos standards. Comme un schéma vaut mieux qu’un long discours :
</p>
<p>
 <img alt="Position en fonction de la pulsation" src="./images/uploaded/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur/position-en-fonction-de-la-pulsation.jpg"/>
</p>
<p>
 Vous aurez deviné, à travers cette illustration, que la durée de l’état HAUT fixe la position du bras du servomoteur à un angle déterminé.
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Et comment je fais si je veux que mon servomoteur fasse un angle de 45° ? Ça ne marche pas ?
   <img alt="o_O" class="smiley" src="./static/smileys/blink.gif"/>
  </p>
 </div>
</div>
<p>
 Si, bien sûr. En fait, il va falloir faire jouer le temps de l’état HAUT. Pour un angle de 45°, il va être compris entre 1ms et 1,5ms. À 1,25ms précisément. Après, c’est un rapport qui utilise une relation très simple, le calcul ne vous posera donc aucun problème. Tous les angles compris dans la limite de débattement du bras du servomoteur sont possibles et configurables grâce à ce fameux état HAUT.
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Et si mon servomoteur n’a pas l’angle 0° pour origine, mais 90°, comment on fait ?
  </p>
 </div>
</div>
<p>
 C’est pareil ! Disons que 90° est l’origine, donc on peut dire qu’il est à l’angle 0°, ce qui lui donne un débattement de -90° à +90° :
</p>
<p>
 <img alt="Position en fonction de la pulsation avec décalage" src="./images/uploaded/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur/position-en-fonction-de-la-pulsation-avec-decalage.jpg"/>
</p>
<p>
 Et dans le cas où le servo peut faire un tour complet (donc 360°), c’est aussi la même chose. En fait c’est toujours pareil, quel que soit le débattement du moteur. En revanche, c’est légèrement différent pour les servomoteurs à rotation continue. Le signal ayant un état HAUT de 1ms donnera l’ordre "vitesse maximale dans un sens", la même ayant 2ms sera l’ordre pour "vitesse maximale dans l’autre sens" et 1.5ms sera la consigne pour "moteur arrêté". Entre chaque temps (par exemple entre 1ms et 1,5ms), le moteur tournera à une vitesse proportionnelle à la durée de l’état HAUT. On peut donc commander la vitesse de rotation du servo.
</p>
<h3 id="arduino-et-les-servomoteurs">
 <a aria-hidden="true" href="#arduino-et-les-servomoteurs">
  <span class="es-autolink-heading">
  </span>
 </a>
 Arduino et les servomoteurs
</h3>
<p>
 Bon, eh bien à présent, voyons un peu comment utiliser ces moteurs dont je vous vente les intérêts depuis tout à l’heure. Vous allez le voir, et ça ne vous surprendra même plus, la facilité d’utilisation est encore améliorée grâce à une bibliothèque intégrée à l’environnement Arduino. Ils nous mâchent vraiment tout le travail ces développeurs !
 <img alt="^^" class="smiley" src="./static/smileys/hihi.png"/>
</p>
<h4 id="câblage">
 <a aria-hidden="true" href="#câblage">
  <span class="es-autolink-heading">
  </span>
 </a>
 Câblage
</h4>
<p>
 Nous l’avons vu plus haut, la connectique d’un servomoteur se résume à trois fils : deux pour l’alimentation positive et la masse et le dernier pour le signal de commande. Rappelons qu’un servomoteur accepte généralement une plage d’alimentation comprise entre 4.5V et 6V (à 6V il aura plus de couple et sera un peu plus rapide qu’à 4.5V). Si vous n’avez besoin d’utiliser qu’un ou deux servomoteurs, vous pouvez les brancher sur la sortie 5V de la carte Arduino. Si vous voulez en utiliser plus, il serait bon d’envisager une alimentation externe car le régulateur de l’Arduino n’est pas fait pour délivrer trop de courant, vous risqueriez de le cramer. Dans ce cas, n’oubliez pas de relier la masse de l’alimentation externe et celle de l’Arduino afin de garder un référentiel électrique commun. Le câble permettant le transit du signal de commande du servo peut-être branché sur n’importe quelle broche de l’Arduino. Sachez cependant que lorsque nous utiliserons ces derniers, les sorties 9 et 10 ne pourront plus fournir un signal PWM (elles pourront cependant être utilisées comme de simples entrées/sorties numériques). C’est une des contraintes de la bibliothèque que nous allons utiliser.
</p>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   Ces dernières contraintes s’appliquent différemment sur les cartes MEGA.
   <a href="http://arduino.cc/en/Reference/Servo">
    Cette page
   </a>
   vous dira tout !
  </p>
 </div>
</div>
<p>
 Voici maintenant un petit exemple de montage d’un servo sur l’Arduino :
</p>
<p>
 <img alt="Montage simple d'un servomoteur avec l'Arduino" src="./images/uploaded/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur/montage-simple-dun-servomoteur-avec-larduino.png"/>
</p>
<h4 id="la-librairie-servo">
 <a aria-hidden="true" href="#la-librairie-servo">
  <span class="es-autolink-heading">
  </span>
 </a>
 La librairie
 <em>
  Servo
 </em>
</h4>
<p>
 Pour utiliser le servo avec Arduino, il va nous falloir générer le signal PPM vu précédemment. C’est-à-dire créer un signal d’une fréquence de 50Hz et modifier l’état haut d’une durée comprise entre 1 et 2ms. Contraignant n’est-ce pas ? Surtout si l’on a plusieurs servos et tout un programme à gérer derrière… C’est pourquoi l’équipe d’Arduino a été sympa en implémentant une classe très bien nommée : Servo. Tout comme l’objet Serial vous permettait de faire abstraction du protocole de la voie série, l’objet Servo va vous permettre d’utiliser les servomoteurs. Et comme elle est développée par une équipe de personnes compétentes, on peut leur faire totalement confiance pour qu’elle soit optimisée et sans bugs !
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
 Voyons maintenant comme s’en servir !
</p>
<h5 id="préparer-le-terrain">
 <a aria-hidden="true" href="#préparer-le-terrain">
  <span class="es-autolink-heading">
  </span>
 </a>
 Préparer le terrain
</h5>
<p>
 Tout d’abord, il nous faut inclure la librairie dans notre sketch. Pour cela, vous pouvez au choix écrire vous même au début du code
 <code>
  #include &lt;Servo.h&gt;
 </code>
 ou alors cliquer sur
 <em>
  library
 </em>
 dans la barre de menu puis sur "Servo" pour que s’écrive automatiquement et sans faute la ligne précédente. Ensuite, il vous faudra créer un objet de type Servo pour chaque servomoteur que vous allez utiliser. Nous allons ici n’en créer qu’un seul que j’appellerai "monServo" de la manière suivante :
 <code>
  Servo monServo;
 </code>
 . Nous devons lui indiquer la broche sur laquelle est connecté le fil de commande du servo en utilisant la fonction
 <code>
  attach()
 </code>
 de l’objet Servo créé. Cette fonction prend 3 arguments :
</p>
<ul>
 <li>
  Le numéro de la broche sur laquelle est relié le fil de signal
 </li>
 <li>
  La valeur basse (angle à 0°) de la durée de l’état haut du signal de PPM en microsecondes (optionnel, défaut à 544 µs)
 </li>
 <li>
  La valeur haute (angle à 90°, 180°, 360°, etc.) de la durée de l’état haut du signal de PPM en microsecondes (optionnel, défaut à 2400 µs)
 </li>
</ul>
<p>
 Par exemple, si mon servo possède comme caractéristique des durées de 1ms pour 0° et 2ms pour 180° et que je l’ai branché sur la broche 2, j’obtiendrais le code suivant :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Servo.h&gt;</span></span>

Servo monServo;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    monServo.attach(<span class="hljs-number">2</span>, <span class="hljs-number">1000</span>, <span class="hljs-number">2000</span>);
}
</code></pre>
 </div>
 <figcaption>
  Initialisation d’un servo moteur
 </figcaption>
</figure>
<h5 id="utiliser-le-servo">
 <a aria-hidden="true" href="#utiliser-le-servo">
  <span class="es-autolink-heading">
  </span>
 </a>
 Utiliser le servo
</h5>
<p>
 Une fois ces quelques étapes terminées, notre servo est fin prêt à être mis en route. Nous allons donc lui donner une consigne d’angle à laquelle il doit s’exécuter. Pour cela, nous allons utiliser la fonction prévue à cet effet :
 <code>
  write()
 </code>
 . Tiens, c’est la même que lorsque l’on utilisait la liaison série ! Eh oui.
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
 Comme son nom l’indique, elle va
 <em>
  écrire
 </em>
 quelque chose au servo. Ce quelque chose est l’angle qu’il doit donner à son axe. Cette fonction prend pour argument un nombre, de type
 <code>
  int
 </code>
 , qui donne la valeur en degré de l’angle à suivre. Si par exemple je veux placer le bras du servo à mi-chemin entre 0 et 180°, j’écrirais :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">monServo.write(<span class="hljs-number">90</span>);
</code></pre>
</div>
<p>
 Pour terminer, voilà le code complet qui vous permettra de mettre l’angle du bras de votre servomoteur à 90° :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Servo.h&gt;</span></span>

Servo monServo;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    monServo.attach(<span class="hljs-number">2</span>, <span class="hljs-number">1000</span>, <span class="hljs-number">2000</span>);
    monServo.write(<span class="hljs-number">90</span>);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
}
</code></pre>
 </div>
 <figcaption>
  Initialisation et déplacement d’un servo
 </figcaption>
</figure>
<p>
 J’ai mis l’ordre de l’angle dans la fonction setup() mais j’aurais tout autant pu la mettre dans la loop(). En effet, lorsque vous utilisez write(), la valeur est enregistrée par Arduino et est ensuite envoyée 50 fois par seconde (rappelez-vous du 50Hz du signal
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
 ) au servo moteur afin qu’il garde toujours la position demandée.
</p>
<h3 id="lélectronique-dasservissement-1">
 <a aria-hidden="true" href="#lélectronique-dasservissement-1">
  <span class="es-autolink-heading">
  </span>
 </a>
 L’électronique d’asservissement
</h3>
<p>
 Je le disais donc, on va voir un peu comment se profile le fonctionnement de l’électronique interne des servomoteurs analogiques. Je précise bien
 <em>
  analogiques
 </em>
 car je rappelle qu’il y a aussi des servomoteurs numériques, beaucoup plus complexes au niveau de l’électronique.
</p>
<h4 id="principe-de-fonctionnement">
 <a aria-hidden="true" href="#principe-de-fonctionnement">
  <span class="es-autolink-heading">
  </span>
 </a>
 Principe de fonctionnement
</h4>
<p>
 Commençons par un simple synoptique de fonctionnement. Référez-vous à la vidéo et aux explications que je vous ai données jusqu’à présent pour comprendre ce synoptique :
</p>
<p>
 <img alt="Principe de fonctionnement de l'électronique de commande d'un servomoteur" src="./images/uploaded/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur/principe-de-fonctionnement-de-lelectronique-de-commande-dun-servomoteur.jpg"/>
</p>
<p>
 Rapidement : la consigne donnée par l’utilisateur (dans notre cas, il va s’agir du signal envoyé par la carte Arduino) est comparée par rapport à la position réelle de l’axe du moteur. Ainsi, s’il y a une différence d’angle entre la consigne et l’angle mesuré par le capteur (le potentiomètre qui est fixé sur l’axe du servomoteur) eh bien le comparateur va commander le moteur et le faire tourner jusqu’à ce que cette différence s’annule.
</p>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   Avant d’aller plus loin, il faut savoir que les servomoteurs analogiques du commerce emploient en fait, dans leur électronique de commande, un microcontrôleur. Je ne vais donc pas vous expliquer comment ceux-là fonctionnent, mais je vais prendre le montage le plus basique qui soit. D’ailleurs, à l’issue de mes explications, vous serez capable de mettre en œuvre le montage que je vais donner et créer votre propre servomoteur avec un moteur CC anodin.
   <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
  </p>
 </div>
</div>
<h4 id="Électronique-à-consigne-manuelle">
 <a aria-hidden="true" href="#Électronique-à-consigne-manuelle">
  <span class="es-autolink-heading">
  </span>
 </a>
 Électronique à consigne manuelle
</h4>
<p>
 On va commencer par un montage dont la simplicité est extrême, mais dont vous ne connaissez pas encore le fonctionnement d’un composant essentiel : le
 <strong>
  comparateur
 </strong>
 . Allez, c’est parti pour un bon petit cours d’électronique pure !
 <img alt=":euh:" class="smiley" src="./static/smileys/unsure.gif"/>
 Alors, déjà, pourquoi "manuelle" ? Simplement parce que la consigne envoyée à l’électronique de commande est une tension continue et qu’elle sera réglable par un potentiomètre. En gros vous aurez simplement à faire tourner l’axe d’un potentiomètre pour régler l’angle du bras du servomoteur.
</p>
<h5 id="synoptique-de-lélectronique-interne">
 <a aria-hidden="true" href="#synoptique-de-lélectronique-interne">
  <span class="es-autolink-heading">
  </span>
 </a>
 Synoptique de l’électronique interne
</h5>
<p>
 Commençons par un synoptique qui établit le fonctionnement de l’électronique de contrôle :
</p>
<p>
 <img alt="Fonctionnement de l'électronique de contrôle" src="./images/uploaded/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur/fonctionnement-de-lelectronique-de-controle.jpg"/>
</p>
<p>
 Il y a donc en entrée les deux paramètres : la consigne et l’angle réel de l’axe du moteur; Et en sortie, la tension qui va commander le moteur. On l’a vu, un moteur à courant continu doit être commandé par une tension continue, si cette tension est positive, le moteur tournera dans un sens, si elle est négative, le moteur tournera dans l’autre sens. C’est pourquoi le comparateur délivrera une tension positive ou négative selon la correction d’angle à effectuer.
</p>
<h5 id="schéma-de-principe">
 <a aria-hidden="true" href="#schéma-de-principe">
  <span class="es-autolink-heading">
  </span>
 </a>
 Schéma de principe
</h5>
<p>
 À présent, voici le schéma de principe qui a pour fonctionnement celui expliqué par le synoptique précédent :
</p>
<p>
 <img alt="Schéma de principe" src="./images/uploaded/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur/schema-de-principe.jpg"/>
</p>
<p>
 De gauche à droite on a : les alimentations qui fournissent la tension positive et négative ; les potentiomètres P1 et P2 ; le comparateur (oui c’est ce gros triangle avec un plus et un moins) : enfin le moteur à courant continu.
</p>
<h5 id="fonctionnement-du-comparateur">
 <a aria-hidden="true" href="#fonctionnement-du-comparateur">
  <span class="es-autolink-heading">
  </span>
 </a>
 Fonctionnement du comparateur
</h5>
<p>
 Un comparateur est un composant électronique de la famille des circuits intégrés car, il contient en vérité d’autres composants, essentiellement des semi-conducteurs (diodes, transistors) et des résistances.
 <strong>
  Ce composant a toujours besoin d’une alimentation externe pour fonctionner, c’est-à-dire qu’on ne peut lui mettre des signaux à son entrée que s’il est alimenté.
 </strong>
 Autrement, il pourrait être endommagé (ce n’est pas souvent le cas, mais mieux vaut être prudent). Vous le constatez par vous-même, le comparateur est un composant qui possède deux entrées et une sortie. Et, de la manière la plus simple qui soit, en fait il n’y a rien de plus simple qui puisse exister, son fonctionnement réside sur le principe suivant :
</p>
<ul>
 <li>
  Si la tension (je me base par rapport au schéma)
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         V
        </mi>
        <mn>
         1
        </mn>
       </mrow>
       <annotation encoding="application/x-tex">
        V1
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="mord mathrm">
       1
      </span>
     </span>
    </span>
   </span>
  </span>
  qui arrive sur l’entrée
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         E
        </mi>
        <mn>
         1
        </mn>
       </mrow>
       <annotation encoding="application/x-tex">
        E1
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.05764em;">
       E
      </span>
      <span class="mord mathrm">
       1
      </span>
     </span>
    </span>
   </span>
  </span>
  du comparateur est supérieure à la tension
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         V
        </mi>
        <mn>
         2
        </mn>
       </mrow>
       <annotation encoding="application/x-tex">
        V2
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="mord mathrm">
       2
      </span>
     </span>
    </span>
   </span>
  </span>
  qui entre sur l’entrée
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         E
        </mi>
        <mn>
         2
        </mn>
       </mrow>
       <annotation encoding="application/x-tex">
        E2
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.05764em;">
       E
      </span>
      <span class="mord mathrm">
       2
      </span>
     </span>
    </span>
   </span>
  </span>
  du comparateur, alors la tension en sortie
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         S
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        S
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.05764em;">
       S
      </span>
     </span>
    </span>
   </span>
  </span>
  du comparateur est égale à
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mo>
         +
        </mo>
        <mi>
         V
        </mi>
        <mi>
         c
        </mi>
        <mi>
         c
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        +Vcc
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.76666em;vertical-align:-0.08333em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord">
       +
      </span>
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="mord mathit">
       c
      </span>
      <span class="mord mathit">
       c
      </span>
     </span>
    </span>
   </span>
  </span>
  (l’alimentation du comparateur).
 </li>
 <li>
  Tandis que dans le cas opposé où la tension
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         V
        </mi>
        <mn>
         2
        </mn>
       </mrow>
       <annotation encoding="application/x-tex">
        V2
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="mord mathrm">
       2
      </span>
     </span>
    </span>
   </span>
  </span>
  va être supérieure à
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         V
        </mi>
        <mn>
         1
        </mn>
       </mrow>
       <annotation encoding="application/x-tex">
        V1
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="mord mathrm">
       1
      </span>
     </span>
    </span>
   </span>
  </span>
  , la sortie
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         S
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        S
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.05764em;">
       S
      </span>
     </span>
    </span>
   </span>
  </span>
  du comparateur aura une tension égale à
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mo>
         −
        </mo>
        <mi>
         V
        </mi>
        <mi>
         c
        </mi>
        <mi>
         c
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        -Vcc
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.76666em;vertical-align:-0.08333em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord">
       −
      </span>
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="mord mathit">
       c
      </span>
      <span class="mord mathit">
       c
      </span>
     </span>
    </span>
   </span>
  </span>
  .
 </li>
</ul>
<p>
 En transposant mes dires sous une forme mathématique, cela donnerait ceci :
</p>
<ul>
 <li>
  Si
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         V
        </mi>
        <mn>
         1
        </mn>
        <mo>
         &gt;
        </mo>
        <mi>
         V
        </mi>
        <mn>
         2
        </mn>
       </mrow>
       <annotation encoding="application/x-tex">
        V1 \gt V2
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.72243em;vertical-align:-0.0391em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="mord mathrm">
       1
      </span>
      <span class="mrel">
       &gt;
      </span>
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="mord mathrm">
       2
      </span>
     </span>
    </span>
   </span>
  </span>
  , alors
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         V
        </mi>
        <mi>
         s
        </mi>
        <mo>
         =
        </mo>
        <mo>
         +
        </mo>
        <mi>
         V
        </mi>
        <mi>
         c
        </mi>
        <mi>
         c
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        Vs = +Vcc
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.76666em;vertical-align:-0.08333em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="mord mathit">
       s
      </span>
      <span class="mrel">
       =
      </span>
      <span class="mord">
       +
      </span>
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="mord mathit">
       c
      </span>
      <span class="mord mathit">
       c
      </span>
     </span>
    </span>
   </span>
  </span>
 </li>
 <li>
  Si
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         V
        </mi>
        <mn>
         1
        </mn>
        <mo>
         &lt;
        </mo>
        <mi>
         V
        </mi>
        <mn>
         2
        </mn>
       </mrow>
       <annotation encoding="application/x-tex">
        V1 \lt V2
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.72243em;vertical-align:-0.0391em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="mord mathrm">
       1
      </span>
      <span class="mrel">
       &lt;
      </span>
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="mord mathrm">
       2
      </span>
     </span>
    </span>
   </span>
  </span>
  , alors
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mi>
         V
        </mi>
        <mi>
         s
        </mi>
        <mo>
         =
        </mo>
        <mo>
         −
        </mo>
        <mi>
         V
        </mi>
        <mi>
         c
        </mi>
        <mi>
         c
        </mi>
       </mrow>
       <annotation encoding="application/x-tex">
        Vs = -Vcc
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.68333em;">
     </span>
     <span class="strut bottom" style="height:0.76666em;vertical-align:-0.08333em;">
     </span>
     <span class="base textstyle uncramped">
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="mord mathit">
       s
      </span>
      <span class="mrel">
       =
      </span>
      <span class="mord">
       −
      </span>
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="mord mathit">
       c
      </span>
      <span class="mord mathit">
       c
      </span>
     </span>
    </span>
   </span>
  </span>
 </li>
</ul>
<p>
 Comment s’en rappeler ? Eh bien grâce aux petits symboles "+" et "-" présents dans le triangle représentant le comparateur. La sortie du comparateur prendra +Vcc si la tension sur l’entrée "+" du comparateur est supérieure à celle sur l’entrée "-" et inversement. Voyez, j’vous z’avais dit que c’était ultra simple.
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
 Il y a encore quelque chose à savoir : il est impossible que les tensions V1 et V2 soient égales ! Oui, car le comparateur ne peut pas fournir une tension positive ET une tension négative en sa sortie, c’est pourquoi, même si vous reliez E1 et E2 avec un fil, la tension en sortie du comparateur sera toujours OU +Vcc OU -Vcc.
</p>
<h4 id="Électronique-à-consigne-pwm">
 <a aria-hidden="true" href="#Électronique-à-consigne-pwm">
  <span class="es-autolink-heading">
  </span>
 </a>
 Électronique à consigne PWM
</h4>
<h5 id="synoptique-de-principe">
 <a aria-hidden="true" href="#synoptique-de-principe">
  <span class="es-autolink-heading">
  </span>
 </a>
 Synoptique de principe
</h5>
<p>
 Prenons l’exemple d’un servomoteur qui utilise une PWM, oui j’ai bien dit… euh écrit
 <strong>
  PWM
 </strong>
 . Je prends cet exemple fictif car comme je le disais il y a quelques instants, c’est bien souvent un microcontrôleur qui gère l’asservissement du servomoteur. Et puis, avec l’exemple que je vais vous donner, vous pourrez vous-même créer un servomoteur.
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
 En fait, on ne peut pas utiliser directement ce signal PWM avec le schéma précédent. Il va falloir que l’on fasse une extraction de la composante continue de ce signal pour obtenir une consigne dont la tension varie et non la durée de l’état HAUT du signal. Et ceci, nous l’avons déjà vu dans
 <a href="https:// zestedesavoir.com/tutoriels/537/arduino-premiers-pas-en-informatique-embarquee/745/les-grandeurs-analogiques/3432/et-les-sorties-analogiques-enfin-presque/#2-la-pwm-de-larduino">
  un chapitre dédié à la PWM
 </a>
 justement. Le synoptique ne change guère, il y a simplement ajout de ce montage intermédiaire qui va extraire cette tension continue du signal :
</p>
<p>
 <img alt="Principe d'extraction de la tension continue du signal" src="./images/uploaded/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur/principe-dextraction-de-la-tension-continue-du-signal.jpg"/>
</p>
<p>
 Le schéma électrique ne change pas non plus de beaucoup, on retire le potentiomètre qui permettait de régler la consigne manuellement en le remplaçant par le montage qui fait l’extraction de la composante continue:
</p>
<p>
 <img alt="Montage d'extraction de la tension continue du signal" src="./images/uploaded/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur/montage-dextraction-de-la-tension-continue-du-signal.jpg"/>
</p>
<p>
 À la place du potentiomètre de commande manuelle on retrouve un couple résistance/condensateur avec
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        R
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       R
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.00773em;">
      R
     </span>
    </span>
   </span>
  </span>
 </span>
 et
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        C
       </mi>
      </mrow>
      <annotation encoding="application/x-tex">
       C
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.07153em;">
      C
     </span>
    </span>
   </span>
  </span>
 </span>
 , qui permet d’extraire la tension continue du signal
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <msub>
        <mi>
         V
        </mi>
        <mrow>
         <mi>
          P
         </mi>
         <mi>
          W
         </mi>
         <mi>
          M
         </mi>
        </mrow>
       </msub>
      </mrow>
      <annotation encoding="application/x-tex">
       V_{PWM}
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord">
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="msupsub">
       <span class="vlist">
        <span style="top:0.15em;margin-right:0.05em;margin-left:-0.22222em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord scriptstyle cramped mtight">
           <span class="mord mathit mtight" style="margin-right:0.13889em;">
            P
           </span>
           <span class="mord mathit mtight" style="margin-right:0.13889em;">
            W
           </span>
           <span class="mord mathit mtight" style="margin-right:0.10903em;">
            M
           </span>
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
     </span>
    </span>
   </span>
  </span>
 </span>
 qui est donc un signal de type PWM dont le rapport cyclique varie de 0 à 100%. Et là, tenez-vous bien, on en arrive au point où je voulais vous amener !
 <img alt=":D" class="smiley" src="./static/smileys/heureux.png"/>
 Que remarquez-vous ? Rien ? Alors je vous le dis : que se passe-t-il si on arrête d’envoyer le signal
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <msub>
        <mi>
         V
        </mi>
        <mrow>
         <mi>
          P
         </mi>
         <mi>
          W
         </mi>
         <mi>
          M
         </mi>
        </mrow>
       </msub>
      </mrow>
      <annotation encoding="application/x-tex">
       V_{PWM}
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord">
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="msupsub">
       <span class="vlist">
        <span style="top:0.15em;margin-right:0.05em;margin-left:-0.22222em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord scriptstyle cramped mtight">
           <span class="mord mathit mtight" style="margin-right:0.13889em;">
            P
           </span>
           <span class="mord mathit mtight" style="margin-right:0.13889em;">
            W
           </span>
           <span class="mord mathit mtight" style="margin-right:0.10903em;">
            M
           </span>
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
     </span>
    </span>
   </span>
  </span>
 </span>
 ? Le moteur garde son bras au même angle ? Ou bien il reprend sa position initiale ? Réponse : il reprend sa position initiale. Eh oui, car la tension continue
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        V
       </mi>
       <mn>
        1
       </mn>
      </mrow>
      <annotation encoding="application/x-tex">
       V1
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.22222em;">
      V
     </span>
     <span class="mord mathrm">
      1
     </span>
    </span>
   </span>
  </span>
 </span>
 n’existe plus puisqu’elle est créée à partir du signal
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <msub>
        <mi>
         V
        </mi>
        <mrow>
         <mi>
          P
         </mi>
         <mi>
          W
         </mi>
         <mi>
          M
         </mi>
        </mrow>
       </msub>
      </mrow>
      <annotation encoding="application/x-tex">
       V_{PWM}
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord">
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="msupsub">
       <span class="vlist">
        <span style="top:0.15em;margin-right:0.05em;margin-left:-0.22222em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord scriptstyle cramped mtight">
           <span class="mord mathit mtight" style="margin-right:0.13889em;">
            P
           </span>
           <span class="mord mathit mtight" style="margin-right:0.13889em;">
            W
           </span>
           <span class="mord mathit mtight" style="margin-right:0.10903em;">
            M
           </span>
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
     </span>
    </span>
   </span>
  </span>
 </span>
 . Quand il y avait le potentiomètre, la tension
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        V
       </mi>
       <mn>
        1
       </mn>
      </mrow>
      <annotation encoding="application/x-tex">
       V1
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.22222em;">
      V
     </span>
     <span class="mord mathrm">
      1
     </span>
    </span>
   </span>
  </span>
 </span>
 gardait la même valeur tant que vous ne tourniez pas l’axe du potentiomètre, hors là, si on enlève le signal
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <msub>
        <mi>
         V
        </mi>
        <mrow>
         <mi>
          P
         </mi>
         <mi>
          W
         </mi>
         <mi>
          M
         </mi>
        </mrow>
       </msub>
      </mrow>
      <annotation encoding="application/x-tex">
       V_{PWM}
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord">
      <span class="mord mathit" style="margin-right:0.22222em;">
       V
      </span>
      <span class="msupsub">
       <span class="vlist">
        <span style="top:0.15em;margin-right:0.05em;margin-left:-0.22222em;">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         <span class="reset-textstyle scriptstyle cramped mtight">
          <span class="mord scriptstyle cramped mtight">
           <span class="mord mathit mtight" style="margin-right:0.13889em;">
            P
           </span>
           <span class="mord mathit mtight" style="margin-right:0.13889em;">
            W
           </span>
           <span class="mord mathit mtight" style="margin-right:0.10903em;">
            M
           </span>
          </span>
         </span>
        </span>
        <span class="baseline-fix">
         <span class="fontsize-ensurer reset-size5 size5">
          <span style="font-size:0em;">
           ​
          </span>
         </span>
         ​
        </span>
       </span>
      </span>
     </span>
    </span>
   </span>
  </span>
 </span>
 , eh bien la tension
 <span class="inlineMath">
  <span class="katex">
   <span class="katex-mathml">
    <math>
     <semantics>
      <mrow>
       <mi>
        V
       </mi>
       <mn>
        1
       </mn>
      </mrow>
      <annotation encoding="application/x-tex">
       V1
      </annotation>
     </semantics>
    </math>
   </span>
   <span aria-hidden="true" class="katex-html">
    <span class="strut" style="height:0.68333em;">
    </span>
    <span class="strut bottom" style="height:0.68333em;vertical-align:0em;">
    </span>
    <span class="base textstyle uncramped">
     <span class="mord mathit" style="margin-right:0.22222em;">
      V
     </span>
     <span class="mord mathrm">
      1
     </span>
    </span>
   </span>
  </span>
 </span>
 perd sa valeur et retombe à 0V. Par conséquent, le moteur redonne à son bras sa position initiale.
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Et si je veux que mon servomoteur continue de garder l’angle de la consigne qui lui a été transmise sans que je continue à lui envoyer cette consigne, est-ce possible ?
  </p>
 </div>
</div>
<p>
 Oui, c’est tout à fait possible. En fait, cela va peut-être paraître un peu "barbare", mais c’est la seule solution envisageable avec les servomoteurs analogiques : il suffit de le positionner à l’angle voulu et de couper son alimentation. L’angle du bras du servomoteur sera alors conservé.
 <strong>
  Mais attention, cet angle ne sera conservé que s’il n’y a pas de contrainte mécanique exercée sur le bras du servo !
 </strong>
 C’est-à-dire qu’il n’y ait pas un poids accroché à l’axe du moteur, ou alors il faut qu’il soit bien inférieur à la force de maintien de la position du bras du servo lorsque celui-ci n’est plus alimenté.
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Et pour l’électronique à consigne PPM alors ?
   <img alt="o_O" class="smiley" src="./static/smileys/blink.gif"/>
  </p>
 </div>
</div>
<p>
 Pour ce type d’électronique de commande (présent dans tous les servos du commerce), je vous l’ai dit : il y a utilisation d’un microcontrôleur. Donc tout se fait par un programme qui scrute la position réelle du bras du moteur par rapport à la consigne PPM qu’il reçoit. Je n’ai donc rien d’intéressant à vous raconter.
 <img alt=":-°" class="smiley" src="./static/smileys/siffle.png"/>
</p>
<h3 id="un-peu-dexercice">
 <a aria-hidden="true" href="#un-peu-dexercice">
  <span class="es-autolink-heading">
  </span>
 </a>
 Un peu d’exercice !
</h3>
<p>
 Bon allez, il est temps de faire un peu d’entrainement ! Je vous laisse découvrir le sujet…
</p>
<h5 id="consigne">
 <a aria-hidden="true" href="#consigne">
  <span class="es-autolink-heading">
  </span>
 </a>
 Consigne
</h5>
<p>
 Nous allons utiliser trois éléments dans cet exercice :
</p>
<ul>
 <li>
  un servomoteur (évidemment)
 </li>
 <li>
  un potentiomètre (valeur de votre choix)
 </li>
 <li>
  la liaison série
 </li>
</ul>
<h5 id="objectif">
 <a aria-hidden="true" href="#objectif">
  <span class="es-autolink-heading">
  </span>
 </a>
 Objectif
</h5>
<p>
 Le servo doit "suivre" le potentiomètre. C’est-à-dire que lorsque vous faites tourner l’axe du potentiomètre, le bras du servomoteur doit tourner à son tour et dans le même sens. Pour ce qui est de l’utilisation de la liaison série, je veux simplement que l’on ait un retour de la valeur donnée par le potentiomètre pour faire une supervision. Je ne vous en dis pas plus, vous savez déjà tout faire. Bon courage et à plus tard !
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
</p>
<div class="text-center">
 <div class="video-container">
  <div class="video-wrapper">
   <iframe allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/LQtl9KkunVE" width="560">
   </iframe>
  </div>
 </div>
</div>
<h4 id="correction">
 <a aria-hidden="true" href="#correction">
  <span class="es-autolink-heading">
  </span>
 </a>
 Correction
</h4>
<p>
 J’espère que vous avez réussi ! Tout d’abord le schéma, même si je sais que vous avez été capable de faire les branchements par vous-même. C’est toujours bon de l’avoir sous les yeux.
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
</p>
<p>
 <img alt="Arduino branché avec un servomoteur et un potentiomètre" src="./images/uploaded/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur/arduino-branche-avec-un-servomoteur-et-un-potentiometre.png"/>
</p>
<p>
 Pour ma part, j’ai branché le servo sur la broche numérique 2 et le potentiomètre sur la broche analogique 0. J’ai donc le code suivant pour préparer l’ensemble :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Servo.h&gt; // On n'oublie pas d'ajouter la bibliothèque !</span></span>

<span class="hljs-comment">// notre potentiomètre</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> potar = <span class="hljs-number">0</span>;

<span class="hljs-comment">// création d'un nouveau servomoteur</span>
Servo monServo;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// on déclare l'entrée du servo connectée sur la broche 2</span>
    monServo.attach(<span class="hljs-number">2</span>);
    <span class="hljs-comment">// on n'oublie pas de démarrer la liaison série ;-)</span>
    Serial.begin(<span class="hljs-number">9600</span>);
}
</code></pre>
</div>
<p>
 Voilà qui est fait pour les préparatifs, il n’y a plus qu’à travailler un tout petit peu pour faire la logique du code. Commençons par la lecture analogique que nous allons renvoyer sur le servo ensuite. Le potentiomètre délivre une tension variable de 0 à 5V selon sa position. La carte Arduino, elle, lit une valeur comprise entre 0 et 1023. Ce nombre est stocké au format
 <code>
  int
 </code>
 . Il faut ensuite que l’on donne à la fonction qui permet d’envoyer la consigne au servo une valeur comprise entre 0 et 180°. On va donc utiliser une fonction dédiée à cela. Cette fonction permet de faire le rapport entre deux gammes de valeurs ayant chacune des extremums différents. Il s’agit de la fonction
 <a href="http://arduino.cc/en/Reference/Map">
  <code>
   map()
  </code>
 </a>
 (nous en avions parlé dans le chapitre sur les lectures analogiques) :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp"><span class="hljs-built_in">map</span>(value, fromLow, fromHigh, toLow, toHigh)
</code></pre>
</div>
<p>
 Avec pour correspondance :
</p>
<ul>
 <li>
  <strong>
   value
  </strong>
  : valeur à convertir pour la changer de gamme
 </li>
 <li>
  <strong>
   fromLow
  </strong>
  : valeur minimale de la gamme à convertir
 </li>
 <li>
  <strong>
   fromHigh
  </strong>
  : valeur maximale de la gamme à convertir
 </li>
 <li>
  <strong>
   toLow
  </strong>
  : valeur minimale de la gamme vers laquelle est convertie la valeur initiale
 </li>
 <li>
  <strong>
   toHigh
  </strong>
  : valeur maximale de la gamme vers laquelle est convertie la valeur initiale
 </li>
</ul>
<p>
 Nous utiliserons cette fonction de la manière suivante :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp"><span class="hljs-built_in">map</span>(valeur_potentiometre, <span class="hljs-number">0</span>, <span class="hljs-number">1023</span>, <span class="hljs-number">0</span>, <span class="hljs-number">180</span>) ;
</code></pre>
</div>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   On aurait pu faire un simple produit en croix, non ?
  </p>
 </div>
</div>
<p>
 Tout à fait. Mais les programmeurs sont de véritables fainéants et aiment utiliser des outils déjà prêts. :P Cela dit, ils les ont créés. Et pour créer de nouveaux outils, il est plus facile de prendre des outils déjà existants. Mais si vous voulez, on peut recréer la fonction map() par nous-mêmes :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">conversion</span><span class="hljs-params">(<span class="hljs-keyword">int</span> mesure)</span>
</span>{
    <span class="hljs-keyword">return</span> mesure*<span class="hljs-number">180</span>/<span class="hljs-number">1023</span>;
}
</code></pre>
</div>
<h5 id="fonction-loop">
 <a aria-hidden="true" href="#fonction-loop">
  <span class="es-autolink-heading">
  </span>
 </a>
 Fonction
 <code>
  loop()
 </code>
</h5>
<p>
 Dans la fonction
 <code>
  loop()
 </code>
 on a donc la récupération et l’envoi de la consigne au servomoteur :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// on lit la valeur du potentiomètre</span>
    <span class="hljs-keyword">int</span> val = analogRead(potar);
    <span class="hljs-comment">// mise à l'échelle de la valeur lue vers la plage [0;180]</span>
    <span class="hljs-keyword">int</span> angle = <span class="hljs-built_in">map</span>(val, <span class="hljs-number">0</span>, <span class="hljs-number">1023</span>, <span class="hljs-number">0</span>, <span class="hljs-number">180</span>);
    <span class="hljs-comment">// on met à jour l'angle sur le servo</span>
    monServo.write(angle);
}
</code></pre>
 </div>
 <figcaption>
  Rotation du servo en fonction du potentiomètre
 </figcaption>
</figure>
<p>
 Avez-vous remarqué que ces trois lignes de code auraient pu être réduites en une seule ? :P Comme ceci :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">monServo.write(<span class="hljs-built_in">map</span>(analogRead(potar), <span class="hljs-number">0</span>, <span class="hljs-number">1023</span>, <span class="hljs-number">0</span>, <span class="hljs-number">180</span>));
</code></pre>
</div>
<p>
 Ou bien la version utilisant le produit en croix :
</p>
<div class="custom-block custom-block-spoiler">
 <div class="custom-block-body">
  <div class="hljs-code-div">
   <div class="hljs-line-numbers">
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
   </div>
   <pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// on lit la valeur du potentiomètre</span>
    <span class="hljs-keyword">int</span> val = analogRead(potar);
    <span class="hljs-comment">// on converti la valeur lue en angle compris dans l’interval [0;180]</span>
    <span class="hljs-keyword">int</span> angle = val / <span class="hljs-number">5.7</span>;
    <span class="hljs-comment">// 5,7 provient de la division de 1023/180</span>
    <span class="hljs-comment">// pour la mise à l'échelle de la valeur lue</span>

    <span class="hljs-comment">// on met à jour l'angle sur le servo</span>
    monServo.write(angle);
}
</code></pre>
  </div>
  <p>
   Et à nouveau une condensation de ces trois lignes en une :
  </p>
  <div class="hljs-code-div">
   <div class="hljs-line-numbers">
    <span>
    </span>
   </div>
   <pre><code class="hljs language-cpp">monServo.write(analogRead(potar)/<span class="hljs-number">5.7</span>);
</code></pre>
  </div>
 </div>
</div>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   Mais comme il nous faut renvoyer la valeur convertie vers l’ordinateur, il est mieux de stocker cette valeur dans une variable. Autrement dit, préférez garder le code à trois lignes.
  </p>
 </div>
</div>
<h5 id="et-la-liaison-série">
 <a aria-hidden="true" href="#et-la-liaison-série">
  <span class="es-autolink-heading">
  </span>
 </a>
 Et la liaison série
</h5>
<p>
 Pour renvoyer la valeur, rien de bien sorcier :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">Serial.println(angle);
</code></pre>
</div>
<h5 id="code-final">
 <a aria-hidden="true" href="#code-final">
  <span class="es-autolink-heading">
  </span>
 </a>
 Code final
</h5>
<p>
 Au final, on se retrouve avec un code tel que celui-ci :
</p>
<div class="custom-block custom-block-spoiler">
 <div class="custom-block-body">
  <figure>
   <div class="hljs-code-div">
    <div class="hljs-line-numbers">
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
    </div>
    <pre><code class="hljs language-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Servo.h&gt; // On n'oublie pas d'ajouter la bibliothèque !</span></span>

<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> potar = <span class="hljs-number">0</span>; <span class="hljs-comment">// notre potentiomètre</span>
Servo monServo;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// on déclare le servo sur la broche 2 (éventuellement régler les bornes)</span>
    monServo.attach(<span class="hljs-number">2</span>);
    <span class="hljs-comment">// on n'oublie pas de démarrer la voie série</span>
    Serial.begin(<span class="hljs-number">9600</span>);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// on lit la valeur du potentiomètre</span>
    <span class="hljs-keyword">int</span> val = analogRead(potar);
    <span class="hljs-comment">// on convertit la valeur lue en angle compris dans l’intervalle [0;180]</span>
    <span class="hljs-keyword">int</span> angle = val / <span class="hljs-number">5.7</span>;
    <span class="hljs-comment">// on met à jour l'angle sur le servo</span>
    monServo.write(angle);
    <span class="hljs-comment">// on renvoie l'angle par la voie série pour superviser</span>
    Serial.println(angle);
    <span class="hljs-comment">// un petit temps de pause</span>
    delay(<span class="hljs-number">100</span>);
}
</code></pre>
   </div>
   <figcaption>
    Code final de l’exercice de rotation d’un servo en fonction d’un potentiomètre
   </figcaption>
  </figure>
 </div>
</div>
<p>
 Je vous laisse mixer avec les différents codes que l’on vous a donnés pour que vous fassiez celui qui vous convient le mieux (avec la fonction map(), ou bien celui qui est tout condensé, etc.). Dorénavant, vous allez pouvoir vous amuser avec les servomoteurs !
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
</p>
<h3 id="tester-un-servomoteur-non-standard">
 <a aria-hidden="true" href="#tester-un-servomoteur-non-standard">
  <span class="es-autolink-heading">
  </span>
 </a>
 Tester un servomoteur “non-standard”
</h3>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   C’est déjà la fin ?
   <img alt="o_O" class="smiley" src="./static/smileys/blink.gif"/>
  </p>
 </div>
</div>
<p>
 Eh oui, je n’ai plus grand-chose à vous dire, car ce n’est pas très compliqué puisqu’il suffit d’utiliser un outil déjà tout prêt qui est la bibliothèque
 <em>
  Servo
 </em>
 . Je vais cependant vous montrer deux autres fonctions bien utiles.
</p>
<h5 id="writemicroseconds">
 <a aria-hidden="true" href="#writemicroseconds">
  <span class="es-autolink-heading">
  </span>
 </a>
 <code>
  writeMicroSeconds()
 </code>
</h5>
<p>
 En premier, la fonction
 <code>
  writeMicroSeconds()
 </code>
 . Cette fonction permet de définir un temps à l’état HAUT du signal PPM autre que celui compris entre 1 et 2 ms. Elle est très pratique pour tester un servo dont vous ne connaissez pas les caractéristiques (servo 0 à 90° ou autre). De plus, il arrive que certains constructeurs ne se soucient pas trop des standards [1ms-2ms] et dépassent un peu ces valeurs. De par ce fait, si vous utilisez un servo avec les valeurs originales vous n’obtiendrez pas le comportement escompté. En utilisant cette fonction, vous pourrez ainsi tester le servo petit à petit en envoyant différentes valeurs une à une (par la voie série par exemple).
</p>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   Une valeur incorrecte se repère assez facilement. Si vous voyez votre servo "trembler" aux alentours des 0° ou 180° ou bien encore s’il fait des allers-retours étranges sans que vous n’ayez changé la consigne alors c’est que la valeur utilisée est probablement fausse.
  </p>
 </div>
</div>
<h5 id="read">
 <a aria-hidden="true" href="#read">
  <span class="es-autolink-heading">
  </span>
 </a>
 <code>
  read()
 </code>
</h5>
<p>
 Une deuxième fonction pouvant être utile est la fonction
 <code>
  read()
 </code>
 . Tout l’intérêt de cette fonction est perdu si elle est utilisée pour le code que l’on a vu dans l’exercice précédent. En revanche, elle a très bien sa place dans un système où le servomoteur est géré automatiquement par le programme de la carte Arduino et où l’utilisateur ne peut y accéder.
</p>
<h4 id="programme-de-test">
 <a aria-hidden="true" href="#programme-de-test">
  <span class="es-autolink-heading">
  </span>
 </a>
 Programme de test
</h4>
<p>
 En préparant ce chapitre, j’ai pu commencer à jouer avec un servomoteur issu de mes fonds de tiroirs. N’ayant bien entendu aucune documentation sur place ou sur internet, j’ai commencé à jouer avec en assumant qu’il utiliserait des valeurs "standards", donc entre 1000 et 2000µs pour l’état haut de la PPM. J’ai ainsi pu constater que mon servo fonctionnait, mais on était loin de parcourir les 180° attendus. J’ai donc fait un petit code utilisant une des fonctions précédentes pour tester le moteur en mode "pas à pas" et ainsi trouver les vrais timings de ces bornes. Pour cela, j’ai utilisé la liaison série. Elle m’a servi pour envoyer une commande simple (’a' pour augmenter la consigne, 'd' pour la diminuer). Ainsi, en recherchant à tâtons et en observant le comportement du moteur, j’ai pu déterminer qu’il était borné entre 560 et 2130 µs. Pas super proche des 1 et 2ms attendues ! :P Comme je suis sympa (
 <img alt=":euh:" class="smiley" src="./static/smileys/unsure.gif"/>
 ), je vous donne le code que j’ai réalisé pour le tester. Les symptômes à observer sont : aucune réaction du servo (pour ma part en dessous de 560 il ne se passe plus rien) ou au contraire, du mouvement sans changement de la consigne (de mon côté, si l’on augmente au-dessus de 2130 le servo va continuer à tourner sans s’arrêter).
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Servo.h&gt; // On oublie pas d'ajouter la bibliothèque !</span></span>

<span class="hljs-keyword">int</span> temps = <span class="hljs-number">1500</span>; <span class="hljs-comment">// censée être à mi-chemin entre 1000 et 2000, un bon point de départ</span>

Servo monServo;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    Serial.begin(<span class="hljs-number">115200</span>);
    Serial.println(<span class="hljs-string">"Hello World"</span>);

    monServo.attach(<span class="hljs-number">2</span>);
    <span class="hljs-comment">// on démarre à une valeur censé être la moitié de</span>
    <span class="hljs-comment">// l'excursion totale de l'angle réalisé par le servomoteur</span>
    monServo.writeMicroseconds(temps);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// des données sur la liaison série ? (lorsque l'on appuie sur 'a' ou 'd')</span>
    <span class="hljs-keyword">if</span>(Serial.available())
    {
        <span class="hljs-keyword">char</span> commande = Serial.read(); <span class="hljs-comment">// on lit</span>

        <span class="hljs-comment">// on modifie la consigne si c'est un caractère qui nous intéresse</span>
        <span class="hljs-keyword">if</span>(commande == <span class="hljs-string">'a'</span>)
            temps += <span class="hljs-number">10</span>;  <span class="hljs-comment">// ajout de 10µs au temps HAUT</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(commande == <span class="hljs-string">'d'</span>)
            temps -= <span class="hljs-number">10</span>;  <span class="hljs-comment">// retrait de 10µs au temps HAUT</span>

        <span class="hljs-comment">// on modifie la consigne du servo</span>
        monServo.writeMicroseconds(temps);

        <span class="hljs-comment">// et on fait un retour sur la console pour savoir où on est rendu</span>
        Serial.println(temps, DEC);
    }
}
</code></pre>
 </div>
 <figcaption>
  Programme de test d’un servomoteur
 </figcaption>
</figure>
<p>
 Ce programme est très simple d’utilisation et vous pouvez d’ailleurs le modifier comme bon vous semble pour qu’il corresponde à ce que vous voulez faire avec. Il suffit en fait de brancher la carte Arduino à un ordinateur et ouvrir un terminal série (par exemple le moniteur intégré dans l’environnement Arduino). Ensuite, appuyez sur 'a' ou 'd' pour faire augmenter ou diminuer le temps de l’état HAUT du signal PPM. Vous pourrez ainsi avoir un retour des temps extrêmes qu’utilise votre servomoteur.
</p>
<p>
 On en termine avec les servomoteurs. Vous avez sans doute plein de nouvelles idées avec lesquelles vous emploierez les servomoteurs qui vous permettront de faire beaucoup de choses très utiles, voire inutiles mais indispensables. :P
</p>
            </div>
            <!-- /.entry-content -->
            <hr>
            <div class="row bg-light my-2 py-2 rounded">
                <div class="col mr-auto">
                    <a class="" href="/tuto-arduino-601-le-moteur-à-courant-continu" rel="prev">
                        <i class="fas fa-chevron-left fa-lg"></i>
                        tuto-arduino-601-le-moteur-à-courant-continu
                    </a>
                </div>
                <div class="col-auto">
                    <a class="" href="/tuto-arduino-603-a-petits-pas-le-moteur-pas-à-pas" rel="next">
                        tuto-arduino-603-a-petits-pas-le-moteur-pas-à-pas
                        <i class="fas fa-chevron-right fa-lg"></i>
                    </a>
                </div>
            </div>
            <div class="text-center">
                <img class="es-licence-pic" src="/static/images/CC BY-NC-SA.png" alt="Licence CC BY-NC-SA" title="Article sous licence CC BY-NC-SA">
            </div>
            <div class="my-3 text-center">
                <a class="btn btn-outline-dark mx-1" href="https://twitter.com/share?url=http://eskimon.fr/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur&amp;text=Un moteur qui a de la tête : le Servomoteur - http://eskimon.fr/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur" rel="nofollow" title="Partager cet article sur Twitter" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-twitter fa-lg"></i>
                </a>
                <a class="btn btn-outline-dark mx-1" href="https://www.facebook.com/sharer.php?u=http://eskimon.fr/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur&amp;t=Un moteur qui a de la tête : le Servomoteur - http://eskimon.fr/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur" rel="nofollow" title="Partager cet article sur Facebook" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-facebook-f fa-lg"></i>
                </a>
                <a class="btn btn-outline-dark mx-1" href="https://plus.google.com/share?url=http://eskimon.fr/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur&amp;hl=fr" rel="nofollow" title="Partager cet article sur Google +" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-google-plus fa-lg"></i>
                </a>
                <!--<a class="btn btn-outline-dark mx-1" href="http://sharetodiaspora.github.io/?url=http://eskimon.fr/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur&amp;title=Un moteur qui a de la tête : le Servomoteur - http://eskimon.fr/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur" rel="nofollow"  title="Partager cet article sur Diaspora" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-google-plus fa-lg"></i>
                </a>-->
                <a class="btn btn-outline-dark mx-1" href="mailto:?subject=Un moteur qui a de la tête : le Servomoteur&amp;body=http://eskimon.fr/tuto-arduino-602-un-moteur-qui-a-de-la-tête-le-servomoteur"rel="nofollow" title="Partager cet article par email" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="far fa-envelope fa-lg"></i>
                </a>
            </div>
            <div class="text-center">
                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <!-- pub article large horizontal -->
                <ins class="adsbygoogle"
                    style="display:inline-block;width:728px;height:90px"
                    data-ad-client="ca-pub-2080155902357792"
                    data-ad-slot="8315996923"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
        </article>
    </div>
    <div class="d-none d-xl-block col-xl-1 offset-xl-1 px-0">
        <div class="d-flex flex-column justify-content-around align-items-end h-100">
            <!-- 45659 -->
            <!-- 127755 -->
                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <!-- droite contenu -->
                <ins class="adsbygoogle"
                    style="display:inline-block;width:120px;height:600px"
                    data-ad-client="ca-pub-2080155902357792"
                    data-ad-slot="4023722026"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <!-- droite contenu -->
                <ins class="adsbygoogle"
                    style="display:inline-block;width:120px;height:600px"
                    data-ad-client="ca-pub-2080155902357792"
                    data-ad-slot="4023722026"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <!-- droite contenu -->
                <ins class="adsbygoogle"
                    style="display:inline-block;width:120px;height:600px"
                    data-ad-client="ca-pub-2080155902357792"
                    data-ad-slot="4023722026"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <!-- droite contenu -->
                <ins class="adsbygoogle"
                    style="display:inline-block;width:120px;height:600px"
                    data-ad-client="ca-pub-2080155902357792"
                    data-ad-slot="4023722026"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <!-- droite contenu -->
                <ins class="adsbygoogle"
                    style="display:inline-block;width:120px;height:600px"
                    data-ad-client="ca-pub-2080155902357792"
                    data-ad-slot="4023722026"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <!-- droite contenu -->
                <ins class="adsbygoogle"
                    style="display:inline-block;width:120px;height:600px"
                    data-ad-client="ca-pub-2080155902357792"
                    data-ad-slot="4023722026"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <!-- droite contenu -->
                <ins class="adsbygoogle"
                    style="display:inline-block;width:120px;height:600px"
                    data-ad-client="ca-pub-2080155902357792"
                    data-ad-slot="4023722026"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <!-- droite contenu -->
                <ins class="adsbygoogle"
                    style="display:inline-block;width:120px;height:600px"
                    data-ad-client="ca-pub-2080155902357792"
                    data-ad-slot="4023722026"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <!-- droite contenu -->
                <ins class="adsbygoogle"
                    style="display:inline-block;width:120px;height:600px"
                    data-ad-client="ca-pub-2080155902357792"
                    data-ad-slot="4023722026"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
        </div>
    </div>
</div>
    </div>
<footer class="container-fluid bg-dark small text-white px-3">
<div class="row">
    <div class="col align-self-center">
        © Eskimon -
        Blog propulsé par <a class="bold text-white" href="https://blog.getpelican.com/" rel="nofollow">Pelican</a> -
        Thème fait maison
    </div>
    <div class="col align-self-end text-right">
        <a class="btn btn-lg text-light" href="https://github.com/Eskimon" rel="nofollow" title="Mon profil Github">
            <i class="fab fa-github fa-lg"></i>
        </a>
        <a class="btn btn-lg text-light" href="https://twitter.com/Eskimon_fr" rel="nofollow" title="Me suivre sur Linkedin">
            <i class="fab fa-twitter fa-lg"></i>
        </a>
    </div>
  </div>
</footer>
    <!-- For formula -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- Font awesome -->
    <script src="https://use.fontawesome.com/releases/v5.0.0/js/all.js"></script>
    <!-- JQuery first -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <!-- Popper.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <!-- Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- For tooltips -->
    <script>$(function () {  $('[data-toggle="tooltip"]').tooltip()})</script>
    <script src="/static/js/my-scripts.js"></script>
<script>
function create_side_summary() {
    // Duplicate summary
    var main_summary = $('#sommaire').next();
    if(main_summary.length === 0)
        return
    var side_summary = main_summary.clone();
    side_summary.addClass('pl-0');
    var all_p = side_summary.find('p');
    all_p.contents().unwrap();
    var all_li = side_summary.find('li');
    all_li.addClass('pl-1');

    // scrollspy - in
    side_summary.attr('id', 'es-side-summary-mainlist');
    //side_summary.addClass('nav');
    //all_li.addClass('nav-item');
    var all_a = side_summary.find('a');
    all_a.addClass('nav-link');
    var all_ul = side_summary.find('ul');
    all_ul.addClass('pl-1');
    $('body').scrollspy({ target: '#es-side-summary-mainlist' });
    // scrollspy - out

    var summary_title = document.createElement("h4");
    summary_title.className = 'navbar-brand';
    summary_title.innerHTML = 'Sommaire';
    $(summary_title).prependTo('#es-side-summary-content');
    side_summary.appendTo('#es-side-summary-content');
    main_summary.addClass('es-subul-collapse');
}

function generate_spoilers() {
    all_secret = $('.custom-block-spoiler');
    all_secret.each(function( index ) {
    let content = $(this).html();
    $(this).html('');
    $(this).addClass('card');
    var headerText = document.createElement("button");
    var cardHeader = document.createElement("div");
    var cardBodyWrapper = document.createElement("div");
    var cardBody = document.createElement("div");
    $(headerText).text('Contenu masqué, cliquez pour afficher');
    $(headerText).addClass('btn btn-link btn-sm');
    $(headerText).attr('data-toggle', 'collapse');
    $(headerText).attr('data-target', '#collapse-' + index);
    $(headerText).attr('aria-controls', 'collapse-' + index);
    $(headerText).attr('aria-expanded', 'false');
    $(cardHeader).append(headerText);
    $(cardHeader).addClass('card-header');
    $(cardHeader).attr('id', 'spoiler-' + index);
    $(cardBody).html(content);
    $(cardBody).addClass('card-body');
    $(cardBodyWrapper).append(cardBody);
    $(cardBodyWrapper).addClass('collapse hide');
    $(cardBodyWrapper).attr('id', 'collapse-' + index)
    $(cardBodyWrapper).attr('aria-labelledby', 'spoiler-' + index)
    $(this).prepend(cardHeader);
    $(this).append(cardBodyWrapper);
    });

    $('.collapse').collapse({toggle: false});
}


$(document).ready(function () {

    create_side_summary();
    generate_spoilers();

    // when opening the sidebar
    $('#sidebarCollapse').on('click', function () {
        // open sidebar
        $('#es-side-summary').removeClass('d-none');
        $('#es-content').addClass('d-none');
        $('#sidebarCollapse').removeClass('sticky-top');
    });

    // if dismiss or overlay was clicked
    $('#es-side-summary').on('click', function () {
      // hide the sidebar
      $('#es-side-summary').addClass('d-none');
      $('#es-content').removeClass('d-none');
      $('#sidebarCollapse').addClass('sticky-top');
    });
});

</script>
</body>

</html>

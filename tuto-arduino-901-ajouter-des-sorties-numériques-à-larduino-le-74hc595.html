<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Ajouter des sorties numériques à l'Arduino, le 74HC595 &bull; Le blog d'Eskimon</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/hljs-monokai.css" />
    <link rel="stylesheet" href="/static/css/style.css" />
    <!-- Google font -->
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/images/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="57x57" href="/static/images/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/static/images/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/static/images/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/static/images/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/static/images/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/static/images/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/static/images/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/static/images/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/images/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/static/images/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/static/images/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="/static/images/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/static/images/favicon/ms-icon-144x144.png">

    <link href="https://eskimon.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Le blog d'Eskimon Atom Feed" />
    <link href="https://eskimon.fr/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Le blog d'Eskimon RSS Feed" />

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-46353906-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-46353906-1');
    </script>

    <meta name="description" content="14 sorties numériques sur une Arduino Uno c'est peu. Voyons comment avec un composant simple, le 74HC595, nous pouvons multiplier ces dernières." />

  <meta name="tags" content="arduino" />
  <meta name="tags" content="tuto" />


  <meta property="og:site_name" content="Le blog d'Eskimon">
  <meta property="og:title" content="Ajouter des sorties numériques à l'Arduino, le 74HC595">
  <meta property="og:url" content="https://eskimon.fr/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595">
  <meta property="og:language" content="fr_FR">
  <meta property="og:type" content="website">

  <meta property="twitter:domain" content="https://eskimon.fr/">
  <meta property="twitter:card" content="summary">
  <meta property="twitter:url" content="https://eskimon.fr/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595">
  <meta property="twitter:title" content="Ajouter des sorties numériques à l'Arduino, le 74HC595">
<meta property="twitter:description" content="14 sorties numériques sur une Arduino Uno c'est peu. Voyons comment avec un composant simple, le 74HC595, nous pouvons multiplier ces dernières.">  <meta property="twitter:site" content="SITENAME">
  <meta property="twitter:creator" content="@eskimon_fr">

  <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
  <meta name="DC.publisher" lang="fr" content="Le blog d'Eskimon" />
  <meta name="DC.creator" content="Eskimon" />
  <meta name="DC.type" content="text" />
  <meta name="DC.title" content="Ajouter des sorties numériques à l'Arduino, le 74HC595" />
  <meta name="DC.abstract" content="Ajouter des sorties numériques à l'Arduino, le 74HC595 – 14 sorties numériques sur une Arduino Uno c'est peu. Voyons comment avec un composant simple, le 74HC595, nous pouvons multiplier ces dernières." />
  <meta name="DC.subject" lang="fr" content="Arduino/I - Annexes – arduino; tuto" />
<meta name="DC.description" lang="fr" content="14 sorties numériques sur une Arduino Uno c'est peu. Voyons comment avec un composant simple, le 74HC595, nous pouvons multiplier ces dernières." />  <meta name="DC.date" content="2013-12-11T22:27:00+01:00" />
  <meta name="DC.format" content="text/html" />
  <meta name="DC.language" content="fr" />
  <meta name="DC.rights" content="CC BY" />

  <script type="application/ld+json">
    [{
        "@context": "http://schema.org",
        "@type": "Article",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://eskimon.fr/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595"
        },
        "headline": ""Ajouter des sorties num\u00e9riques \u00e0 l\u0027Arduino, le 74HC595"",
        "datePublished": "2013-12-11T22:27:00+01:00",
        "image": [
            "https://eskimon.fr/static/images/logo.png"
        ],
        "author": {
            "@type": "Person",
            "name": "Eskimon",
            "image": "https://eskimon.fr/static/images/logo.png"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Eskimon",
            "logo": {
                "@type": "ImageObject",
                "url": "https://eskimon.fr/static/images/logo.png"
            }
        },
        "description": ""14 sorties num\u00e9riques sur une Arduino Uno c\u0027est peu. Voyons comment avec un composant simple, le 74HC595, nous pouvons multiplier ces derni\u00e8res.""
    },
    {
        "@context": "http://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [{
            "@type": "ListItem",
            "position": 1,
            "item": {
                "@id": "https://eskimon.fr/category/arduino",
                "name": ""Arduino""
            }
        }
        , {
            "@type": "ListItem",
            "position": 2,
            "item": {
                "@id": "https://eskimon.fr/subcategory/arduino/i-annexes",
                "name": ""I - Annexes""
            }
        }
        , {
            "@type": "ListItem",
            "position": 3,
            "item": {
                "@id": "https://eskimon.fr/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595",
                "name": ""Ajouter des sorties num\u00e9riques \u00e0 l\u0027Arduino, le 74HC595""
            }
        }]
    }]
    </script>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-2080155902357792",
              enable_page_level_ads: true
         });
    </script>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light bg-secondary-l40 py-0">
    <a class="navbar-brand" href="/">
        <img src="/static/images/logo.png" width="20" height="20" alt="">
        Le blog d'Eskimon
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div></div>
        <div>
            <a class="btn btn-lg text-secondary" href="https://github.com/Eskimon" rel="nofollow" title="Mon profil Github">
                <i class="fab fa-github fa-lg"></i>
            </a>
            <a class="btn btn-lg text-secondary" href="https://twitter.com/Eskimon_fr" rel="nofollow" title="Me suivre sur Twitter">
                <i class="fab fa-twitter fa-lg"></i>
            </a>
            <a class="btn btn-lg text-secondary" href="https://twitch.tv/eskimon" rel="nofollow" title="Me suivre sur Twitch">
                <i class="fab fa-twitch fa-lg"></i>
            </a>
            <a class="btn btn-lg text-secondary" href="https://www.youtube.com/user/Eskimon49/featured" rel="nofollow" title="Les VOD sur Youtube">
                <i class="fab fa-youtube fa-lg"></i>
            </a>
            <a class="btn btn-lg text-secondary" href="https://discord.gg/9SkDWft" rel="nofollow" title="Venez participer sur Discord">
                <i class="fab fa-discord fa-lg"></i>
            </a>
        </div>
        <div class="navbar-nav">
                <a class="nav-item nav-link active" href="/category/arduino">Arduino</a>
                <a class="nav-item nav-link " href="/category/articles">Articles</a>
                <a class="nav-item nav-link " href="/category/web">Web</a>
        </div>
    </div>
</nav>
    <div class="container-fluid es-verticalfill">
<div class="row">
    <!-- Sidebar -->
    <div class="col-lg-2 d-none d-lg-block sticky-top es-scrollable pt-3 px-1 bg-light es-ul-bordered" id="es-side-summary">
        <nav class="px-2" id="es-side-summary-content">
            <!-- Summary will come here -->
        </nav>
        <hr>
        <!-- Self-promo for ebook -->
        <div class="text-center">
            <h4>Ebook Arduino !</h4>
            <a href="/ebook-tutoriel-arduino.html"><img src="/images/couverture-mini.png" alt="couverture ebook" title="couverture de l'ebook"></a>
        </div>
        <hr>
        <!-- Blog side carree -->
        <div id="es-side-summary-bot-annonce" class="text-center">
            <ins class="adsbygoogle"
                 style="display:inline-block;width:250px;height:250px"
                 data-ad-client="ca-pub-2080155902357792"
                 data-ad-slot="6115810402"></ins>
            <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>
    <!-- Main content -->
    <div class="col-md-10 col-lg-8 col-xl-7 offset-md-1 offset-lg-1 offset-xl-1 d-block pt-3" id="es-content">

<div class="row" role="alert">
    <div class="ml-auto mr-auto alert alert-primary text-center">
        <a class="btn btn-lg text-secondary" href="https://twitch.tv/eskimon" rel="nofollow" title="Me suivre sur Twitch"><i class="fab fa-twitch fa-lg"></i></a>
        Rejoignez moi en <a href="htts://twitch.tv/eskimon"> live sur Twitch </a> pour apprendre le tuto Arduino autrement ! (<a href="https://twitter.com/Eskimon_fr/status/1169158978129092618">plus d'infos</a>)
        <a class="btn btn-lg text-secondary" href="https://twitch.tv/eskimon" rel="nofollow" title="Me suivre sur Twitch"><i class="fab fa-twitch fa-lg"></i></a>
    </div>
</div>

        <article>
            <!-- Leaderboard head article -->
            <ins class="adsbygoogle"
                style="display:inline-block;width:970px;height:90px"
                data-ad-client="ca-pub-2080155902357792"
                data-ad-slot="7158680773"></ins>
            <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb bg-white">
                    <li class="breadcrumb-item"><a href="/category/arduino">Arduino</a></li>
                        <li class="breadcrumb-item"><a href="/subcategory/arduino/i-annexes">I - Annexes</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Ajouter des sorties numériques à l'Arduino, le 74HC595</li>
                </ol>
            </nav>
            <header class="es-post-info">
                <h1 class="text-center my-4">Ajouter des sorties numériques à l'Arduino, le 74HC595</h1>
            </header>
            <footer class="es-post-info pb-2 mb-2">
                <div class="row align-items-center">
                    <div class="col-auto mr-auto">
                        <span class="vcard author">
                            <a class="" href="/author/eskimon" rel="author">Eskimon</a>
                        </span>
                        ,
                        <time class="" datetime="2013-12-11T22:27:00+01:00" pubdate>
                            le mer. 11 décembre 2013
                        </time>
                            (<a href="https://eskimon.fr/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595#disqus_thread" data-disqus-identifier="tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595">commentaires</a>)
                    </div>
                    <div class="col-auto">
                        <a class="btn btn-outline-primary btn-sm" href="/tag/arduino" rel="tag">arduino</a>
                        <a class="btn btn-outline-primary btn-sm" href="/tag/tuto" rel="tag">tuto</a>
                    </div>
                </div>
            </footer>
            <button type="button" id="sidebarCollapse" class="float-right btn btn-secondary sticky-top d-block d-lg-none">
                Sommaire
            </button>
            <!-- /.post-info -->
            <div class="entry-content">
                <p>
 Dans ce petit tutoriel, nous allons découvrir comment ajouter des sorties numériques à une carte Arduino. En effet, pour vos projets les plus fous, vous serez certainement amené à avoir besoin d’un grand nombre de sorties. Deux choix s’offrent alors à vous : le premier serait d’opter pour une carte Arduino qui dispose de plus de sorties, telle que la Arduino Mega ; mais dans le cas où vous aurez besoin d’un énorme nombre de sorties, même la Mega ne pourrait suffire. Le deuxième choix c’est donc… de lire ce tuto !
</p>
<p>
 Ce que vous allez découvrir se révélera fort utile, soyez-en certains.
</p>
<p>
 Prenons l’exemple suivant : dans le cas où vous devrez gérer un grand nombre de LED pour réaliser un afficheur comme l’on en trouve parfois dans les vitrines de magasins, vous serez très vite limité par le nombre de sorties de votre Arduino. Surtout si votre afficheur contient plus de 1000 LEDs ! Ce chapitre va alors vous aider dans de pareils cas, car nous allons vous présenter un composant spécialisé dans ce domaine : le
 <strong>
  74HC595
 </strong>
 .
</p>
<h3 id="sommaire">
 <a aria-hidden="true" href="#sommaire">
  <span class="es-autolink-heading">
  </span>
 </a>
 Sommaire
</h3>
<ul>
 <li>
  <p>
   <a href="#présentation-du-74hc595">
    Présentation du 74HC595
   </a>
  </p>
  <ul>
   <li>
    <a href="#principe">
     Principe
    </a>
   </li>
   <li>
    <p>
     <a href="#le-composant">
      Le composant
     </a>
    </p>
    <ul>
     <li>
      <a href="#brochage">
       Brochage
      </a>
     </li>
     <li>
      <a href="#fonctionnement">
       Fonctionnement
      </a>
     </li>
     <li>
      <a href="#montage">
       Montage
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#programmons-pour-utiliser-ce-composant">
    Programmons pour utiliser ce composant
   </a>
  </p>
  <ul>
   <li>
    <p>
     <a href="#envoyer-un-ordre-au-74hc595">
      Envoyer un ordre au 74HC595
     </a>
    </p>
    <ul>
     <li>
      <a href="#le-protocole">
       Le protocole
      </a>
     </li>
     <li>
      <a href="#création-de-la-fonction-denvoi">
       Création de la fonction d’envoi
      </a>
     </li>
     <li>
      <a href="#envoyer-un-char-en-tant-que-donnée-binaire">
       Envoyer un char en tant que donnée binaire
      </a>
     </li>
     <li>
      <a href="#les-masques-en-programmation">
       Les masques en programmation
      </a>
     </li>
     <li>
      <a href="#lévolution-du-masque">
       L’évolution du masque
      </a>
     </li>
     <li>
      <a href="#un-petit-programme-dessai">
       Un petit programme d’essai
      </a>
     </li>
    </ul>
   </li>
   <li>
    <a href="#la-fonction-magique-shiftout">
     La fonction magique, ShiftOut
    </a>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#exercices-des-chenillards">
    Exercices : des chenillards !
   </a>
  </p>
  <ul>
   <li>
    <p>
     <a href="#javance-et-repars-">
      "J’avance et repars !"
     </a>
    </p>
    <ul>
     <li>
      <a href="#consigne">
       Consigne
      </a>
     </li>
     <li>
      <a href="#correction">
       Correction
      </a>
     </li>
    </ul>
   </li>
   <li>
    <p>
     <a href="#javance-et-reviens-">
      "J’avance et reviens !"
     </a>
    </p>
    <ul>
     <li>
      <a href="#consigne-1">
       Consigne
      </a>
     </li>
     <li>
      <a href="#correction-1">
       Correction
      </a>
     </li>
    </ul>
   </li>
   <li>
    <p>
     <a href="#un-dernier-pour-la-route">
      Un dernier pour la route !
     </a>
    </p>
    <ul>
     <li>
      <a href="#consigne-2">
       Consigne
      </a>
     </li>
     <li>
      <a href="#correction-2">
       Correction
      </a>
     </li>
    </ul>
   </li>
   <li>
    <p>
     <a href="#exo-bonus">
      Exo bonus
     </a>
    </p>
    <ul>
     <li>
      <a href="#consigne-3">
       Consigne
      </a>
     </li>
     <li>
      <a href="#correction-3">
       Correction
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#pas-assez-augmentez-encore">
    Pas assez ? Augmentez encore !
   </a>
  </p>
  <ul>
   <li>
    <a href="#branchement">
     Branchement
    </a>
   </li>
   <li>
    <a href="#exemple-dun-affichage-simple">
     Exemple d’un affichage simple
    </a>
   </li>
   <li>
    <a href="#exemple-dun-chenillard">
     Exemple d’un chenillard
    </a>
   </li>
  </ul>
 </li>
</ul>
<h3 id="présentation-du-74hc595">
 <a aria-hidden="true" href="#présentation-du-74hc595">
  <span class="es-autolink-heading">
  </span>
 </a>
 Présentation du 74HC595
</h3>
<h4 id="principe">
 <a aria-hidden="true" href="#principe">
  <span class="es-autolink-heading">
  </span>
 </a>
 Principe
</h4>
<p>
 Comme je viens de l’énoncer, il peut arriver qu’il vous faille utiliser plus de broches qu’il n’en existe sur un micro-contrôleur, votre carte Arduino en l’occurrence (ou plutôt, l’ATMEGA328 présent sur votre carte Arduino). Dans cette idée, des ingénieurs ont développé un composant que l’on pourrait qualifier de "décodeur série -&gt; parallèle". D’une manière assez simple, cela consiste à envoyer un octet de données (8 bits) à ce composant qui va alors décoder l’information reçue et changer l’état de chacune de ses sorties en conséquence. Le composant que nous avons choisi de vous faire utiliser dispose de huit sorties de données pour une seule entrée de données.
</p>
<p>
 Concrètement, cela signifie que lorsque l’on enverra l’octet suivant : 00011000 au décodeur 74HC595, il va changer l’état (HAUT ou BAS) de ses sorties. On verra alors, en supposant qu’il y a une LED de connectée sur chacune de ses sorties, les 2 LED du "milieu" (géographiquement parlant) qui seront dans un état opposé de leurs congénères. Ainsi, en utilisant seulement deux sorties de votre carte Arduino, on peut
 <em>
  virtuellement
 </em>
 en utiliser 8 (voir beaucoup plus, mais nous verrons cela plus tard).
</p>
<h4 id="le-composant">
 <a aria-hidden="true" href="#le-composant">
  <span class="es-autolink-heading">
  </span>
 </a>
 Le composant
</h4>
<p>
 Rentrons maintenant dans les entrailles de ce fameux 595. Pour cela nous utiliserons
 <a href="http://www.datasheetcatalog.org/datasheet/philips/74AHC_AHCT595_1.pdf">
  cette datasheet
 </a>
 tout au long du tuto.
</p>
<h5 id="brochage">
 <a aria-hidden="true" href="#brochage">
  <span class="es-autolink-heading">
  </span>
 </a>
 Brochage
</h5>
<p>
 Lisons ensemble quelques pages. La première nous donne, de par le titre, la fonctionnalité du composant. Elle est importante, car l’on sait à ce moment à quel composant nous allons avoir affaire. La seconde apporte déjà quelques informations utiles outre la fonctionnalité. Au-delà du résumé qu’il est toujours bon de lire, les caractéristiques du composant sont détaillées. On apprend également que ce composant peut fonctionner jusqu’à une fréquence de 170MHz. C’est très très rapide par rapport à notre carte Arduino qui tourne à 16MHz, nous sommes tranquilles de ce côté-là. Continuons… C’est la page 4 qui nous intéresse vraiment ici. On y retrouve le tableau et la figure suivants :
</p>
<figure>
 <img alt="Brochage du 74HC595" src="./images/uploaded/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595/brochage-du-74hc595.png"/>
 <figcaption>
  Brochage du 74HC595
 </figcaption>
</figure>
<p>
 Avec ce dernier, on va pouvoir faire le lien entre le nom de chaque broche et leur rôle. De plus, nous savons où elles sont placées sur le composant. Nous avons donc les sorties et la masse à gauche et les broches de commande à droite (plus la sortie Q0) et l’alimentation. Voyons maintenant comment faire fonctionner tout cela.
</p>
<h5 id="fonctionnement">
 <a aria-hidden="true" href="#fonctionnement">
  <span class="es-autolink-heading">
  </span>
 </a>
 Fonctionnement
</h5>
<p>
 Comme tout composant électronique, il faut commencer par l’alimenter pour le faire fonctionner. Le tableau que nous avons vu juste au-dessus nous indique que les broches d’alimentation sont la broche 16 (VCC) et la broche 8 (masse). Quelques pages plus loin dans la datasheet, page 7 précisément, nous voyons la tension à appliquer pour l’alimenter : entre 2V et 5.5V (et idéalement 5.0V).
</p>
<p>
 Une fois que ce dernier est alimenté, il faut se renseigner sur le rôle des broches pour savoir comment l’utiliser correctement. Pour cela il faut revenir sur le tableau précédent et la table de vérité qui le suit. On découvre donc que les sorties sont les broches de 1 à 7 et la broche 15 (
 <em>
  Qn
 </em>
 ) ; l’entrée des données série, qui va commander les sorties du composant, se trouve sur la broche 14 (
 <em>
  serial data input
 </em>
 ) ; une sortie particulière est disponible sur la broche 9 (
 <em>
  serial data output
 </em>
 , nous y reviendrons à la fin de ce chapitre). Sur la broche 10 on trouve le
 <em>
  Master Reset
 </em>
 , pour mettre à zéro toutes les sorties. Elle est active à l’état BAS. Vous ferez alors attention, dans le cas où vous utiliseriez cette sortie, de la forcer à un état logique HAUT, en la reliant par exemple au +5V ou bien à une broche de l’Arduino que vous ne mettrez à l’état BAS que lorsque vous voudrez mettre toutes les sorties du 74HC595 à l’état bas. Nous, nous mettrons cette sortie sur le +5V.
</p>
<p>
 La broche 13,
 <em>
  output enable input
 </em>
 , est un broche de sélection qui permet d’inhiber les sorties. En clair, cela signifie que lorsque cette broche n’a pas l’état logique requis, les sorties du 74HC595 ne seront pas utilisables. Soit vous choisissez de l’utiliser en la connectant à une sortie de l’Arduino, soit on la force à l’état logique BAS pour utiliser pleinement chaque sortie. Nous, nous la relierons à la masse. Deux dernières broches sont importantes.
</p>
<p>
 La n°11 et la n°12. Ce sont des "horloges". Nous allons expliquer quelles fonctions elles remplissent. Lorsque nous envoyons un ordre au 74HC595, nous envoyons cet ordre sous forme d’états logiques qui se suivent. Par exemple l’ordre 01100011. Cet ordre est composé de 8 états logiques, ou bits, et forme un octet (une suite de 8 bits). Cet ordre va précisément définir l’état de sortie de chacune des sorties du 74HC595. Le problème c’est que ce composant ne peut pas dissocier chaque bit qui arrive…
</p>
<p>
 Prenons le cas des trois zéros qui se suivent dans l’octet que nous envoyons. On envoie le premier 0, la tension sur la ligne est alors de 0V. Le second 0 est envoyé, la tension est toujours de 0V. Enfin le dernier zéro est envoyé, avec la même tension de 0V puis vient un changement de tension à 5V avec l’envoi du 1 qui suit les trois 0. Au final, le composant n’aura vu en entrée qu’un seul 0 puisqu’il n’y a eu aucun changement d’état. De plus, il ne peut pas savoir quelle est la durée des états logiques qu’on lui envoie. S’il le connaissait, ce temps de "vie" des états logiques qu’on lui envoie, il pourrait aisément décoder l’ordre transmis. En effet, il pourrait se dire: "tiens ce bit (état logique) dépasse 10ms, donc un deuxième bit l’accompagne et est aussi au niveau logique 0". Encore 10ms d’écoulées et toujours pas de changement, eh bien c’est un troisième bit au niveau 0 qui vient d’arriver. C’est dans ce cas de figure que l’ordre reçu sera compris dans sa totalité par le composant.
</p>
<p>
 Bon, eh bien c’est là qu’intervient le
 <strong>
  signal d’horloge
 </strong>
 . Ce signal est en fait là dans l’unique but de dire si c’est un nouveau bit qui arrive, puisque le 74HC595 n’est pas capable de le voir tout seul. En fait, c’est très simple, l’horloge est un signal carré fixé à une certaine fréquence. À chaque front montant (quand le signal d’horloge passe du niveau 0 au niveau 1), le 74HC595 saura que sur son entrée, c’est un nouveau bit qui arrive. Il pourra alors facilement voir s’il y a trois 0 qui se suivent. Ce chronogramme vous aidera à mettre du concret dans vos idées :
</p>
<figure>
 <img alt="Signaux" src="./images/uploaded/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595/signaux.png"/>
 <figcaption>
  Signaux
 </figcaption>
</figure>
<p>
 Source : Wikipédia - SDA est le signal de données, l’ordre que l’on envoie ; SCL est le signal d’horloge
</p>
<p>
 Pour câbler cette horloge, il faudra connecter une broche de l’Arduino à la broche numéro 11 du 74HC595. Ce signal travaillera donc en corrélation avec le signal de données relié sur la broche 14 du composant. La seconde horloge pourrait aussi s’appeler "verrou". Elle sert à déterminer si le composant doit mettre à jour les états de ses sorties ou non, en fonction de l’ordre qui est transmis. Lorsque ce signal passe de l’état BAS à l’état HAUT, le composant change les niveaux logiques de ses sorties en fonction des bits de données reçues. En clair, il copie les huit derniers bits transmis sur ses sorties. Ce verrou se présente sur la broche 12.
</p>
<h5 id="montage">
 <a aria-hidden="true" href="#montage">
  <span class="es-autolink-heading">
  </span>
 </a>
 Montage
</h5>
<p>
 Voici un petit montage à titre d’illustration que nous utiliserons par la suite. Je vous laisse faire le câblage sur votre breadboard comme bon vous semble, pendant ce temps je vais aller me siroter un bon petit café. :roll:
</p>
<figure>
 <img alt="Utilisation du 74HC595 - schéma" src="./images/uploaded/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595/utilisation-du-74hc595-schema.png"/>
 <figcaption>
  Utilisation du 74HC595 - schéma
 </figcaption>
</figure>
<figure>
 <img alt="Utilisation du 74HC595 - montage" src="./images/uploaded/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595/utilisation-du-74hc595-montage.png"/>
 <figcaption>
  Utilisation du 74HC595 - montage
 </figcaption>
</figure>
<figure>
 <img alt="Utilisation du 74HC595 et 8 LEDs" src="./images/uploaded/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595/utilisation-du-74hc595-et-8-leds.jpg"/>
 <figcaption>
  Utilisation du 74HC595 et 8 LEDs
 </figcaption>
</figure>
<figure>
 <img alt="Utilisation du 74HC595 et 8 LEDs (zoom)" src="./images/uploaded/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595/utilisation-du-74hc595-et-8-leds-zoom.jpg"/>
 <figcaption>
  Utilisation du 74HC595 et 8 LEDs (zoom)
 </figcaption>
</figure>
<h3 id="programmons-pour-utiliser-ce-composant">
 <a aria-hidden="true" href="#programmons-pour-utiliser-ce-composant">
  <span class="es-autolink-heading">
  </span>
 </a>
 Programmons pour utiliser ce composant
</h3>
<h4 id="envoyer-un-ordre-au-74hc595">
 <a aria-hidden="true" href="#envoyer-un-ordre-au-74hc595">
  <span class="es-autolink-heading">
  </span>
 </a>
 Envoyer un ordre au 74HC595
</h4>
<p>
 Nous allons maintenant voir comment utiliser le composant de manière logicielle, avec Arduino. Pour cela, je vais vous expliquer la façon de faire pour lui envoyer un ordre. Puis, nous créerons nous-mêmes la fonction qui va commander le 74HC595.
</p>
<h5 id="le-protocole">
 <a aria-hidden="true" href="#le-protocole">
  <span class="es-autolink-heading">
  </span>
 </a>
 Le protocole
</h5>
<p>
 Nous le verrons dans le chapitre sur la liaison série plus en détail, le protocole est en fait un moyen qui permet de faire communiquer deux dispositifs. C’est une sorte de convention qui établit des règles de langage.
</p>
<p>
 Par exemple, si deux personnes parlent deux langues différentes, elles vont avoir un mal fou à se comprendre l’une de l’autre. Et bien le protocole sert à imposer un langage qui leur permettra de se comprendre. En l’occurrence, il va s’agir de l’anglais. Bon, cet exemple n’est pas parfait et a ses limites, c’est avant tout pour vous donner une vague idée de ce qu’est un protocole. Comme je vous l’ai dit, on en reparlera dans la partie suivante.
</p>
<p>
 Nous l’avons vu tout à l’heure, pour envoyer un ordre au composant, il faut lui transmettre une série de bits. Autrement dit, il faut envoyer des bits les uns après les autres sur la même broche d’entrée. Cette broche sera nommée "data". Ensuite, rappelez-vous, le composant a besoin de savoir quand lire la donnée, quand est-ce qu’un nouveau bit est arrivé ? C’est donc le rôle de l’horloge, ce que je vous expliquais plus haut. On pourrait s’imaginer qu’elle dit au composant : " Top ! tu peux lire la valeur car c’est un autre bit qui arrive sur ton entrée ! ". Enfin, une troisième broche où l’on va amener l’horloge de verrou sert à dire au composant : " Nous sommes en train de mettre à jour la valeur de tes sorties, alors le temps de la mise à jour, garde chaque sortie à son état actuel ". Quand elle changera d’état, en passant du niveau BAS au niveau HAUT (front montant), cela donnera le "top" au composant pour qu’il puisse mettre à jour ses sorties avec les nouvelles valeurs.
</p>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   Si jamais vous voulez économiser une broche sur votre Arduino, l’horloge de verrou peut être reliée avec l’horloge de données. Dans ce cas l’affichage va "scintiller" lors de la mise à jour car les sorties seront rafraîchies en même temps que la donnée arrive. Ce n’est pas gênant pour faire de l’affichage sur des LEDs mais ça peut l’être beaucoup plus si on a un composant qui réagit en fonction du 595.
  </p>
 </div>
</div>
<h5 id="création-de-la-fonction-denvoi">
 <a aria-hidden="true" href="#création-de-la-fonction-denvoi">
  <span class="es-autolink-heading">
  </span>
 </a>
 Création de la fonction d’envoi
</h5>
<p>
 Passons à la création de la fonction d’envoi des données. C’est avec cette fonction que nous enverrons les ordres au 74HC595, pour lui dire par exemple d’allumer une LED sur sa sortie 4. On va donc faire un peu de programmation, aller zou ! Commençons par nommer judicieusement cette fonction :
 <code>
  envoi_ordre()
 </code>
 . Cette fonction va prendre quatre paramètres. Le premier sera le numéro de la broche de données. Nous l’appellerons "dataPin". Le second sera similaire puisque ce sera le numéro de la broche d’horloge. Nous l’appellerons "clockPin". Le troisième sera le "sens" d’envoi des données, je reviendrai là-dessus ensuite. Enfin le dernier paramètre sera la donnée elle-même, donc un char (sur 8 bits, exactement comme l’ordre qui est à envoyer), que nous appellerons "donnee". Le prototype de la fonction sera alors le suivant :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">envoi_ordre</span><span class="hljs-params">(<span class="hljs-keyword">int</span> dataPin, <span class="hljs-keyword">int</span> clockPin, boolean sens, <span class="hljs-keyword">char</span> donnee)</span>
</span></code></pre>
</div>
<p>
 Le code de la fonction ne sera pas très compliqué. Comme expliqué plus tôt, il suffit de générer une horloge et d’envoyer la bonne donnée pour que tout se passe bien. Le 74HC595 copie le bit envoyé dans sa mémoire lorsque le signal d’horloge passe de 0 à 1. Pour cela, il faut donc débuter le cycle par une horloge à 0. Ensuite, nous allons placer la donnée sur la broche de donnée. Enfin, nous ferons basculer la broche d’horloge à l’état haut pour terminer le cycle. Nous ferons ça huit fois pour pouvoir envoyer les huit bits de l’octet concerné (l’octet d’ordre). Schématiquement le code serait donc le suivant :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">8</span>; i++) <span class="hljs-comment">// on va parcourir chaque bit de l'octet</span>
{
    <span class="hljs-comment">// départ du cycle, on met l'horloge à l'état bas</span>
    digitalWrite(clockPin, LOW);
    <span class="hljs-comment">// on met le bit de donnée courant en place</span>
    digitalWrite(dataPin, le_bit_a_envoyer);
    <span class="hljs-comment">// enfin on remet l'horloge à l'état haut pour</span>
    <span class="hljs-comment">// faire prendre en compte ce dernier et finir le cycle</span>
    digitalWrite(clockPin, HIGH);
}
<span class="hljs-comment">// et on boucle 8 fois pour faire de même sur chaque bit de l'octet d'ordre</span>
</code></pre>
 </div>
 <figcaption>
  Boucle pour envoyer un octet
 </figcaption>
</figure>
<h5 id="envoyer-un-char-en-tant-que-donnée-binaire">
 <a aria-hidden="true" href="#envoyer-un-char-en-tant-que-donnée-binaire">
  <span class="es-autolink-heading">
  </span>
 </a>
 Envoyer un
 <code>
  char
 </code>
 en tant que donnée binaire
</h5>
<p>
 Maintenant que l’on a défini une partie de la fonction
 <code>
  envoi_ordre()
 </code>
 , il va nous rester un léger problème à régler : envoyer une donnée de type
 <code>
  char
 </code>
 en tant que suite de bit (ou donnée binaire). Prenons un exemple : le nombre 231 s’écrit aussi sous la forme 11100111 en base 2 (et oui, c’est le moment de se rappeler les conversions décimales/binaires
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
 ). Seulement, en voulant envoyer ce nombre sur la broche de donnée pour commander le 74HC595, cela ne marchera pas d’écrire :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">digitalWrite(dataPin, <span class="hljs-number">231</span>);
</code></pre>
</div>
<p>
 En faisant de cette façon, la carte Arduino va simplement comprendre qu’il faut mettre un état HAUT (car 231 est différent de 0) sur sa broche de sortie que l’on a nommée
 <code>
  dataPin
 </code>
 . Pour pouvoir donc envoyer ce nombre sous forme binaire, il va falloir ajouter à la fonction que l’on a créée un morceau de code supplémentaire. Ce que nous allons va faire va être une vraie boucherie : on va découper ce nombre en huit tranches et envoyer chaque morceau un par un sur la sortie
 <code>
  dataPin
 </code>
 . :mrgreen: Pour découper ce nombre, ça va pas être de la tarte… euh… je m’égare. :roll: On va utiliser une technique qui se nomme, tenez-vous bien, le
 <strong>
  masquage
 </strong>
 . On va en fait utiliser un masque qui va cacher la véritable valeur du nombre 231. Bon bon, je vous explique. Tout d’abord, on va considérer que le nombre 231 est vu sous sa forme binaire, qui je le rappel est 11100111, par votre carte Arduino. Donc, lorsque l’on va passer en paramètre
 <code>
  donnee
 </code>
 le nombre 231, le programme verra la suite de 1 et de 0 : 11100111. Jusque-là, rien de bien sorcier. Voilà donc notre suite de 1 et de 0 que l’on va devoir découper. Alors, il n’existe pas de fonction toute prête spécialement conçue pour découper un nombre binaire. Non, ça va être à nous de faire cela. Et c’est pourquoi je vous parlais du masquage. Cette technique ne porte pas son nom par hasard, en effet, nous allons réellement utiliser un
 <strong>
  masque
 </strong>
 . Quelques précisions s’imposent, je le sens bien. Reprenons notre suite binaire :
</p>
<figure>
 <img alt="Une suite binaire" src="./images/uploaded/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595/une-suite-binaire.jpg"/>
 <figcaption>
  Une suite binaire
 </figcaption>
</figure>
<p>
 Notre objectif étant d’envoyer chaque bit un par un, on va faire croire à l’Arduino que cette suite n’est composée que d’un seul bit. En clair, on va cacher les 7 autres bits en utilisant un masque :
</p>
<figure>
 <img alt="La suite masquée" src="./images/uploaded/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595/la-suite-masquee.jpg"/>
 <figcaption>
  La suite masquée
 </figcaption>
</figure>
<p>
 Ce qui, au final, donnera :
</p>
<figure>
 <img alt="Résultat" src="./images/uploaded/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595/resultat.jpg"/>
 <figcaption>
  Résultat
 </figcaption>
</figure>
<p>
 L’Arduino ne verra donc qu’un seul bit.
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Et les autres, il les voit pas, comment on peut envoyer les 8 bits alors ?
   <img alt="o_O" class="smiley" src="./static/smileys/blink.gif"/>
  </p>
 </div>
</div>
<p>
 Bien sûr, les autres, l’Arduino ne les voit pas. C’est pourquoi l’on va faire évoluer le masque et révéler chaque bit un par un. En faisant cela huit fois, on aura envoyé les 8 bits à la suite :
</p>
<figure>
 <img alt="Envoi des 8 bits" src="./images/uploaded/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595/envoi-des-8-bits.jpg"/>
 <figcaption>
  Envoi des 8 bits
 </figcaption>
</figure>
<p>
 On peut aussi faire évoluer le masque dans le sens opposé :
</p>
<figure>
 <img alt="Gestion du masque" src="./images/uploaded/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595/gestion-du-masque.jpg"/>
 <figcaption>
  Gestion du masque
 </figcaption>
</figure>
<p>
 L’étape qui suit est donc d’identifier le bit à envoyer en premier. C’est là que rentre en jeu le paramètre sens. On a le choix d’envoyer soit le bit de poids fort (on l’appelle
 <strong>
  MSB
 </strong>
 , Most Significant Bit) en premier et finir par le bit de poids faible (Least Significant Bit,
 <strong>
  LSB
 </strong>
 ) ; soit dans le sens opposé, du LSB vers le MSB. On parle alors d’envoi MSB First (pour "bit de poids fort en premier") ou LSB First. À présent, voyons comment appliquer la technique de masquage que je viens de vous présenter
</p>
<h5 id="les-masques-en-programmation">
 <a aria-hidden="true" href="#les-masques-en-programmation">
  <span class="es-autolink-heading">
  </span>
 </a>
 Les masques en programmation
</h5>
<p>
 Maintenant que vous connaissez cela, nous allons pouvoir voir comment isoler chacun des bits pour les envoyer un par un. En programmation, il est évident que l’on ne peut pas mettre un masque papier sur les bits pour les cacher.
 <img alt=":P" class="smiley" src="./static/smileys/langue.png"/>
 Il existe donc un moyen de les cacher. Cela va faire appel à la
 <strong>
  logique binaire
 </strong>
 . Nous n’entrerons pas dans le détail, mais sachez que nous allons employer des
 <strong>
  opérateurs logiques
 </strong>
 . Il en existe plusieurs, dont deux très utilisés, même dans la vie courante, l’opérateur
 <strong>
  ET
 </strong>
 et
 <strong>
  OU
 </strong>
 . Commençons par l’opérateur logique ET (je vous laisse regarder le OU tout seul, nous n’en aurons pas besoin ici). Il s’utilise avec le symbole
 <strong>
  &amp;
 </strong>
 que vous trouverez sous la touche 1 au-dessus de la lettre "a" sur un clavier azerty. Pour envoyer le premier bit de notre donnée, nous allons effectuer le masquage avec cet opérateur logique dont la table de vérité se trouve être la suivante :
</p>
<div class="text-center">
 <figure>
  <div class="table-wrapper">
   <table class=" table table-bordered table-striped">
    <thead>
     <tr>
      <th>
       Bit 2
      </th>
      <th>
       Bit 1
      </th>
      <th>
       Résultat
      </th>
     </tr>
    </thead>
    <tbody>
     <tr>
      <td>
       0
      </td>
      <td>
       0
      </td>
      <td>
       0
      </td>
     </tr>
     <tr>
      <td>
       0
      </td>
      <td>
       1
      </td>
      <td>
       0
      </td>
     </tr>
     <tr>
      <td>
       1
      </td>
      <td>
       0
      </td>
      <td>
       0
      </td>
     </tr>
     <tr>
      <td>
       1
      </td>
      <td>
       1
      </td>
      <td>
       1
      </td>
     </tr>
    </tbody>
   </table>
  </div>
  <figcaption>
   Table de vérité du ET
  </figcaption>
 </figure>
</div>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Je ne comprends pas trop où tu veux en venir ? :roll:
  </p>
 </div>
</div>
<p>
 Je vais vous expliquer. Pour faire le masquage, on va faire une opération avec ce fameux ET logique. Il s’agit de la même chose que si l’on additionnait deux nombres ensemble, ou si on les multipliait. Dans notre cas l’opération est "un peu bizarre". Disons que c’est une opération évoluée. Cette opération va utiliser deux nombres : le premier on le connaît bien, il s’agit de la suite logique 11100111, quant au second, il s’agira du masque. Pour l’instant, vous ne connaissez pas la valeur du masque, qui sera lui aussi sous forme binaire. Pour définir cette valeur, on va utiliser la table de vérité précédente. Afin que vous ne vous perdiez pas dans mes explications, on va prendre pour objectif d’envoyer le bit de poids faible de notre nombre 11100111 (celui tout à droite). Le code qui suit est un pseudo-code, mis sous forme d’une opération mathématique telle que l’on en ferait à l’école :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">  <span class="hljs-number">11100111</span> (donnée à transmettre)
&amp; <span class="hljs-number">00000001</span> (on veut envoyer uniquement le bit de poids faible)
= --------
  <span class="hljs-number">00000001</span> (donnée à transmettre au final) -&gt; soit <span class="hljs-number">1</span>
</code></pre>
</div>
<p>
 Pour comprendre ce qui vient de se passer, il faut se référer à la table de vérité de l’opérateur ET : on sait que lorsque l’on fait 1 et 0 le résultat est 0. Donc, pour cacher tous les bits du nombre à masquer, il n’y a qu’à mettre que des 0 dans le masque. Là, l’Arduino ne verra que le bit 0 puisque le masque aura caché au complet le nombre du départ. On sait aussi que 1 ET 1 donne 1. Donc, lorsque l’on voudra montrer un bit à l’Arduino, on va mettre un 1 dans le masque, à l’emplacement du bit qui doit être montré. Pour monter ensuite le bit supérieur au bit de poids faible, on procède de la même manière :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">  <span class="hljs-number">11100111</span> (donnée à transmettre)
&amp; <span class="hljs-number">00000010</span> (on veut envoyer uniquement le deuxième bit)
= --------
  <span class="hljs-number">00000010</span> (donnée à transmettre au final) -&gt; soit <span class="hljs-number">1</span>
</code></pre>
</div>
<p>
 Pour le quatrième bit en partant de la droite :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">  <span class="hljs-number">11100111</span> (donnée à transmettre)
&amp; <span class="hljs-number">00001000</span> (on veut envoyer uniquement le quatrième bit)
= --------
  <span class="hljs-number">00000000</span> (donnée à transmettre au final) -&gt; soit <span class="hljs-number">0</span>
</code></pre>
</div>
<p>
 Dans le cas où vous voudriez montrer deux bits à l’Arduino (ce qui n’a aucun intérêt dans notre cas, je fais ça juste pour vous montrer) :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">  <span class="hljs-number">11100111</span> (donnée à transmettre)
&amp; <span class="hljs-number">01000100</span> (on veut envoyer le septième et troisième bit)
= --------
  <span class="hljs-number">01000100</span> (donnée à transmettre au final) -&gt; soit <span class="hljs-number">68</span> en base décimale
</code></pre>
</div>
<h5 id="lévolution-du-masque">
 <a aria-hidden="true" href="#lévolution-du-masque">
  <span class="es-autolink-heading">
  </span>
 </a>
 L’évolution du masque
</h5>
<p>
 Ce titre pourrait être apparenté à celui d’un film d’horreur, mais n’indique finalement que nous allons faire évoluer le masque automatiquement à chaque fois que l’on aura envoyé un bit. Cette fois, cela va être un peu plus simple, car nous n’avons qu’à rajouter un opérateur spécialisé dans le décalage. Si l’on veut déplacer le 1 du masque (qui permet de montrer un bit à l’Arduino) de la droite vers la gauche (pour le LSBFirst) ou dans l’autre sens (pour le MSBFirst), nous avons la possibilité d’utiliser l’opérateur
 <strong>
  «
 </strong>
 pour décaler vers la gauche ou
 <strong>
  »
 </strong>
 pour décaler vers la droite. Par exemple :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">  <span class="hljs-number">00000001</span> (masque initial)
  &lt;&lt; <span class="hljs-number">3</span>     (on décale de trois bits)
= --------
  <span class="hljs-number">00001000</span> (masque final, décalé)
</code></pre>
</div>
<p>
 Et dans le sens opposé :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">  <span class="hljs-number">10000000</span> (masque initial)
  &gt;&gt; <span class="hljs-number">3</span>     (on décale de trois bits)
= --------
  <span class="hljs-number">00010000</span> (masque final, décalé)
</code></pre>
</div>
<p>
 Avouez que ce n’est pas très compliqué maintenant que vous maîtrisez un peu les masques.
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
 On va donc pouvoir isoler un par un chacun des bits pour les envoyer au 74HC595. Comme le sens dépend d’un paramètre de la fonction, nous rajoutons un test pour décaler soit vers la droite, soit vers la gauche. Voici la fonction que nous obtenons à la fin :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">envoi_ordre</span><span class="hljs-params">(<span class="hljs-keyword">int</span> dataPin, <span class="hljs-keyword">int</span> clockPin, boolean sens, <span class="hljs-keyword">char</span> donnee)</span>
</span>{
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">8</span>; i++) <span class="hljs-comment">// on va parcourir chaque bit de l'octet</span>
    {
        <span class="hljs-comment">// on met l'horloge à l'état bas</span>
        digitalWrite(clockPin, LOW);
        <span class="hljs-comment">// on met le bit de donnée courante en place</span>
        <span class="hljs-keyword">if</span>(sens)
        {
            <span class="hljs-comment">// envoie la donnée en allant de droite à gauche,</span>
            <span class="hljs-comment">// en partant d'un masque de type "00000001"</span>
            digitalWrite(dataPin, donnee &amp; <span class="hljs-number">0x01</span> &lt;&lt; i);
        }
        <span class="hljs-keyword">else</span>
        {
            <span class="hljs-comment">// envoie la donnée en allant de droite à gauche,</span>
            <span class="hljs-comment">// en partant d'un masque de type "10000000"</span>
            digitalWrite(dataPin, donnee &amp; <span class="hljs-number">0x80</span> &gt;&gt; i);
        }
        <span class="hljs-comment">// enfin on remet l'horloge à l'état haut pour</span>
        <span class="hljs-comment">// faire prendre en compte cette dernière</span>
        digitalWrite(clockPin, HIGH);
    }
}
</code></pre>
 </div>
 <figcaption>
  La fonction
  <code>
   envoi_ordre
  </code>
 </figcaption>
</figure>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Oula ! Hé ! Stop ! C’est quoi ce 0x01 et ce 0x80 ? Qu’est-ce que ça vient faire là, c’est pas censé être le masque que l’on doit voir ?
  </p>
 </div>
</div>
<p>
 Si, c’est bien cela. Il s’agit du masque… écrit sous sa forme hexadécimale. Il aurait été bien entendu possible d’écrire :
 <code>
  0b00000001
 </code>
 à la place de
 <code>
  0x01
 </code>
 , ou
 <code>
  0b10000000
 </code>
 à la place de
 <code>
  0x80
 </code>
 . On a simplement opté pour la base hexadécimale qui est plus facile à manipuler.
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Cette technique de masquage peut sembler difficile au premier abord, mais elle ne l’est pas réellement une fois que l’on a compris le principe. Il est essentiel de comprendre comment elle fonctionne pour aller loin dans la programmation de micro-contrôleur (pour paramétrer les registres par exemple), et vous en aurez besoin pour les exercices du chapitre suivant. Pour plus d’informations, un bon tuto plus complet mais rapide à lire est
   <a href="http://fr.openclassrooms.com/informatique/cours/introduction-aux-operateurs-de-bits">
    rédigé ici
   </a>
   … en PHP, mais c’est pareil !
  </p>
 </div>
</div>
<h5 id="un-petit-programme-dessai">
 <a aria-hidden="true" href="#un-petit-programme-dessai">
  <span class="es-autolink-heading">
  </span>
 </a>
 Un petit programme d’essai
</h5>
<p>
 Je vous propose maintenant d’essayer notre belle fonction. Pour cela, quelques détails sont à préciser/rajouter. Pour commencer, il nous faut déclarer les broches utilisées. Il y en a trois : verrou, horloge et data. Pour ma part elles sont branchées respectivement sur les broches 11, 12 et 10. Il faudra donc aussi les déclarer en sortie dans le setup(). Si vous faites de même, vous devriez obtenir le code suivant :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-comment">// Broche connectée au ST_CP du 74HC595</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> verrou = <span class="hljs-number">11</span>;
<span class="hljs-comment">// Broche connectée au SH_CP du 74HC595</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> horloge = <span class="hljs-number">12</span>;
<span class="hljs-comment">// Broche connectée au DS du 74HC595</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> data = <span class="hljs-number">10</span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// On met les broches en sortie</span>
    pinMode(verrou, OUTPUT);
    pinMode(horloge, OUTPUT);
    pinMode(data, OUTPUT);
}
</code></pre>
 </div>
 <figcaption>
  Code de setup de nos expériences
 </figcaption>
</figure>
<p>
 Ensuite, nous allons nous amuser à afficher un nombre allant de 0 à 255 en binaire. Ce nombre peut tenir sur un octet, ça tombe bien car nous allons justement transmettre un octet ! Pour cela, nous allons utiliser une boucle for() allant de 0 à 255 et qui appellera notre fonction. Avant cela, je tiens à rappeler qu’il faut aussi mettre en place le verrou en encadrant l’appel de notre fonction. Rappelez-vous, si nous ne le faisons pas, l’affichage risque de scintiller.
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-comment">// On active le verrou le temps de transférer les données</span>
digitalWrite(verrou, LOW);
<span class="hljs-comment">// on envoi toutes les données grâce à notre belle fonction (octet inversé avec l'opérateur de complément à 1 '~' pour piloter les LED à l'état bas)</span>
envoi_ordre(data, horloge, <span class="hljs-number">1</span>, ~j);
<span class="hljs-comment">// et enfin on relâche le verrou</span>
digitalWrite(verrou, HIGH);
</code></pre>
 </div>
 <figcaption>
  Mécanisme de verrou
 </figcaption>
</figure>
<p>
 Et voici le code complet que vous aurez sûrement deviné :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-comment">// Broche connectée au ST_CP du 74HC595</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> verrou = <span class="hljs-number">11</span>;
<span class="hljs-comment">// Broche connectée au SH_CP du 74HC595</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> horloge = <span class="hljs-number">12</span>;
<span class="hljs-comment">// Broche connectée au DS du 74HC595</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> data = <span class="hljs-number">10</span>;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// On met les broches en sortie</span>
    pinMode(verrou, OUTPUT);
    pinMode(horloge, OUTPUT);
    pinMode(data, OUTPUT);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// on affiche les nombres de 0 à 255 en binaire</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">char</span> i = <span class="hljs-number">0</span>; i&lt;<span class="hljs-number">256</span>; i++)
    {
        <span class="hljs-comment">// On active le verrou le temps de transférer les données</span>
        digitalWrite(verrou, LOW);
        <span class="hljs-comment">// on envoi toutes les données grâce à notre belle fonction</span>
        envoi_ordre(data, horloge, <span class="hljs-number">1</span>, ~i);
        <span class="hljs-comment">// et enfin on relâche le verrou</span>
        digitalWrite(verrou, HIGH);
        <span class="hljs-comment">// une petite pause pour constater l'affichage</span>
        delay(<span class="hljs-number">1000</span>);
    }
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">envoi_ordre</span><span class="hljs-params">(<span class="hljs-keyword">int</span> dataPin, <span class="hljs-keyword">int</span> clockPin, boolean sens, <span class="hljs-keyword">char</span> donnee)</span>
</span>{
    <span class="hljs-comment">// on va parcourir chaque bit de l'octet</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">8</span>; i++)
    {
        <span class="hljs-comment">// on met l'horloge à l'état bas</span>
        digitalWrite(clockPin, LOW);
        <span class="hljs-comment">// on met le bit de donnée courante en place</span>
        <span class="hljs-keyword">if</span>(sens)
        {
            digitalWrite(dataPin, donnee &amp; <span class="hljs-number">0x01</span> &lt;&lt; i);
        }
        <span class="hljs-keyword">else</span>
        {
            digitalWrite(dataPin, donnee &amp; <span class="hljs-number">0x80</span> &gt;&gt; i);
        }
        <span class="hljs-comment">// enfin on remet l'horloge à l'état haut pour</span>
        <span class="hljs-comment">// faire prendre en compte cette dernière</span>
        digitalWrite(clockPin, HIGH);
    }
}
</code></pre>
 </div>
 <figcaption>
  Code complet d’envoi d’un octet
 </figcaption>
</figure>
<p>
 Et voilà le travail ! :
</p>
<div class="text-center">
 <div class="video-container">
  <div class="video-wrapper">
   <iframe allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/if2xNvj7DYo" width="560">
   </iframe>
  </div>
 </div>
</div>
<p>
 Et une petite démonstration avec le simulateur interactif :
</p>
<div class="video-container">
 <div class="video-wrapper">
  <iframe allowfullscreen="" frameborder="0" height="800" src="https://www.tinkercad.com/embed/5JnMmA7XnqH" width="100%">
  </iframe>
 </div>
</div>
<h4 id="la-fonction-magique-shiftout">
 <a aria-hidden="true" href="#la-fonction-magique-shiftout">
  <span class="es-autolink-heading">
  </span>
 </a>
 La fonction magique, ShiftOut
</h4>
<p>
 Vous êtes content ? vous avez une belle fonction qui marche bien et fait le boulot proprement ? Alors laissez-moi vous présenter une nouvelle fonction qui s’appelle
 <code>
  shiftOut()
 </code>
 . Quel est son rôle ? Faire exactement la même chose que la fonction dont l’on vient juste de finir la création.
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   *#@"e !! :mad:
  </p>
 </div>
</div>
<p>
 Alors oui je sais, c’est pas sympa de ma part de vous avoir fait travailler, mais admettez que c’était un très bon exercice de développement non ? À présent vous comprenez comment agit cette fonction et vous serez mieux capable de créer votre propre système que si je vous avais donné la fonction au début en disant : "voilà, c’est celle-là, on l’utilise comme ça, ça marche, c’est beau… mais vous avez rien compris". Comme je vous le disais précédemment, cette fonction sert à faire ce que l’on vient de créer, mais elle est déjà intégrée à l’environnement Arduino (donc a été testée par de nombreux développeurs, ne laissant pas beaucoup de place pour les bugs !). Cette fonction prend quatre paramètres :
</p>
<ul>
 <li>
  La broche de donnée
 </li>
 <li>
  La broche d’horloge
 </li>
 <li>
  Le sens d’envoi des données (utiliser avec deux valeurs symboliques, MSBFIRST ou LSBFIRST)
 </li>
 <li>
  L’octet à transmettre
 </li>
</ul>
<p>
 Son utilisation doit maintenant vous paraître assez triviale. Comme nous l’avons vu plutôt, il suffit de bloquer le verrou, envoyer la donnée avec la fonction puis relâcher le verrou pour constater la mise à jour des données. Voici un exemple de loop avec cette fonction :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// on affiche les nombres de 0 à 255 en binaire</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)
    {
        <span class="hljs-comment">// On active le verrou le temps de transférer les données</span>
        digitalWrite(verrou, LOW);
        <span class="hljs-comment">// on envoi toutes les données grâce à shiftOut</span>
        <span class="hljs-comment">// (octet inversée avec '~' pour piloter les LED à l'état bas)</span>
        shiftOut(data, horloge, LSBFIRST, ~i);
        <span class="hljs-comment">// et enfin on relache le verrou</span>
        digitalWrite(verrou, HIGH);
        <span class="hljs-comment">// une petite pause pour constater l'affichage</span>
        delay(<span class="hljs-number">1000</span>);
    }
}
</code></pre>
 </div>
 <figcaption>
  Utilisation de la fonction
  <code>
   shiftOut
  </code>
 </figcaption>
</figure>
<h3 id="exercices-des-chenillards">
 <a aria-hidden="true" href="#exercices-des-chenillards">
  <span class="es-autolink-heading">
  </span>
 </a>
 Exercices : des chenillards !
</h3>
<p>
 Je vous propose maintenant trois exercices pour jouer un peu avec ce nouveau composant et tester votre habileté au code. Le but du jeu est d’arriver à reproduire l’effet proposé sur chaque vidéo. Le but second est de le faire intelligemment… Autrement dit, tous les petits malins qui se proposeraient de faire un "tableau de motif" contenant les valeurs "affichages binaires" successives devront faire autrement.
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
 Amusez-vous bien !
</p>
<p>
 PS : Les corrections seront juste composées du code de la loop avec des commentaires. Le schéma reste le même ainsi que les noms de broches utilisés précédemment.
</p>
<p>
 <sub>
  PPS : La bande son des vidéos est juste là pour cacher le bruit ambiant… je n’y ai pas pensé quand je faisais les vidéos et Youtube ne permet pas de supprimer la bande audio…
 </sub>
</p>
<h4 id="javance-et-repars-">
 <a aria-hidden="true" href="#javance-et-repars-">
  <span class="es-autolink-heading">
  </span>
 </a>
 "J’avance et repars !"
</h4>
<h5 id="consigne">
 <a aria-hidden="true" href="#consigne">
  <span class="es-autolink-heading">
  </span>
 </a>
 Consigne
</h5>
<p>
 Pour ce premier exercice, histoire de se mettre en jambe, nous allons faire une animation simple. Pour cela, il suffit de faire un chenillard très simple, consistant en une LED qui "avance" du début à la fin de la ligne. Arrivée à la fin elle repart au début. Si ce n’est pas clair, regardez la vidéo ci-dessous ! (Éventuellement vous pouvez ajouter un bouton pour inverser le sens de l’animation).
</p>
<div class="text-center">
 <div class="video-container">
  <div class="video-wrapper">
   <iframe allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/uMiJnwISEFA" width="560">
   </iframe>
  </div>
 </div>
</div>
<h5 id="correction">
 <a aria-hidden="true" href="#correction">
  <span class="es-autolink-heading">
  </span>
 </a>
 Correction
</h5>
<div class="custom-block custom-block-spoiler">
 <div class="custom-block-body">
  <figure>
   <div class="hljs-code-div">
    <div class="hljs-line-numbers">
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
    </div>
    <pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++)
    {
        <span class="hljs-comment">// On active le verrou le temps de transférer les données</span>
        digitalWrite(verrou, LOW);
        <span class="hljs-comment">// on envoie la donnée</span>
        <span class="hljs-comment">// ici, c'est assez simple.</span>
        <span class="hljs-comment">// On va décaler l'octet 00000001 i fois puis l'envoyer</span>
        shiftOut(data, horloge, LSBFIRST, ~(<span class="hljs-number">0x01</span> &lt;&lt; i));
        <span class="hljs-comment">// et enfin on relache le verrou</span>
        digitalWrite(verrou, HIGH);
        <span class="hljs-comment">// une petite pause pour constater l'affichage</span>
        delay(<span class="hljs-number">250</span>);
    }
}
</code></pre>
   </div>
   <figcaption>
    Exercice chenillard "J’avance et repars !"
   </figcaption>
  </figure>
 </div>
</div>
<h4 id="javance-et-reviens-">
 <a aria-hidden="true" href="#javance-et-reviens-">
  <span class="es-autolink-heading">
  </span>
 </a>
 "J’avance et reviens !"
</h4>
<h5 id="consigne-1">
 <a aria-hidden="true" href="#consigne-1">
  <span class="es-autolink-heading">
  </span>
 </a>
 Consigne
</h5>
<p>
 Cette seconde animation ne sera pas trop compliquée non plus. La seule différence avec la première est que lorsque la "lumière" atteint la fin de la ligne, elle repart en arrière et ainsi de suite. Là encore si ce n’est pas clair, voici une vidéo :
</p>
<div class="text-center">
 <div class="video-container">
  <div class="video-wrapper">
   <iframe allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/kYtlfWnNC34" width="560">
   </iframe>
  </div>
 </div>
</div>
<h5 id="correction-1">
 <a aria-hidden="true" href="#correction-1">
  <span class="es-autolink-heading">
  </span>
 </a>
 Correction
</h5>
<p>
 Dans cet exercice, le secret est d’utiliser de manière intelligente le paramètre LSBFIRST ou MSBFIRST pour pouvoir facilement inverser le sens de l’animation sans écrire deux fois la boucle for.
</p>
<div class="custom-block custom-block-spoiler">
 <div class="custom-block-body">
  <figure>
   <div class="hljs-code-div">
    <div class="hljs-line-numbers">
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
    </div>
    <pre><code class="hljs language-cpp"><span class="hljs-keyword">char</span> sens = MSBFIRST;
<span class="hljs-comment">// on commence à aller de droite vers gauche</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// on ne fait la boucle que 7 fois pour</span>
    <span class="hljs-comment">// ne pas se répéter au début et à la fin</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">7</span>; i++)
    {
        <span class="hljs-comment">// On active le verrou le temps de transférer les données</span>
        digitalWrite(verrou, LOW);
        <span class="hljs-comment">// on envoie la donnée</span>
        <span class="hljs-comment">// On va décaler l'octet 00000001 i fois puis l'envoyer</span>
        shiftOut(data, horloge, sens, ~(<span class="hljs-number">0x01</span> &lt;&lt; i));
        <span class="hljs-comment">// et enfin on relache le verrou</span>
        digitalWrite(verrou, HIGH);
        <span class="hljs-comment">// une petite pause pour constater l'affichage</span>
        delay(<span class="hljs-number">250</span>);
    }
    <span class="hljs-comment">// on inverse le sens d'affichage pour la prochaine fois</span>
    sens = !sens;
}
</code></pre>
   </div>
   <figcaption>
    Exercice chenillard "J’avance et reviens !"
   </figcaption>
  </figure>
 </div>
</div>
<h4 id="un-dernier-pour-la-route">
 <a aria-hidden="true" href="#un-dernier-pour-la-route">
  <span class="es-autolink-heading">
  </span>
 </a>
 Un dernier pour la route !
</h4>
<h5 id="consigne-2">
 <a aria-hidden="true" href="#consigne-2">
  <span class="es-autolink-heading">
  </span>
 </a>
 Consigne
</h5>
<p>
 Pour cette dernière animation, il vous faudra un peu d’imagination. Imaginez le chenillard numéro 1 allant dans les deux sens en même temps… C’est bon ? si non alors voici la vidéo :
</p>
<div class="text-center">
 <div class="video-container">
  <div class="video-wrapper">
   <iframe allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/fjev82HNJaQ" width="560">
   </iframe>
  </div>
 </div>
</div>
<h5 id="correction-2">
 <a aria-hidden="true" href="#correction-2">
  <span class="es-autolink-heading">
  </span>
 </a>
 Correction
</h5>
<div class="custom-block custom-block-spoiler">
 <div class="custom-block-body">
  <figure>
   <div class="hljs-code-div">
    <div class="hljs-line-numbers">
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
    </div>
    <pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">char</span> donnee = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++)
  {
    <span class="hljs-comment">// on saute la boucle si i vaut 4</span>
    <span class="hljs-comment">// (pour une histoire de fluidité de l'animation, testez sans et comparez)</span>
    <span class="hljs-keyword">if</span>(i == <span class="hljs-number">4</span>)
      <span class="hljs-keyword">continue</span>;
    <span class="hljs-comment">// calcule la donnée à envoyer</span>
    donnee = <span class="hljs-number">0</span>;
    <span class="hljs-comment">//  on calcule l'image du balayage dans un sens</span>
    donnee = donnee | (<span class="hljs-number">0x01</span> &lt;&lt; i);
    <span class="hljs-comment">// et on ajoute aussi l'image du balayage dans l'autre sens</span>
    donnee = donnee | (<span class="hljs-number">0x80</span> &gt;&gt; i);
    <span class="hljs-comment">// On active le verrou le temps de transférer les données</span>
    digitalWrite(verrou, LOW);
    <span class="hljs-comment">// on envoie la donnée</span>
    shiftOut(data, horloge, LSBFIRST, ~donnee);
    <span class="hljs-comment">// et enfin on relache le verrou</span>
    digitalWrite(verrou, HIGH);
    <span class="hljs-comment">// une petite pause pour constater l'affichage</span>
    delay(<span class="hljs-number">250</span>);
  }
}
</code></pre>
   </div>
   <figcaption>
    Exercice chenillard "Un dernier pour la route !"
   </figcaption>
  </figure>
 </div>
</div>
<h4 id="exo-bonus">
 <a aria-hidden="true" href="#exo-bonus">
  <span class="es-autolink-heading">
  </span>
 </a>
 Exo bonus
</h4>
<h5 id="consigne-3">
 <a aria-hidden="true" href="#consigne-3">
  <span class="es-autolink-heading">
  </span>
 </a>
 Consigne
</h5>
<p>
 Ici le but du jeu sera de donner un effet de "chargement / déchargement" en alternance… Comme d’habitude, voici la vidéo pour mieux comprendre…
</p>
<div class="text-center">
 <div class="video-container">
  <div class="video-wrapper">
   <iframe allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/1h0kh57GVps" width="560">
   </iframe>
  </div>
 </div>
</div>
<h5 id="correction-3">
 <a aria-hidden="true" href="#correction-3">
  <span class="es-autolink-heading">
  </span>
 </a>
 Correction
</h5>
<p>
 Dans cet exercice, tout repose sur l’utilisation du MSBFIRST ou LSBFIRST ainsi que du complément appliqué sur la donnée. Ce dernier permet d’activer ou non les LEDs et le premier atout permet d’inverser l’effet.
</p>
<div class="custom-block custom-block-spoiler">
 <div class="custom-block-body">
  <figure>
   <div class="hljs-code-div">
    <div class="hljs-line-numbers">
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
    </div>
    <pre><code class="hljs language-cpp"><span class="hljs-comment">// on commence à aller de droite vers gauche</span>
<span class="hljs-keyword">char</span> extinction = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// on démarre à 0 ou 1 selon...</span>
    <span class="hljs-keyword">char</span> donnee = extinction;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++)
    {
        <span class="hljs-comment">// On active le verrou le temps de transférer les données</span>
        digitalWrite(verrou, LOW);
        <span class="hljs-comment">// si on est en train d'éteindre</span>
        <span class="hljs-keyword">if</span>(extinction)
            <span class="hljs-comment">// on envoie la donnée inversé</span>
            shiftOut(data, horloge, MSBFIRST, ~donnee);
        <span class="hljs-keyword">else</span> <span class="hljs-comment">// sinon</span>
            <span class="hljs-comment">// on envoie la donnée normale</span>
            shiftOut(data, horloge, LSBFIRST, donnee);

        <span class="hljs-comment">// et enfin on relache le verrou</span>
        digitalWrite(verrou, HIGH);
        <span class="hljs-comment">// une petite pause pour constater l'affichage</span>
        delay(<span class="hljs-number">250</span>);
        <span class="hljs-comment">// et on met à jour la donnée en cumulant les décalages</span>
        donnee = donnee | (<span class="hljs-number">0x01</span> &lt;&lt; i);
    }
    <span class="hljs-comment">// permet d'inverser "MSBFIRST  LSBFIRST" comme dans l'exercice 2</span>
    extinction = !extinction;
}
</code></pre>
   </div>
   <figcaption>
    Exercice "effet de chargement / déchargement"
   </figcaption>
  </figure>
 </div>
</div>
<h3 id="pas-assez-augmentez-encore">
 <a aria-hidden="true" href="#pas-assez-augmentez-encore">
  <span class="es-autolink-heading">
  </span>
 </a>
 Pas assez ? Augmentez encore !
</h3>
<p>
 Si jamais 8 nouvelles sorties ne vous suffisent pas (bien que cela n’en face que 5 au total puisque trois sont prises pour communiquer avec le composant), les ingénieurs ont déjà tout prévu. Ainsi il est possible de mettre en cascade plusieurs 74HC595 ! Pour cela, le 595 dispose d’une broche appelée "débordement". Lorsque vous envoyez un seul octet au 74HC595, rien ne se passe sur cette broche. Cependant, si vous envoyez plus d’un octet, les huit derniers bits seront conservés par le composant, tandis que les autres vont être "éjectés" vers cette fameuse sortie de débordement (numéro 9). Le premier bit envoyé ira alors vers le 74HC595 le plus loin dans la chaîne. Souvenez-vous, elle s’appelle "serial data output" et j’avais dit qu’on reviendrait dessus. D’une manière très simple, les bits éjectés vont servir aux éventuels 74HC595 qui seront mis en aval de celui-ci.
</p>
<h4 id="branchement">
 <a aria-hidden="true" href="#branchement">
  <span class="es-autolink-heading">
  </span>
 </a>
 Branchement
</h4>
<p>
 Il suffit dons de mettre deux 595 bout-à-bout en reliant la broche de débordement du premier sur la broche de donnée du second. Ainsi, les bits "en trop" du premier arriveront sur le second. Afin que le second fonctionne, il faut aussi également relier les mêmes broches pour l’horloge et le verrou (reliées en parallèle entre les deux).
</p>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   Les images proviennent d’une
   <a href="http://arduino.cc/en/Tutorial/ShiftOut">
    explication du site Arduino
   </a>
   . Dans ce schéma les LEDs sont branchées en cathode commune.
  </p>
 </div>
</div>
<figure>
 <img alt="Deux 74HC595 en cascade, schéma" src="./images/uploaded/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595/deux-74hc595-en-cascade-schema.jpg"/>
 <figcaption>
  Deux 74HC595 en cascade, schéma
 </figcaption>
</figure>
<figure>
 <img alt="Deux 74HC595 en cascade, montage" src="./images/uploaded/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595/deux-74hc595-en-cascade-montage.jpg"/>
 <figcaption>
  Deux 74HC595 en cascade, montage
 </figcaption>
</figure>
<h4 id="exemple-dun-affichage-simple">
 <a aria-hidden="true" href="#exemple-dun-affichage-simple">
  <span class="es-autolink-heading">
  </span>
 </a>
 Exemple d’un affichage simple
</h4>
<p>
 Au niveau du programme, il suffira de faire appel deux fois de suite à la fonction shiftOut pour tout envoyer (2 fois 8 bits). Ces deux appels seront encadrés par le verrou pour actualiser l’affichage des données. On commence par envoyer la donnée qui doit avancer le plus pour atteindre le second 595, puis ensuite on fait celle qui concerne le premier 595. Voici un exemple :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> verrou = <span class="hljs-number">11</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> donnee = <span class="hljs-number">10</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> horloge = <span class="hljs-number">12</span>;

<span class="hljs-keyword">char</span> premier = <span class="hljs-number">8</span>; <span class="hljs-comment">// en binaire : 00001000</span>
<span class="hljs-keyword">char</span> second = <span class="hljs-number">35</span>; <span class="hljs-comment">// en binaire : 00100011</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// on déclare les broches en sortie</span>
    pinMode(verrou, OUTPUT);
    pinMode(donnee, OUTPUT);
    pinMode(horloge, OUTPUT);
    <span class="hljs-comment">// puis on envoie les données juste une fois</span>
    <span class="hljs-comment">// on commence par mettre le verrou</span>
    digitalWrite(verrou, LOW);
    <span class="hljs-comment">// on envoie la seconde donnée d'abord</span>
    <span class="hljs-comment">// les LEDs vertes du montage</span>
    shiftOut(donnee, horloge, LSBFIRST, ~second);
    <span class="hljs-comment">// on envoie la première donnée</span>
    <span class="hljs-comment">// les LEDs rouges du montage</span>
    shiftOut(donnee, horloge, LSBFIRST, ~premier);
    <span class="hljs-comment">// et on relache le verrou pour mettre à jour les données</span>
    digitalWrite(verrou, HIGH);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// rien à faire</span>
}
</code></pre>
 </div>
 <figcaption>
  Envoi de deux octets consécutifs avec deux 74HC595
 </figcaption>
</figure>
<figure>
 <img alt="Exemple de deux 74HC595 en cascade" src="./images/uploaded/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595/exemple-de-deux-74hc595-en-cascade.jpg"/>
 <figcaption>
  Exemple de deux 74HC595 en cascade
 </figcaption>
</figure>
<h4 id="exemple-dun-chenillard">
 <a aria-hidden="true" href="#exemple-dun-chenillard">
  <span class="es-autolink-heading">
  </span>
 </a>
 Exemple d’un chenillard
</h4>
<p>
 Voici maintenant un petit exemple pour faire un chenillard sur 16 LEDs. Pour cela, j’utiliserai un int qui sera transformé en char au moment de l’envoi. Il faudra donc le décaler vers la droite de 8 bits pour pouvoir afficher ses 8 bits de poids fort. Voici une loop pour illustrer mes propos (le setup étant toujours le même). (Attention cependant, contrairement au montage précédent en cathode commune, j’utilise pour ma part un montage à anode commune et donc toutes les sorties sont inversé).
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">int</span> masque = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">16</span>; i++)
    {
        <span class="hljs-comment">// on décale d'un cran le masque</span>
        masque = <span class="hljs-number">0x01</span> &lt;&lt; i;
        <span class="hljs-comment">// on commence par mettre le verrou</span>
        digitalWrite(verrou, LOW);
        <span class="hljs-comment">// on envoie la seconde donnée d'abord</span>
        <span class="hljs-comment">// on envoie les 8 premiers bits</span>
        shiftOut(donnee, horloge, LSBFIRST, ~(masque &amp; <span class="hljs-number">0x00FF</span>));
        <span class="hljs-comment">// on envoie la première donnée</span>
        <span class="hljs-comment">// on envoie les 8 derniers bits</span>
        shiftOut(donnee, horloge, LSBFIRST, ~((masque &amp; <span class="hljs-number">0xFF00</span>) &gt;&gt; <span class="hljs-number">8</span>));
        <span class="hljs-comment">// et on relache le verrou pour mettre à jour les données</span>
        digitalWrite(verrou, HIGH);
        delay(<span class="hljs-number">500</span>);
    }
}
</code></pre>
 </div>
 <figcaption>
  Démonstration de l’utilisation de deux 74HC595
 </figcaption>
</figure>
<div class="text-center">
 <div class="video-container">
  <div class="video-wrapper">
   <iframe allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/in_GIqS5CU4" width="560">
   </iframe>
  </div>
 </div>
</div>
<p>
 Et voici là encore la démonstration sur simulateur interactif :
</p>
<div class="video-container">
 <div class="video-wrapper">
  <iframe allowfullscreen="" frameborder="0" height="800" src="https://www.tinkercad.com/embed/ibDMHV4H3Cl" width="100%">
  </iframe>
 </div>
</div>
<p>
 Ce composant peut vous paraître un peu superflu, mais il existe en fait de très nombreuses applications avec. Par exemple, si vous voulez réaliser un cube de LED (disons 4x4x4 pour commencer gentiment). Si vous vouliez donner une broche par LED vous seriez bloqué puisque Arduino n’en possède pas autant (il vous en faudrait 64). Ici le composant vous permet donc de gérer plus de sorties que vous ne le pourriez initialement.
</p>
            </div>
            <!-- /.entry-content -->
            <hr>
            <div class="row bg-light my-2 py-2 rounded">
                <div class="col mr-auto">
                    <a class="" href="/tuto-arduino-803-arduino-et-ethernet-serveur" rel="prev">
                        <i class="fas fa-chevron-left fa-lg"></i>
                        tuto-arduino-803-arduino-et-ethernet-serveur
                    </a>
                </div>
                <div class="col-auto">
                    <a class="" href="/tuto-arduino-902-gestion-de-la-mémoire-sur-arduino" rel="next">
                        tuto-arduino-902-gestion-de-la-mémoire-sur-arduino
                        <i class="fas fa-chevron-right fa-lg"></i>
                    </a>
                </div>
            </div>
            <div class="text-center">
                <img class="es-licence-pic" src="/static/images/CC BY.png" alt="Licence CC BY" title="Article sous licence CC BY">
            </div>
            <div class="my-3 text-center">
                <a class="btn btn-outline-dark mx-1" href="https://twitter.com/share?url=https://eskimon.fr/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595&amp;text=Ajouter des sorties numériques à l'Arduino, le 74HC595 - https://eskimon.fr/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595" rel="nofollow" title="Partager cet article sur Twitter" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-twitter fa-lg"></i>
                </a>
                <a class="btn btn-outline-dark mx-1" href="https://www.facebook.com/sharer.php?u=https://eskimon.fr/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595&amp;t=Ajouter des sorties numériques à l'Arduino, le 74HC595 - https://eskimon.fr/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595" rel="nofollow" title="Partager cet article sur Facebook" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-facebook-f fa-lg"></i>
                </a>
                <a class="btn btn-outline-dark mx-1" href="https://plus.google.com/share?url=https://eskimon.fr/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595&amp;hl=fr" rel="nofollow" title="Partager cet article sur Google +" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-google-plus fa-lg"></i>
                </a>
                <!--<a class="btn btn-outline-dark mx-1" href="http://sharetodiaspora.github.io/?url=https://eskimon.fr/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595&amp;title=Ajouter des sorties numériques à l'Arduino, le 74HC595 - https://eskimon.fr/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595" rel="nofollow"  title="Partager cet article sur Diaspora" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-google-plus fa-lg"></i>
                </a>-->
                <a class="btn btn-outline-dark mx-1" href="mailto:?subject=Ajouter des sorties numériques à l'Arduino, le 74HC595&amp;body=https://eskimon.fr/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595"rel="nofollow" title="Partager cet article par email" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="far fa-envelope fa-lg"></i>
                </a>
            </div>
            <hr>
            <div class="text-center">
                <!-- billboard horizontal fin article -->
                <ins class="adsbygoogle" style="display:inline-block;width:970px;height:250px" data-ad-client="ca-pub-2080155902357792" data-ad-slot="6471099302"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
            <!-- disqus start -->
            <div id="disqus_thread"></div>
            <script>
                var disqus_config = function () {
                    this.page.url = 'https://eskimon.fr/tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595';
                    this.page.identifier = 'tuto-arduino-901-ajouter-des-sorties-numériques-à-larduino-le-74hc595';
                    this.page.title = 'Ajouter des sorties numériques à l&#39;Arduino, le 74HC595';
                };
                (function () { // DON'T EDIT BELOW THIS LINE
                    var d = document, s = d.createElement('script');
                    s.src = 'https://eskimon-fr.disqus.com/embed.js';
                    s.setAttribute('data-timestamp', +new Date());
                    (d.head || d.body).appendChild(s);
                })();
            </script>
            <noscript>Please enable JavaScript to view the
                <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
            </noscript>
            <!-- disqus end -->
        </article>
    </div>
    <div class="d-none d-xl-block col-xl-1 offset-xl-1 px-0">
        <div class="d-flex flex-column justify-content-around align-items-end h-100" id="es-right-ad-block">
            <!-- Pub ajouté auto -->
        </div>
    </div>
</div>
    </div>
<footer class="container-fluid bg-dark small text-white px-3">
<div class="row">
    <div class="col align-self-center">
        © Eskimon -
        Blog propulsé par <a class="bold text-white" href="https://blog.getpelican.com/" rel="nofollow">Pelican</a> -
        Thème fait maison
    </div>
    <div class="col align-self-end text-right">
        <a class="btn btn-lg text-light" href="https://github.com/Eskimon" rel="nofollow" title="Mon profil Github">
            <i class="fab fa-github fa-lg"></i>
        </a>
        <a class="btn btn-lg text-light" href="https://twitter.com/Eskimon_fr" rel="nofollow" title="Me suivre sur Twitter">
            <i class="fab fa-twitter fa-lg"></i>
        </a>
        <a class="btn btn-lg text-light" href="https://twitch.tv/eskimon" rel="nofollow" title="Me suivre sur Twitch">
            <i class="fab fa-twitch fa-lg"></i>
        </a>
        <a class="btn btn-lg text-light" href="https://www.youtube.com/user/Eskimon49/featured" rel="nofollow" title="Les VOD sur Youtube">
            <i class="fab fa-youtube fa-lg"></i>
        </a>
        <a class="btn btn-lg text-light" href="https://discord.gg/9SkDWft" rel="nofollow" title="Venez participer sur Discord">
            <i class="fab fa-discord fa-lg"></i>
        </a>
    </div>
  </div>
</footer>
    <!-- For formula -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- Font awesome -->
    <script src="https://use.fontawesome.com/releases/v5.0.0/js/all.js"></script>
    <!-- JQuery first -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <!-- Popper.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <!-- Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- For tooltips -->
    <script>$(function () {  $('[data-toggle="tooltip"]').tooltip()})</script>
    <script src="/static/js/my-scripts.js"></script>
<script>
function create_side_summary() {
    // Duplicate summary
    var main_summary = $('#sommaire').next();
    if(main_summary.length === 0)
        return
    var side_summary = main_summary.clone();
    side_summary.addClass('pl-0');
    var all_p = side_summary.find('p');
    all_p.contents().unwrap();
    var all_li = side_summary.find('li');
    all_li.addClass('pl-1');

    // scrollspy - in
    side_summary.attr('id', 'es-side-summary-mainlist');
    //side_summary.addClass('nav');
    //all_li.addClass('nav-item');
    var all_a = side_summary.find('a');
    all_a.addClass('nav-link');
    var all_ul = side_summary.find('ul');
    all_ul.addClass('pl-1');
    $('body').scrollspy({ target: '#es-side-summary-mainlist' });
    // scrollspy - out

    var summary_title = document.createElement("h4");
    summary_title.className = 'navbar-brand';
    summary_title.innerHTML = 'Sommaire';
    $(summary_title).prependTo('#es-side-summary-content');
    side_summary.appendTo('#es-side-summary-content');
    main_summary.addClass('es-subul-collapse');
}

function generate_spoilers() {
    all_secret = $('.custom-block-spoiler');
    all_secret.each(function( index ) {
        let content = $(this).html();
        $(this).html('');
        $(this).addClass('card');
        var headerText = document.createElement("button");
        var cardHeader = document.createElement("div");
        var cardBodyWrapper = document.createElement("div");
        var cardBody = document.createElement("div");
        $(headerText).text('Contenu masqué, cliquez pour afficher');
        $(headerText).addClass('btn btn-link btn-sm');
        $(headerText).attr('data-toggle', 'collapse');
        $(headerText).attr('data-target', '#collapse-' + index);
        $(headerText).attr('aria-controls', 'collapse-' + index);
        $(headerText).attr('aria-expanded', 'false');
        $(cardHeader).append(headerText);
        $(cardHeader).addClass('card-header');
        $(cardHeader).attr('id', 'spoiler-' + index);
        $(cardBody).html(content);
        $(cardBody).addClass('card-body');
        $(cardBodyWrapper).append(cardBody);
        $(cardBodyWrapper).addClass('collapse hide');
        $(cardBodyWrapper).attr('id', 'collapse-' + index)
        $(cardBodyWrapper).attr('aria-labelledby', 'spoiler-' + index)
        $(this).prepend(cardHeader);
        $(this).append(cardBodyWrapper);
    });

    $('.collapse').collapse({toggle: false});
}

function load_extra_ads() {
    return;
    // Load right side blocks
    var sidebar = $('#es-right-ad-block');
    var n_height = Math.floor(sidebar.height() / 2000);
    for (i = 0; i < n_height; i++) {
        var frag = document.createDocumentFragment();
        var newAdBlock = document.createElement("div");
        var block1 = document.createElement("ins");
        var block2 = document.createElement("script");

        block1.innerHTML = '<ins class="adsbygoogle" ' +
            'style="display:inline-block;width:120px;height:600px" ' +
            'data-ad-client="ca-pub-2080155902357792" ' +
            'data-ad-slot="4023722026"></ins>';
        block2.innerHTML = '(adsbygoogle = window.adsbygoogle || []).push({});';

        $(newAdBlock).append(block1);
        $(newAdBlock).append(block2);
        $(frag).append(newAdBlock);

        $(sidebar).append(frag);
    }

    // Load in feed blocks (above every h3)
    var frag = document.createDocumentFragment();
    var newAdBlock = document.createElement("div");
    var block1 = document.createElement("ins");
    var block2 = document.createElement("script");
    block1.innerHTML = '<ins class="adsbygoogle"' +
    'style = "display:inline-block;width:970px;height:90px"' +
    'data - ad - client="ca-pub-2080155902357792"' +
    'data - ad - slot="7100712740" ></ins >'
    block2.innerHTML = '(adsbygoogle = window.adsbygoogle || []).push({});';
    $(newAdBlock).append(block1);
    $(newAdBlock).append(block2);
    newAdBlock.className = 'my-3 text-center';
    $(frag).append(newAdBlock);
    var titles = $('.entry-content h3').slice(1);
    $(frag).insertBefore(titles);
}

$(document).ready(function () {

    create_side_summary();
    generate_spoilers();
    load_extra_ads();

    // when opening the sidebar
    $('#sidebarCollapse').on('click', function () {
        // open sidebar
        $('#es-side-summary').removeClass('d-none');
        $('#es-content').addClass('d-none');
        $('#sidebarCollapse').removeClass('sticky-top');
    });

    // if dismiss or overlay was clicked
    $('#es-side-summary').on('click', function () {
      // hide the sidebar
      $('#es-side-summary').addClass('d-none');
      $('#es-content').removeClass('d-none');
      $('#sidebarCollapse').addClass('sticky-top');
    });
});
</script>

<script id="dsq-count-scr" src="//eskimon-fr.disqus.com/count.js" async></script>
</body>

</html>
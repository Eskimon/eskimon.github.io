<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Introduire le temps &bull; Le blog d'Eskimon</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/hljs-monokai.css" />
    <link rel="stylesheet" href="/static/css/style.css" />
    <!-- Google font -->
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/images/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="57x57" href="/static/images/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/static/images/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/static/images/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/static/images/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/static/images/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/static/images/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/static/images/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/static/images/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/images/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/static/images/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/static/images/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="/static/images/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/static/images/favicon/ms-icon-144x144.png">


    <meta name="description" content="Le temps s'écoule aussi dans la carte Arduino... Voyons comment le dompter !" />

    <meta name="tags" content="arduino" />
    <meta name="tags" content="tuto" />

  <meta property="og:site_name" content="Le blog d'Eskimon">
  <meta property="og:title" content="Introduire le temps">
  <meta property="og:url" content="https://eskimon.fr/tuto-arduino-202-introduire-le-temps">
  <meta property="og:language" content="fr_FR">
  <meta property="og:type" content="website">

  <meta property="twitter:domain" content="https://eskimon.fr/">
  <meta property="twitter:card" content="summary">
  <meta property="twitter:url" content="https://eskimon.fr/tuto-arduino-202-introduire-le-temps">
  <meta property="twitter:title" content="Introduire le temps">
<meta property="twitter:description" content="Le temps s'écoule aussi dans la carte Arduino... Voyons comment le dompter !">  <meta property="twitter:site" content="SITENAME">
  <meta property="twitter:creator" content="@eskimon_fr">

  <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
  <meta name="DC.publisher" lang="fr" content="Le blog d'Eskimon" />
  <meta name="DC.creator" content="Eskimon" />
  <meta name="DC.type" content="text" />
  <meta name="DC.title" content="Introduire le temps" />
  <meta name="DC.abstract" content="Introduire le temps – Le temps s'écoule aussi dans la carte Arduino... Voyons comment le dompter !" />
  <meta name="DC.subject" lang="fr" content="Arduino/Gestion des entrées - sorties – arduino; tuto" />
<meta name="DC.description" lang="fr" content="Le temps s'écoule aussi dans la carte Arduino... Voyons comment le dompter !" />  <meta name="DC.date" content="2013-12-10T20:03:00+01:00" />
  <meta name="DC.format" content="text/html" />
  <meta name="DC.language" content="fr" />
  <meta name="DC.rights" content="CC BY-NC-SA" />


</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light bg-secondary-l40 py-0">
    <a class="navbar-brand" href="/">
        <img src="/static/images/logo.png" width="20" height="20" alt="">
        Le blog d'Eskimon
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav ml-auto">
                <a class="nav-item nav-link active" href="/category/arduino">Arduino</a>
                <a class="nav-item nav-link " href="/category/articles">Articles</a>
                <a class="nav-item nav-link " href="/category/tuto">Tuto</a>
            <!--<a class="nav-item nav-link active" href="#">Home <span class="sr-only">(current)</span></a>-->
        </div>
    </div>
</nav>
<!--
    <div class="vh-100 m-0 p-0 ">
        <div class="wmax-1024 mx-auto my-0 py-0 text-justify">
            <div class="text-center">
                <a href="https://eskimon.fr" class="text-dark no-decoration" >
                    <h1 class="logo-font text-center my-5 display-2 d-md-block d-none">Le blog d'Eskimon</h1>
                    <h2 class="logo-font text-center d-md-none my-5">Le blog d'Eskimon</h2>
                </a>
            </div>
        </div>
    </div>
-->
    <div class="container-fluid es-verticalfill">
<div class="row">
    <!-- Sidebar -->
    <div class="col-md-2 col-lg-2 d-none d-md-block sticky-top es-scrollable pt-3 px-1 bg-light es-ul-bordered" id="es-side-summary">
        <nav class="px-2" id="es-side-summary-content">
            <!-- Summary will come here -->
        </nav>
        <!-- Add here self-promo for ebook -->
        <!-- Add here adsense block -->
        <hr>
        <div id="es-side-summary-bot-annonce">
            <!-- Responsive sidebar -->
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-2080155902357792"
                data-ad-slot="3497585408"
                data-ad-format="auto"></ins>
            <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>
    <!-- Main content -->
    <div class="col-md-9 col-lg-7 offset-lg-1 d-block pt-3">
        <article>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb bg-white">
                    <li class="breadcrumb-item"><a href="/category/arduino">Arduino</a></li>
                        <li class="breadcrumb-item"><a href="/subcategory/arduino/gestion-des-entrees-sorties.html">Gestion des entrées - sorties</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Introduire le temps</li>
                </ol>
            </nav>
            <header class="es-post-info">
                <h1 class="text-center my-4">Introduire le temps</h1>
            </header>
            <footer class="es-post-info pb-2 mb-2">
                <div class="row align-items-center">
                    <div class="col-auto mr-auto">
                        <span class="vcard author">
                            <a class="" href="/author/eskimon" rel="author">Eskimon</a>
                        </span>
                        ,
                        <time class="" datetime="2013-12-10T20:03:00+01:00" pubdate>
                            le mar. 10 décembre 2013
                        </time>
                    </div>
                    <div class="col-auto">
                        <a class="btn btn-outline-primary btn-sm" href="/tag/arduino" rel="tag">arduino</a>
                        <a class="btn btn-outline-primary btn-sm" href="/tag/tuto" rel="tag">tuto</a>
                    </div>
                </div>
            </footer>

            <!-- /.post-info -->
            <div class="entry-content">
                <p>
 C’est bien beau d’allumer une LED, mais si elle ne fait rien d’autre, ce n’est pas très utile. Autant la brancher directement sur une pile (avec une résistance tout de même ! :P ).
Alors voyons comment rendre intéressante cette LED en la faisant clignoter !
Ce que ne sait pas faire une pile… Pour cela il va nous falloir introduire la notion de temps. Eh bien devinez quoi ?
Il existe une fonction toute prête là encore ! Je ne vous en dis pas plus, passons à la pratique !
</p>
<h3 id="sommaire">
 <a aria-hidden="true" href="#sommaire">
  <span class="es-autolink-heading">
  </span>
 </a>
 Sommaire
</h3>
<ul>
 <li>
  <p>
   <a href="#comment-faire">
    Comment faire ?
   </a>
  </p>
  <ul>
   <li>
    <ul>
     <li>
      <a href="#trouver-la-commande">
       Trouver la commande…
      </a>
     </li>
     <li>
      <a href="#utiliser-la-commande">
       Utiliser la commande
      </a>
     </li>
     <li>
      <a href="#mettre-en-pratique-faire-clignoter-une-led">
       Mettre en pratique : faire clignoter une LED
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#faire-clignoter-un-groupe-de-led">
    Faire clignoter un groupe de LED
   </a>
  </p>
  <ul>
   <li>
    <ul>
     <li>
      <a href="#le-matériel-et-les-schémas">
       Le matériel et les schémas
      </a>
     </li>
     <li>
      <a href="#le-programme">
       Le programme
      </a>
     </li>
     <li>
      <a href="#le-programme-final">
       Le programme final
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#réaliser-un-chenillard">
    Réaliser un chenillard
   </a>
  </p>
  <ul>
   <li>
    <ul>
     <li>
      <a href="#le-but-du-programme">
       Le but du programme
      </a>
     </li>
     <li>
      <a href="#organigramme">
       Organigramme
      </a>
     </li>
     <li>
      <a href="#le-programme-1">
       Le programme
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#fonction-millis">
    Fonction millis()
   </a>
  </p>
  <ul>
   <li>
    <a href="#les-limites-de-la-fonction-delay">
     Les limites de la fonction delay()
    </a>
   </li>
   <li>
    <a href="#découvrons-et-utilisons-millis">
     Découvrons et utilisons millis()
    </a>
   </li>
  </ul>
 </li>
</ul>
<h3 id="comment-faire">
 <a aria-hidden="true" href="#comment-faire">
  <span class="es-autolink-heading">
  </span>
 </a>
 Comment faire ?
</h3>
<h5 id="trouver-la-commande">
 <a aria-hidden="true" href="#trouver-la-commande">
  <span class="es-autolink-heading">
  </span>
 </a>
 Trouver la commande…
</h5>
<p>
 Je vous laisse cherche un peu par vous-même, cela vous entrainera !
 <img alt=":pirate:" class="smiley" src="./static/smileys/pirate.png"/>
 …
Pour ceux qui ont fait l’effort de chercher et n’ont pas trouvé (à cause de l’anglais ?), je vous donne la fonction qui va bien :
on va utiliser :
 <code>
  delay()
 </code>
 .
Petite description de la fonction : elle va servir à mettre en pause le programme pendant un temps prédéterminé.
</p>
<h5 id="utiliser-la-commande">
 <a aria-hidden="true" href="#utiliser-la-commande">
  <span class="es-autolink-heading">
  </span>
 </a>
 Utiliser la commande
</h5>
<p>
 La fonction admet un paramètre qui est le temps pendant lequel on veut mettre en pause le programme. Ce temps doit être donné en millisecondes.
C’est-à-dire que si vous voulez arrêter le programme pendant une seconde, il va falloir donner à la fonction ce même temps, écrit en millisecondes, soit 1000ms. La fonction est simple à utiliser :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp"><span class="hljs-comment">// on fait une pause du programme pendant 1000ms, soit 1 seconde</span>
delay(<span class="hljs-number">1000</span>);
</code></pre>
</div>
<p>
 Rien de plus simple donc. Pour 20 secondes de pause, il aurait fallu écrire :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp"><span class="hljs-comment">// on fait une pause du programme pendant 20000ms, soit 20 secondes</span>
delay(<span class="hljs-number">20000</span>);
</code></pre>
</div>
<h5 id="mettre-en-pratique-faire-clignoter-une-led">
 <a aria-hidden="true" href="#mettre-en-pratique-faire-clignoter-une-led">
  <span class="es-autolink-heading">
  </span>
 </a>
 Mettre en pratique : faire clignoter une LED
</h5>
<p>
 Du coup, si on veut faire clignoter notre LED, on peut utiliser cette fonction.
Voyons un peu le schéma de principe du clignotement d’une LED :
</p>
<p>
 <img alt="Schéma de principe du clignotement" src="./images/uploaded/tuto-arduino-202-introduire-le-temps/schema-de-principe-du-clignotement.jpg"/>
</p>
<p>
 Vous le voyez, la LED s’allume. Puis, on fait intervenir la fonction
 <code>
  delay()
 </code>
 , qui va mettre le programme en pause pendant un certain temps.
Ensuite, on éteint la LED. On met en pause le programme. Puis on revient au début du programme.
On recommence et ainsi de suite.
C’est cette suite de commandes qui forme le processus faisant clignoter la LED.
</p>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   Dorénavant, prenez l’habitude de faire ce genre de schéma lorsque vous faites un programme.
Cela aide grandement la réflexion, croyez moi !
   <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
   C’est le principe de perdre du temps pour en gagner. Autrement dit : l'
   <strong>
    organisation
   </strong>
   !
  </p>
 </div>
</div>
<p>
 Maintenant, il faut que l’on traduise ce schéma, portant le nom d'
 <strong>
  organigramme
 </strong>
 , en code.
</p>
<p>
 Il suffit pour cela de remplacer les phrases dans chaque cadre par une ligne de code.
Par exemple, "on allume la LED", va être traduit par l’instruction que l’on a vue dans le chapitre précédent :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">digitalWrite(led_rouge, LOW);   <span class="hljs-comment">// allume la LED</span>
</code></pre>
</div>
<p>
 Ensuite, on traduit le cadre suivant, ce qui donne :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp"><span class="hljs-comment">// fait une pause de 1 seconde (= 1000ms)</span>
delay(<span class="hljs-number">1000</span>);
</code></pre>
</div>
<p>
 Puis, on traduit la ligne suivante :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp"><span class="hljs-comment">// éteint la LED</span>
digitalWrite(led_rouge, HIGH);
</code></pre>
</div>
<p>
 Enfin, la dernière ligne est identique à la deuxième, soit :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp"><span class="hljs-comment">// fait une pause de 1 seconde</span>
delay(<span class="hljs-number">1000</span>);
</code></pre>
</div>
<p>
 On se retrouve avec le code suivant :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp"><span class="hljs-comment">// allume la LED</span>
digitalWrite(led_rouge, LOW);
<span class="hljs-comment">// fait une pause de 1 seconde</span>
delay(<span class="hljs-number">1000</span>);
<span class="hljs-comment">// éteint la LED</span>
digitalWrite(led_rouge, HIGH);
<span class="hljs-comment">// fait une pause de 1 seconde</span>
delay(<span class="hljs-number">1000</span>);
</code></pre>
</div>
<p>
 La fonction qui va boucler à l’infini le code précédent est la fonction
 <code>
  loop()
 </code>
 .
On inscrit donc le code précédent dans cette fonction :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// allume la LED</span>
    digitalWrite(led_rouge, LOW);
    <span class="hljs-comment">// fait une pause de 1 seconde</span>
    delay(<span class="hljs-number">1000</span>);
    <span class="hljs-comment">// éteint la LED</span>
    digitalWrite(led_rouge, HIGH);
    <span class="hljs-comment">// fait une pause de 1 seconde</span>
    delay(<span class="hljs-number">1000</span>);
}
</code></pre>
</div>
<p>
 Et on n’oublie pas de définir la broche utilisée par la LED, ainsi que d’initialiser cette broche en tant que sortie. Cette fois, le code est terminé !
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp"><span class="hljs-comment">// définition de la broche 2 de la carte en tant que variable</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> led_rouge = <span class="hljs-number">2</span>;

<span class="hljs-comment">// fonction d'initialisation de la carte</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// initialisation de la broche 2 comme étant une sortie</span>
    pinMode(led_rouge, OUTPUT);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// allume la LED</span>
    digitalWrite(led_rouge, LOW);
    <span class="hljs-comment">// fait une pause de 1 seconde</span>
    delay(<span class="hljs-number">1000</span>);
    <span class="hljs-comment">// éteint la LED</span>
    digitalWrite(led_rouge, HIGH);
    <span class="hljs-comment">// fait une pause de 1 seconde</span>
    delay(<span class="hljs-number">1000</span>);
}
</code></pre>
</div>
<p>
 Vous n’avez plus qu’à charger le code dans la carte et admirer
 <del>
  mon
 </del>
 votre travail ! La LED clignote !
Libre à vous de changer le temps de clignotement : vous pouvez par exemple éteindre la LED pendant 40ms et l’allumer pendant 600ms :
</p>
<div class="custom-block custom-block-spoiler">
 <div class="custom-block-body">
  <div class="hljs-code-div">
   <div class="hljs-line-numbers">
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
    <span>
    </span>
   </div>
   <pre><code class="hljs language-cpp"><span class="hljs-comment">// définition de la broche 2 de la carte en tant que variable</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> led_rouge = <span class="hljs-number">2</span>;

<span class="hljs-comment">// fonction d'initialisation de la carte</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// initialisation de la broche 2 comme étant une sortie</span>
    pinMode(led_rouge, OUTPUT);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// allume la LED</span>
    digitalWrite(led_rouge, LOW);
    <span class="hljs-comment">// fait une pause de 600 ms</span>
    delay(<span class="hljs-number">600</span>);
    <span class="hljs-comment">// éteint la LED</span>
    digitalWrite(led_rouge, HIGH);
    <span class="hljs-comment">// fait une pause de 40 ms</span>
    delay(<span class="hljs-number">40</span>);
}
</code></pre>
  </div>
 </div>
</div>
<p>
 Et hop, une petite vidéo d’illustration !
</p>
<div class="text-center">
 <div class="video-container">
  <div class="video-wrapper">
   <iframe allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/YAOakcEoIfk" width="560">
   </iframe>
  </div>
 </div>
</div>
<h3 id="faire-clignoter-un-groupe-de-led">
 <a aria-hidden="true" href="#faire-clignoter-un-groupe-de-led">
  <span class="es-autolink-heading">
  </span>
 </a>
 Faire clignoter un groupe de LED
</h3>
<p>
 Vous avouerez facilement que ce n’était pas bien difficile d’arriver jusque-là. Alors, à présent, accentuons la difficulté.
Notre but : faire clignoter
 <em>
  un groupe
 </em>
 de LED.
</p>
<h5 id="le-matériel-et-les-schémas">
 <a aria-hidden="true" href="#le-matériel-et-les-schémas">
  <span class="es-autolink-heading">
  </span>
 </a>
 Le matériel et les schémas
</h5>
<p>
 Ce groupe de LED sera composé de six LED, nommées L1, L2, L3, L4, L5 et L6. Vous aurez par conséquent besoin d’un nombre identique de résistances. Le schéma de la réalisation :
</p>
<p>
 <img alt="Schéma avec 6 leds" src="./images/uploaded/tuto-arduino-202-introduire-le-temps/schema-avec-6-leds.png"/>
</p>
<p>
 <img alt="Montage avec 6 leds" src="./images/uploaded/tuto-arduino-202-introduire-le-temps/montage-avec-6-leds.png"/>
</p>
<h5 id="le-programme">
 <a aria-hidden="true" href="#le-programme">
  <span class="es-autolink-heading">
  </span>
 </a>
 Le programme
</h5>
<p>
 Le programme est un peu plus long que le précédent, car il ne s’agit plus d’allumer une seule LED, mais six !
Voilà l’organigramme que va suivre notre programme :
</p>
<p>
 <img alt="Description du programme" src="./images/uploaded/tuto-arduino-202-introduire-le-temps/description-du-programme.jpg"/>
</p>
<p>
 Cet organigramme n’est pas très beau, mais il a le mérite d’être assez lisible.
Nous allons essayer de le suivre pour créer notre programme.
Traduction des six premières instructions :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">digitalWrite(L1, LOW); <span class="hljs-comment">// notez que le nom de la broche a changé</span>
digitalWrite(L2, LOW); <span class="hljs-comment">// et ce pour toutes les LED connectées</span>
digitalWrite(L3, LOW); <span class="hljs-comment">// au micro-controleur</span>
digitalWrite(L4, LOW);
digitalWrite(L5, LOW);
digitalWrite(L6, LOW);
</code></pre>
</div>
<p>
 Ensuite, on attend 1,5 seconde :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">delay(<span class="hljs-number">1500</span>);
</code></pre>
</div>
<p>
 Puis on traduit les six autres instructions :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">digitalWrite(L1, HIGH); <span class="hljs-comment">// on éteint les LED</span>
digitalWrite(L2, HIGH);
digitalWrite(L3, HIGH);
digitalWrite(L4, HIGH);
digitalWrite(L5, HIGH);
digitalWrite(L6, HIGH);
</code></pre>
</div>
<p>
 Enfin, la dernière ligne de code, disons que nous attendrons 4,32 secondes :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">delay(<span class="hljs-number">4320</span>);
</code></pre>
</div>
<p>
 Tous ces bouts de code sont à mettre à la suite et dans la fonction
 <code>
  loop()
 </code>
 pour qu’ils se répètent.
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    digitalWrite(L1, LOW);  <span class="hljs-comment">// allumer les LED</span>
    digitalWrite(L2, LOW);
    digitalWrite(L3, LOW);
    digitalWrite(L4, LOW);
    digitalWrite(L5, LOW);
    digitalWrite(L6, LOW);

    delay(<span class="hljs-number">1500</span>);             <span class="hljs-comment">// attente du programme de 1,5 secondes</span>

    digitalWrite(L1, HIGH);   <span class="hljs-comment">// on éteint les LED</span>
    digitalWrite(L2, HIGH);
    digitalWrite(L3, HIGH);
    digitalWrite(L4, HIGH);
    digitalWrite(L5, HIGH);
    digitalWrite(L6, HIGH);

    delay(<span class="hljs-number">4320</span>);             <span class="hljs-comment">// attente du programme de 4,32 secondes</span>
}
</code></pre>
 </div>
 <figcaption>
  la boucle complète
 </figcaption>
</figure>
<p>
 Je l’ai mentionné dans un de mes commentaires entre les lignes du programme, les noms attribués aux broches sont à changer.
En effet, car si on définit des noms de variables identiques, le compilateur n’aimera pas ça et vous affichera une erreur.
En plus, le micro-contrôleur ne pourrait pas exécuter le programme car il ne saurait pas quelle broche mettre à l’état HAUT ou BAS.
Pour définir les broches, on fait la même chose qu’à notre premier programme :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L1 = <span class="hljs-number">2</span>; <span class="hljs-comment">// broche 2 du micro-contrôleur se nomme maintenant : L1</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L2 = <span class="hljs-number">3</span>; <span class="hljs-comment">// broche 3 du micro-contrôleur se nomme maintenant : L2</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L3 = <span class="hljs-number">4</span>; <span class="hljs-comment">// ...</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L4 = <span class="hljs-number">5</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L5 = <span class="hljs-number">6</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L6 = <span class="hljs-number">7</span>;
</code></pre>
 </div>
 <figcaption>
  Définition des broches
 </figcaption>
</figure>
<p>
 Maintenant que les broches utilisées sont définies, il faut dire si ce sont des entrées ou des sorties :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp">pinMode(L1, OUTPUT); <span class="hljs-comment">// L1 est une broche de sortie</span>
pinMode(L2, OUTPUT); <span class="hljs-comment">// L2 est une broche de sortie</span>
pinMode(L3, OUTPUT); <span class="hljs-comment">// ...</span>
pinMode(L4, OUTPUT);
pinMode(L5, OUTPUT);
pinMode(L6, OUTPUT);
</code></pre>
</div>
<h5 id="le-programme-final">
 <a aria-hidden="true" href="#le-programme-final">
  <span class="es-autolink-heading">
  </span>
 </a>
 Le programme final
</h5>
<p>
 Il n’est certes pas très beau, mais il fonctionne :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L1 = <span class="hljs-number">2</span>; <span class="hljs-comment">// broche 2 du micro-contrôleur se nomme maintenant : L1</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L2 = <span class="hljs-number">3</span>; <span class="hljs-comment">// broche 3 du micro-contrôleur se nomme maintenant : L2</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L3 = <span class="hljs-number">4</span>; <span class="hljs-comment">// ...</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L4 = <span class="hljs-number">5</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L5 = <span class="hljs-number">6</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L6 = <span class="hljs-number">7</span>;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    pinMode(L1, OUTPUT); <span class="hljs-comment">// L1 est une broche de sortie</span>
    pinMode(L2, OUTPUT); <span class="hljs-comment">// L2 est une broche de sortie</span>
    pinMode(L3, OUTPUT); <span class="hljs-comment">// ...</span>
    pinMode(L4, OUTPUT);
    pinMode(L5, OUTPUT);
    pinMode(L6, OUTPUT);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// allumer les LED</span>
    digitalWrite(L1, LOW);
    digitalWrite(L2, LOW);
    digitalWrite(L3, LOW);
    digitalWrite(L4, LOW);
    digitalWrite(L5, LOW);
    digitalWrite(L6, LOW);

    <span class="hljs-comment">// attente du programme de 1,5 secondes</span>
    delay(<span class="hljs-number">1500</span>);

    <span class="hljs-comment">// on éteint les LED</span>
    digitalWrite(L1, HIGH);
    digitalWrite(L2, HIGH);
    digitalWrite(L3, HIGH);
    digitalWrite(L4, HIGH);
    digitalWrite(L5, HIGH);
    digitalWrite(L6, HIGH);

    <span class="hljs-comment">// attente du programme de 4,32 secondes</span>
    delay(<span class="hljs-number">4320</span>);
}
</code></pre>
 </div>
 <figcaption>
  Allumage puis extinction en boucle d’un groupe de leds
 </figcaption>
</figure>
<p>
 Voilà, vous avez en votre possession un magnifique clignotant, que vous pouvez attacher à votre vélo ! :P
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Une question me chiffonne. Doit-on toujours écrire l’état d’une sortie, ou peut-on faire plus simple ?
  </p>
 </div>
</div>
<p>
 C’est là un un point intéressant.
Si je comprends bien, vous vous demandez comment faire pour remplacer l’intérieur de la fonction
 <code>
  loop()
 </code>
 ?
C’est vrai que c’est très lourd à écrire et à lire ! Il faut en effet s’occuper de définir l’état de chaque LED.
C’est rébarbatif, surtout si vous en aviez mis autant qu’il y a de broches disponibles sur la carte !
Il y a une solution pour faire ce que vous dites. Nous allons la voir dans quelques chapitres, ne soyez pas impatient !
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
 En attendant, voici une vidéo d’illustration du clignotement :
</p>
<div class="text-center">
 <div class="video-container">
  <div class="video-wrapper">
   <iframe allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/2SgxKU67mn8" width="560">
   </iframe>
  </div>
 </div>
</div>
<h3 id="réaliser-un-chenillard">
 <a aria-hidden="true" href="#réaliser-un-chenillard">
  <span class="es-autolink-heading">
  </span>
 </a>
 Réaliser un chenillard
</h3>
<h5 id="le-but-du-programme">
 <a aria-hidden="true" href="#le-but-du-programme">
  <span class="es-autolink-heading">
  </span>
 </a>
 Le but du programme
</h5>
<p>
 Le but du programme que nous allons créer va consister à réaliser un chenillard. Pour ceux qui ne savent pas ce qu’est un chenillard, je vous ai préparé une petite image .gif animée :
</p>
<div class="text-center">
 <p>
  <img alt="Chenillard" src="./images/uploaded/tuto-arduino-202-introduire-le-temps/chenillard.gif"/>
 </p>
</div>
<p>
 Comme on dit souvent, une image vaut mieux qu’un long discours ! :P Voilà donc ce qu’est un chenillard.
Chaque LED s’allume alternativement et dans l’ordre. De la gauche vers la droite ou l’inverse, c’est au choix.
</p>
<h5 id="organigramme">
 <a aria-hidden="true" href="#organigramme">
  <span class="es-autolink-heading">
  </span>
 </a>
 Organigramme
</h5>
<p>
 Comme j’en ai marre de faire des dessins avec paint.net, je vous laisse réfléchir tout seuls comme des grands à l’organigramme du programme. …
Bon, aller, le voilà cet organigramme ! Attention, il n’est pas complet, mais si vous avez compris le principe, le compléter ne vous posera pas de problèmes :
</p>
<div class="custom-block custom-block-spoiler">
 <div class="custom-block-body">
  <div class="text-center">
   <p>
    <img alt="Organigramme" src="./images/uploaded/tuto-arduino-202-introduire-le-temps/organigramme.jpg"/>
   </p>
  </div>
 </div>
</div>
<p>
 À vous de jouer !
</p>
<h5 id="le-programme-1">
 <a aria-hidden="true" href="#le-programme-1">
  <span class="es-autolink-heading">
  </span>
 </a>
 Le programme
</h5>
<p>
 Normalement, sa conception ne devrait pas vous poser de problèmes.
Il suffit en effet de récupérer le code du programme précédent ("allumer un groupe de LED") et de le modifier en fonction de notre besoin.
Ce code, je vous le donne, avec les commentaires qui vont bien :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L1 = <span class="hljs-number">2</span>; <span class="hljs-comment">// broche 2 du micro-contrôleur se nomme maintenant : L1</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L2 = <span class="hljs-number">3</span>; <span class="hljs-comment">// broche 3 du micro-contrôleur se nomme maintenant : L2</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L3 = <span class="hljs-number">4</span>; <span class="hljs-comment">// ...</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L4 = <span class="hljs-number">5</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L5 = <span class="hljs-number">6</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> L6 = <span class="hljs-number">7</span>;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    pinMode(L1, OUTPUT); <span class="hljs-comment">// L1 est une broche de sortie</span>
    pinMode(L2, OUTPUT); <span class="hljs-comment">// L2 est une broche de sortie</span>
    pinMode(L3, OUTPUT); <span class="hljs-comment">// ...</span>
    pinMode(L4, OUTPUT);
    pinMode(L5, OUTPUT);
    pinMode(L6, OUTPUT);
}

<span class="hljs-comment">// on change simplement l’intérieur de la boucle pour atteindre notre objectif</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> <span class="hljs-comment">// la fonction loop() exécute le code qui suit en le répétant en boucle</span>
</span>{
    digitalWrite(L1, LOW);   <span class="hljs-comment">// allumer L1</span>
    delay(<span class="hljs-number">1000</span>);             <span class="hljs-comment">// attendre 1 seconde</span>
    digitalWrite(L1, HIGH);  <span class="hljs-comment">// on éteint L1</span>
    digitalWrite(L2, LOW);   <span class="hljs-comment">// on allume L2 en même temps que l'on éteint L1</span>
    delay(<span class="hljs-number">1000</span>);             <span class="hljs-comment">// on attend 1 seconde</span>
    digitalWrite(L2, HIGH);  <span class="hljs-comment">// on éteint L2 et</span>
    digitalWrite(L3, LOW);   <span class="hljs-comment">// on allume immédiatement L3</span>
    delay(<span class="hljs-number">1000</span>);             <span class="hljs-comment">// ...</span>
    digitalWrite(L3, HIGH);
    digitalWrite(L4, LOW);
    delay(<span class="hljs-number">1000</span>);
    digitalWrite(L4, HIGH);
    digitalWrite(L5, LOW);
    delay(<span class="hljs-number">1000</span>);
    digitalWrite(L5, HIGH);
    digitalWrite(L6, LOW);
    delay(<span class="hljs-number">1000</span>);
    digitalWrite(L6, HIGH);
}
</code></pre>
 </div>
 <figcaption>
  Votre premier chenillard
 </figcaption>
</figure>
<p>
 Vous le voyez, ce code est très lourd et n’est pas pratique.
Nous verrons plus loin comment faire en sorte de l’alléger.
Mais avant cela, un TP arrive… Au fait, voici un exemple de ce que vous pouvez obtenir !
</p>
<div class="text-center">
 <div class="video-container">
  <div class="video-wrapper">
   <iframe allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/hKNqRAi-kKI" width="560">
   </iframe>
  </div>
 </div>
</div>
<h3 id="fonction-millis">
 <a aria-hidden="true" href="#fonction-millis">
  <span class="es-autolink-heading">
  </span>
 </a>
 Fonction millis()
</h3>
<p>
 Nous allons terminer ce chapitre par un point qui peut être utile, notamment dans certaines situations où l’on ne veut pas arrêter le programme.
En effet, si on veut faire clignoter une LED sans arrêter l’exécution du programme, on ne peut pas utiliser la fonction
 <code>
  delay()
 </code>
 qui met en pause le programme durant le temps défini.
</p>
<h4 id="les-limites-de-la-fonction-delay">
 <a aria-hidden="true" href="#les-limites-de-la-fonction-delay">
  <span class="es-autolink-heading">
  </span>
 </a>
 Les limites de la fonction delay()
</h4>
<p>
 Vous avez probablement remarqué, lorsque vous utilisez la fonction
 <code>
  delay()
 </code>
 tout notre programme s’arrête le temps d’attendre.
Dans certains cas ce n’est pas un problème mais dans certains cas ça peut être plus gênant.
Imaginons, vous êtes en train de faire avancer un robot. Vous mettez vos moteurs à une vitesse moyenne, tranquille, jusqu’à ce qu’un petit bouton sur l’avant soit appuyé (il clic lorsqu’on touche un mur par exemple).
Pendant ce temps-là, vous décidez de faire des signaux en faisant clignoter vos LED.
Pour faire un joli clignotement, vous allumez une LED rouge pendant une seconde puis l’éteignez pendant une autre seconde.
Voilà par exemple ce qu’on pourrait faire comme code
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    pinMode(moteur, OUTPUT);
    pinMode(led, OUTPUT);
    pinMode(bouton, INPUT);
    <span class="hljs-comment">// on met le moteur en marche (en admettant qu'il soit en marche à HIGH)</span>
    digitalWrite(moteur, HIGH);
    <span class="hljs-comment">// on allume la LED</span>
    digitalWrite(led, LOW);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// si le bouton est cliqué (on rentre dans un mur)</span>
    <span class="hljs-keyword">if</span>(digitalRead(bouton)==HIGH)
    {
        <span class="hljs-comment">// on arrête le moteur</span>
        digitalWrite(moteur, LOW);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-comment">// sinon on clignote</span>
    {
        digitalWrite(led, HIGH);
        delay(<span class="hljs-number">1000</span>);
        digitalWrite(led, LOW);
        delay(<span class="hljs-number">1000</span>);
    }
}
</code></pre>
</div>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   Attention ce code n’est pas du tout rigoureux voire faux dans son écriture, il sert juste à comprendre le principe !
  </p>
 </div>
</div>
<p>
 Maintenant imaginez. Vous roulez, tester que le bouton n’est pas appuyé, donc faites clignoter les LED (cas du
 <code>
  else
 </code>
 ).
Le temps que vous fassiez l’affichage en entier s’écoule 2 longues secondes !
Le robot a pu pendant cette éternité se prendre le mur en pleine poire et les moteurs continuent à avancer tête baissée jusqu’à fumer !
Ce n’est pas bon du tout ! Voici pourquoi la fonction millis() peut nous sauver.
</p>
<h4 id="découvrons-et-utilisons-millis">
 <a aria-hidden="true" href="#découvrons-et-utilisons-millis">
  <span class="es-autolink-heading">
  </span>
 </a>
 Découvrons et utilisons millis()
</h4>
<p>
 Tout d’abord, quelques précisions à son sujet, avant d’aller s’en servir.
À l’intérieur du cœur de la carte Arduino se trouve un chronomètre. Ce chrono mesure l’écoulement du temps depuis le lancement de l’application.
Sa granularité (la précision de son temps) est la milliseconde.
La fonction millis() nous sert à savoir quelle est la valeur courante de ce compteur. Attention, comme ce compteur est capable de mesurer une durée allant jusqu’à 50 jours, la valeur retournée doit être stockée dans une variable de type "long".
</p>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   C’est bien gentil mais concrètement on l’utilise comment ?
  </p>
 </div>
</div>
<p>
 Eh bien c’est très simple. On sait maintenant "lire l’heure".
Maintenant, au lieu de dire "allume-toi pendant une seconde et ne fais surtout rien pendant ce temps", on va faire un truc du genre "Allume-toi, fais tes petites affaires, vérifie l’heure de temps en temps et si une seconde est écoulée, alors réagis !".
Voici le code précédent transformé selon la nouvelle philosophie :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-keyword">long</span> temps; <span class="hljs-comment">// variable qui stocke la mesure du temps</span>
boolean etat_led;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
    pinMode(moteur, OUTPUT);
    pinMode(led, OUTPUT);
    pinMode(bouton, INPUT);
    <span class="hljs-comment">// on met le moteur en marche</span>
    digitalWrite(moteur, HIGH);
    <span class="hljs-comment">// par défaut la LED sera éteinte</span>
    etat_led = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// on éteint la LED</span>
    digitalWrite(led, etat_led);

    <span class="hljs-comment">// on initialise le temps</span>
    temps = millis();
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// si le bouton est cliqué (on rentre dans un mur)</span>
    <span class="hljs-keyword">if</span>(digitalRead(bouton)==HIGH)
    {
        <span class="hljs-comment">// on arrête le moteur</span>
        digitalWrite(moteur, LOW);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-comment">// sinon on clignote</span>
    {
        <span class="hljs-comment">// on compare l'ancienne valeur du temps et la valeur sauvée</span>
        <span class="hljs-comment">// si la comparaison (l'un moins l'autre) dépasse 1000...</span>
        <span class="hljs-comment">// ...cela signifie qu'au moins une seconde s'est écoulée</span>
        <span class="hljs-keyword">if</span>((millis() - temps) &gt; <span class="hljs-number">1000</span>)
        {
            etat_led = !etat_led; <span class="hljs-comment">// on inverse l'état de la LED</span>
            digitalWrite(led, etat_led); <span class="hljs-comment">// on allume ou éteint</span>
            temps = millis(); <span class="hljs-comment">// on stocke la nouvelle heure</span>
        }
    }
}
</code></pre>
 </div>
 <figcaption>
  Clignotement avec
  <code>
   millis
  </code>
 </figcaption>
</figure>
<p>
 Et voilà, grâce à cette astuce plus de fonction bloquante.
L’état du bouton est vérifié très fréquemment ce qui permet de s’assurer que si jamais on rentre dans un mur, on coupe les moteurs très vite. Dans ce code, tout s’effectue de manière fréquente.
En effet, on ne reste jamais bloqué à attendre que le temps passe. À la place, on avance dans le programme et teste souvent la valeur du chronomètre.
Si cette valeur est de 1000 itérations supérieures à la dernière valeur mesurée, alors cela signifie qu’une seconde est passée.
</p>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   Attention, au
   <code>
    if
   </code>
   de la ligne 25 ne faites surtout pas
   <code>
    millis() - temps == 1000
   </code>
   .
Cela signifierait que vous voulez vérifier que 1000 millisecondes EXACTEMENT se sont écoulées, ce qui est très peu probable (vous pourrez plus probablement mesurer plus ou moins mais rarement exactement)
  </p>
 </div>
</div>
<p>
 Maintenant que vous savez maîtriser le temps, vos programmes/animations vont pouvoir posséder un peu plus de "vie" en faisant des pauses, des motifs, etc. Impressionnez-moi !
</p>
            </div>
            <!-- /.entry-content -->
            <hr>
            <div class="row bg-light my-2 py-2 rounded">
                <div class="col mr-auto">
                    <a class="" href="/tuto-arduino-201-notre-premier-programme" rel="prev">
                        <i class="fas fa-chevron-left fa-lg"></i>
                        tuto-arduino-201-notre-premier-programme
                    </a>
                </div>
                <div class="col-auto">
                    <a class="" href="/tuto-arduino-203-tp-feux-de-signalisation-routière" rel="next">
                        tuto-arduino-203-tp-feux-de-signalisation-routière
                        <i class="fas fa-chevron-right fa-lg"></i>
                    </a>
                </div>
            </div>
            <div class="mb-3 text-center">
                <a class="btn btn-outline-dark mx-1" href="https://twitter.com/share?url=https://eskimon.fr/tuto-arduino-202-introduire-le-temps&amp;text=Introduire le temps - https://eskimon.fr/tuto-arduino-202-introduire-le-temps" rel="nofollow" title="Partager cet article sur Twitter" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-twitter fa-lg"></i>
                </a>
                <a class="btn btn-outline-dark mx-1" href="https://www.facebook.com/sharer.php?u=https://eskimon.fr/tuto-arduino-202-introduire-le-temps&amp;t=Introduire le temps - https://eskimon.fr/tuto-arduino-202-introduire-le-temps" rel="nofollow" title="Partager cet article sur Facebook" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-facebook-f fa-lg"></i>
                </a>
                <a class="btn btn-outline-dark mx-1" href="https://plus.google.com/share?url=https://eskimon.fr/tuto-arduino-202-introduire-le-temps&amp;hl=fr" rel="nofollow" title="Partager cet article sur Google +" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-google-plus fa-lg"></i>
                </a>
                <!--<a class="btn btn-outline-dark mx-1" href="http://sharetodiaspora.github.io/?url=https://eskimon.fr/tuto-arduino-202-introduire-le-temps&amp;title=Introduire le temps - https://eskimon.fr/tuto-arduino-202-introduire-le-temps" rel="nofollow"  title="Partager cet article sur Diaspora" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-google-plus fa-lg"></i>
                </a>-->
                <a class="btn btn-outline-dark mx-1" href="mailto:?subject=Introduire le temps&amp;body=https://eskimon.fr/tuto-arduino-202-introduire-le-temps"rel="nofollow" title="Partager cet article par email" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="far fa-envelope fa-lg"></i>
                </a>
            </div>
        </article>
    </div>
</div>
    </div>
<footer class="container-fluid bg-dark small text-white px-3">
<div class="row">
    <div class="col align-self-start">

    </div>
    <div class="col align-self-center text-center">
        © Eskimon -
        Blog propulsé par <a class="bold text-white" href="https://blog.getpelican.com/" rel="nofollow">Pelican</a> -
        Thème fait maison
    </div>
    <div class="col align-self-end text-right">
        <a class="btn btn-lg text-light" href="https://github.com/Eskimon" rel="nofollow" title="Mon profil Github">
            <i class="fab fa-github fa-lg"></i>
        </a>
        <a class="btn btn-lg text-light" href="https://twitter.com/Eskimon_fr" rel="nofollow" title="Me suivre sur Linkedin">
            <i class="fab fa-twitter fa-lg"></i>
        </a>
    </div>
  </div>
</footer>

    <!-- For formula -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- Font awesome -->
    <script src="https://use.fontawesome.com/releases/v5.0.0/js/all.js"></script>
    <!-- JQuery first -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <!-- Popper.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <!-- Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- For tooltips -->
    <script>$(function () {  $('[data-toggle="tooltip"]').tooltip()})</script>
    <script src="/static/js/my-scripts.js"></script>
<script>
function create_side_summary() {
    // Duplicate summary
    var main_summary = $('#sommaire').next();
    if(main_summary.length === 0)
        return
    var side_summary = main_summary.clone();
    side_summary.addClass('pl-0');
    var all_p = side_summary.find('p');
    all_p.contents().unwrap();
    var all_li = side_summary.find('li');
    all_li.addClass('pl-1');

    // scrollspy - in
    side_summary.attr('id', 'es-side-summary-mainlist');
    //side_summary.addClass('nav');
    //all_li.addClass('nav-item');
    var all_a = side_summary.find('a');
    all_a.addClass('nav-link');
    var all_ul = side_summary.find('ul');
    all_ul.addClass('pl-1');
    $('body').scrollspy({ target: '#es-side-summary-mainlist' });
    // scrollspy - out

    var summary_title = document.createElement("h4");
    summary_title.className = 'navbar-brand';
    summary_title.innerHTML = 'Sommaire';
    $(summary_title).prependTo('#es-side-summary-content');
    side_summary.appendTo('#es-side-summary-content');
    main_summary.addClass('es-subul-collapse');
}

function generate_spoilers() {
    all_secret = $('.custom-block-spoiler');
    all_secret.each(function( index ) {
    let content = $(this).html();
    $(this).html('');
    $(this).addClass('card');
    var headerText = document.createElement("button");
    var cardHeader = document.createElement("div");
    var cardBodyWrapper = document.createElement("div");
    var cardBody = document.createElement("div");
    $(headerText).text('Contenu masqué, cliquez pour afficher');
    $(headerText).addClass('btn btn-link btn-sm');
    $(headerText).attr('data-toggle', 'collapse');
    $(headerText).attr('data-target', '#collapse-' + index);
    $(headerText).attr('aria-controls', 'collapse-' + index);
    $(headerText).attr('aria-expanded', 'false');
    $(cardHeader).append(headerText);
    $(cardHeader).addClass('card-header');
    $(cardHeader).attr('id', 'spoiler-' + index);
    $(cardBody).html(content);
    $(cardBody).addClass('card-body');
    $(cardBodyWrapper).append(cardBody);
    $(cardBodyWrapper).addClass('collapse hide');
    $(cardBodyWrapper).attr('id', 'collapse-' + index)
    $(cardBodyWrapper).attr('aria-labelledby', 'spoiler-' + index)
    $(this).prepend(cardHeader);
    $(this).append(cardBodyWrapper);
    });

    $('.collapse').collapse({toggle: false});
}

create_side_summary();
generate_spoilers();
</script>
</body>

</html>

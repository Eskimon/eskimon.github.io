<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>[Annexe] Ordinateur et voie série dans un autre langage de programmation &bull; Le blog d'Eskimon</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/hljs-monokai.css" />
    <link rel="stylesheet" href="/static/css/style.css" />
    <!-- Google font -->
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/images/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="57x57" href="/static/images/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/static/images/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/static/images/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/static/images/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/static/images/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/static/images/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/static/images/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/static/images/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/images/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/static/images/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/static/images/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="/static/images/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/static/images/favicon/ms-icon-144x144.png">

    <link href="https://eskimon.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Le blog d'Eskimon Atom Feed" />
    <link href="https://eskimon.fr/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Le blog d'Eskimon RSS Feed" />

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-46353906-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-46353906-1');
    </script>

<!-- Quantcast Choice. Consent Manager Tag v2.0 (for TCF 2.0) -->
<script type="text/javascript" async="true">
(function() {
    var host = 'www.themoneytizer.com';
    var element = document.createElement('script');
    var firstScript = document.getElementsByTagName('script')[0];
    var url = 'https://quantcast.mgr.consensu.org'
        .concat('/choice/', '6Fv0cGNfc_bw8', '/', host, '/choice.js')
    var uspTries = 0;
    var uspTriesLimit = 3;
    element.async = true;
    element.type = 'text/javascript';
    element.src = url;

    firstScript.parentNode.insertBefore(element, firstScript);

    function makeStub() {
        var TCF_LOCATOR_NAME = '__tcfapiLocator';
        var queue = [];
        var win = window;
        var cmpFrame;

        function addFrame() {
            var doc = win.document;
            var otherCMP = !!(win.frames[TCF_LOCATOR_NAME]);

            if (!otherCMP) {
                if (doc.body) {
                    var iframe = doc.createElement('iframe');

                    iframe.style.cssText = 'display:none';
                    iframe.name = TCF_LOCATOR_NAME;
                    doc.body.appendChild(iframe);
                } else {
                    setTimeout(addFrame, 5);
                }
            }
            return !otherCMP;
        }

        function tcfAPIHandler() {
            var gdprApplies;
            var args = arguments;

            if (!args.length) {
                return queue;
            } else if (args[0] === 'setGdprApplies') {
                if (
                    args.length > 3 &&
                    args[2] === 2 &&
                    typeof args[3] === 'boolean'
                ) {
                    gdprApplies = args[3];
                    if (typeof args[2] === 'function') {
                        args[2]('set', true);
                    }
                }
            } else if (args[0] === 'ping') {
                var retr = {
                    gdprApplies: gdprApplies,
                    cmpLoaded: false,
                    cmpStatus: 'stub'
                };

                if (typeof args[2] === 'function') {
                    args[2](retr);
                }
            } else {
                queue.push(args);
            }
        }

        function postMessageEventHandler(event) {
            var msgIsString = typeof event.data === 'string';
            var json = {};

            try {
                if (msgIsString) {
                    json = JSON.parse(event.data);
                } else {
                    json = event.data;
                }
            } catch (ignore) {}

            var payload = json.__tcfapiCall;

            if (payload) {
                window.__tcfapi(
                    payload.command,
                    payload.version,
                    function(retValue, success) {
                        var returnMsg = {
                            __tcfapiReturn: {
                                returnValue: retValue,
                                success: success,
                                callId: payload.callId
                            }
                        };
                        if (msgIsString) {
                            returnMsg = JSON.stringify(returnMsg);
                        }
                        event.source.postMessage(returnMsg, '*');
                    },
                    payload.parameter
                );
            }
        }

        while (win) {
            try {
                if (win.frames[TCF_LOCATOR_NAME]) {
                    cmpFrame = win;
                    break;
                }
            } catch (ignore) {}

            if (win === window.top) {
                break;
            }
            win = win.parent;
        }
        if (!cmpFrame) {
            addFrame();
            win.__tcfapi = tcfAPIHandler;
            win.addEventListener('message', postMessageEventHandler, false);
        }
    };

    if (typeof module !== 'undefined') {
        module.exports = makeStub;
    } else {
        makeStub();
    }

    var uspStubFunction = function() {
        var arg = arguments;
        if (typeof window.__uspapi !== uspStubFunction) {
            setTimeout(function() {
                if (typeof window.__uspapi !== 'undefined') {
                    window.__uspapi.apply(window.__uspapi, arg);
                }
            }, 500);
        }
    };

    var checkIfUspIsReady = function() {
        uspTries++;
        if (window.__uspapi === uspStubFunction && uspTries < uspTriesLimit) {
            console.warn('USP is not accessible');
        } else {
            clearInterval(uspInterval);
        }
    };

    if (typeof window.__uspapi === 'undefined') {
        window.__uspapi = uspStubFunction;
        var uspInterval = setInterval(checkIfUspIsReady, 6000);
    }
})();
</script>
<!-- End Quantcast Choice. Consent Manager Tag v2.0 (for TCF 2.0) -->


    <meta name="description" content="Utiliser la voie série c'est bien, le faire avec un langage que l'on maîtrise c'est mieux ! Voici quelques démonstration avec des langages populaires." />

  <meta name="tags" content="arduino" />
  <meta name="tags" content="tuto" />


  <meta property="og:site_name" content="Le blog d'Eskimon">
  <meta property="og:title" content="[Annexe] Ordinateur et voie série dans un autre langage de programmation">
  <meta property="og:url" content="https://eskimon.fr/tuto-arduino-304-annexe-ordinateur-et-voie-série-dans-un-autre-langage-de-programmation">
  <meta property="og:language" content="fr_FR">
  <meta property="og:type" content="website">

  <meta property="twitter:domain" content="https://eskimon.fr/">
  <meta property="twitter:card" content="summary">
  <meta property="twitter:url" content="https://eskimon.fr/tuto-arduino-304-annexe-ordinateur-et-voie-série-dans-un-autre-langage-de-programmation">
  <meta property="twitter:title" content="[Annexe] Ordinateur et voie série dans un autre langage de programmation">
<meta property="twitter:description" content="Utiliser la voie série c'est bien, le faire avec un langage que l'on maîtrise c'est mieux ! Voici quelques démonstration avec des langages populaires.">  <meta property="twitter:site" content="SITENAME">
  <meta property="twitter:creator" content="@eskimon_fr">

  <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
  <meta name="DC.publisher" lang="fr" content="Le blog d'Eskimon" />
  <meta name="DC.creator" content="Eskimon" />
  <meta name="DC.type" content="text" />
  <meta name="DC.title" content="[Annexe] Ordinateur et voie série dans un autre langage de programmation" />
  <meta name="DC.abstract" content="[Annexe] Ordinateur et voie série dans un autre langage de programmation – Utiliser la voie série c'est bien, le faire avec un langage que l'on maîtrise c'est mieux ! Voici quelques démonstration avec des langages populaires." />
  <meta name="DC.subject" lang="fr" content="Arduino/C - La communication avec Arduino – arduino; tuto" />
<meta name="DC.description" lang="fr" content="Utiliser la voie série c'est bien, le faire avec un langage que l'on maîtrise c'est mieux ! Voici quelques démonstration avec des langages populaires." />  <meta name="DC.date" content="2013-12-10T20:03:00+01:00" />
  <meta name="DC.format" content="text/html" />
  <meta name="DC.language" content="fr" />
  <meta name="DC.rights" content="CC BY-NC-SA" />

  <script type="application/ld+json">
    [{
        "@context": "http://schema.org",
        "@type": "Article",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://eskimon.fr/tuto-arduino-304-annexe-ordinateur-et-voie-série-dans-un-autre-langage-de-programmation"
        },
        "headline": ""[Annexe] Ordinateur et voie s\u00e9rie dans un autre langage de programmation"",
        "datePublished": "2013-12-10T20:03:00+01:00",
        "image": [
            "https://eskimon.fr/static/images/logo.png"
        ],
        "author": {
            "@type": "Person",
            "name": "Eskimon",
            "image": "https://eskimon.fr/static/images/logo.png"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Eskimon",
            "logo": {
                "@type": "ImageObject",
                "url": "https://eskimon.fr/static/images/logo.png"
            }
        },
        "description": ""Utiliser la voie s\u00e9rie c\u0027est bien, le faire avec un langage que l\u0027on ma\u00eetrise c\u0027est mieux ! Voici quelques d\u00e9monstration avec des langages populaires.""
    },
    {
        "@context": "http://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [{
            "@type": "ListItem",
            "position": 1,
            "item": {
                "@id": "https://eskimon.fr/category/arduino",
                "name": ""Arduino""
            }
        }
        , {
            "@type": "ListItem",
            "position": 2,
            "item": {
                "@id": "https://eskimon.fr/subcategory/arduino/c-la-communication-avec-arduino",
                "name": ""C - La communication avec Arduino""
            }
        }
        , {
            "@type": "ListItem",
            "position": 3,
            "item": {
                "@id": "https://eskimon.fr/tuto-arduino-304-annexe-ordinateur-et-voie-série-dans-un-autre-langage-de-programmation",
                "name": ""[Annexe] Ordinateur et voie s\u00e9rie dans un autre langage de programmation""
            }
        }]
    }]
    </script>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-2080155902357792",
              enable_page_level_ads: true
         });
    </script>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light bg-secondary-l40 py-0">
    <a class="navbar-brand" href="/">
        <img src="/static/images/logo.png" width="20" height="20" alt="">
        Le blog d'Eskimon
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div></div>
        <div>
            <a class="btn btn-lg text-secondary" href="https://github.com/Eskimon" rel="nofollow" title="Mon profil Github">
                <i class="fab fa-github fa-lg"></i>
            </a>
            <a class="btn btn-lg text-secondary" href="https://twitter.com/Eskimon_fr" rel="nofollow" title="Me suivre sur Twitter">
                <i class="fab fa-twitter fa-lg"></i>
            </a>
            <a class="btn btn-lg text-secondary" href="https://twitch.tv/eskimon" rel="nofollow" title="Me suivre sur Twitch">
                <i class="fab fa-twitch fa-lg"></i>
            </a>
            <a class="btn btn-lg text-secondary" href="https://www.youtube.com/user/Eskimon49/featured" rel="nofollow" title="Les VOD sur Youtube">
                <i class="fab fa-youtube fa-lg"></i>
            </a>
            <a class="btn btn-lg text-secondary" href="https://discord.gg/9SkDWft" rel="nofollow" title="Venez participer sur Discord">
                <i class="fab fa-discord fa-lg"></i>
            </a>
        </div>
        <div class="navbar-nav">
                <a class="nav-item nav-link active" href="/category/arduino">Arduino</a>
                <a class="nav-item nav-link " href="/category/articles">Articles</a>
                <a class="nav-item nav-link " href="/category/web">Web</a>
        </div>
    </div>
</nav>
    <div class="container-fluid es-verticalfill">
<div class="row">
    <!-- Sidebar -->
    <div class="col-lg-2 d-none d-lg-block sticky-top es-scrollable pt-3 px-1 bg-light es-ul-bordered" id="es-side-summary">
        <nav class="px-2" id="es-side-summary-content">
            <!-- Summary will come here -->
        </nav>
        <hr>
        <!-- Self-promo for ebook -->
        <div class="text-center">
            <h4>Ebook Arduino !</h4>
            <a href="/ebook-tutoriel-arduino.html"><img src="/images/couverture-mini.png" alt="couverture ebook" title="couverture de l'ebook"></a>
        </div>
        <hr>
        <!-- Blog side carree -->
        <div id="es-side-summary-bot-annonce" class="text-center">
            <ins class="adsbygoogle"
                 style="display:inline-block;width:250px;height:250px"
                 data-ad-client="ca-pub-2080155902357792"
                 data-ad-slot="6115810402"></ins>
            <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>
    <!-- Main content -->
    <div class="col-md-10 col-lg-8 col-xl-7 offset-md-1 offset-lg-1 offset-xl-1 d-block pt-3" id="es-content">

        <div class="row">
            <div class="col ml-auto mr-auto text-center">
                <div class="custom-block alert alert-info">
                    <div class="custom-block-body">
                        <p>
                        Vous avez une question ? Une remarque ? N'hésitez pas à venir en parler dans le chat si je suis en cours de diffusion !
                        </p>
                        <iframe src="https://player.twitch.tv/?channel=eskimon&amp;muted=true&amp;autoplay=true&parent=eskimon.fr" scrolling="false" allowfullscreen="true" width="450" height="260" frameborder="0"></iframe>
                    </div>
                </div>
            </div>
        </div>

        <article>
            <!-- Leaderboard head article -->
            <!--
            <ins class="adsbygoogle"
                style="display:inline-block;width:970px;height:90px"
                data-ad-client="ca-pub-2080155902357792"
                data-ad-slot="7158680773"></ins>
            <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
            -->
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb bg-white">
                    <li class="breadcrumb-item"><a href="/category/arduino">Arduino</a></li>
                        <li class="breadcrumb-item"><a href="/subcategory/arduino/c-la-communication-avec-arduino">C - La communication avec Arduino</a></li>
                    <li class="breadcrumb-item active" aria-current="page">[Annexe] Ordinateur et voie série dans un autre langage de programmation</li>
                </ol>
            </nav>
            <header class="es-post-info">
                <h1 class="text-center my-4">[Annexe] Ordinateur et voie série dans un autre langage de programmation</h1>
            </header>
            <footer class="es-post-info pb-2 mb-2">
                <div class="row align-items-center">
                    <div class="col-auto mr-auto">
                        <span class="vcard author">
                            <a class="" href="/author/eskimon" rel="author">Eskimon</a>
                        </span>
                        ,
                        <time class="" datetime="2013-12-10T20:03:00+01:00" pubdate>
                            le mar. 10 décembre 2013
                        </time>
                    </div>
                    <div class="col-auto">
                        <a class="btn btn-outline-primary btn-sm" href="/tag/arduino" rel="tag">arduino</a>
                        <a class="btn btn-outline-primary btn-sm" href="/tag/tuto" rel="tag">tuto</a>
                    </div>
                </div>
            </footer>
            <button type="button" id="sidebarCollapse" class="float-right btn btn-secondary sticky-top d-block d-lg-none">
                Sommaire
            </button>
            <!-- /.post-info -->
            <div class="entry-content">
                <p>
 Maintenant que vous savez comment utiliser la voie série avec Arduino, il peut être bon de savoir comment visualiser les données envoyées avec vos propres programmes (l’émulateur terminal Windows ou le moniteur série Arduino ne comptent pas
 <img alt=":P" class="smiley" src="./static/smileys/langue.png"/>
 ). Cette annexe a donc pour but de vous montrer comment utiliser la voie série avec quelques langages de programmation. Les langages utilisés ci-dessous ont été choisis arbitrairement en fonction de mes connaissances, car je ne connais pas tous les langages possibles et une fois vu quelques exemples, il ne devrait pas être trop dur de l’utiliser avec un autre langage. Nous allons donc travailler avec :
</p>
<p>
 Afin de se concentrer sur la partie "Informatique", nous allons reprendre un programme travaillé précédemment dans le cours. Ce sera celui de l’exercice :
 <a href="http://zestedesavoir.com/tutoriels/537/arduino-premiers-pas-en-informatique-embarquee/744/la-communication-avec-arduino/3427/envoyer-et-recevoir-des-donnees-sur-la-voie-serie/#4-exercice-attention-a-la-casse">
  Attention à la casse
 </a>
 . Pensez donc à le charger dans votre carte Arduino avant de faire les tests.
 <img alt=":P" class="smiley" src="./static/smileys/langue.png"/>
</p>
<h3 id="sommaire">
 <a aria-hidden="true" href="#sommaire">
  <span class="es-autolink-heading">
  </span>
 </a>
 Sommaire
</h3>
<ul>
 <li>
  <p>
   <a href="#en-c-avec-qt">
    En C++ avec Qt
   </a>
  </p>
  <ul>
   <li>
    <p>
     <a href="#installer-qextserialport">
      Installer QextSerialPort
     </a>
    </p>
    <ul>
     <li>
      <a href="#1ère-étape-télécharger-les-sources">
       1ère étape : télécharger les sources
      </a>
     </li>
     <li>
      <a href="#compiler-la-librairie">
       Compiler la librairie
      </a>
     </li>
     <li>
      <a href="#installer-la-librairie-sous-linux">
       Installer la librairie : Sous Linux
      </a>
     </li>
     <li>
      <a href="#installer-la-librairie-sous-windows">
       Installer la librairie : Sous Windows
      </a>
     </li>
     <li>
      <a href="#infos-à-rajouter-dans-le-pro">
       Infos à rajouter dans le .pro
      </a>
     </li>
    </ul>
   </li>
   <li>
    <p>
     <a href="#les-trucs-utiles">
      Les trucs utiles
     </a>
    </p>
    <ul>
     <li>
      <a href="#linterface-utilisée">
       L’interface utilisée
      </a>
     </li>
     <li>
      <a href="#lister-les-liaisons-séries">
       Lister les liaisons séries
      </a>
     </li>
     <li>
      <a href="#gérer-une-connexion">
       Gérer une connexion
      </a>
     </li>
    </ul>
   </li>
   <li>
    <p>
     <a href="#Émettre-et-recevoir-des-données">
      Émettre et recevoir des données
     </a>
    </p>
    <ul>
     <li>
      <a href="#Émettre-des-données">
       Émettre des données
      </a>
     </li>
     <li>
      <a href="#recevoir-des-données">
       Recevoir des données
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#en-c-net">
    En C# (.Net)
   </a>
  </p>
  <ul>
   <li>
    <p>
     <a href="#les-trucs-utiles-1">
      Les trucs utiles
     </a>
    </p>
    <ul>
     <li>
      <a href="#linterface-et-les-imports">
       L’interface et les imports
      </a>
     </li>
     <li>
      <a href="#lister-les-liaisons-séries-1">
       Lister les liaisons séries
      </a>
     </li>
     <li>
      <a href="#gérer-une-connexion-1">
       Gérer une connexion
      </a>
     </li>
    </ul>
   </li>
   <li>
    <p>
     <a href="#Émettre-et-recevoir-des-données-1">
      Émettre et recevoir des données
     </a>
    </p>
    <ul>
     <li>
      <a href="#envoyer-des-données">
       Envoyer des données
      </a>
     </li>
     <li>
      <a href="#recevoir-des-données-1">
       Recevoir des données
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#en-python">
    En Python
   </a>
  </p>
  <ul>
   <li>
    <p>
     <a href="#installation">
      Installation
     </a>
    </p>
    <ul>
     <li>
      <a href="#ubuntu">
       Ubuntu
      </a>
     </li>
     <li>
      <a href="#windows">
       Windows
      </a>
     </li>
    </ul>
   </li>
   <li>
    <p>
     <a href="#utiliser-la-librairie">
      Utiliser la librairie
     </a>
    </p>
    <ul>
     <li>
      <a href="#ouvrir-un-port-série">
       Ouvrir un port série
      </a>
     </li>
     <li>
      <a href="#envoyer-des-données-1">
       Envoyer des données
      </a>
     </li>
     <li>
      <a href="#recevoir-des-données-2">
       Recevoir des données
      </a>
     </li>
    </ul>
   </li>
   <li>
    <a href="#code-exemple-complet-et-commenté">
     Code exemple complet et commenté
    </a>
   </li>
  </ul>
 </li>
</ul>
<h3 id="en-c-avec-qt">
 <a aria-hidden="true" href="#en-c-avec-qt">
  <span class="es-autolink-heading">
  </span>
 </a>
 En C++ avec Qt
</h3>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   Avant de commencer cette sous-partie, il est indispensable de connaître la programmation en C++ et savoir utiliser le framework Qt. Si vous ne connaissez pas tout cela, vous pouvez toujours aller vous renseigner avec un
   <a href="http://fr.openclassrooms.com/informatique/cours/apprenez-a-programmer-en-c">
    tutoriel C++
   </a>
   !
  </p>
 </div>
</div>
<div class="custom-block alert alert-info">
 <div class="custom-block-body">
  <p>
   Le C++, OK, mais pourquoi Qt ?
  </p>
 </div>
</div>
<p>
 J’ai choisi de vous faire travailler avec Qt pour plusieurs raisons d’ordres pratiques.
</p>
<ul>
 <li>
  Qt est multiplateforme, donc les réfractaires à Linux (ou à Windows) pourront quand même travailler.
 </li>
 <li>
  Dans le même ordre d’idée, nous allons utiliser une librairie tierce pour nous occuper de la voie série. Ainsi, aucun problème pour interfacer notre matériel que l’on soit sur un système ou un autre !
 </li>
 <li>
  Enfin, j’aime beaucoup Qt et donc je vais vous en faire profiter
  <img alt=":)" class="smiley" src="./static/smileys/smile.png"/>
 </li>
</ul>
<p>
 En fait, sachez que chaque système d’exploitation à sa manière de communiquer avec les périphériques matériels. L’utilisation d’une librairie tierce nous permet donc de faire abstraction de tout cela. Sinon il m’aurait fallu faire un tutoriel par OS, ce qui, on l’imagine facilement, serait une perte de temps (écrire trois fois
 <em>
  environ
 </em>
 les mêmes choses) et vraiment galère à maintenir.
</p>
<h4 id="installer-qextserialport">
 <a aria-hidden="true" href="#installer-qextserialport">
  <span class="es-autolink-heading">
  </span>
 </a>
 Installer QextSerialPort
</h4>
<p>
 QextSerialPort est une librairie tierce réalisée par un membre de la communauté Qt. Pour utiliser cette librairie, il faut soit la compiler, soit utiliser les sources directement dans votre projet.
</p>
<h5 id="1ère-étape-télécharger-les-sources">
 <a aria-hidden="true" href="#1ère-étape-télécharger-les-sources">
  <span class="es-autolink-heading">
  </span>
 </a>
 1ère étape : télécharger les sources
</h5>
<p>
 Le début de tout cela commence donc par récupérer les sources de la librairie. Pour cela, rendez-vous sur
 <a href="http://code.google.com/p/qextserialport/">
  la page google code
 </a>
 du projet. A partir d’ici vous avez plusieurs choix. Soit vous récupérez les sources en utilisant le gestionnaire de source mercurial (Hg). Il suffit de faire un clone du dépôt avec la commande suivante :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-bash">hg <span class="hljs-built_in">clone</span> https:// code.google.com/p/qextserialport/
</code></pre>
</div>
<p>
 Sinon, vous pouvez
 <a href="http://code.google.com/p/qextserialport/source/browse/#hg/src">
  récupérer les fichiers un par un
 </a>
 (une dizaine). C’est plus contraignant mais ça marche aussi si vous n’avez jamais utilisé de gestionnaire de sources (mais c’est vraiment plus contraignant !)
</p>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   Cette dernière méthode est vraiment
   <strong>
    déconseillée
   </strong>
   . En effet, vous vous retrouverez avec le strict minimum (fichiers sources sans exemples ou docs).
  </p>
 </div>
</div>
<p>
 La manipulation est la même sous Windows ou Linux !
</p>
<h5 id="compiler-la-librairie">
 <a aria-hidden="true" href="#compiler-la-librairie">
  <span class="es-autolink-heading">
  </span>
 </a>
 Compiler la librairie
</h5>
<p>
 Maintenant que nous avons tous nos fichiers, nous allons pouvoir compiler la librairie. Pour cela, nous allons laisser Qt travailler à notre place.
</p>
<ul>
 <li>
  Démarrez QtCreator et ouvrez le fichier .pro de QextSerialPort
 </li>
 <li>
  Compilez…
 </li>
 <li>
  C’est fini !
 </li>
</ul>
<p>
 Normalement vous avez un nouveau dossier à côté de celui des sources qui contient des exemples, ainsi que les
 <strong>
  librairies
 </strong>
 QExtSerialPort.
</p>
<h5 id="installer-la-librairie-sous-linux">
 <a aria-hidden="true" href="#installer-la-librairie-sous-linux">
  <span class="es-autolink-heading">
  </span>
 </a>
 Installer la librairie : Sous Linux
</h5>
<p>
 Une fois que vous avez compilé votre nouvelle librairie, vous allez devoir placer les fichiers aux bons endroits pour les utiliser. Les librairies, qui sont apparues dans le dossier "build" qui vient d’être créé, vont être déplacées vers le dossier /usr/lib. Les fichiers sources qui étaient avec le fichier ".pro" pour la compilation sont à copier dans un sous-dossier "QextSerialPort" dans le répertoire de travail de votre projet courant.
</p>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   A priori il y aurait un bug avec la compilation en mode release (la librairie générée ne fonctionnerait pas correctement). Je vous invite donc à compiler aussi la debug et travailler avec.
  </p>
 </div>
</div>
<h5 id="installer-la-librairie-sous-windows">
 <a aria-hidden="true" href="#installer-la-librairie-sous-windows">
  <span class="es-autolink-heading">
  </span>
 </a>
 Installer la librairie : Sous Windows
</h5>
<div class="custom-block alert alert-danger">
 <div class="custom-block-body">
  <p>
   Ce point est en cours de rédaction, merci de patienter avant sa mise en ligne.
   <img alt=":)" class="smiley" src="./static/smileys/smile.png"/>
  </p>
 </div>
</div>
<h5 id="infos-à-rajouter-dans-le-pro">
 <a aria-hidden="true" href="#infos-à-rajouter-dans-le-pro">
  <span class="es-autolink-heading">
  </span>
 </a>
 Infos à rajouter dans le .pro
</h5>
<p>
 Dans votre nouveau projet Qt pour traiter avec la voie série, vous aller rajouter les lignes suivantes à votre .pro :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-text">INCLUDEPATH += QextSerialPort

CONFIG(debug, debug|release):LIBS += -lqextserialportd
else:LIBS += -lqextserialport
</code></pre>
 </div>
 <figcaption>
  Ajout au .pro
 </figcaption>
</figure>
<p>
 La ligne "INCLUDEPATH" représente le dossier où vous avez mis les fichiers sources de QextSerialPort. Les deux autres lignes font le lien vers les librairies copiées plus tôt (les .so ou les .dll selon votre OS).
</p>
<h4 id="les-trucs-utiles">
 <a aria-hidden="true" href="#les-trucs-utiles">
  <span class="es-autolink-heading">
  </span>
 </a>
 Les trucs utiles
</h4>
<h5 id="linterface-utilisée">
 <a aria-hidden="true" href="#linterface-utilisée">
  <span class="es-autolink-heading">
  </span>
 </a>
 L’interface utilisée
</h5>
<p>
 Comme expliqué dans l’introduction, nous allons toujours travailler sur le même exercice et juste changer le langage étudié. Voici donc l’interface sur laquelle nous allons travailler, et quels sont les noms et les types d’objets instanciés :
</p>
<figure>
 <img alt="interface Qt" src="./images/uploaded/tuto-arduino-304-annexe-ordinateur-et-voie-série-dans-un-autre-langage-de-programmation/interface-qt.png"/>
 <figcaption>
  interface Qt
 </figcaption>
</figure>
<p>
 Cette interface possède deux parties importantes : La
 <strong>
  gestion de la connexion
 </strong>
 (en haut) et
 <strong>
  l’échange de résultat
 </strong>
 (milieu -&gt; émission, bas -&gt; réception). Dans la partie supérieure, nous allons choisir le port de l’ordinateur sur lequel communiquer ainsi que la vitesse de cette communication. Ensuite, deux boîtes de texte sont présentes. L’une pour écrire du texte à émettre, et l’autre affichant le texte reçu. Voici les noms que j’utiliserai dans mon code :
</p>
<div class="text-center">
 <figure>
  <div class="table-wrapper">
   <table class=" table table-bordered table-striped">
    <thead>
     <tr>
      <th>
       Widget
      </th>
      <th>
       Nom
      </th>
      <th>
       Rôle
      </th>
     </tr>
    </thead>
    <tbody>
     <tr>
      <td>
       QComboBox
      </td>
      <td>
       comboPort
      </td>
      <td>
       Permet de choisir le port série
      </td>
     </tr>
     <tr>
      <td>
       QComboBox
      </td>
      <td>
       comboVitesse
      </td>
      <td>
       Permet de choisir la vitesse de communication
      </td>
     </tr>
     <tr>
      <td>
       QButton
      </td>
      <td>
       btnconnexion
      </td>
      <td>
       (Dé)Connecte la voie série (bouton "checkable")
      </td>
     </tr>
     <tr>
      <td>
       QTextEdit
      </td>
      <td>
       boxEmission
      </td>
      <td>
       Nous écrirons ici le texte à envoyer
      </td>
     </tr>
     <tr>
      <td>
       QTextEdit
      </td>
      <td>
       boxReception
      </td>
      <td>
       Ici apparaitra le texte à recevoir
      </td>
     </tr>
    </tbody>
   </table>
  </div>
  <figcaption>
   Liste des widgets utilisé
  </figcaption>
 </figure>
</div>
<h5 id="lister-les-liaisons-séries">
 <a aria-hidden="true" href="#lister-les-liaisons-séries">
  <span class="es-autolink-heading">
  </span>
 </a>
 Lister les liaisons séries
</h5>
<p>
 Avant de créer et d’utiliser l’objet pour gérer la voie série, nous allons en voir quelques-uns pouvant être utiles. Tout d’abord, nous allons apprendre à obtenir la liste des ports série présents sur notre machine. Pour cela, un objet a été créé spécialement, il s’agit de
 <code>
  QextPortInfo
 </code>
 . Voici un exemple de code leur permettant de fonctionner ensemble :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-comment">// L'objet mentionnant les infos</span>
QextSerialEnumerator enumerateur;
<span class="hljs-comment">// on met ces infos dans une liste</span>
QList&lt;QextPortInfo&gt; ports = enumerateur.getPorts();
</code></pre>
 </div>
 <figcaption>
  Récuperation de la liste des ports séries
 </figcaption>
</figure>
<p>
 Une fois que nous avons récupéré une énumération de tous les ports, nous allons pouvoir les ajouter au combobox qui est censé les afficher (comboPort). Pour cela on va parcourir la liste construite précédemment et ajouter à chaque fois une item dans le menu déroulant :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-comment">// on parcourt la liste des ports</span>
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;ports.size(); i++)
   ui-&gt;ComboPort-&gt;addItem(ports.at(i).physName);
</code></pre>
 </div>
 <figcaption>
  Remplissage du combobox des ports séries
 </figcaption>
</figure>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   Les ports sont nommés différemment sous Windows et Linux, ne soyez donc pas surpris avec mes captures d’écrans, elles viennent toutes de Linux.
  </p>
 </div>
</div>
<p>
 Une fois que la liste des ports est faite (attention, certains ports ne sont connectés à rien), on va construire la liste des vitesses, pour se laisser le choix le jour où l’on voudra faire une application à une vitesse différente. Cette opération n’est pas très compliquée puisqu’elle consiste simplement à ajouter des items dans la liste déroulante "comboVitesse".
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp">ui-&gt;comboVitesse-&gt;addItem(<span class="hljs-string">"300"</span>);
ui-&gt;comboVitesse-&gt;addItem(<span class="hljs-string">"1200"</span>);
ui-&gt;comboVitesse-&gt;addItem(<span class="hljs-string">"2400"</span>);
ui-&gt;comboVitesse-&gt;addItem(<span class="hljs-string">"4800"</span>);
ui-&gt;comboVitesse-&gt;addItem(<span class="hljs-string">"9600"</span>);
ui-&gt;comboVitesse-&gt;addItem(<span class="hljs-string">"14400"</span>);
ui-&gt;comboVitesse-&gt;addItem(<span class="hljs-string">"19200"</span>);
ui-&gt;comboVitesse-&gt;addItem(<span class="hljs-string">"38400"</span>);
ui-&gt;comboVitesse-&gt;addItem(<span class="hljs-string">"57600"</span>);
ui-&gt;comboVitesse-&gt;addItem(<span class="hljs-string">"115200"</span>);
</code></pre>
 </div>
 <figcaption>
  Remplissage du combobox des vitesses
 </figcaption>
</figure>
<p>
 Votre interface est maintenant prête. En la démarrant maintenant vous devriez être en mesure de voir s’afficher les noms des ports séries existant sur l’ordinateur ainsi que les vitesses. Un clic sur le bouton ne fera évidemment rien puisque son comportement n’est pas encore implémenté.
</p>
<h5 id="gérer-une-connexion">
 <a aria-hidden="true" href="#gérer-une-connexion">
  <span class="es-autolink-heading">
  </span>
 </a>
 Gérer une connexion
</h5>
<p>
 Lorsque tous les détails concernant l’interface sont terminés, nous pouvons passer au cœur de l’application : la
 <em>
  communication série
 </em>
 . La première étape pour pouvoir faire une communication est de se connecter (tout comme vous vous connectez sur une borne WiFi avant de communiquer et d’échanger des données avec cette dernière). C’est le rôle de notre bouton de connexion. A partir du système de slot automatique, nous allons créer une fonction qui va recevoir le clic de l’utilisateur. Cette fonction instanciera un objet QextSerialPort pour créer la communication, règlera cet objet et enfin ouvrira le canal. Dans le cas où le bouton était déjà coché (puisqu’il sera "checkable" rappelons-le) nous ferons la déconnexion, puis la destruction de l’objet QextSerialPort créé auparavant. Pour commencer nous allons donc déclarer les objets et méthodes utiles dans le .h de la classe avec laquelle nous travaillons :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-cpp"><span class="hljs-keyword">private</span>:
<span class="hljs-comment">// l'objet représentant le port</span>
QextSerialPort * port;

<span class="hljs-comment">// une fonction utile que j'expliquerais après</span>
<span class="hljs-function">BaudRateType <span class="hljs-title">getBaudRateFromString</span><span class="hljs-params">(QString baudRate)</span></span>;

<span class="hljs-keyword">private</span> slots:
<span class="hljs-comment">// le slot automatique du bouton de connexion</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">on_btnconnexion_clicked</span><span class="hljs-params">()</span></span>;
</code></pre>
</div>
<p>
 Ensuite, il nous faudra instancier le slot du bouton afin de traduire un comportement. Pour rappel, il devra :
</p>
<ul>
 <li>
  Créer l’objet "port" de type QextSerialPort
 </li>
 <li>
  Le régler avec les bons paramètres
 </li>
 <li>
  Ouvrir la voie série
 </li>
</ul>
<p>
 Dans le cas où la voie série est déjà ouverte (le bouton est déjà appuyé) on devra la fermer et détruire l’objet. Voici le code commenté permettant l’ouverture de la voie série (quelques précisions viennent ensuite) :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-comment">// Slot pour le click sur le bouton de connexion</span>
<span class="hljs-keyword">void</span> Fenetre::on_btnconnexion_clicked() {
    <span class="hljs-comment">// deux cas de figures à gérer,</span>
    <span class="hljs-comment">// soit on coche (connecte), soit on décoche (déconnecte)</span>

    <span class="hljs-comment">// on coche -&gt; connexion</span>
    <span class="hljs-keyword">if</span>(ui-&gt;btnconnexion-&gt;isChecked()) {
        <span class="hljs-comment">// on essaie de faire la connexion avec la carte Arduino</span>
        <span class="hljs-comment">// on commence par créer l'objet port série</span>
        port = <span class="hljs-keyword">new</span> QextSerialPort();
        <span class="hljs-comment">// on règle le port utilisé (sélectionné dans la liste déroulante)</span>
        port-&gt;setPortName(ui-&gt;ComboPort-&gt;currentText());
        <span class="hljs-comment">// on règle la vitesse utilisée</span>
        port-&gt;setBaudRate(
            getBaudRateFromString(ui-&gt;comboVitesse-&gt;currentText()));
        <span class="hljs-comment">// quelques règlages pour que tout marche bien</span>
        port-&gt;setParity(PAR_NONE);<span class="hljs-comment">// parité</span>
        port-&gt;setStopBits(STOP_1);<span class="hljs-comment">// nombre de bits de stop</span>
        port-&gt;setDataBits(DATA_8);<span class="hljs-comment">// nombre de bits de données</span>
        port-&gt;setFlowControl(FLOW_OFF);<span class="hljs-comment">// pas de contrôle de flux</span>
        <span class="hljs-comment">// on démarre !</span>
        port-&gt;open(QextSerialPort::ReadWrite);
        <span class="hljs-comment">// change le message du bouton</span>
        ui-&gt;btnconnexion-&gt;setText(<span class="hljs-string">"Deconnecter"</span>);

        <span class="hljs-comment">// on fait la connexion pour pouvoir obtenir les évènements</span>
        connect(port,SIGNAL(readyRead()), <span class="hljs-keyword">this</span>, SLOT(readData()));
        connect(ui-&gt;boxEmission,SIGNAL(textChanged()),<span class="hljs-keyword">this</span>,SLOT(sendData()));
    }
    <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// on se déconnecte de la carte Arduino</span>
        port-&gt;close();
        <span class="hljs-comment">// puis on détruit l'objet port série devenu inutile</span>
        <span class="hljs-keyword">delete</span> port;
        ui-&gt;btnconnexion-&gt;setText(<span class="hljs-string">"Connecter"</span>);
    }
}
</code></pre>
 </div>
 <figcaption>
  Gestion du bouton de connexion
 </figcaption>
</figure>
<p>
 Ce code n’est pas très compliqué à comprendre. Cependant quelques points méritent votre attention. Pour commencer, pour régler la vitesse du port série on fait appel à la fonction "setBaudRate". Cette fonction prend un paramètre de type BaudRateType qui fait partie d’une énumération de QextSerialPort. Afin de faire le lien entre le comboBox qui possède des chaines et le type particulier attendu, on crée et utilise la fonction "getBaudRateFromString". A partir d’un simple
 <code>
  BaudRateType
 </code>
 .
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp">BaudRateType Fenetre::getBaudRateFromString(QString baudRate) {
    <span class="hljs-keyword">int</span> vitesse = baudRate.toInt();
    <span class="hljs-keyword">switch</span>(vitesse) {
        <span class="hljs-keyword">case</span>(<span class="hljs-number">300</span>):<span class="hljs-keyword">return</span> BAUD300;
        <span class="hljs-keyword">case</span>(<span class="hljs-number">1200</span>):<span class="hljs-keyword">return</span> BAUD1200;
        <span class="hljs-keyword">case</span>(<span class="hljs-number">2400</span>):<span class="hljs-keyword">return</span> BAUD2400;
        <span class="hljs-keyword">case</span>(<span class="hljs-number">4800</span>):<span class="hljs-keyword">return</span> BAUD4800;
        <span class="hljs-keyword">case</span>(<span class="hljs-number">9600</span>):<span class="hljs-keyword">return</span> BAUD9600;
        <span class="hljs-keyword">case</span>(<span class="hljs-number">14400</span>):<span class="hljs-keyword">return</span> BAUD14400;
        <span class="hljs-keyword">case</span>(<span class="hljs-number">19200</span>):<span class="hljs-keyword">return</span> BAUD19200;
        <span class="hljs-keyword">case</span>(<span class="hljs-number">38400</span>):<span class="hljs-keyword">return</span> BAUD38400;
        <span class="hljs-keyword">case</span>(<span class="hljs-number">57600</span>):<span class="hljs-keyword">return</span> BAUD57600;
        <span class="hljs-keyword">case</span>(<span class="hljs-number">115200</span>):<span class="hljs-keyword">return</span> BAUD115200;
        <span class="hljs-keyword">default</span>:<span class="hljs-keyword">return</span> BAUD9600;
    }
}
</code></pre>
 </div>
 <figcaption>
  Gestion du changement de vitesse
 </figcaption>
</figure>
<p>
 Un autre point important à regarder est l’utilisation de la fonction open() de l’objet QextSerialPort. En effet, il existe plusieurs façons d’ouvrir un port série :
</p>
<ul>
 <li>
  En lecture seule
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mo>
         →
        </mo>
       </mrow>
       <annotation encoding="application/x-tex">
        \to
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.36687em;">
     </span>
     <span class="strut bottom" style="height:0.36687em;vertical-align:0em;">
     </span>
     <span class="base">
      <span class="mrel">
       →
      </span>
     </span>
    </span>
   </span>
  </span>
  QextSerialPort::ReadOnly
 </li>
 <li>
  En écriture seule
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mo>
         →
        </mo>
       </mrow>
       <annotation encoding="application/x-tex">
        \to
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.36687em;">
     </span>
     <span class="strut bottom" style="height:0.36687em;vertical-align:0em;">
     </span>
     <span class="base">
      <span class="mrel">
       →
      </span>
     </span>
    </span>
   </span>
  </span>
  QextSerialPort::WriteOnly
 </li>
 <li>
  En lecture/écriture
  <span class="inlineMath">
   <span class="katex">
    <span class="katex-mathml">
     <math>
      <semantics>
       <mrow>
        <mo>
         →
        </mo>
       </mrow>
       <annotation encoding="application/x-tex">
        \to
       </annotation>
      </semantics>
     </math>
    </span>
    <span aria-hidden="true" class="katex-html">
     <span class="strut" style="height:0.36687em;">
     </span>
     <span class="strut bottom" style="height:0.36687em;vertical-align:0em;">
     </span>
     <span class="base">
      <span class="mrel">
       →
      </span>
     </span>
    </span>
   </span>
  </span>
  QextSerialPort::ReadWrite
 </li>
</ul>
<p>
 Ensuite, on connecte simplement les signaux émis par la voie série et par la boite de texte servant à l’émission (que l’on verra juste après). Enfin, lorsque l’utilisateur re-clic sur le bouton, on passe dans le
 <code>
  NULL
 </code>
 .
</p>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   Ce code présente le principe et n’est pas parfait ! Il faudrait par exemple s’assurer que le port est bien ouvert avant d’envoyer des données (faire un test
   <code>
    if(port-&gt;isOpen())
   </code>
   par exemple).
  </p>
 </div>
</div>
<h4 id="Émettre-et-recevoir-des-données">
 <a aria-hidden="true" href="#Émettre-et-recevoir-des-données">
  <span class="es-autolink-heading">
  </span>
 </a>
 Émettre et recevoir des données
</h4>
<p>
 Maintenant que la connexion est établie, nous allons pouvoir envoyer et recevoir des données. Ce sera le rôle de deux slots qui ont été brièvement évoqués dans la fonction
 <code>
  connect()
 </code>
 du code de connexion précédent.
</p>
<h5 id="Émettre-des-données">
 <a aria-hidden="true" href="#Émettre-des-données">
  <span class="es-autolink-heading">
  </span>
 </a>
 Émettre des données
</h5>
<p>
 L’émission des données se fera dans le slot "sendData". Ce slot sera appelé à chaque fois qu’il y aura une modification du contenu de la boîte de texte "boxEmission". Pour l’application concernée (l’envoi d’un seul caractère), il nous suffit de chercher le dernier caractère tapé. On récupère donc le dernier caractère du texte contenu dans la boite avant de l’envoyer sur la voie série. L’envoi de texte se fait à partir de la fonction
 <code>
  toAscii()
 </code>
 et on peut donc les utiliser directement. Voici le code qui illustre toutes ces explications (ne pas oublier de mettre les déclarations des slots dans le .h) :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-keyword">void</span> Fenetre::sendData() {
    <span class="hljs-comment">// On récupère le dernier caractère tapé</span>
    QString caractere = ui-&gt;boxEmission-&gt;toPlainText().right(<span class="hljs-number">1</span>);
    <span class="hljs-comment">// si le port est instancié (donc ouvert a priori)</span>
    <span class="hljs-keyword">if</span>(port != <span class="hljs-literal">NULL</span>)
        port-&gt;write(caractere.toAscii());
}
</code></pre>
 </div>
 <figcaption>
  Envoi de données
 </figcaption>
</figure>
<h5 id="recevoir-des-données">
 <a aria-hidden="true" href="#recevoir-des-données">
  <span class="es-autolink-heading">
  </span>
 </a>
 Recevoir des données
</h5>
<p>
 Le programme étudié est censé nous répondre en renvoyant le caractère émis mais dans une
 <em>
  casse opposée
 </em>
 (majuscule contre minuscule et vice versa). En temps normal, deux politiques différentes s’appliquent pour savoir si des données sont arrivées. La première est d’aller voir de manière régulière (ou pas) si des caractères sont présents dans le tampon de réception de la voie série. Cette méthode dite de *Polling n’est pas très fréquemment utilisée. La seconde est de déclencher un évènement lorsque des données arrivent sur la voie série. C’est la forme qui est utilisée par défaut par l’objet
 <code>
  readyRead()
 </code>
 ) est émis par l’objet et peut donc être connecté à un slot. Pour changer le mode de fonctionnement, il faut utiliser la méthode
 <code>
  QextSerialPort::EventDriven
 </code>
 pour la seconde (par défaut). Comme la connexion entre le signal et le slot est créée dans la fonction de connexion, il ne nous reste qu’à écrire le comportement du slot de réception lorsqu’une donnée arrive. Le travail est simple et se résume en deux étapes :
</p>
<ul>
 <li>
  Lire le caractère reçu grâce à la fonction
  <code>
   QextSerialPort
  </code>
 </li>
 <li>
  Le copier dans la boite de texte "réception"
 </li>
</ul>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-cpp"><span class="hljs-keyword">void</span> Fenetre::readData() {
    QByteArray <span class="hljs-built_in">array</span> = port-&gt;readAll();
    ui-&gt;boxReception-&gt;insertPlainText(<span class="hljs-built_in">array</span>);
}
</code></pre>
 </div>
 <figcaption>
  Réception de données
 </figcaption>
</figure>
<p>
 Et voilà, vous êtes maintenant capable de travailler avec la voie série dans vos programmes Qt en C++. Au risque de me répéter, je suis conscient qu’il y a des lacunes en terme de "sécurité" et d’efficacité. Ce code a pour but de vous montrer les bases de la classe pour que vous puissiez continuer ensuite votre apprentissage. En effet, la programmation C++/Qt n’est pas le sujet de ce tutoriel.
 <img alt=":ninja:" class="smiley" src="./static/smileys/ninja.png"/>
 Nous vous serons donc reconnaissants de ne pas nous harceler de commentaires relatifs au tuto pour nous dire "bwaaaa c’est mal codéééééé". Merci !
 <img alt=":)" class="smiley" src="./static/smileys/smile.png"/>
</p>
<h3 id="en-c-net">
 <a aria-hidden="true" href="#en-c-net">
  <span class="es-autolink-heading">
  </span>
 </a>
 En C# (.Net)
</h3>
<div class="custom-block alert alert-warning">
 <div class="custom-block-body">
  <p>
   Dans cette partie (comme dans les précédentes) je pars du principe que vous connaissez le langage et avez déjà dessiné des interfaces et créé des actions sur des boutons par exemple. Cette sous-partie n’est pas là pour vous apprendre le C# !
  </p>
 </div>
</div>
<p>
 Là encore je vais reprendre la même structure que les précédentes sous-parties.
</p>
<h4 id="les-trucs-utiles-1">
 <a aria-hidden="true" href="#les-trucs-utiles-1">
  <span class="es-autolink-heading">
  </span>
 </a>
 Les trucs utiles
</h4>
<h5 id="linterface-et-les-imports">
 <a aria-hidden="true" href="#linterface-et-les-imports">
  <span class="es-autolink-heading">
  </span>
 </a>
 L’interface et les imports
</h5>
<p>
 Voici tout de suite l’interface utilisée ! Je vous donnerai juste après le nom que j’utilise pour chacun des composants (et tant qu’à faire je vous donnerai aussi leurs types).
</p>
<figure>
 <img alt="L'interface en C#" src="./images/uploaded/tuto-arduino-304-annexe-ordinateur-et-voie-série-dans-un-autre-langage-de-programmation/linterface-en-c.jpg"/>
 <figcaption>
  L'interface en C#
 </figcaption>
</figure>
<p>
 Comme cette interface est la même pour tout ce chapitre, nous retrouvons comme d’habitude le bandeau pour gérer la connexion ainsi que les deux boîtes de texte pour l’émission et la réception des données. Voici les types d’objets et leurs noms pour le bandeau de connexion :
</p>
<div class="text-center">
 <figure>
  <div class="table-wrapper">
   <table class=" table table-bordered table-striped">
    <thead>
     <tr>
      <th>
       Composant
      </th>
      <th>
       Nom
      </th>
      <th>
       Rôle
      </th>
     </tr>
    </thead>
    <tbody>
     <tr>
      <td>
       System.Windows.Forms.ComboBox
      </td>
      <td>
       comboPort
      </td>
      <td>
       Permet de choisir le port série
      </td>
     </tr>
     <tr>
      <td>
       System.Windows.Forms.ComboBox
      </td>
      <td>
       comboVitesse
      </td>
      <td>
       Permet de choisir la vitesse de communication
      </td>
     </tr>
     <tr>
      <td>
       System.Windows.Forms.Button
      </td>
      <td>
       btnConnexion
      </td>
      <td>
       (Dé)Connecte la voie série (bouton "checkable")
      </td>
     </tr>
     <tr>
      <td>
       System.Windows.Forms.TextBox
      </td>
      <td>
       boxEmission
      </td>
      <td>
       Nous écrirons ici le texte à envoyer
      </td>
     </tr>
     <tr>
      <td>
       System.Windows.Forms.TextBox
      </td>
      <td>
       boxReception
      </td>
      <td>
       Ici apparaitra le texte à recevoir
      </td>
     </tr>
    </tbody>
   </table>
  </div>
  <figcaption>
   Liste des widgets utilisé
  </figcaption>
 </figure>
</div>
<p>
 Avant de commencer les choses marrantes, nous allons d’abord devoir ajouter une librairie : celle des liaisons séries. Elle se nomme simplement
 <code>
  using System.IO.Ports;
 </code>
 . Nous allons en profiter pour rajouter une variable membre de la classe de type SerialPort que j’appellerai "port". Cette variable représentera, vous l’avez deviné, notre port série !
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-csharp">SerialPort port
</code></pre>
</div>
<p>
 Maintenant que tous les outils sont prêts, nous pouvons commencer !
</p>
<h5 id="lister-les-liaisons-séries-1">
 <a aria-hidden="true" href="#lister-les-liaisons-séries-1">
  <span class="es-autolink-heading">
  </span>
 </a>
 Lister les liaisons séries
</h5>
<p>
 La première étape sera de lister l’ensemble des liaisons séries sur l’ordinateur. Pour cela nous allons nous servir d’une fonction statique de la classe
 <code>
  String
 </code>
 . Chaque case du tableau sera une chaîne de caractère comportant le nom d’une voie série. Une fois que nous avons ce tableau, nous allons l’ajouter sur l’interface, dans la liste déroulante prévue à cet effet pour pouvoir laisser le choix à l’utilisateur au démarrage de l’application. Dans le même élan, on va peupler la liste déroulante des vitesses avec quelques-unes des vitesses les plus courantes. Voici le code de cet ensemble. Personnellement je l’ai ajouté dans la méthode
 <code>
  InitializeComponent()
 </code>
 qui charge les composants.
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-csharp"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Form1_Load</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, EventArgs e</span>)
</span>{
    <span class="hljs-comment">// on commence par lister les voies séries présentes</span>
    String[] ports = SerialPort.GetPortNames(); <span class="hljs-comment">// fonction statique</span>
    <span class="hljs-comment">// on ajoute les ports au combo box</span>
    <span class="hljs-keyword">foreach</span> (String s <span class="hljs-keyword">in</span> ports)
        comboPort.Items.Add(s);

    <span class="hljs-comment">// on ajoute les vitesses au combo des vitesses</span>
    comboVitesse.Items.Add(<span class="hljs-string">"300"</span>);
    comboVitesse.Items.Add(<span class="hljs-string">"1200"</span>);
    comboVitesse.Items.Add(<span class="hljs-string">"2400"</span>);
    comboVitesse.Items.Add(<span class="hljs-string">"4800"</span>);
    comboVitesse.Items.Add(<span class="hljs-string">"9600"</span>);
    comboVitesse.Items.Add(<span class="hljs-string">"14400"</span>);
    comboVitesse.Items.Add(<span class="hljs-string">"19200"</span>);
    comboVitesse.Items.Add(<span class="hljs-string">"38400"</span>);
    comboVitesse.Items.Add(<span class="hljs-string">"57600"</span>);
    comboVitesse.Items.Add(<span class="hljs-string">"115200"</span>);
}
</code></pre>
 </div>
 <figcaption>
  Intialisation du combobox des vitesses
 </figcaption>
</figure>
<p>
 Si vous lancez votre programme maintenant avec la carte Arduino connectée, vous devriez avoir le choix des vitesses mais aussi d’au moins un port série. Si ce n’est pas le cas, il faut trouver pourquoi avant de passer à la suite (Vérifiez que la carte est bien connectée par exemple).
</p>
<h5 id="gérer-une-connexion-1">
 <a aria-hidden="true" href="#gérer-une-connexion-1">
  <span class="es-autolink-heading">
  </span>
 </a>
 Gérer une connexion
</h5>
<p>
 Une fois que la carte est reconnue et que l’on voit bien son port dans la liste déroulante, nous allons pouvoir ouvrir le port pour établir le canal de communication entre Arduino et l’ordinateur. Comme vous vous en doutez surement, la fonction que nous allons écrire est celle du clic sur le bouton. Lorsque nous cliquons sur le bouton de connexion, deux actions peuvent être effectuées selon l’état précédent. Soit nous nous connectons, soit nous nous déconnectons. Les deux cas seront gérés en regardant le texte contenu dans le bouton ("Connecter" ou "Deconnecter"). Dans le cas de la déconnexion, il suffit de fermer le port à l’aide de la méthode
 <code>
  close()
 </code>
 . Dans le cas de la connexion, plusieurs choses sont à faire. Dans l’ordre, nous allons commencer par instancier un nouvel objet de type
 <code>
  BaudRate
 </code>
 et ainsi de suite. Voici le code commenté pour faire tout cela. Il y a cependant un dernier point évoqué rapidement juste après et sur lequel nous reviendrons plus tard.
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-csharp"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">btnConnexion_Click</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, EventArgs e</span>)
</span>{
    <span class="hljs-comment">// on gère la connexion/déconnexion</span>
    <span class="hljs-keyword">if</span> (btnConnexion.Text == <span class="hljs-string">"Connecter"</span>) <span class="hljs-comment">// alors on connecte</span>
    {
        <span class="hljs-comment">// crée un nouvel objet voie série</span>
        port = <span class="hljs-keyword">new</span> SerialPort();
        <span class="hljs-comment">// règle la voie série</span>
        <span class="hljs-comment">// parse en int le combo des vitesses</span>
        port.BaudRate = <span class="hljs-keyword">int</span>.Parse(comboVitesse.SelectedItem.ToString());
        port.DataBits = <span class="hljs-number">8</span>;
        port.StopBits = StopBits.One;
        port.Parity = Parity.None;
        <span class="hljs-comment">// récupère le nom sélectionné</span>
        port.PortName = comboPort.SelectedItem.ToString();

        <span class="hljs-comment">// ajoute un gestionnaire de réception</span>
        <span class="hljs-comment">// pour la réception de donnée sur la voie série</span>
        port.DataReceived +=
            <span class="hljs-keyword">new</span> SerialDataReceivedEventHandler(DataReceivedHandler);

        port.Open(); <span class="hljs-comment">// ouvre la voie série</span>

        btnConnexion.Text = <span class="hljs-string">"Deconnecter"</span>;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-comment">// sinon on déconnecte</span>
    {
        port.Close(); <span class="hljs-comment">// ferme la voie série</span>
        btnConnexion.Text = <span class="hljs-string">"Connecter"</span>;
    }
}
</code></pre>
 </div>
 <figcaption>
  Gestion du bouton de connexion
 </figcaption>
</figure>
<p>
 Le point qui peut paraître étrange est la ligne 16, avec la propriété
 <code>
  Handler()
 </code>
 qui devra être appelée lorsque des données arriveront. Je vais vous demander d’être patient, nous en reparlerons plus tard lorsque nous verrons la réception de données. A ce stade du développement, lorsque vous lancez votre application vous devriez pouvoir sélectionner une voie série, une vitesse, et cliquer sur "Connecter" et "Déconnecter" sans aucun bug.
</p>
<h4 id="Émettre-et-recevoir-des-données-1">
 <a aria-hidden="true" href="#Émettre-et-recevoir-des-données-1">
  <span class="es-autolink-heading">
  </span>
 </a>
 Émettre et recevoir des données
</h4>
<p>
 La voie série est prête à être utilisée ! La connexion est bonne, il ne nous reste plus qu’à envoyer les données et espérer avoir quelque chose en retour.
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
</p>
<h5 id="envoyer-des-données">
 <a aria-hidden="true" href="#envoyer-des-données">
  <span class="es-autolink-heading">
  </span>
 </a>
 Envoyer des données
</h5>
<p>
 Pour envoyer des données, une fonction toute prête existe pour les objets
 <code>
  char
 </code>
 qui serait envoyé un par un. Dans notre cas d’utilisation, c’est ce deuxième cas qui nous intéresse. Nous allons donc implémenter la méthode
 <code>
  TextChanged
 </code>
 du composant "boxEmission" afin de détecter chaque caractère entré par l’utilisateur. Ainsi, nous enverrons chaque nouveau caractère sur la voie série, un par un. Le code suivant, commenté, vous montre la voie à suivre.
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-csharp"><span class="hljs-comment">// lors d'un envoi de caractère</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">boxEmission_TextChanged</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, EventArgs e</span>)
</span>{
    <span class="hljs-comment">// met le dernier caractère dans un tableau avec une seule case le contenant</span>
    <span class="hljs-keyword">char</span>[] car = <span class="hljs-keyword">new</span> <span class="hljs-keyword">char</span>[] {boxEmission.Text[boxEmission.TextLength<span class="hljs-number">-1</span>]};
    <span class="hljs-comment">// on s'assure que le port est existant et ouvert</span>
    <span class="hljs-keyword">if</span>(port!=<span class="hljs-literal">null</span> &amp;&amp; port.IsOpen)
    {
        <span class="hljs-comment">// envoie le tableau de caractère,</span>
        <span class="hljs-comment">// depuis la position 0, et envoie 1 seul élément</span>
        port.Write(car,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>);
    }
}
</code></pre>
 </div>
 <figcaption>
  Envoi de données
 </figcaption>
</figure>
<h5 id="recevoir-des-données-1">
 <a aria-hidden="true" href="#recevoir-des-données-1">
  <span class="es-autolink-heading">
  </span>
 </a>
 Recevoir des données
</h5>
<p>
 La dernière étape pour pouvoir gérer de manière complète notre voie série est de pouvoir afficher les caractères reçus. Cette étape est un petit peu plus compliquée. Tout d’abord, revenons à l’explication commencée un peu plus tôt. Lorsque nous démarrons la connexion et créons l’objet
 <code>
  boxReception
 </code>
 . Dans l’idéal nous aimerions faire de la façon suivante :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-csharp"><span class="hljs-comment">// gestionnaire de la réception de caractère</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DataReceivedHandler</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, SerialDataReceivedEventArgs e</span>)
</span>{
    String texte = port.ReadExisting();
    boxReception.Text += texte;
}
</code></pre>
 </div>
 <figcaption>
  Réception de données
 </figcaption>
</figure>
<p>
 Cependant, les choses ne sont pas aussi simples cette fois-ci. En effet, pour des raisons de sécurité sur les processus, C# interdit que le texte d’un composant (
 <code>
  boxReception
 </code>
 ) soit modifié de manière asynchrone, quand les données arrivent. Pour contourner cela, nous devons créer une méthode "déléguée" à qui on passera notre texte à afficher et qui se chargera d’afficher le texte quand l’interface sera prête. Pour créer cette déléguée, nous allons commencer par rajouter une méthode dite de
 <em>
  callback
 </em>
 pour gérer la mise à jour du texte. La ligne suivante est donc à ajouter dans la classe, comme membre :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-csharp"><span class="hljs-comment">// une déléguée pour pouvoir mettre à jour le texte de la boite de réception</span>
<span class="hljs-comment">// de manière "thread-safe"</span>
<span class="hljs-function"><span class="hljs-keyword">delegate</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetTextCallback</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> text</span>)</span>;
</code></pre>
</div>
<p>
 Le code de la réception devient alors le suivant :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-csharp"><span class="hljs-comment">// gestionnaire de la réception de caractère</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DataReceivedHandler</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, SerialDataReceivedEventArgs e</span>)
</span>{
    String texte = port.ReadExisting();
    <span class="hljs-comment">// boxReception.Text += texte;</span>
    SetText(texte);
}

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetText</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> text</span>)
</span>{
    <span class="hljs-keyword">if</span> (boxReception.InvokeRequired)
    {
        SetTextCallback d = <span class="hljs-keyword">new</span> SetTextCallback(SetText);
        boxReception.Invoke(d, <span class="hljs-keyword">new</span> <span class="hljs-keyword">object</span>[] { text });
    }
    <span class="hljs-keyword">else</span>
    {
        boxReception.Text += text;
    }
}
</code></pre>
 </div>
 <figcaption>
  Réception de données avec la déléguée
 </figcaption>
</figure>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   Je suis désolé si mes informations sont confuses. Je ne suis malheureusement pas un maitre dans l’art des threads UI de C#. Cependant, un tas de documentation mieux expliqué existe sur internet si vous voulez plus de détails.
  </p>
 </div>
</div>
<p>
 Une fois tout cela instancié, vous devriez avoir un terminal voie série tout beau fait par vous même ! Libre à vous maintenant toutes les cartes en main pour créer des applications qui communiqueront avec votre Arduino et feront des échanges d’informations avec.
</p>
<h3 id="en-python">
 <a aria-hidden="true" href="#en-python">
  <span class="es-autolink-heading">
  </span>
 </a>
 En Python
</h3>
<p>
 Comme ce langage à l’air d’être en vogue, je me suis un peu penché dessus pour vous fournir une approche de comment utiliser python pour se servir de la voie série. Mon niveau en python étant équivalent à "grand débutant", je vais vous proposer un code simple reprenant les fonctions utiles à savoir le tout sans interface graphique. Nul doute que les pythonistes chevronnés sauront creuser plus loin
 <img alt=":)" class="smiley" src="./static/smileys/smile.png"/>
</p>
<div class="custom-block alert alert-primary">
 <div class="custom-block-body">
  <p>
   Comme pour les exemples dans les autres langages, on utilisera l’exercice "Attention à la casse" dans l’Arduino pour tester notre programme.
  </p>
 </div>
</div>
<p>
 Pour communiquer avec la voie série, nous allons utiliser une librairie externe qui s’appelle
 <a href="http://pyserial.sourceforge.net/">
  pySerial
 </a>
 .
</p>
<h4 id="installation">
 <a aria-hidden="true" href="#installation">
  <span class="es-autolink-heading">
  </span>
 </a>
 Installation
</h4>
<h5 id="ubuntu">
 <a aria-hidden="true" href="#ubuntu">
  <span class="es-autolink-heading">
  </span>
 </a>
 Ubuntu
</h5>
<p>
 Pour installer pySerial sur votre une machine Ubuntu c’est très simple, il suffit de lancer une seule commande :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-bash">sudo apt-get install python3-serial
</code></pre>
</div>
<p>
 Vous pouvez aussi l’installer à partir des sources à l’adresse suivante : https:// pypi.python.org/pypi/pyserial . Ensuite, décompresser l’archive et exécuter la commande : (pour python 2)
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-bash">python setup.py install
</code></pre>
</div>
<p>
 (pour python 3)
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-bash">python3 setup.py install
</code></pre>
</div>
<h5 id="windows">
 <a aria-hidden="true" href="#windows">
  <span class="es-autolink-heading">
  </span>
 </a>
 Windows
</h5>
<p>
 Si vous utilisez Windows, il vous faudra un logiciel capable de décompresser les archives de types tar.gz (comme 7-zip par exemple). Ensuite vous devrez récupérer les sources à la même adresse que pour Linux : https:// pypi.python.org/pypi/pyserial . Enfin, comme pour Linux encore il vous suffira d’exécuter la commande qui va bien :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-bash">python setup.py install
</code></pre>
</div>
<h4 id="utiliser-la-librairie">
 <a aria-hidden="true" href="#utiliser-la-librairie">
  <span class="es-autolink-heading">
  </span>
 </a>
 Utiliser la librairie
</h4>
<p>
 Pour utiliser la librairie, il vous faudra tout d’abord l’importer. Pour cela, on utilise la commande import :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-python"><span class="hljs-keyword">import</span> serial
</code></pre>
</div>
<p>
 mais comme seule une partie du module nous intéresse vraiment (Serial) on peut restreindre :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-python"><span class="hljs-keyword">from</span> serial <span class="hljs-keyword">import</span> Serial
</code></pre>
</div>
<p>
 (notez l’importance des majuscules/minuscules)
</p>
<h5 id="ouvrir-un-port-série">
 <a aria-hidden="true" href="#ouvrir-un-port-série">
  <span class="es-autolink-heading">
  </span>
 </a>
 Ouvrir un port série
</h5>
<p>
 Maintenant que le module est bien chargé, nous allons pouvoir commencer à l’utiliser. La première chose importante à faire est de connaître le port série à utiliser. On peut obtenir une liste de ces derniers grâce à la commande :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-bash">python -m serial.tools.list_ports
</code></pre>
</div>
<p>
 Si comme chez moi cela ne fonctionne pas, vous pouvez utiliser d’autres méthodes.
</p>
<ul>
 <li>
  Sous Windows : en allant dans le gestionnaire de périphériques pour trouver le port série concerné (COMx)
 </li>
 <li>
  Sous Linux : en utilisant la commande
  <code>
   ls /dev
  </code>
  , vous pourrez trouver le nom du port série sous le nom "ttyACMx" par exemple
 </li>
</ul>
<figure>
 <img alt="Le port USB de l'Arduino" src="./images/uploaded/tuto-arduino-304-annexe-ordinateur-et-voie-série-dans-un-autre-langage-de-programmation/le-port-usb-de-larduino.jpg"/>
 <figcaption>
  Le port USB de l'Arduino
 </figcaption>
</figure>
<p>
 Lorsque le port USB est identifié, on peut créer un objet de type Serial. Le constructeur que l’on va utiliser prend deux paramètres, le nom du port série et la vitesse à utiliser (les autres paramètres (parité…) conviennent par défaut).
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-python">port = Serial(<span class="hljs-string">'/dev/ttyACM0'</span>, <span class="hljs-number">9600</span>)
</code></pre>
</div>
<p>
 Une fois cet objet créé, la connexion peut-être ouverte avec la fonction open()
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-python">port.open()
</code></pre>
</div>
<p>
 Pour vérifier que la voie série est bien ouverte, on utilisera la méthode "isOpen()" qui retourne un booléen vrai si la connexion est établie.
</p>
<h5 id="envoyer-des-données-1">
 <a aria-hidden="true" href="#envoyer-des-données-1">
  <span class="es-autolink-heading">
  </span>
 </a>
 Envoyer des données
</h5>
<p>
 Maintenant que la voie série est ouverte, nous allons pouvoir lui envoyer des données à traiter. Pour le bien de l’exercice, il nous faut récupérer un (des) caractère(s) à envoyer et retourner avec la casse inversée. Nous allons donc commencer par récupérer une chaîne de caractère de l’utilisateur :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-python">chaine = input(<span class="hljs-string">"Que voulez vous transformer ? "</span>)
</code></pre>
</div>
<p>
 Puis nous allons simplement l’envoyer avec la fonction "write". Cette fonction prend en paramètre un tableau de bytes. Nous allons donc transformer notre chaîne pour convenir à ce format avec la fonction python "bytes()" qui prend en paramètres la chaine de caractères et le format d’encodage.
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-python">bytes(chaine, <span class="hljs-string">'UTF-8'</span>)
</code></pre>
</div>
<p>
 Ce tableau peut directement être envoyé dans la fonction write() :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
 </div>
 <pre><code class="hljs language-python">port.write(bytes(chaine, <span class="hljs-string">'UTF-8'</span>))
</code></pre>
</div>
<h5 id="recevoir-des-données-2">
 <a aria-hidden="true" href="#recevoir-des-données-2">
  <span class="es-autolink-heading">
  </span>
 </a>
 Recevoir des données
</h5>
<p>
 La suite logique des choses voudrait que l’on réussisse à recevoir des données. C’est ce que nous allons voir maintenant.
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
 Nous allons tout d’abord vérifier que des données sont arrivées sur la voie série via la méthode inWaiting(). Cette dernière nous renvoie le nombre de caractères dans le buffer de réception de la voie série. S’il est différent de 0, cela signifie qu’il y a des données à lire. S’il y a des caractères, nous allons utiliser la fonction "read()" pour les récupérer. Cette fonction retourne les caractères (byte) un par un dans l’ordre où il sont arrivés. Un exemple de récupération de caractère pourrait-être :
</p>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-python"><span class="hljs-keyword">while</span>(port.inWaiting() != <span class="hljs-number">0</span>):
    car = port.read() <span class="hljs-comment">#on lit un caractère</span>
    print(car) <span class="hljs-comment">#on l'affiche</span>
</code></pre>
 </div>
 <figcaption>
  Lecture des données en python
 </figcaption>
</figure>
<p>
 Vous en savez maintenant presque autant que moi sur la voie série en python
 <img alt=":P" class="smiley" src="./static/smileys/langue.png"/>
 ! Je suis conscient que c’est assez maigre comparé aux autres langages, mais je ne vais pas non plus apprendre tout les langages du monde
 <img alt=":D" class="smiley" src="./static/smileys/heureux.png"/>
</p>
<h4 id="code-exemple-complet-et-commenté">
 <a aria-hidden="true" href="#code-exemple-complet-et-commenté">
  <span class="es-autolink-heading">
  </span>
 </a>
 Code exemple complet et commenté
</h4>
<figure>
 <div class="hljs-code-div">
  <div class="hljs-line-numbers">
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
   <span>
   </span>
  </div>
  <pre><code class="hljs language-python"><span class="hljs-comment">#!/usr/bin/python3</span>
<span class="hljs-comment">## -*-coding:Utf-8 -*</span>

<span class="hljs-keyword">from</span> serial <span class="hljs-keyword">import</span> Serial
<span class="hljs-keyword">import</span> time

port = Serial(<span class="hljs-string">'/dev/ttyACM0'</span>, <span class="hljs-number">9600</span>)

port.open()

<span class="hljs-comment">## test que le port est ouvert</span>
<span class="hljs-keyword">if</span> (port.isOpen()):
    <span class="hljs-comment"># demande de la chaîne à envoyer</span>
    chaine = input(<span class="hljs-string">"Que voulez vous transformer ? "</span>)
    <span class="hljs-comment"># on écrit la chaîne en question</span>
    port.write(bytes(chaine, <span class="hljs-string">'UTF-8'</span>))
    <span class="hljs-comment"># attend que des données soit revenues</span>
    <span class="hljs-keyword">while</span>(port.inWaiting() == <span class="hljs-number">0</span>):
        <span class="hljs-comment"># on attend 0.5 seconde pour que les données arrive</span>
        time.sleep(<span class="hljs-number">0.5</span>)

    <span class="hljs-comment"># si on arrive là, des données sont arrivées</span>
    <span class="hljs-keyword">while</span>(port.inWaiting() != <span class="hljs-number">0</span>):
        <span class="hljs-comment"># il y a des données !</span>
        car = port.read() <span class="hljs-comment">#on lit un caractère</span>
        print(car) <span class="hljs-comment">#on l'affiche</span>
<span class="hljs-keyword">else</span>:
    <span class="hljs-keyword">print</span> (<span class="hljs-string">"Le port n'a pas pu être ouvert !"</span>)
</code></pre>
 </div>
 <figcaption>
  Code complet d’utilisation de la liaison série en python
 </figcaption>
</figure>
<p>
 Cette annexe vous aura permis de comprendre un peu comment utiliser la voie série en général avec un ordinateur. Avec vos connaissances vous êtes dorénavant capable de créer des interfaces graphiques pour communiquer avec votre arduino. De grandes possibilités s’offrent à vous, et de plus grandes vous attendent avec les parties qui suivent…
</p>
            </div>
            <!-- /.entry-content -->
            <hr>
            <div class="row bg-light my-2 py-2 rounded">
                <div class="col mr-auto">
                    <a class="" href="/tuto-arduino-303-tp-baignade-interdite" rel="prev">
                        <i class="fas fa-chevron-left fa-lg"></i>
                        tuto-arduino-303-tp-baignade-interdite
                    </a>
                </div>
                <div class="col-auto">
                    <a class="" href="/tuto-arduino-401-les-entrées-analogiques-de-larduino" rel="next">
                        tuto-arduino-401-les-entrées-analogiques-de-larduino
                        <i class="fas fa-chevron-right fa-lg"></i>
                    </a>
                </div>
            </div>
            <div class="text-center">
                <img class="es-licence-pic" src="/static/images/CC BY-NC-SA.png" alt="Licence CC BY-NC-SA" title="Article sous licence CC BY-NC-SA">
            </div>
            <div class="my-3 text-center">
                <a class="btn btn-outline-dark mx-1" href="https://twitter.com/share?url=https://eskimon.fr/tuto-arduino-304-annexe-ordinateur-et-voie-série-dans-un-autre-langage-de-programmation&amp;text=[Annexe] Ordinateur et voie série dans un autre langage de programmation - https://eskimon.fr/tuto-arduino-304-annexe-ordinateur-et-voie-série-dans-un-autre-langage-de-programmation" rel="nofollow" title="Partager cet article sur Twitter" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-twitter fa-lg"></i>
                </a>
                <a class="btn btn-outline-dark mx-1" href="https://www.facebook.com/sharer.php?u=https://eskimon.fr/tuto-arduino-304-annexe-ordinateur-et-voie-série-dans-un-autre-langage-de-programmation&amp;t=[Annexe] Ordinateur et voie série dans un autre langage de programmation - https://eskimon.fr/tuto-arduino-304-annexe-ordinateur-et-voie-série-dans-un-autre-langage-de-programmation" rel="nofollow" title="Partager cet article sur Facebook" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-facebook-f fa-lg"></i>
                </a>
                <a class="btn btn-outline-dark mx-1" href="https://plus.google.com/share?url=https://eskimon.fr/tuto-arduino-304-annexe-ordinateur-et-voie-série-dans-un-autre-langage-de-programmation&amp;hl=fr" rel="nofollow" title="Partager cet article sur Google +" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-google-plus fa-lg"></i>
                </a>
                <!--<a class="btn btn-outline-dark mx-1" href="http://sharetodiaspora.github.io/?url=https://eskimon.fr/tuto-arduino-304-annexe-ordinateur-et-voie-série-dans-un-autre-langage-de-programmation&amp;title=[Annexe] Ordinateur et voie série dans un autre langage de programmation - https://eskimon.fr/tuto-arduino-304-annexe-ordinateur-et-voie-série-dans-un-autre-langage-de-programmation" rel="nofollow"  title="Partager cet article sur Diaspora" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-google-plus fa-lg"></i>
                </a>-->
                <a class="btn btn-outline-dark mx-1" href="mailto:?subject=[Annexe] Ordinateur et voie série dans un autre langage de programmation&amp;body=https://eskimon.fr/tuto-arduino-304-annexe-ordinateur-et-voie-série-dans-un-autre-langage-de-programmation"rel="nofollow" title="Partager cet article par email" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="far fa-envelope fa-lg"></i>
                </a>
            </div>
            <hr>
            <div class="text-center">
                <!-- billboard horizontal fin article -->
                <ins class="adsbygoogle" style="display:inline-block;width:970px;height:250px" data-ad-client="ca-pub-2080155902357792" data-ad-slot="6471099302"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
            <div class="text-center">
                <p>Vous avez une question ? Vous souhaitez partager votre experience ? Venez nous rejoindre sur Discord !</p>
                <iframe src="https://discordapp.com/widget?id=550632131877928960&theme=dark" width="500" height="500" allowtransparency="true" frameborder="0"></iframe>
            </div>
        </article>
    </div>
    <div class="d-none d-xl-block col-xl-1 offset-xl-1 px-0">
        <div class="d-flex flex-column justify-content-around align-items-end h-100" id="es-right-ad-block">
            <!-- Pub ajouté auto -->
        </div>
    </div>
</div>
    </div>
<footer class="container-fluid bg-dark small text-white px-3">
<div class="row">
    <div class="col align-self-center">
        © Eskimon -
        Blog propulsé par <a class="bold text-white" href="https://blog.getpelican.com/" rel="nofollow">Pelican</a> -
        Thème fait maison
    </div>
    <div class="col align-self-end text-right">
        <a class="btn btn-lg text-light" href="https://github.com/Eskimon" rel="nofollow" title="Mon profil Github">
            <i class="fab fa-github fa-lg"></i>
        </a>
        <a class="btn btn-lg text-light" href="https://twitter.com/Eskimon_fr" rel="nofollow" title="Me suivre sur Twitter">
            <i class="fab fa-twitter fa-lg"></i>
        </a>
        <a class="btn btn-lg text-light" href="https://twitch.tv/eskimon" rel="nofollow" title="Me suivre sur Twitch">
            <i class="fab fa-twitch fa-lg"></i>
        </a>
        <a class="btn btn-lg text-light" href="https://www.youtube.com/user/Eskimon49/featured" rel="nofollow" title="Les VOD sur Youtube">
            <i class="fab fa-youtube fa-lg"></i>
        </a>
        <a class="btn btn-lg text-light" href="https://discord.gg/9SkDWft" rel="nofollow" title="Venez participer sur Discord">
            <i class="fab fa-discord fa-lg"></i>
        </a>
    </div>
  </div>
</footer>
    <!-- For formula -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- Font awesome -->
    <script src="https://use.fontawesome.com/releases/v5.0.0/js/all.js"></script>
    <!-- JQuery first -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <!-- Popper.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <!-- Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- For tooltips -->
    <script>$(function () {  $('[data-toggle="tooltip"]').tooltip()})</script>
    <script src="/static/js/my-scripts.js"></script>
<script>
function create_side_summary() {
    // Duplicate summary
    var main_summary = $('#sommaire').next();
    if(main_summary.length === 0)
        return
    var side_summary = main_summary.clone();
    side_summary.addClass('pl-0');
    var all_p = side_summary.find('p');
    all_p.contents().unwrap();
    var all_li = side_summary.find('li');
    all_li.addClass('pl-1');

    // scrollspy - in
    side_summary.attr('id', 'es-side-summary-mainlist');
    //side_summary.addClass('nav');
    //all_li.addClass('nav-item');
    var all_a = side_summary.find('a');
    all_a.addClass('nav-link');
    var all_ul = side_summary.find('ul');
    all_ul.addClass('pl-1');
    $('body').scrollspy({ target: '#es-side-summary-mainlist' });
    // scrollspy - out

    var summary_title = document.createElement("h4");
    summary_title.className = 'navbar-brand';
    summary_title.innerHTML = 'Sommaire';
    $(summary_title).prependTo('#es-side-summary-content');
    side_summary.appendTo('#es-side-summary-content');
    main_summary.addClass('es-subul-collapse');
}

function generate_spoilers() {
    all_secret = $('.custom-block-spoiler');
    all_secret.each(function( index ) {
        let content = $(this).html();
        $(this).html('');
        $(this).addClass('card');
        var headerText = document.createElement("button");
        var cardHeader = document.createElement("div");
        var cardBodyWrapper = document.createElement("div");
        var cardBody = document.createElement("div");
        $(headerText).text('Contenu masqué, cliquez pour afficher');
        $(headerText).addClass('btn btn-link btn-sm');
        $(headerText).attr('data-toggle', 'collapse');
        $(headerText).attr('data-target', '#collapse-' + index);
        $(headerText).attr('aria-controls', 'collapse-' + index);
        $(headerText).attr('aria-expanded', 'false');
        $(cardHeader).append(headerText);
        $(cardHeader).addClass('card-header');
        $(cardHeader).attr('id', 'spoiler-' + index);
        $(cardBody).html(content);
        $(cardBody).addClass('card-body');
        $(cardBodyWrapper).append(cardBody);
        $(cardBodyWrapper).addClass('collapse hide');
        $(cardBodyWrapper).attr('id', 'collapse-' + index)
        $(cardBodyWrapper).attr('aria-labelledby', 'spoiler-' + index)
        $(this).prepend(cardHeader);
        $(this).append(cardBodyWrapper);
    });

    $('.collapse').collapse({toggle: false});
}

function load_extra_ads() {
    return;
    // Load right side blocks
    var sidebar = $('#es-right-ad-block');
    var n_height = Math.floor(sidebar.height() / 2000);
    for (i = 0; i < n_height; i++) {
        var frag = document.createDocumentFragment();
        var newAdBlock = document.createElement("div");
        var block1 = document.createElement("ins");
        var block2 = document.createElement("script");

        block1.innerHTML = '<ins class="adsbygoogle" ' +
            'style="display:inline-block;width:120px;height:600px" ' +
            'data-ad-client="ca-pub-2080155902357792" ' +
            'data-ad-slot="4023722026"></ins>';
        block2.innerHTML = '(adsbygoogle = window.adsbygoogle || []).push({});';

        $(newAdBlock).append(block1);
        $(newAdBlock).append(block2);
        $(frag).append(newAdBlock);

        $(sidebar).append(frag);
    }

    // Load in feed blocks (above every h3)
    var frag = document.createDocumentFragment();
    var newAdBlock = document.createElement("div");
    var block1 = document.createElement("ins");
    var block2 = document.createElement("script");
    block1.innerHTML = '<ins class="adsbygoogle"' +
    'style = "display:inline-block;width:970px;height:90px"' +
    'data - ad - client="ca-pub-2080155902357792"' +
    'data - ad - slot="7100712740" ></ins >'
    block2.innerHTML = '(adsbygoogle = window.adsbygoogle || []).push({});';
    $(newAdBlock).append(block1);
    $(newAdBlock).append(block2);
    newAdBlock.className = 'my-3 text-center';
    $(frag).append(newAdBlock);
    var titles = $('.entry-content h3').slice(1);
    $(frag).insertBefore(titles);
}

$(document).ready(function () {

    create_side_summary();
    generate_spoilers();
    load_extra_ads();

    // when opening the sidebar
    $('#sidebarCollapse').on('click', function () {
        // open sidebar
        $('#es-side-summary').removeClass('d-none');
        $('#es-content').addClass('d-none');
        $('#sidebarCollapse').removeClass('sticky-top');
    });

    // if dismiss or overlay was clicked
    $('#es-side-summary').on('click', function () {
      // hide the sidebar
      $('#es-side-summary').addClass('d-none');
      $('#es-content').removeClass('d-none');
      $('#sidebarCollapse').addClass('sticky-top');
    });
});
</script>

</body>

</html>
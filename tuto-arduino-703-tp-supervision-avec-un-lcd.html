<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>[TP] Supervision avec un LCD &bull; Le blog d'Eskimon</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/hljs-monokai.css" />
    <link rel="stylesheet" href="/static/css/style.css" />
    <!-- Google font -->
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/images/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="57x57" href="/static/images/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/static/images/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/static/images/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/static/images/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/static/images/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/static/images/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/static/images/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/static/images/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/images/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/static/images/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/static/images/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="/static/images/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/static/images/favicon/ms-icon-144x144.png">


    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-46353906-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-46353906-1');
    </script>

    <meta name="description" content="Comme un bon chapitre ne va pas sans son TP, voici un exercice de mise en place d'un écran LCD avec l'Arduino." />

  <meta name="tags" content="arduino" />
  <meta name="tags" content="tuto" />


  <meta property="og:site_name" content="Le blog d'Eskimon">
  <meta property="og:title" content="[TP] Supervision avec un LCD">
  <meta property="og:url" content="https://eskimon.fr/tuto-arduino-703-tp-supervision-avec-un-lcd">
  <meta property="og:language" content="fr_FR">
  <meta property="og:type" content="website">

  <meta property="twitter:domain" content="https://eskimon.fr/">
  <meta property="twitter:card" content="summary">
  <meta property="twitter:url" content="https://eskimon.fr/tuto-arduino-703-tp-supervision-avec-un-lcd">
  <meta property="twitter:title" content="[TP] Supervision avec un LCD">
<meta property="twitter:description" content="Comme un bon chapitre ne va pas sans son TP, voici un exercice de mise en place d'un écran LCD avec l'Arduino.">  <meta property="twitter:site" content="SITENAME">
  <meta property="twitter:creator" content="@eskimon_fr">

  <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
  <meta name="DC.publisher" lang="fr" content="Le blog d'Eskimon" />
  <meta name="DC.creator" content="Eskimon" />
  <meta name="DC.type" content="text" />
  <meta name="DC.title" content="[TP] Supervision avec un LCD" />
  <meta name="DC.abstract" content="[TP] Supervision avec un LCD – Comme un bon chapitre ne va pas sans son TP, voici un exercice de mise en place d'un écran LCD avec l'Arduino." />
  <meta name="DC.subject" lang="fr" content="Arduino/G - L'affichage, une autre manière d'interagir – arduino; tuto" />
<meta name="DC.description" lang="fr" content="Comme un bon chapitre ne va pas sans son TP, voici un exercice de mise en place d'un écran LCD avec l'Arduino." />  <meta name="DC.date" content="2013-12-11T18:14:00+01:00" />
  <meta name="DC.format" content="text/html" />
  <meta name="DC.language" content="fr" />
  <meta name="DC.rights" content="CC BY-NC-SA" />

  <script type="application/ld+json">
    [{
        "@context": "http://schema.org",
        "@type": "Article",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://eskimon.fr/tuto-arduino-703-tp-supervision-avec-un-lcd"
        },
        "headline": ""[TP] Supervision avec un LCD"",
        "datePublished": "2013-12-11T18:14:00+01:00",
        "image": [
            "https://eskimon.fr/static/images/logo.png"
        ],
        "author": {
            "@type": "Person",
            "name": "Eskimon",
            "image": "https://eskimon.fr/static/images/logo.png"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Eskimon",
            "logo": {
                "@type": "ImageObject",
                "url": "https://eskimon.fr/static/images/logo.png"
            }
        },
        "description": ""Comme un bon chapitre ne va pas sans son TP, voici un exercice de mise en place d\u0027un \u00e9cran LCD avec l\u0027Arduino.""
    },
    {
        "@context": "http://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [{
            "@type": "ListItem",
            "position": 1,
            "item": {
                "@id": "https://eskimon.fr/category/arduino",
                "name": ""Arduino""
            }
        }
        , {
            "@type": "ListItem",
            "position": 2,
            "item": {
                "@id": "https://eskimon.fr/subcategory/arduino/g-laffichage-une-autre-maniere-dinteragir",
                "name": ""G - L\u0027affichage, une autre mani\u00e8re d\u0027interagir""
            }
        }
        , {
            "@type": "ListItem",
            "position": 3,
            "item": {
                "@id": "https://eskimon.fr/tuto-arduino-703-tp-supervision-avec-un-lcd",
                "name": ""[TP] Supervision avec un LCD""
            }
        }]
    }]
    </script>

</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light bg-secondary-l40 py-0">
    <a class="navbar-brand" href="/">
        <img src="/static/images/logo.png" width="20" height="20" alt="">
        Le blog d'Eskimon
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav ml-auto">
                <a class="nav-item nav-link active" href="/category/arduino">Arduino</a>
                <a class="nav-item nav-link " href="/category/articles">Articles</a>
                <a class="nav-item nav-link " href="/category/tuto">Tuto</a>
        </div>
    </div>
</nav>
    <div class="container-fluid es-verticalfill">
<div class="row">
    <!-- Sidebar -->
    <div class="col-lg-2 d-none d-lg-block sticky-top es-scrollable pt-3 px-1 bg-light es-ul-bordered" id="es-side-summary">
        <nav class="px-2" id="es-side-summary-content">
            <!-- Summary will come here -->
        </nav>
        <hr>
        <!-- Add here self-promo for ebook -->
    </div>
    <!-- Main content -->
    <div class="col-md-10 col-lg-8 col-xl-7 offset-md-1 offset-lg-1 offset-xl-1 d-block pt-3" id="es-content">
        <article>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb bg-white">
                    <li class="breadcrumb-item"><a href="/category/arduino">Arduino</a></li>
                        <li class="breadcrumb-item"><a href="/subcategory/arduino/g-laffichage-une-autre-maniere-dinteragir">G - L'affichage, une autre manière d'interagir</a></li>
                    <li class="breadcrumb-item active" aria-current="page">[TP] Supervision avec un LCD</li>
                </ol>
            </nav>
            <header class="es-post-info">
                <h1 class="text-center my-4">[TP] Supervision avec un LCD</h1>
            </header>
            <footer class="es-post-info pb-2 mb-2">
                <div class="row align-items-center">
                    <div class="col-auto mr-auto">
                        <span class="vcard author">
                            <a class="" href="/author/eskimon" rel="author">Eskimon</a>
                        </span>
                        ,
                        <time class="" datetime="2013-12-11T18:14:00+01:00" pubdate>
                            le mer. 11 décembre 2013
                        </time>
                            (<a href="https://eskimon.fr/tuto-arduino-703-tp-supervision-avec-un-lcd#disqus_thread" data-disqus-identifier="tuto-arduino-703-tp-supervision-avec-un-lcd">commentaires</a>)
                    </div>
                    <div class="col-auto">
                        <a class="btn btn-outline-primary btn-sm" href="/tag/arduino" rel="tag">arduino</a>
                        <a class="btn btn-outline-primary btn-sm" href="/tag/tuto" rel="tag">tuto</a>
                    </div>
                </div>
            </footer>
            <button type="button" id="sidebarCollapse" class="float-right btn btn-secondary sticky-top d-block d-lg-none">
                Sommaire
            </button>
            <!-- /.post-info -->
            <div class="entry-content">
                <p>
 Chers lecteurs et lectrices, savez-vous qu’il est toujours aussi difficile de faire une introduction et une conclusion pour chaque chapitre ? C’est pourquoi je n’ai choisi ici que de dire ceci :
 <em>
  amusez-vous bien avec les LCD !
 </em>
 <img alt=":D" class="smiley" src="./static/smileys/heureux.png"/>
</p>
<h3 id="sommaire">
 <a aria-hidden="true" href="#sommaire">
  <span class="es-autolink-heading">
  </span>
 </a>
 Sommaire
</h3>
<ul>
 <li>
  <p>
   <a href="#consigne">
    Consigne
   </a>
  </p>
  <ul>
   <li>
    <ul>
     <li>
      <a href="#comportement-de-lécran">
       Comportement de l’écran
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li>
  <p>
   <a href="#correction">
    Correction
   </a>
  </p>
  <ul>
   <li>
    <a href="#le-montage">
     Le montage
    </a>
   </li>
   <li>
    <p>
     <a href="#le-code">
      Le code
     </a>
    </p>
    <ul>
     <li>
      <a href="#les-variables-utilisées">
       Les variables utilisées
      </a>
     </li>
     <li>
      <a href="#le-setup">
       Le setup
      </a>
     </li>
     <li>
      <a href="#quelques-fonctions-utiles">
       Quelques fonctions utiles
      </a>
     </li>
     <li>
      <a href="#la-boucle-principale">
       La boucle principale
      </a>
     </li>
     <li>
      <a href="#programme-complet">
       Programme complet
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>
<h3 id="consigne">
 <a aria-hidden="true" href="#consigne">
  <span class="es-autolink-heading">
  </span>
 </a>
 Consigne
</h3>
<p>
 Dans ce TP, on se propose de mettre en place un système de supervision, comme on pourrait en retrouver dans un milieu industriel (en plus simple ici, bien sûr !) ou dans d’autres applications. Le but sera d’afficher des informations sur l’écran LCD en fonction d’évènements qui se passent dans le milieu extérieur. Ce monde extérieur sera représenté par les composants suivants :
</p>
<ul>
 <li>
  Deux boutons, qui pourraient représenter par exemple deux barrières infrarouges et dont le signal reçu passe de 1 à 0 lorsqu’un objet passe devant.
 </li>
 <li>
  Deux potentiomètres. Le premier sert de "consigne" et est réglé par l’utilisateur. Le second représentera un capteur. À titre d’exemple, sur la vidéo à la suite vous verrez un potentiomètre rotatif qui représentera la consigne et un autre sous forme de glissière qui sera le capteur.
 </li>
 <li>
  Enfin, une LED rouge nous permettra de faire une alarme visuelle. Elle sera normalement éteinte mais si la valeur du capteur dépasse celle de la consigne alors elle s’allumera.
 </li>
</ul>
<h5 id="comportement-de-lécran">
 <a aria-hidden="true" href="#comportement-de-lécran">
  <span class="es-autolink-heading">
  </span>
 </a>
 Comportement de l’écran
</h5>
<p>
 L’écran que j’utilise ne propose que 2 lignes et 16 colonnes. Il n’est donc pas possible d’afficher toutes les informations de manière lisible en même temps. On se propose donc de faire un affichage alterné entre deux interfaces. Chaque interface sera affichée pendant cinq secondes à tour de rôle. La première affichera l’état des boutons. On pourra par exemple lire :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-text">Bouton G : ON
Bouton D : OFF
</code></pre>
</div>
<p>
 La seconde interface affichera la valeur de la consigne et celle du capteur. On aura par exemple :
</p>
<div class="hljs-code-div">
 <div class="hljs-line-numbers">
  <span>
  </span>
  <span>
  </span>
 </div>
 <pre><code class="hljs language-text">Consigne : 287
Capteur  : 115
</code></pre>
</div>
<p>
 (Sur la vidéo vous verrez "gauche / droite" pour symboliser les deux potentiomètres, chacun fait comme il veut/peut :P ).
</p>
<p>
 Enfin, bien que l’information "consigne/capteur" ne s’affiche que toutes les 5 secondes, l’alarme (la LED rouge), elle, doit être visible à tout moment si la valeur du capteur dépasse celle de la consigne. En effet, imaginez que cette alarme représentera une pression trop élevée, ce serait dommage que tout explose à cause d’un affichage 5 secondes sur 10 ! :P Je pense avoir fait le tour de mes attentes ! Je vous souhaite un bon courage, prenez votre temps, faites un beau schéma/montage/code et à bientôt pour la correction !
</p>
<div class="text-center">
 <div class="video-container">
  <div class="video-wrapper">
   <iframe allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/rGdUo7j2ou8" width="560">
   </iframe>
  </div>
 </div>
</div>
<h3 id="correction">
 <a aria-hidden="true" href="#correction">
  <span class="es-autolink-heading">
  </span>
 </a>
 Correction
</h3>
<h4 id="le-montage">
 <a aria-hidden="true" href="#le-montage">
  <span class="es-autolink-heading">
  </span>
 </a>
 Le montage
</h4>
<p>
 Vous en avez l’habitude maintenant, je vais vous présenter le schéma puis ensuite le code. Pour le schéma, je n’ai pas des milliers de commentaires à faire. Parmi les choses auxquelles il faut être attentif se trouvent :
</p>
<ul>
 <li>
  Des condensateurs de filtrage pour éviter les rebonds parasites créés par les boutons
 </li>
 <li>
  Mettre les potentiomètres sur des entrées analogiques
 </li>
 <li>
  Brancher la LED dans le bon sens et ne pas oublier sa résistance de limitation de courant
 </li>
</ul>
<p>
 Et en cas de doute, voici le schéma (qui est un peu fouillis par endroit, j’en suis désolé) !
</p>
<div class="custom-block custom-block-spoiler">
 <div class="custom-block-body">
  <p>
   <img alt="Montage du TP - Schéma" src="./images/uploaded/tuto-arduino-703-tp-supervision-avec-un-lcd/montage-du-tp-schema.jpg"/>
  </p>
  <p>
   <img alt="Montage du TP - Montage" src="./images/uploaded/tuto-arduino-703-tp-supervision-avec-un-lcd/montage-du-tp-montage.png"/>
  </p>
 </div>
</div>
<h4 id="le-code">
 <a aria-hidden="true" href="#le-code">
  <span class="es-autolink-heading">
  </span>
 </a>
 Le code
</h4>
<p>
 Là encore, je vais reprendre le même schéma de fonctionnement que d’habitude en vous présentant tout d’abord les variables globales utilisées, puis les initialisations pour continuer avec quelques fonctions utiles et la boucle principale.
</p>
<h5 id="les-variables-utilisées">
 <a aria-hidden="true" href="#les-variables-utilisées">
  <span class="es-autolink-heading">
  </span>
 </a>
 Les variables utilisées
</h5>
<p>
 Dans ce TP, beaucoup de variables vont être déclarées. En effet, il en faut déjà 5 pour les entrées/sorties (2 boutons, 2 potentiomètres, 1 LED), j’utilise aussi deux tableaux pour contenir et préparer les messages à afficher sur la première et deuxième ligne. Enfin, j’en utilise 4 pour contenir les mesures faites et 4 autres servant de mémoire pour ces mesures. Ah et j’oubliais, il me faut aussi une variable contenant le temps écoulé et une servant à savoir sur quelle "interface" nous sommes en train d’écrire. Voici un petit tableau résumant tout cela ainsi que le type des variables.
</p>
<div class="custom-block custom-block-spoiler">
 <div class="custom-block-body">
  <div class="text-center">
   <figure>
    <div class="table-wrapper">
     <table class=" table table-bordered table-striped">
      <thead>
       <tr>
        <th>
         Nom
        </th>
        <th>
         Type
        </th>
        <th>
         Description
        </th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td>
         boutonGauche
        </td>
        <td>
         <code>
          const int
         </code>
        </td>
        <td>
         Broche du bouton de gauche
        </td>
       </tr>
       <tr>
        <td>
         boutonDroite
        </td>
        <td>
         <code>
          const int
         </code>
        </td>
        <td>
         Broche du bouton de droite
        </td>
       </tr>
       <tr>
        <td>
         potentiometreGauche
        </td>
        <td>
         <code>
          const int
         </code>
        </td>
        <td>
         Broche du potar "consigne"
        </td>
       </tr>
       <tr>
        <td>
         potentiometreDroite
        </td>
        <td>
         <code>
          const int
         </code>
        </td>
        <td>
         Broche du potar "alarme"
        </td>
       </tr>
       <tr>
        <td>
         ledAlarme
        </td>
        <td>
         <code>
          const int
         </code>
        </td>
        <td>
         Broche de la LED d’alarme
        </td>
       </tr>
       <tr>
        <td>
         messageHaut
[
16
]
        </td>
        <td>
         <code>
          char
         </code>
        </td>
        <td>
         Tableau représentant la ligne du haut
        </td>
       </tr>
       <tr>
        <td>
         messageBas
[
16
]
        </td>
        <td>
         <code>
          char
         </code>
        </td>
        <td>
         Tableau représentant la ligne du bas
        </td>
       </tr>
       <tr>
        <td>
         etatGauche
        </td>
        <td>
         <code>
          int
         </code>
        </td>
        <td>
         État du bouton de gauche
        </td>
       </tr>
       <tr>
        <td>
         etatDroite
        </td>
        <td>
         <code>
          int
         </code>
        </td>
        <td>
         État du bouton de droite
        </td>
       </tr>
       <tr>
        <td>
         niveauGauche
        </td>
        <td>
         <code>
          int
         </code>
        </td>
        <td>
         Conversion du potar de gauche
        </td>
       </tr>
       <tr>
        <td>
         niveauDroite
        </td>
        <td>
         <code>
          int
         </code>
        </td>
        <td>
         Conversion du potar de droite
        </td>
       </tr>
       <tr>
        <td>
         etatGauche_old
        </td>
        <td>
         <code>
          int
         </code>
        </td>
        <td>
         Mémoire de l’état du bouton de gauche
        </td>
       </tr>
       <tr>
        <td>
         etatDroite_old
        </td>
        <td>
         <code>
          int
         </code>
        </td>
        <td>
         Mémoire de l’état du bouton de droite
        </td>
       </tr>
       <tr>
        <td>
         niveauGauche_old
        </td>
        <td>
         <code>
          int
         </code>
        </td>
        <td>
         Mémoire de la conversion du potar de gauche
        </td>
       </tr>
       <tr>
        <td>
         niveauDroite_old
        </td>
        <td>
         <code>
          int
         </code>
        </td>
        <td>
         Mémoire de la conversion du potar de droite
        </td>
       </tr>
       <tr>
        <td>
         temps
        </td>
        <td>
         <code>
          unsigned long
         </code>
        </td>
        <td>
         Pour mémoriser le temps écoulé
        </td>
       </tr>
       <tr>
        <td>
         ecran
        </td>
        <td>
         <code>
          boolean
         </code>
        </td>
        <td>
         Pour savoir sur quelle interface on écrit
        </td>
       </tr>
      </tbody>
     </table>
    </div>
    <figcaption>
     Liste des broches utilisées
    </figcaption>
   </figure>
  </div>
 </div>
</div>
<h5 id="le-setup">
 <a aria-hidden="true" href="#le-setup">
  <span class="es-autolink-heading">
  </span>
 </a>
 Le setup
</h5>
<p>
 Maintenant que les présentations sont faites, nous allons passer à toutes les initialisations. Le setup n’aura que peu de choses à faire puisqu’il suffira de régler les broches en entrées/sorties et de mettre en marche l’écran LCD.
</p>
<div class="custom-block custom-block-spoiler">
 <div class="custom-block-body">
  <figure>
   <div class="hljs-code-div">
    <div class="hljs-line-numbers">
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
    </div>
    <pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// règlage des entrées/sorties</span>
    pinMode(boutonGauche, INPUT);
    pinMode(boutonDroite, INPUT);
    pinMode(ledAlarme, OUTPUT);

    <span class="hljs-comment">// réglage du LCD</span>
    lcd.begin(<span class="hljs-number">16</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// règle la  taille du LCD</span>
    lcd.noBlink(); <span class="hljs-comment">// pas de clignotement</span>
    lcd.noCursor(); <span class="hljs-comment">// pas de curseur</span>
    lcd.noAutoscroll(); <span class="hljs-comment">// pas de défilement</span>
}
</code></pre>
   </div>
   <figcaption>
    Correction de l’exercice :
    <code>
     setup
    </code>
   </figcaption>
  </figure>
 </div>
</div>
<h5 id="quelques-fonctions-utiles">
 <a aria-hidden="true" href="#quelques-fonctions-utiles">
  <span class="es-autolink-heading">
  </span>
 </a>
 Quelques fonctions utiles
</h5>
<p>
 Afin de bien séparer notre code en morceaux logiques, nous allons écrire plusieurs fonctions, qui ont toutes un rôle particulier. La première d’entre elles sera celle chargée de faire le relevé des valeurs. Son objectif sera de faire les conversions analogiques et de regarder l’état des entrées numériques. Elle stockera bien entendu chacune des mesures dans la variable concernée.
</p>
<div class="custom-block custom-block-spoiler">
 <div class="custom-block-body">
  <figure>
   <div class="hljs-code-div">
    <div class="hljs-line-numbers">
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
    </div>
    <pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">recupererDonnees</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// efface les anciens avec les "nouveaux anciens"</span>
    etatGauche_old = etatGauche;
    etatDroite_old = etatDroite;
    niveauGauche_old = niveauGauche;
    niveauDroite_old = niveauDroite;

    <span class="hljs-comment">// effectue les mesures</span>
    etatGauche = digitalRead(boutonGauche);
    etatDroite = digitalRead(boutonDroite);
    niveauGauche = analogRead(potentiometreGauche);
    niveauDroite = analogRead(potentiometreDroite);

    <span class="hljs-comment">// pour s'assurer que les conversions analogiques sont terminées</span>
    <span class="hljs-comment">// avant de passer à la suite on fait une petite pause</span>
    delay(<span class="hljs-number">2</span>);
}
</code></pre>
   </div>
   <figcaption>
    Correction de l’exercice : fonction
    <code>
     recupererDonnees
    </code>
   </figcaption>
  </figure>
 </div>
</div>
<p>
 Ensuite, deux fonctions vont nous permettre de déterminer si oui ou non il faut mettre à jour l’écran. En effet, afin d’éviter un phénomène de scintillement qui se produit si on envoi des données sans arrêt, on préfère écrire sur l’écran que si nécessaire. Pour décider si l’on doit mettre à jour les "phrases" concernant les boutons, il suffit de vérifier l’état "ancien" et l’état courant de chaque bouton. Si l’état est différent, notre fonction renvoie
 <code>
  true
 </code>
 , sinon elle renvoie
 <code>
  false
 </code>
 . Une même fonction sera codée pour les valeurs analogiques. Cependant, comme les valeurs lues par le convertisseur de la carte Arduino ne sont pas toujours très stables (je rappelle que le convertisseur offre plus ou moins deux bits de précision, soit 20mV de précision totale), on va faire une petite opération. Cette opération consiste à regarder si la valeur absolue de la différence entre la valeur courante et la valeur ancienne est supérieure à deux unités. Si c’est le cas, on renvoi
 <code>
  true
 </code>
 , sinon
 <code>
  false
 </code>
 .
</p>
<div class="custom-block custom-block-spoiler">
 <div class="custom-block-body">
  <figure>
   <div class="hljs-code-div">
    <div class="hljs-line-numbers">
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
    </div>
    <pre><code class="hljs language-cpp"><span class="hljs-function">boolean <span class="hljs-title">boutonsChanged</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// si un bouton à changé d'état</span>
    <span class="hljs-keyword">if</span>(etatGauche_old != etatGauche || etatDroite_old != etatDroite)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-function">boolean <span class="hljs-title">potarChanged</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// si un potentiomètre affiche une différence de plus de 2 unités</span>
    <span class="hljs-comment">// entre ces deux valeurs, alors on met à jour</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">abs</span>(niveauGauche_old-niveauGauche) &gt; <span class="hljs-number">2</span> ||
       <span class="hljs-built_in">abs</span>(niveauDroite_old-niveauDroite) &gt; <span class="hljs-number">2</span>)
    {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
</code></pre>
   </div>
   <figcaption>
    Correction de l’exercice : fonction
    <code>
     boutonsChanged
    </code>
    et
    <code>
     potarChanged
    </code>
   </figcaption>
  </figure>
 </div>
</div>
<p>
 Une dernière fonction nous servira à faire la mise à jour de l’écran. Elle va préparer les deux chaines de caractères (celle du haut et celle du bas) et va ensuite les envoyer successivement sur l’écran. Pour écrire dans les chaines, on vérifiera la valeur de la variable
 <code>
  ecran
 </code>
 pour savoir si on doit écrire les valeurs des potentiomètres ou celles des boutons. L’envoi à l’écran se fait simplement avec
 <code>
  print()
 </code>
 comme vu antérieurement. On notera le
 <code>
  clear()
 </code>
 de l’écran avant de faire les mises à jour. En effet, sans cela les valeurs pourraient se chevaucher (essayez d’écrire un OFF puis un ON, sans clear(), cela vous fera un "ONF" à la fin).
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
</p>
<div class="custom-block custom-block-spoiler">
 <div class="custom-block-body">
  <figure>
   <div class="hljs-code-div">
    <div class="hljs-line-numbers">
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
    </div>
    <pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">updateEcran</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">if</span>(ecran)
    {
        <span class="hljs-comment">// prépare les chaines à mettre sur l'écran : boutons</span>
        <span class="hljs-keyword">if</span>(etatGauche)
            <span class="hljs-built_in">sprintf</span>(messageHaut,<span class="hljs-string">"Bouton G : ON"</span>);
        <span class="hljs-keyword">else</span>
            <span class="hljs-built_in">sprintf</span>(messageHaut,<span class="hljs-string">"Bouton G : OFF"</span>);
        <span class="hljs-keyword">if</span>(etatDroite)
            <span class="hljs-built_in">sprintf</span>(messageBas,<span class="hljs-string">"Bouton D : ON"</span>);
        <span class="hljs-keyword">else</span>
            <span class="hljs-built_in">sprintf</span>(messageBas,<span class="hljs-string">"Bouton D : OFF"</span>);
        }
        <span class="hljs-keyword">else</span>
        {
            <span class="hljs-comment">// prépare les chaines à mettre sur l'écran : potentiomètres</span>
            <span class="hljs-built_in">sprintf</span>(messageHaut,<span class="hljs-string">"gauche = %4d"</span>, niveauGauche);
            <span class="hljs-built_in">sprintf</span>(messageBas,<span class="hljs-string">"droite = %4d"</span>, niveauDroite);
    }

    <span class="hljs-comment">// on envoie le texte</span>
    lcd.clear();
    lcd.setCursor(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
    lcd.print(messageHaut);
    lcd.setCursor(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>);
    lcd.print(messageBas);
}
</code></pre>
   </div>
   <figcaption>
    Correction de l’exercice : fonction
    <code>
     updateEcran
    </code>
   </figcaption>
  </figure>
 </div>
</div>
<h5 id="la-boucle-principale">
 <a aria-hidden="true" href="#la-boucle-principale">
  <span class="es-autolink-heading">
  </span>
 </a>
 La boucle principale
</h5>
<p>
 Nous voici enfin au cœur du programme, la boucle principale. Cette dernière est relativement légère, grâce aux fonctions permettant de repartir le code en unité logique. La boucle principale n’a plus qu’à les utiliser à bon escient et dans le bon ordre ( :P ) pour faire son travail. Dans l’ordre il nous faudra donc :
</p>
<ul>
 <li>
  Récupérer toutes les données (faire les conversions, etc.).
 </li>
 <li>
  Selon l’interface courante, afficher soit les états des boutons soit les valeurs des potentiomètres si ils/elles ont changé(e)s.
 </li>
 <li>
  Tester les valeurs des potentiomètres pour déclencher l’alarme ou non.
 </li>
 <li>
  Enfin, si 5 secondes se sont écoulées, changer d’interface et mettre à jour l’écran.
 </li>
</ul>
<p>
 Simple non ? On ne le dira jamais assez, un code bien séparé est toujours plus facile à comprendre et à retoucher si nécessaire !
 <img alt=":)" class="smiley" src="./static/smileys/smile.png"/>
 Allez, comme vous êtes sages, voici le code de cette boucle (qui va de paire avec les fonctions expliquées précédemment) :
</p>
<div class="custom-block custom-block-spoiler">
 <div class="custom-block-body">
  <figure>
   <div class="hljs-code-div">
    <div class="hljs-line-numbers">
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
    </div>
    <pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-comment">// commence par récupérer les données des boutons et capteurs</span>
    recupererDonnees();

    <span class="hljs-keyword">if</span>(ecran) <span class="hljs-comment">// quel écran affiche t'on ? (bouton ou potentiomètre ?)</span>
    {
        <span class="hljs-keyword">if</span>(boutonsChanged()) <span class="hljs-comment">// si un bouton a changé d'état</span>
        updateEcran();
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-keyword">if</span>(potarChanged()) <span class="hljs-comment">// si un potentiomètre a changé d'état</span>
        updateEcran();
    }

    <span class="hljs-keyword">if</span>(niveauDroite &gt; niveauGauche)
        <span class="hljs-comment">// RAPPEL : piloté à l'état bas donc on allume !</span>
        digitalWrite(ledAlarme, LOW);
    <span class="hljs-keyword">else</span>
        digitalWrite(ledAlarme, HIGH);

    <span class="hljs-comment">// si ça fait 5s qu'on affiche la même donnée</span>
    <span class="hljs-keyword">if</span>(millis() - temps &gt; <span class="hljs-number">5000</span>)
    {
        ecran = ~ecran;
        lcd.clear();
        updateEcran();
        temps = millis();
    }
}
</code></pre>
   </div>
   <figcaption>
    Correction de l’exercice :
    <code>
     loop
    </code>
   </figcaption>
  </figure>
 </div>
</div>
<h5 id="programme-complet">
 <a aria-hidden="true" href="#programme-complet">
  <span class="es-autolink-heading">
  </span>
 </a>
 Programme complet
</h5>
<p>
 Voici enfin le code complet. Vous pourrez le copier/coller et l’essayer pour comparer si vous voulez.
 <strong>
  Attention cependant à déclarer les bonnes broches en fonction de votre montage (notamment pour le LCD)
 </strong>
 .
</p>
<div class="custom-block custom-block-spoiler">
 <div class="custom-block-body">
  <figure>
   <div class="hljs-code-div">
    <div class="hljs-line-numbers">
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
     <span>
     </span>
    </div>
    <pre><code class="hljs language-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"LiquidCrystal.h"</span> <span class="hljs-comment">// on inclut la librairie</span></span>

<span class="hljs-comment">// les branchements</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> boutonGauche = <span class="hljs-number">11</span>; <span class="hljs-comment">// le bouton de gauche</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> boutonDroite = <span class="hljs-number">12</span>; <span class="hljs-comment">// le bouton de droite</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> potentiometreGauche = <span class="hljs-number">0</span>; <span class="hljs-comment">// le potentiomètre de gauche (analogique 0)</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> potentiometreDroite = <span class="hljs-number">1</span>; <span class="hljs-comment">// le potentiomètre de droite (analogique 1)</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ledAlarme = <span class="hljs-number">2</span>; <span class="hljs-comment">// la LED est branché sur la sortie 2</span>

<span class="hljs-comment">// initialise l'écran avec les bonnes broches</span>
<span class="hljs-comment">// ATTENTION, REMPLACER LES NOMBRES PAR VOS BRANCHEMENTS À VOUS !</span>
<span class="hljs-function">LiquidCrystal <span class="hljs-title">lcd</span><span class="hljs-params">(<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>)</span></span>;

<span class="hljs-keyword">char</span> messageHaut[<span class="hljs-number">16</span>] = <span class="hljs-string">""</span>; <span class="hljs-comment">// Message sur la ligne du dessus</span>
<span class="hljs-keyword">char</span> messageBas[<span class="hljs-number">16</span>] = <span class="hljs-string">""</span>; <span class="hljs-comment">// Message sur la ligne du dessous</span>

<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> temps = <span class="hljs-number">0</span>; <span class="hljs-comment">// pour garder une trace du temps qui s'écoule</span>
boolean ecran = LOW; <span class="hljs-comment">// savoir si on affiche les boutons ou les conversions</span>

<span class="hljs-keyword">int</span> etatGauche = LOW; <span class="hljs-comment">// état du bouton de gauche</span>
<span class="hljs-keyword">int</span> etatDroite = LOW; <span class="hljs-comment">// état du bouton de droite</span>
<span class="hljs-keyword">int</span> niveauGauche = <span class="hljs-number">0</span>; <span class="hljs-comment">// conversion du potentiomètre de gauche</span>
<span class="hljs-keyword">int</span> niveauDroite = <span class="hljs-number">0</span>; <span class="hljs-comment">// conversion du potentiomètre de droite</span>

<span class="hljs-comment">// les mêmes variables mais "old"</span>
<span class="hljs-comment">// servant de mémoire pour constater un changement</span>
<span class="hljs-keyword">int</span> etatGauche_old = LOW; <span class="hljs-comment">// état du bouton de gauche</span>
<span class="hljs-keyword">int</span> etatDroite_old = LOW; <span class="hljs-comment">// état du bouton de droite</span>
<span class="hljs-keyword">int</span> niveauGauche_old = <span class="hljs-number">0</span>; <span class="hljs-comment">// conversion du potentiomètre de gauche</span>
<span class="hljs-keyword">int</span> niveauDroite_old = <span class="hljs-number">0</span>; <span class="hljs-comment">// conversion du potentiomètre de droite</span>

<span class="hljs-comment">// -------------------------------------------------------------------------</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// réglage des entrées/sorties</span>
    pinMode(boutonGauche, INPUT);
    pinMode(boutonDroite, INPUT);
    pinMode(ledAlarme, OUTPUT);

    <span class="hljs-comment">// paramétrage du LCD</span>
    lcd.begin(<span class="hljs-number">16</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// règle la  taille du LCD</span>
    lcd.noBlink(); <span class="hljs-comment">// pas de clignotement</span>
    lcd.noCursor(); <span class="hljs-comment">// pas de curseur</span>
    lcd.noAutoscroll(); <span class="hljs-comment">// pas de défilement</span>
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-comment">// commence par récupérer les données des boutons et capteurs</span>
    recupererDonnees();

    <span class="hljs-keyword">if</span>(ecran) <span class="hljs-comment">// quel écran affiche-t'on ? (bouton ou potentiomètre ?)</span>
    {
        <span class="hljs-keyword">if</span>(boutonsChanged()) <span class="hljs-comment">// si un bouton a changé d'état</span>
            updateEcran();
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-keyword">if</span>(potarChanged()) <span class="hljs-comment">// si un potentiomètre a changé d'état</span>
            updateEcran();
    }

    <span class="hljs-keyword">if</span>(niveauDroite &gt; niveauGauche)
        <span class="hljs-comment">// RAPPEL : piloté à l'état bas donc on allume !</span>
        digitalWrite(ledAlarme, LOW);
    <span class="hljs-keyword">else</span>
        digitalWrite(ledAlarme, HIGH);

    <span class="hljs-comment">// si ça fait 5s qu'on affiche la même donnée</span>
    <span class="hljs-keyword">if</span>(millis() - temps &gt; <span class="hljs-number">5000</span>)
    {
        ecran = ~ecran;
        lcd.clear();
        updateEcran();
        temps = millis();
    }
}

<span class="hljs-comment">// -------------------------------------------------------------------------</span>

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">recupererDonnees</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// efface les anciens avec les "nouveaux anciens"</span>
    etatGauche_old = etatGauche;
    etatDroite_old = etatDroite;
    niveauGauche_old = niveauGauche;
    niveauDroite_old = niveauDroite;

    etatGauche = digitalRead(boutonGauche);
    etatDroite = digitalRead(boutonDroite);
    niveauGauche = analogRead(potentiometreGauche);
    niveauDroite = analogRead(potentiometreDroite);

    <span class="hljs-comment">// pour s'assurer que les conversions analogiques sont terminées</span>
    <span class="hljs-comment">// on fait une petite pause avant de passer à la suite</span>
    delay(<span class="hljs-number">1</span>);
}

<span class="hljs-function">boolean <span class="hljs-title">boutonsChanged</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">if</span>(etatGauche_old != etatGauche || etatDroite_old != etatDroite)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-function">boolean <span class="hljs-title">potarChanged</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// si un potentiomètre affiche une différence de plus de 2 unités</span>
    <span class="hljs-comment">// entre ces deux valeurs, alors on met à jour</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">abs</span>(niveauGauche_old-niveauGauche) &gt; <span class="hljs-number">2</span> ||
       <span class="hljs-built_in">abs</span>(niveauDroite_old-niveauDroite) &gt; <span class="hljs-number">2</span>)
    {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">updateEcran</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">if</span>(ecran)
    {
        <span class="hljs-comment">// prépare les chaines à mettre sur l'écran</span>
        <span class="hljs-keyword">if</span>(etatGauche)
            <span class="hljs-built_in">sprintf</span>(messageHaut,<span class="hljs-string">"Bouton G : ON"</span>);
        <span class="hljs-keyword">else</span>
            <span class="hljs-built_in">sprintf</span>(messageHaut,<span class="hljs-string">"Bouton G : OFF"</span>);
        <span class="hljs-keyword">if</span>(etatDroite)
            <span class="hljs-built_in">sprintf</span>(messageBas,<span class="hljs-string">"Bouton D : ON"</span>);
        <span class="hljs-keyword">else</span>
            <span class="hljs-built_in">sprintf</span>(messageBas,<span class="hljs-string">"Bouton D : OFF"</span>);
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-comment">// prépare les chaines à mettre sur l'écran</span>
        <span class="hljs-built_in">sprintf</span>(messageHaut,<span class="hljs-string">"gauche = %4d"</span>, niveauGauche);
        <span class="hljs-built_in">sprintf</span>(messageBas,<span class="hljs-string">"droite = %4d"</span>, niveauDroite);
    }

    <span class="hljs-comment">// on envoie le texte</span>
    lcd.clear();
    lcd.setCursor(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
    lcd.print(messageHaut);
    lcd.setCursor(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>);
    lcd.print(messageBas);
}
</code></pre>
   </div>
   <figcaption>
    Correction de l’exercice : programme complet
   </figcaption>
  </figure>
 </div>
</div>
<p>
 Et voilà ! C’est la fin de ce tutoriel. Enfin… Pour le moment.
 <img alt=";)" class="smiley" src="./static/smileys/clin.png"/>
</p>
<p>
 N’hésitez pas à nous faire part de vos remarques et questions sur le forum
 <a href="http://zestedesavoir.com/forums/savoirs/systemes-et-materiels/">
  Systèmes et Matériels
 </a>
 .
</p>
            </div>
            <!-- /.entry-content -->
            <hr>
            <div class="row bg-light my-2 py-2 rounded">
                <div class="col mr-auto">
                    <a class="" href="/tuto-arduino-702-votre-premier-texte-sur-le-lcd" rel="prev">
                        <i class="fas fa-chevron-left fa-lg"></i>
                        tuto-arduino-702-votre-premier-texte-sur-le-lcd
                    </a>
                </div>
                <div class="col-auto">
                    <a class="" href="/tuto-arduino-801-découverte-de-lethernet-sur-arduino" rel="next">
                        tuto-arduino-801-découverte-de-lethernet-sur-arduino
                        <i class="fas fa-chevron-right fa-lg"></i>
                    </a>
                </div>
            </div>
            <div class="text-center">
                <img class="es-licence-pic" src="/static/images/CC BY-NC-SA.png" alt="Licence CC BY-NC-SA" title="Article sous licence CC BY-NC-SA">
            </div>
            <div class="my-3 text-center">
                <a class="btn btn-outline-dark mx-1" href="https://twitter.com/share?url=https://eskimon.fr/tuto-arduino-703-tp-supervision-avec-un-lcd&amp;text=[TP] Supervision avec un LCD - https://eskimon.fr/tuto-arduino-703-tp-supervision-avec-un-lcd" rel="nofollow" title="Partager cet article sur Twitter" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-twitter fa-lg"></i>
                </a>
                <a class="btn btn-outline-dark mx-1" href="https://www.facebook.com/sharer.php?u=https://eskimon.fr/tuto-arduino-703-tp-supervision-avec-un-lcd&amp;t=[TP] Supervision avec un LCD - https://eskimon.fr/tuto-arduino-703-tp-supervision-avec-un-lcd" rel="nofollow" title="Partager cet article sur Facebook" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-facebook-f fa-lg"></i>
                </a>
                <a class="btn btn-outline-dark mx-1" href="https://plus.google.com/share?url=https://eskimon.fr/tuto-arduino-703-tp-supervision-avec-un-lcd&amp;hl=fr" rel="nofollow" title="Partager cet article sur Google +" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-google-plus fa-lg"></i>
                </a>
                <!--<a class="btn btn-outline-dark mx-1" href="http://sharetodiaspora.github.io/?url=https://eskimon.fr/tuto-arduino-703-tp-supervision-avec-un-lcd&amp;title=[TP] Supervision avec un LCD - https://eskimon.fr/tuto-arduino-703-tp-supervision-avec-un-lcd" rel="nofollow"  title="Partager cet article sur Diaspora" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="fab fa-google-plus fa-lg"></i>
                </a>-->
                <a class="btn btn-outline-dark mx-1" href="mailto:?subject=[TP] Supervision avec un LCD&amp;body=https://eskimon.fr/tuto-arduino-703-tp-supervision-avec-un-lcd"rel="nofollow" title="Partager cet article par email" role="button" data-toggle="tooltip" data-placement="top">
                    <i class="far fa-envelope fa-lg"></i>
                </a>
            </div>
            <hr>
            <!-- disqus start -->
            <div id="disqus_thread"></div>
            <script>
                var disqus_config = function () {
                    this.page.url = 'https://eskimon.fr/tuto-arduino-703-tp-supervision-avec-un-lcd';
                    this.page.identifier = 'tuto-arduino-703-tp-supervision-avec-un-lcd';
                    this.page.title = '[TP] Supervision avec un LCD';
                };
                (function () { // DON'T EDIT BELOW THIS LINE
                    var d = document, s = d.createElement('script');
                    s.src = 'https://eskimon-fr.disqus.com/embed.js';
                    s.setAttribute('data-timestamp', +new Date());
                    (d.head || d.body).appendChild(s);
                })();
            </script>
            <noscript>Please enable JavaScript to view the
                <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
            </noscript>
            <!-- disqus end -->
        </article>
    </div>
    <div class="d-none d-xl-block col-xl-1 offset-xl-1 px-0">
        <div class="d-flex flex-column justify-content-around align-items-end h-100" id="es-right-ad-block">
            <!-- Pub ajouté auto -->
        </div>
    </div>
</div>
    </div>
<footer class="container-fluid bg-dark small text-white px-3">
<div class="row">
    <div class="col align-self-center">
        © Eskimon -
        Blog propulsé par <a class="bold text-white" href="https://blog.getpelican.com/" rel="nofollow">Pelican</a> -
        Thème fait maison
    </div>
    <div class="col align-self-end text-right">
        <a class="btn btn-lg text-light" href="https://github.com/Eskimon" rel="nofollow" title="Mon profil Github">
            <i class="fab fa-github fa-lg"></i>
        </a>
        <a class="btn btn-lg text-light" href="https://twitter.com/Eskimon_fr" rel="nofollow" title="Me suivre sur Linkedin">
            <i class="fab fa-twitter fa-lg"></i>
        </a>
    </div>
  </div>
</footer>
    <!-- For formula -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- Font awesome -->
    <script src="https://use.fontawesome.com/releases/v5.0.0/js/all.js"></script>
    <!-- JQuery first -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <!-- Popper.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <!-- Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!-- For tooltips -->
    <script>$(function () {  $('[data-toggle="tooltip"]').tooltip()})</script>
    <script src="/static/js/my-scripts.js"></script>
<script>
function create_side_summary() {
    // Duplicate summary
    var main_summary = $('#sommaire').next();
    if(main_summary.length === 0)
        return
    var side_summary = main_summary.clone();
    side_summary.addClass('pl-0');
    var all_p = side_summary.find('p');
    all_p.contents().unwrap();
    var all_li = side_summary.find('li');
    all_li.addClass('pl-1');

    // scrollspy - in
    side_summary.attr('id', 'es-side-summary-mainlist');
    //side_summary.addClass('nav');
    //all_li.addClass('nav-item');
    var all_a = side_summary.find('a');
    all_a.addClass('nav-link');
    var all_ul = side_summary.find('ul');
    all_ul.addClass('pl-1');
    $('body').scrollspy({ target: '#es-side-summary-mainlist' });
    // scrollspy - out

    var summary_title = document.createElement("h4");
    summary_title.className = 'navbar-brand';
    summary_title.innerHTML = 'Sommaire';
    $(summary_title).prependTo('#es-side-summary-content');
    side_summary.appendTo('#es-side-summary-content');
    main_summary.addClass('es-subul-collapse');
}

function generate_spoilers() {
    all_secret = $('.custom-block-spoiler');
    all_secret.each(function( index ) {
        let content = $(this).html();
        $(this).html('');
        $(this).addClass('card');
        var headerText = document.createElement("button");
        var cardHeader = document.createElement("div");
        var cardBodyWrapper = document.createElement("div");
        var cardBody = document.createElement("div");
        $(headerText).text('Contenu masqué, cliquez pour afficher');
        $(headerText).addClass('btn btn-link btn-sm');
        $(headerText).attr('data-toggle', 'collapse');
        $(headerText).attr('data-target', '#collapse-' + index);
        $(headerText).attr('aria-controls', 'collapse-' + index);
        $(headerText).attr('aria-expanded', 'false');
        $(cardHeader).append(headerText);
        $(cardHeader).addClass('card-header');
        $(cardHeader).attr('id', 'spoiler-' + index);
        $(cardBody).html(content);
        $(cardBody).addClass('card-body');
        $(cardBodyWrapper).append(cardBody);
        $(cardBodyWrapper).addClass('collapse hide');
        $(cardBodyWrapper).attr('id', 'collapse-' + index)
        $(cardBodyWrapper).attr('aria-labelledby', 'spoiler-' + index)
        $(this).prepend(cardHeader);
        $(this).append(cardBodyWrapper);
    });

    $('.collapse').collapse({toggle: false});
}

function load_extra_ads() {
    // Load right side blocks
    var sidebar = $('#es-right-ad-block');
    var n_height = Math.floor(sidebar.height() / 2000);
    for (i = 0; i < n_height; i++) {
        var frag = document.createDocumentFragment();
        var newAdBlock = document.createElement("div");
        var block1 = document.createElement("ins");
        var block2 = document.createElement("script");

        block1.innerHTML = '<ins class="adsbygoogle" ' +
            'style="display:inline-block;width:120px;height:600px" ' +
            'data-ad-client="ca-pub-2080155902357792" ' +
            'data-ad-slot="4023722026"></ins>';
        block2.innerHTML = '(adsbygoogle = window.adsbygoogle || []).push({});';

        $(newAdBlock).append(block1);
        $(newAdBlock).append(block2);
        $(frag).append(newAdBlock);

        $(sidebar).append(frag);
    }

    // Load in feed blocks (above every h3)
    var frag = document.createDocumentFragment();
    var newAdBlock = document.createElement("div");
    var block1 = document.createElement("ins");
    var block2 = document.createElement("script");
    block1.innerHTML = '<ins class="adsbygoogle"' +
    'style = "display:inline-block;width:970px;height:90px"' +
    'data - ad - client="ca-pub-2080155902357792"' +
    'data - ad - slot="7100712740" ></ins >'
    block2.innerHTML = '(adsbygoogle = window.adsbygoogle || []).push({});';
    $(newAdBlock).append(block1);
    $(newAdBlock).append(block2);
    newAdBlock.className = 'my-3 text-center';
    $(frag).append(newAdBlock);
    var titles = $('.entry-content h3').slice(1);
    $(frag).insertBefore(titles);
}

$(document).ready(function () {

    create_side_summary();
    generate_spoilers();

    // when opening the sidebar
    $('#sidebarCollapse').on('click', function () {
        // open sidebar
        $('#es-side-summary').removeClass('d-none');
        $('#es-content').addClass('d-none');
        $('#sidebarCollapse').removeClass('sticky-top');
    });

    // if dismiss or overlay was clicked
    $('#es-side-summary').on('click', function () {
      // hide the sidebar
      $('#es-side-summary').addClass('d-none');
      $('#es-content').removeClass('d-none');
      $('#sidebarCollapse').addClass('sticky-top');
    });
});
</script>

<script id="dsq-count-scr" src="//eskimon-fr.disqus.com/count.js" async></script>
</body>

</html>
